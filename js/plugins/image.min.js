/*!
 * froala_editor v3.2.7 (https://www.froala.com/wysiwyg-editor)
 * License https://froala.com/wysiwyg-editor/terms/
 * Copyright 2014-2021 Froala Labs
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("froala-editor")):"function"==typeof define&&define.amd?define(["froala-editor"],t):t(e.FroalaEditor)}(this,function(_e){"use strict";function Me(e){return(Me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}_e=_e&&_e.hasOwnProperty("default")?_e["default"]:_e,Object.assign(_e.POPUP_TEMPLATES,{"image.insert":"[_BUTTONS_][_UPLOAD_LAYER_][_BY_URL_LAYER_][_PROGRESS_BAR_]","image.edit":"[_BUTTONS_]","image.alt":"[_BUTTONS_][_ALT_LAYER_]","image.size":"[_BUTTONS_][_SIZE_LAYER_]"}),Object.assign(_e.DEFAULTS,{imageInsertButtons:["imageBack","|","imageUpload","imageByURL"],imageEditButtons:["imageReplace","imageAlign","imageCaption","imageRemove","imageLink","linkOpen","linkEdit","linkRemove","-","imageDisplay","imageStyle","imageAlt","imageSize"],imageAltButtons:["imageBack","|"],imageSizeButtons:["imageBack","|"],imageUpload:!0,imageUploadURL:null,imageCORSProxy:"https://cors-anywhere.froala.com",imageUploadRemoteUrls:!0,imageUploadParam:"file",imageUploadParams:{},imageUploadToS3:!1,imageUploadToAzure:!1,imageUploadMethod:"POST",imageMaxSize:10485760,imageAllowedTypes:["jpeg","jpg","png","gif","webp"],imageResize:!0,imageResizeWithPercent:!1,imageRoundPercent:!1,imageDefaultWidth:300,imageDefaultAlign:"center",imageDefaultDisplay:"block",imageSplitHTML:!1,imageStyles:{"fr-rounded":"Rounded","fr-bordered":"Bordered","fr-shadow":"Shadow"},imageMove:!0,imageMultipleStyles:!0,imageTextNear:!0,imagePaste:!0,imagePasteProcess:!1,imageMinWidth:16,imageOutputSize:!1,imageDefaultMargin:5,imageAddNewLine:!1}),_e.PLUGINS.image=function(C){var S,l,p,f,s,a,E=C.$,R="https://i.froala.com/upload",t=!1,i=1,c=2,d=3,m=4,D=5,U=6,r={};function g(){var e=C.popups.get("image.insert").find(".fr-image-by-url-layer input");e.val(""),S&&e.val(S.attr("src")),e.trigger("change")}function n(){var e=C.popups.get("image.edit");if(e||(e=P()),e){var t=Ae();Ce()&&(t=t.find(".fr-img-wrap")),C.popups.setContainer("image.edit",C.$sc),C.popups.refresh("image.edit");var a=t.offset().left+t.outerWidth()/2,i=(function r(e){for(var t=0;e;){if("BODY"==e.tagName){var a=e.scrollTop||document.documentElement.scrollTop;t+=e.offsetTop-a+e.clientTop}else t+=e.offsetTop-e.scrollTop+e.clientTop;e=e.offsetParent}return{y:t}}(S[0]).y+t.outerHeight())/5;t.offset().top<0||!C.opts.height||C.helpers.isMobile()||C.opts.iframe?i=t.offset().top+t.outerHeight():Ce()&&C.opts.height&&(i=t.offset().top+t.outerHeight()/4),S.hasClass("fr-uploading")?I():C.popups.show("image.edit",a,i,t.outerHeight(),!0)}}function u(){z()}function o(e){0<e.parents(".fr-img-caption").length&&(e=e.parents(".fr-img-caption").first());var t=e.hasClass("fr-dib")?"block":e.hasClass("fr-dii")?"inline":null,a=e.hasClass("fr-fil")?"left":e.hasClass("fr-fir")?"right":he(e);ue(e,t,a),e.removeClass("fr-dib fr-dii fr-fir fr-fil")}function h(){for(var e,t="IMG"==C.el.tagName?[C.el]:C.el.querySelectorAll("img"),a=0;a<t.length;a++){var i=E(t[a]);!C.opts.htmlUntouched&&C.opts.useClasses?((C.opts.imageDefaultAlign||C.opts.imageDefaultDisplay)&&(0<(e=i).parents(".fr-img-caption").length&&(e=e.parents(".fr-img-caption").first()),e.hasClass("fr-dii")||e.hasClass("fr-dib")||(e.addClass("fr-fi".concat(he(e)[0])),e.addClass("fr-di".concat(ve(e)[0])),e.css("margin",""),e.css("float",""),e.css("display",""),e.css("z-index",""),e.css("position",""),e.css("overflow",""),e.css("vertical-align",""))),C.opts.imageTextNear||(0<i.parents(".fr-img-caption").length?i.parents(".fr-img-caption").first().removeClass("fr-dii").addClass("fr-dib"):i.removeClass("fr-dii").addClass("fr-dib"))):C.opts.htmlUntouched||C.opts.useClasses||(C.opts.imageDefaultAlign||C.opts.imageDefaultDisplay)&&o(i),C.opts.iframe&&i.on("load",C.size.syncIframe)}}function v(e){void 0===e&&(e=!0);var t,a=Array.prototype.slice.call(C.el.querySelectorAll("img")),i=[];for(t=0;t<a.length;t++)if(i.push(a[t].getAttribute("src")),E(a[t]).toggleClass("fr-draggable",C.opts.imageMove),""===a[t].getAttribute("class")&&a[t].removeAttribute("class"),""===a[t].getAttribute("style")&&a[t].removeAttribute("style"),a[t].parentNode&&a[t].parentNode.parentNode&&C.node.hasClass(a[t].parentNode.parentNode,"fr-img-caption")){var r=a[t].parentNode.parentNode;C.browser.mozilla||r.setAttribute("contenteditable",!1),r.setAttribute("draggable",!1),r.classList.add("fr-draggable");var n=a[t].nextSibling;n&&!C.browser.mozilla&&n.setAttribute("contenteditable",!0)}if(s)for(t=0;t<s.length;t++)i.indexOf(s[t].getAttribute("src"))<0&&C.events.trigger("image.removed",[E(s[t])]);if(s&&e){var o=[];for(t=0;t<s.length;t++)o.push(s[t].getAttribute("src"));for(t=0;t<a.length;t++)o.indexOf(a[t].getAttribute("src"))<0&&C.events.trigger("image.loaded",[E(a[t])])}s=a}function x(){if(l||function o(){var e;C.shared.$image_resizer?(l=C.shared.$image_resizer,f=C.shared.$img_overlay,C.events.on("destroy",function(){E("body").first().append(l.removeClass("fr-active"))},!0)):(C.shared.$image_resizer=E(document.createElement("div")).attr("class","fr-image-resizer"),l=C.shared.$image_resizer,C.events.$on(l,"mousedown",function(e){e.stopPropagation()},!0),C.opts.imageResize&&(l.append(b("nw")+b("ne")+b("sw")+b("se")),C.shared.$img_overlay=E(document.createElement("div")).attr("class","fr-image-overlay"),f=C.shared.$img_overlay,e=l.get(0).ownerDocument,E(e).find("body").first().append(f)));C.events.on("shared.destroy",function(){l.html("").removeData().remove(),l=null,C.opts.imageResize&&(f.remove(),f=null)},!0),C.helpers.isMobile()||C.events.$on(E(C.o_win),"resize",function(){S&&!S.hasClass("fr-uploading")?ge(!0):S&&(x(),be(),I(!1))});if(C.opts.imageResize){e=l.get(0).ownerDocument,C.events.$on(l,C._mousedown,".fr-handler",w),C.events.$on(E(e),C._mousemove,A),C.events.$on(E(e.defaultView||e.parentWindow),C._mouseup,T),C.events.$on(f,"mouseleave",T);var i=1,r=null,n=0;C.events.on("keydown",function(e){if(S){var t=-1!=navigator.userAgent.indexOf("Mac OS X")?e.metaKey:e.ctrlKey,a=e.which;(a!==r||200<e.timeStamp-n)&&(i=1),(a==_e.KEYCODE.EQUALS||C.browser.mozilla&&a==_e.KEYCODE.FF_EQUALS)&&t&&!e.altKey?i=ee.call(this,e,1,1,i):(a==_e.KEYCODE.HYPHEN||C.browser.mozilla&&a==_e.KEYCODE.FF_HYPHEN)&&t&&!e.altKey?i=ee.call(this,e,2,-1,i):C.keys.ctrlKey(e)||a!=_e.KEYCODE.ENTER||(S.before("<br>"),k(S)),r=a,n=e.timeStamp}},!0),C.events.on("keyup",function(){i=1})}}(),!S)return!1;var e=C.$wp||C.$sc;e.append(l),l.data("instance",C);var t=e.scrollTop()-("static"!=e.css("position")?e.offset().top:0),a=e.scrollLeft()-("static"!=e.css("position")?e.offset().left:0);a-=C.helpers.getPX(e.css("border-left-width")),t-=C.helpers.getPX(e.css("border-top-width")),C.$el.is("img")&&C.$sc.is("body")&&(a=t=0);var i=Ae();Ce()&&(i=i.find(".fr-img-wrap"));var r=0,n=0;C.opts.iframe&&(r=C.helpers.getPX(C.$wp.find(".fr-iframe").css("padding-top")),n=C.helpers.getPX(C.$wp.find(".fr-iframe").css("padding-left"))),l.css("top",(C.opts.iframe?i.offset().top+r:i.offset().top+t)-1).css("left",(C.opts.iframe?i.offset().left+n:i.offset().left+a)-1).css("width",i.get(0).getBoundingClientRect().width).css("height",i.get(0).getBoundingClientRect().height).addClass("fr-active")}function b(e){return'<div class="fr-handler fr-h'.concat(e,'"></div>')}function y(e){Ce()?S.parents(".fr-img-caption").css("width",e):S.css("width",e)}function w(e){if(!C.core.sameInstance(l))return!0;if(e.preventDefault(),e.stopPropagation(),C.$el.find("img.fr-error").left)return!1;C.undo.canDo()||C.undo.saveStep();var t=e.pageX||e.originalEvent.touches[0].pageX;if("mousedown"==e.type){var a=C.$oel.get(0).ownerDocument,i=a.defaultView||a.parentWindow,r=!1;try{r=i.location!=i.parent.location&&!(i.$&&i.$.FE)}catch(s){}r&&i.frameElement&&(t+=C.helpers.getPX(E(i.frameElement).offset().left)+i.frameElement.clientLeft)}(p=E(this)).data("start-x",t),p.data("start-width",S.width()),p.data("start-height",S.height());var n=S.width();if(C.opts.imageResizeWithPercent){var o=S.parentsUntil(C.$el,C.html.blockTagsQuery()).get(0)||C.el;n=(n/E(o).outerWidth()*100).toFixed(2)+"%"}y(n),f.show(),C.popups.hideAll(),me()}function A(e){if(!C.core.sameInstance(l))return!0;var t;if(p&&S){if(e.preventDefault(),C.$el.find("img.fr-error").left)return!1;var a=e.pageX||(e.originalEvent.touches?e.originalEvent.touches[0].pageX:null);if(!a)return!1;var i=a-p.data("start-x"),r=p.data("start-width");if((p.hasClass("fr-hnw")||p.hasClass("fr-hsw"))&&(i=0-i),C.opts.imageResizeWithPercent){var n=S.parentsUntil(C.$el,C.html.blockTagsQuery()).get(0)||C.el;r=((r+i)/E(n).outerWidth()*100).toFixed(2),C.opts.imageRoundPercent&&(r=Math.round(r)),y("".concat(r,"%")),(t=Ce()?(C.helpers.getPX(S.parents(".fr-img-caption").css("width"))/E(n).outerWidth()*100).toFixed(2):(C.helpers.getPX(S.css("width"))/E(n).outerWidth()*100).toFixed(2))===r||C.opts.imageRoundPercent||y("".concat(t,"%")),S.css("height","").removeAttr("height")}else r+i>=C.opts.imageMinWidth&&(y(r+i),t=Ce()?C.helpers.getPX(S.parents(".fr-img-caption").css("width")):C.helpers.getPX(S.css("width"))),t!==r+i&&y(t),((S.attr("style")||"").match(/(^height:)|(; *height:)/)||S.attr("height"))&&(S.css("height",p.data("start-height")*S.width()/p.data("start-width")),S.removeAttr("height"));x(),C.events.trigger("image.resize",[we()])}}function T(e){if(!C.core.sameInstance(l))return!0;if(p&&S){if(e&&e.stopPropagation(),C.$el.find("img.fr-error").left)return!1;p=null,f.hide(),x(),n(),C.undo.saveStep(),C.events.trigger("image.resizeEnd",[we()])}else l.removeClass("fr-active")}function $(e,t,a){C.edit.on(),S&&S.addClass("fr-error"),r[e]?B(C.language.translate(r[e])):B(C.language.translate("Something went wrong. Please try again.")),!S&&a&&te(a),C.events.trigger("image.error",[{code:e,message:r[e]},t,a])}function P(e){if(e)return C.$wp&&C.events.$on(C.$wp,"scroll.image-edit",function(){S&&C.popups.isVisible("image.edit")&&(C.events.disableBlur(),n())}),!0;var t="";if(0<C.opts.imageEditButtons.length){var a={buttons:t+='<div class="fr-buttons"> \n        '.concat(C.button.buildList(C.opts.imageEditButtons),"\n        </div>")};return C.popups.create("image.edit",a)}return!1}function I(e){var t=C.popups.get("image.insert");if(t||(t=V()),t.find(".fr-layer.fr-active").removeClass("fr-active").addClass("fr-pactive"),t.find(".fr-image-progress-bar-layer").addClass("fr-active"),t.find(".fr-buttons").hide(),S){var a=Ae();C.popups.setContainer("image.insert",C.$sc);var i=a.offset().left,r=a.offset().top+a.height();C.popups.show("image.insert",i,r,a.outerHeight())}void 0===e&&O(C.language.translate("Uploading"),0)}function z(e){var t=C.popups.get("image.insert");if(t&&(t.find(".fr-layer.fr-pactive").addClass("fr-active").removeClass("fr-pactive"),t.find(".fr-image-progress-bar-layer").removeClass("fr-active"),t.find(".fr-buttons").show(),e||C.$el.find("img.fr-error").length)){if(C.events.focus(),C.$el.find("img.fr-error").length&&(C.$el.find("img.fr-error").remove(),C.undo.saveStep(),C.undo.run(),C.undo.dropRedo()),!C.$wp&&S){var a=S;ge(!0),C.selection.setAfter(a.get(0)),C.selection.restore()}C.popups.hide("image.insert")}}function O(e,t){var a=C.popups.get("image.insert");if(a){var i=a.find(".fr-image-progress-bar-layer");i.find("h3").text(e+(t?" ".concat(t,"%"):"")),i.removeClass("fr-error"),t?(i.find("div").removeClass("fr-indeterminate"),i.find("div > span").css("width","".concat(t,"%"))):i.find("div").addClass("fr-indeterminate")}}function B(e){I();var t=C.popups.get("image.insert").find(".fr-image-progress-bar-layer");t.addClass("fr-error");var a=t.find("h3");a.text(e),C.events.disableBlur(),a.focus()}function k(e){fe.call(e.get(0))}function N(){var e=E(this);C.popups.hide("image.insert"),e.removeClass("fr-uploading"),e.next().is("br")&&e.next().remove(),k(e),C.events.trigger("image.loaded",[e])}function L(o,e,s,l,p){l&&"string"==typeof l&&(l=C.$(l)),C.edit.off(),O(C.language.translate("Loading image")),e&&(o=C.helpers.sanitizeURL(o));var t=new Image;t.onload=function(){var e,t;if(l){C.undo.canDo()||l.hasClass("fr-uploading")||C.undo.saveStep();var a=l.data("fr-old-src");l.data("fr-image-pasted")&&(a=null),C.$wp?((e=l.clone().removeData("fr-old-src").removeClass("fr-uploading").removeAttr("data-fr-image-pasted")).off("load"),a&&l.attr("src",a),l.replaceWith(e)):e=l;for(var i=e.get(0).attributes,r=0;r<i.length;r++){var n=i[r];0===n.nodeName.indexOf("data-")?e.removeAttr(n.nodeName):s&&s.hasOwnProperty(n.nodeName)&&e.removeAttr(n.nodeName)}if(void 0!==s)for(t in s)s.hasOwnProperty(t)&&"link"!=t&&e.attr("".concat(t),s[t]);e.on("load",N),e.attr("src",o),C.edit.on(),v(!1),C.undo.saveStep(),C.events.disableBlur(),C.$el.blur(),C.events.trigger(a?"image.replaced":"image.inserted",[e,p])}else e=Y(o,s,N),v(!1),C.undo.saveStep(),C.events.disableBlur(),C.$el.blur(),C.events.trigger("image.inserted",[e,p])},t.onerror=function(){$(i)},I(C.language.translate("Loading image")),t.src=o}function _(e,t,a){O(C.language.translate("Loading image"));var i=this.status,r=this.response,n=this.responseXML,o=this.responseText;try{if(C.opts.imageUploadToS3||C.opts.imageUploadToAzure)if(201==i){var s;if(C.opts.imageUploadToAzure){if(!1===C.events.trigger("image.uploadedToAzure",[this.responseURL,a,r],!0))return C.edit.on(),!1;s=t}else s=function p(e){try{var t=E(e).find("Location").text(),a=E(e).find("Key").text();return!1===C.events.trigger("image.uploadedToS3",[t,a,e],!0)?(C.edit.on(),!1):t}catch(i){return $(m,e),!1}}(n);s&&L(s,!1,[],e,r||n)}else $(m,r||n,e);else if(200<=i&&i<300){var l=function f(e){try{if(!1===C.events.trigger("image.uploaded",[e],!0))return C.edit.on(),!1;var t=JSON.parse(e);return t.link?t:($(c,e),!1)}catch(a){return $(m,e),!1}}(o);l&&L(l.link,!1,l,e,r||o)}else $(d,r||o,e)}catch(g){$(m,r||o,e)}}function M(){$(m,this.response||this.responseText||this.responseXML)}function K(e){if(e.lengthComputable){var t=e.loaded/e.total*100|0;O(C.language.translate("Uploading"),t)}}function Y(e,t,a){var i,r=E(document.createElement("img")).attr("src",e);if(t&&void 0!==t)for(i in t)t.hasOwnProperty(i)&&"link"!=i&&(" data-".concat(i,'="').concat(t[i],'"'),r.attr("".concat(i),t[i]));var n=C.opts.imageDefaultWidth;n&&"auto"!=n&&(n=C.opts.imageResizeWithPercent?"100%":"".concat(n,"px")),r.attr("style",n?"width: ".concat(n,";"):""),ue(r,C.opts.imageDefaultDisplay,C.opts.imageDefaultAlign),r.on("load",a),r.on("error",a),C.edit.on(),C.events.focus(!0),C.selection.restore(),C.undo.saveStep(),C.opts.imageSplitHTML?C.markers.split():C.markers.insert(),C.html.wrap();var o=C.$el.find(".fr-marker");return o.length?(o.parent().is("hr")&&o.parent().after(o),C.node.isLastSibling(o)&&o.parent().hasClass("fr-deletable")&&o.insertAfter(o.parent()),o.replaceWith(r)):C.$el.append(r),C.selection.clear(),r}function H(){C.edit.on(),z(!0)}function W(e,t){if(void 0!==e&&0<e.length){if(e&&"image/svg+xml"==e[0].type){var a=new FileReader;a.onload=function(e){var t=e.target.result;C.image.insert(t,null,null,C.image.get())},a.readAsDataURL(e[0])}if(!1===C.events.trigger("image.beforeUpload",[e,t]))return!1;var i,r=e[0];if(!(null!==C.opts.imageUploadURL&&C.opts.imageUploadURL!=R||C.opts.imageUploadToS3||C.opts.imageUploadToAzure))return function w(r,n){var o=new FileReader;o.onload=function(){var e=o.result;if(o.result.indexOf("svg+xml")<0){for(var t=atob(o.result.split(",")[1]),a=[],i=0;i<t.length;i++)a.push(t.charCodeAt(i));e=window.URL.createObjectURL(new Blob([new Uint8Array(a)],{type:r.type})),n&&n.data("fr-old-src",n.attr("src")),C.image.insert(e,!1,null,n)}},I(),o.readAsDataURL(r)}(r,t||S),!1;if(r.name||(r.name=(new Date).getTime()+"."+(r.type||"image/jpeg").replace(/image\//g,"")),r.size>C.opts.imageMaxSize)return $(D),!1;if(C.opts.imageAllowedTypes.indexOf(r.type.replace(/image\//g,""))<0)return $(U),!1;if(C.drag_support.formdata&&(i=C.drag_support.formdata?new FormData:null),i){var n;if(!1!==C.opts.imageUploadToS3)for(n in i.append("key",C.opts.imageUploadToS3.keyStart+(new Date).getTime()+"-"+(r.name||"untitled")),i.append("success_action_status","201"),i.append("X-Requested-With","xhr"),i.append("Content-Type",r.type),C.opts.imageUploadToS3.params)C.opts.imageUploadToS3.params.hasOwnProperty(n)&&i.append(n,C.opts.imageUploadToS3.params[n]);for(n in C.opts.imageUploadParams)C.opts.imageUploadParams.hasOwnProperty(n)&&i.append(n,C.opts.imageUploadParams[n]);i.append(C.opts.imageUploadParam,r,r.name);var o,s,l=C.opts.imageUploadURL,p=C.opts.imageUploadMethod;C.opts.imageUploadToS3&&(l=C.opts.imageUploadToS3.uploadURL?C.opts.imageUploadToS3.uploadURL:"https://".concat(C.opts.imageUploadToS3.region,".amazonaws.com/").concat(C.opts.imageUploadToS3.bucket)),C.opts.imageUploadToAzure&&(o=l=C.opts.imageUploadToAzure.uploadURL?"".concat(C.opts.imageUploadToAzure.uploadURL,"/").concat(r.name):encodeURI("https://".concat(C.opts.imageUploadToAzure.account,".blob.core.windows.net/").concat(C.opts.imageUploadToAzure.container,"/").concat(r.name)),C.opts.imageUploadToAzure.SASToken&&(l+=C.opts.imageUploadToAzure.SASToken),p="PUT");var f=C.core.getXHR(l,p);if(C.opts.imageUploadToAzure){var g=(new Date).toUTCString();if(!C.opts.imageUploadToAzure.SASToken&&C.opts.imageUploadToAzure.accessKey){var c=C.opts.imageUploadToAzure.account,d=C.opts.imageUploadToAzure.container;if(C.opts.imageUploadToAzure.uploadURL){var m=C.opts.imageUploadToAzure.uploadURL.split("/");d=m.pop(),c=m.pop().split(".")[0]}var u="x-ms-blob-type:BlockBlob\nx-ms-date:".concat(g,"\nx-ms-version:2019-07-07"),h=encodeURI("/"+c+"/"+d+"/"+r.name),v=p+"\n\n\n"+r.size+"\n\n"+r.type+"\n\n\n\n\n\n\n"+u+"\n"+h,b=C.cryptoJSPlugin.cryptoJS.HmacSHA256(v,C.cryptoJSPlugin.cryptoJS.enc.Base64.parse(C.opts.imageUploadToAzure.accessKey)).toString(C.cryptoJSPlugin.cryptoJS.enc.Base64),y="SharedKey "+c+":"+b;s=b,f.setRequestHeader("Authorization",y)}for(n in f.setRequestHeader("x-ms-version","2019-07-07"),f.setRequestHeader("x-ms-date",g),f.setRequestHeader("Content-Type",r.type),f.setRequestHeader("x-ms-blob-type","BlockBlob"),C.opts.imageUploadParams)C.opts.imageUploadParams.hasOwnProperty(n)&&f.setRequestHeader(n,C.opts.imageUploadParams[n]);for(n in C.opts.imageUploadToAzure.params)C.opts.imageUploadToAzure.params.hasOwnProperty(n)&&f.setRequestHeader(n,C.opts.imageUploadToAzure.params[n])}!function A(t,a,i,r,n,o){function s(){var e=E(this);e.off("load"),e.addClass("fr-uploading"),e.next().is("br")&&e.next().remove(),C.placeholder.refresh(),k(e),x(),I(),C.edit.off(),t.onload=function(){_.call(t,e,n,o)},t.onerror=M,t.upload.onprogress=K,t.onabort=H,E(e.off("abortUpload")).on("abortUpload",function(){4!=t.readyState&&(t.abort(),r?(r.attr("src",r.data("fr-old-src")),r.removeClass("fr-uploading")):e.remove(),ge(!0))}),t.send(C.opts.imageUploadToAzure?i:a)}var l=new FileReader;l.onload=function(){var e=l.result;if(l.result.indexOf("svg+xml")<0){for(var t=atob(l.result.split(",")[1]),a=[],i=0;i<t.length;i++)a.push(t.charCodeAt(i));e=window.URL.createObjectURL(new Blob([new Uint8Array(a)],{type:"image/jpeg"}))}r?(r.on("load",s),r.on("error",function(){s(),E(this).off("error")}),C.edit.on(),C.undo.saveStep(),r.data("fr-old-src",r.attr("src")),r.attr("src",e)):Y(e,null,s)},l.readAsDataURL(i)}(f,i,r,t||S,o,s)}}}function G(e){if(e.is("img")&&0<e.parents(".fr-img-caption").length)return e.parents(".fr-img-caption")}function F(e){var t=e.originalEvent.dataTransfer;if(t&&t.files&&t.files.length){var a=t.files[0];if(a&&a.type&&-1!==a.type.indexOf("image")&&0<=C.opts.imageAllowedTypes.indexOf(a.type.replace(/image\//g,""))){if(!C.opts.imageUpload)return e.preventDefault(),e.stopPropagation(),!1;C.markers.remove(),C.markers.insertAtPoint(e.originalEvent),C.$el.find(".fr-marker").replaceWith(_e.MARKERS),0===C.$el.find(".fr-marker").length&&C.selection.setAtEnd(C.el),C.popups.hideAll();var i=C.popups.get("image.insert");i||(i=V()),C.popups.setContainer("image.insert",C.$sc);var r=e.originalEvent.pageX,n=e.originalEvent.pageY;if(C.opts.iframe){var o=C.helpers.getPX(C.$wp.find(".fr-iframe").css("padding-top")),s=C.helpers.getPX(C.$wp.find(".fr-iframe").css("padding-left"));n+=C.$iframe.offset().top+o,r+=C.$iframe.offset().left+s}return C.popups.show("image.insert",r,n),I(),0<=C.opts.imageAllowedTypes.indexOf(a.type.replace(/image\//g,""))?(ge(!0),W(t.files)):$(U),e.preventDefault(),e.stopPropagation(),!1}}}function V(e){if(e)return C.popups.onRefresh("image.insert",g),C.popups.onHide("image.insert",u),!0;var t,a,i="";C.opts.imageUpload||-1===C.opts.imageInsertButtons.indexOf("imageUpload")||C.opts.imageInsertButtons.splice(C.opts.imageInsertButtons.indexOf("imageUpload"),1);var r=C.button.buildList(C.opts.imageInsertButtons);""!==r&&(i='<div class="fr-buttons fr-tabs">'.concat(r,"</div>"));var n=C.opts.imageInsertButtons.indexOf("imageUpload"),o=C.opts.imageInsertButtons.indexOf("imageByURL"),s="";0<=n&&(t=" fr-active",0<=o&&o<n&&(t=""),s='<div class="fr-image-upload-layer'.concat(t,' fr-layer" id="fr-image-upload-layer-').concat(C.id,'"><strong>').concat(C.language.translate("Drop image"),"</strong><br>(").concat(C.language.translate("or click"),')<div class="fr-form"><input type="file" accept="image/').concat(C.opts.imageAllowedTypes.join(", image/").toLowerCase(),'" tabIndex="-1" aria-labelledby="fr-image-upload-layer-').concat(C.id,'" role="button"></div></div>'));var l="";0<=o&&(t=" fr-active",0<=n&&n<o&&(t=""),l='<div class="fr-image-by-url-layer'.concat(t,' fr-layer" id="fr-image-by-url-layer-').concat(C.id,'"><div class="fr-input-line"><input id="fr-image-by-url-layer-text-').concat(C.id,'" type="text" placeholder="http://" tabIndex="1" aria-required="true"></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="imageInsertByURL" tabIndex="2" role="button">').concat(C.language.translate("Insert"),"</button></div></div>"));var p={buttons:i,upload_layer:s,by_url_layer:l,progress_bar:'<div class="fr-image-progress-bar-layer fr-layer"><h3 tabIndex="-1" class="fr-message">Uploading</h3><div class="fr-loader"><span class="fr-progress"></span></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-dismiss" data-cmd="imageDismissError" tabIndex="2" role="button">OK</button></div></div>'};return 1<=C.opts.imageInsertButtons.length&&(a=C.popups.create("image.insert",p)),C.$wp&&C.events.$on(C.$wp,"scroll",function(){S&&C.popups.isVisible("image.insert")&&be()}),function f(i){C.events.$on(i,"dragover dragenter",".fr-image-upload-layer",function(e){return E(this).addClass("fr-drop"),(C.browser.msie||C.browser.edge)&&e.preventDefault(),!1},!0),C.events.$on(i,"dragleave dragend",".fr-image-upload-layer",function(e){return E(this).removeClass("fr-drop"),(C.browser.msie||C.browser.edge)&&e.preventDefault(),!1},!0),C.events.$on(i,"drop",".fr-image-upload-layer",function(e){e.preventDefault(),e.stopPropagation(),E(this).removeClass("fr-drop");var t=e.originalEvent.dataTransfer;if(t&&t.files){var a=i.data("instance")||C;a.events.disableBlur(),a.image.upload(t.files),a.events.enableBlur()}},!0),C.helpers.isIOS()&&C.events.$on(i,"touchstart",'.fr-image-upload-layer input[type="file"]',function(){E(this).trigger("click")},!0),C.events.$on(i,"change",'.fr-image-upload-layer input[type="file"]',function(){if(this.files){var e=i.data("instance")||C;e.events.disableBlur(),i.find("input:focus").blur(),e.events.enableBlur(),e.image.upload(this.files,S)}E(this).val("")},!0)}(a),a}function X(){S&&C.popups.get("image.alt").find("input").val(S.attr("alt")||"").trigger("change")}function q(){var e=C.popups.get("image.alt");e||(e=j()),z(),C.popups.refresh("image.alt"),C.popups.setContainer("image.alt",C.$sc);var t=Ae();Ce()&&(t=t.find(".fr-img-wrap"));var a=t.offset().left+t.outerWidth()/2,i=t.offset().top+t.outerHeight();C.popups.show("image.alt",a,i,t.outerHeight(),!0)}function j(e){if(e)return C.popups.onRefresh("image.alt",X),!0;var t={buttons:'<div class="fr-buttons fr-tabs">'.concat(C.button.buildList(C.opts.imageAltButtons),"</div>"),alt_layer:'<div class="fr-image-alt-layer fr-layer fr-active" id="fr-image-alt-layer-'.concat(C.id,'"><div class="fr-input-line"><input id="fr-image-alt-layer-text-').concat(C.id,'" type="text" placeholder="').concat(C.language.translate("Alternative Text"),'" tabIndex="1"></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="imageSetAlt" tabIndex="2" role="button">').concat(C.language.translate("Update"),"</button></div></div>")},a=C.popups.create("image.alt",t);return C.$wp&&C.events.$on(C.$wp,"scroll.image-alt",function(){S&&C.popups.isVisible("image.alt")&&q()}),a}function J(){var e=C.popups.get("image.size"),t=S.get(0).style.height?S.get(0).style.height:"auto",a=S.get(0).style.width?S.get(0).style.width:"auto";if(S)if(Ce()){var i=S.parent();i.get(0).style.width||(i=S.parent().parent()),e.find('input[name="width"]').val(a).trigger("change"),e.find('input[name="height"]').val(t).trigger("change")}else e.find('input[name="width"]').val(a).trigger("change"),e.find('input[name="height"]').val(t).trigger("change")}function Q(){var e=C.popups.get("image.size");e||(e=Z()),z(),C.popups.refresh("image.size"),C.popups.setContainer("image.size",C.$sc);var t=Ae();Ce()&&(t=t.find(".fr-img-wrap"));var a=t.offset().left+t.outerWidth()/2,i=t.offset().top+t.outerHeight();C.popups.show("image.size",a,i,t.outerHeight(),!0)}function Z(e){if(e)return C.popups.onRefresh("image.size",J),!0;var t={buttons:'<div class="fr-buttons fr-tabs">'.concat(C.button.buildList(C.opts.imageSizeButtons),"</div>"),size_layer:'<div class="fr-image-size-layer fr-layer fr-active" id="fr-image-size-layer-'.concat(C.id,'"><div class="fr-image-group"><div class="fr-input-line"><input id="fr-image-size-layer-width-\'').concat(C.id,'" type="text" name="width" placeholder="').concat(C.language.translate("Width"),'" tabIndex="1"></div><div class="fr-input-line"><input id="fr-image-size-layer-height').concat(C.id,'" type="text" name="height" placeholder="').concat(C.language.translate("Height"),'" tabIndex="1"></div></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="imageSetSize" tabIndex="2" role="button">').concat(C.language.translate("Update"),"</button></div></div>")},a=C.popups.create("image.size",t);return C.$wp&&C.events.$on(C.$wp,"scroll.image-size",function(){S&&C.popups.isVisible("image.size")&&Q()}),a}function ee(e,t,a,i){return e.pageX=t,w.call(this,e),e.pageX=e.pageX+a*Math.floor(Math.pow(1.1,i)),A.call(this,e),T.call(this,e),++i}function te(e){(e=e||Ae())&&!1!==C.events.trigger("image.beforeRemove",[e])&&(C.popups.hideAll(),ye(),ge(!0),C.undo.canDo()||C.undo.saveStep(),e.get(0)==C.el?e.removeAttr("src"):(e.get(0).parentNode&&"A"==e.get(0).parentNode.tagName?(C.selection.setBefore(e.get(0).parentNode)||C.selection.setAfter(e.get(0).parentNode)||e.parent().after(_e.MARKERS),E(e.get(0).parentNode).remove()):(C.selection.setBefore(e.get(0))||C.selection.setAfter(e.get(0))||e.after(_e.MARKERS),e.remove()),C.html.fillEmptyBlocks(),C.selection.restore()),C.undo.saveStep())}function ae(e){var t=e.which;if(S&&(t==_e.KEYCODE.BACKSPACE||t==_e.KEYCODE.DELETE))return e.preventDefault(),e.stopPropagation(),te(),!1;if(S&&t==_e.KEYCODE.ESC){var a=S;return ge(!0),C.selection.setAfter(a.get(0)),C.selection.restore(),e.preventDefault(),!1}if(!S||t!=_e.KEYCODE.ARROW_LEFT&&t!=_e.KEYCODE.ARROW_RIGHT)return S&&t===_e.KEYCODE.TAB?(e.preventDefault(),e.stopPropagation(),ge(!0),!1):S&&t!=_e.KEYCODE.F10&&!C.keys.isBrowserAction(e)?(e.preventDefault(),e.stopPropagation(),!1):void 0;var i=S.get(0);return ge(!0),t==_e.KEYCODE.ARROW_LEFT?C.selection.setBefore(i):C.selection.setAfter(i),C.selection.restore(),e.preventDefault(),!1}function ie(e){if(e&&"IMG"==e.tagName){if(C.node.hasClass(e,"fr-uploading")||C.node.hasClass(e,"fr-error")?e.parentNode.removeChild(e):C.node.hasClass(e,"fr-draggable")&&e.classList.remove("fr-draggable"),e.parentNode&&e.parentNode.parentNode&&C.node.hasClass(e.parentNode.parentNode,"fr-img-caption")){var t=e.parentNode.parentNode;t.removeAttribute("contenteditable"),t.removeAttribute("draggable"),t.classList.remove("fr-draggable");var a=e.nextSibling;a&&a.removeAttribute("contenteditable")}}else if(e&&e.nodeType==Node.ELEMENT_NODE)for(var i=e.querySelectorAll("img.fr-uploading, img.fr-error, img.fr-draggable"),r=0;r<i.length;r++)ie(i[r])}function re(e){if(!1===C.events.trigger("image.beforePasteUpload",[e]))return!1;S=E(e),x(),n(),be(),I(),S.on("load",function(){var t=[];x(),E(C.popups.get("image.insert").get(0)).find("div.fr-active.fr-error").length<1&&I(),E(this).data("events").filter(function(e){"load"===e[0]&&t.push(e)}),t.length<=1&&E(this).off("load")});for(var t=E(e).attr("src").split(","),a=atob(t[1]),i=[],r=0;r<a.length;r++)i.push(a.charCodeAt(r));W([new Blob([new Uint8Array(i)],{type:t[0].replace(/data\:/g,"").replace(/;base64/g,"")})],S)}function ne(){C.opts.imagePaste?C.$el.find("img[data-fr-image-pasted]").each(function(e,i){if(C.opts.imagePasteProcess){var t=C.opts.imageDefaultWidth;t&&"auto"!=t&&(t+=C.opts.imageResizeWithPercent?"%":"px"),E(i).css("width",t).removeClass("fr-dii fr-dib fr-fir fr-fil"),ue(E(i),C.opts.imageDefaultDisplay,C.opts.imageDefaultAlign)}if(0===i.src.indexOf("data:"))re(i);else if(0===i.src.indexOf("blob:")||0===i.src.indexOf("http")&&C.opts.imageUploadRemoteUrls&&C.opts.imageCORSProxy){var a=new Image;a.crossOrigin="Anonymous",a.onload=function(){var e,t=C.o_doc.createElement("CANVAS"),a=t.getContext("2d");t.height=this.naturalHeight,t.width=this.naturalWidth,a.drawImage(this,0,0),setTimeout(function(){re(i)},0),e=2e3<this.naturalWidth||1500<this.naturalHeight?"jpeg":"png",i.src=t.toDataURL("image/".concat(e))},a.src=(0===i.src.indexOf("blob:")?"":"".concat(C.opts.imageCORSProxy,"/"))+i.src}else 0!==i.src.indexOf("http")||0===i.src.indexOf("https://mail.google.com/mail")?(C.selection.save(),E(i).remove(),C.selection.restore()):E(i).removeAttr("data-fr-image-pasted")}):C.$el.find("img[data-fr-image-pasted]").remove()}function oe(e){var t=e.target.result,a=C.opts.imageDefaultWidth;a&&"auto"!=a&&(a+=C.opts.imageResizeWithPercent?"%":"px"),C.undo.saveStep(),C.html.insert('<img data-fr-image-pasted="true" src="'.concat(t,'"').concat(a?' style="width: '.concat(a,';"'):"",">"));var i=C.$el.find('img[data-fr-image-pasted="true"]');i&&ue(i,C.opts.imageDefaultDisplay,C.opts.imageDefaultAlign),C.events.trigger("paste.after")}function se(e,t){var a=new FileReader;a.onload=function i(e){var t=C.opts.imageDefaultWidth;t&&"auto"!=t&&(t+=C.opts.imageResizeWithPercent?"%":"px"),C.html.insert('<img data-fr-image-pasted="true" src="'.concat(e,'"').concat(t?' style="width: '.concat(t,';"'):"",">"));var a=C.$el.find('img[data-fr-image-pasted="true"]');a&&ue(a,C.opts.imageDefaultDisplay,C.opts.imageDefaultAlign),C.events.trigger("paste.after")}(t),a.readAsDataURL(e,t)}function le(e){if(e&&e.clipboardData&&e.clipboardData.items){var t=(e.clipboardData||window.clipboardData).getData("text/html")||"",a=(new DOMParser).parseFromString(t,"text/html").querySelector("img");if(a){if(!a)return!1;var i=a.src,r=null;if(e.clipboardData.types&&-1!=[].indexOf.call(e.clipboardData.types,"text/rtf")||e.clipboardData.getData("text/rtf"))r=e.clipboardData.items[0].getAsFile();else for(var n=0;n<e.clipboardData.items.length&&!(r=e.clipboardData.items[n].getAsFile());n++);if(r)return se(r,i),!1}else{var o=null;if(e.clipboardData.types&&-1!=[].indexOf.call(e.clipboardData.types,"text/rtf")||e.clipboardData.getData("text/rtf"))o=e.clipboardData.items[0].getAsFile();else for(var s=0;s<e.clipboardData.items.length&&!(o=e.clipboardData.items[s].getAsFile());s++);if(o)return function l(e){var t=new FileReader;t.onload=oe,t.readAsDataURL(e)}(o),!1}}}function pe(e){return e=e.replace(/<img /gi,'<img data-fr-image-pasted="true" ')}function fe(e){if("false"==E(this).parents("[contenteditable]").not(".fr-element").not(".fr-img-caption").not("body").first().attr("contenteditable"))return!0;if(e&&"touchend"==e.type&&a)return!0;if(e&&C.edit.isDisabled())return e.stopPropagation(),e.preventDefault(),!1;for(var t=0;t<_e.INSTANCES.length;t++)_e.INSTANCES[t]!=C&&_e.INSTANCES[t].events.trigger("image.hideResizer");C.toolbar.disable(),e&&(e.stopPropagation(),e.preventDefault()),C.helpers.isMobile()&&(C.events.disableBlur(),C.$el.blur(),C.events.enableBlur()),C.opts.iframe&&C.size.syncIframe(),S=E(this),ye(),x(),n(),C.browser.msie?(C.popups.areVisible()&&C.events.disableBlur(),C.win.getSelection&&(C.win.getSelection().removeAllRanges(),C.win.getSelection().addRange(C.doc.createRange()))):C.selection.clear(),C.helpers.isIOS()&&(C.events.disableBlur(),C.$el.blur()),C.button.bulkRefresh(),C.events.trigger("video.hideResizer")}function ge(e){S&&(function t(){return ce}()||!0===e)&&(C.toolbar.enable(),l.removeClass("fr-active"),C.popups.hideAll(),S=null,me(),p=null,f&&f.hide())}r[i]="Image cannot be loaded from the passed link.",r[c]="No link in upload response.",r[d]="Error during file upload.",r[m]="Parsing response failed.",r[D]="File is too large.",r[U]="Image file type is invalid.",r[7]="Files can be uploaded only to same domain in IE 8 and IE 9.";var ce=!(r[8]="Image file is corrupted.");function de(){ce=!0}function me(){ce=!1}function ue(e,t,a){!C.opts.htmlUntouched&&C.opts.useClasses?(e.removeClass("fr-fil fr-fir fr-dib fr-dii"),a&&e.addClass("fr-fi".concat(a[0])),t&&e.addClass("fr-di".concat(t[0]))):"inline"==t?(e.css({display:"inline-block",verticalAlign:"bottom",margin:C.opts.imageDefaultMargin}),"center"==a?e.css({"float":"none",marginBottom:"",marginTop:"",maxWidth:"calc(100% - ".concat(2*C.opts.imageDefaultMargin,"px)"),textAlign:"center"}):"left"==a?e.css({"float":"left",marginLeft:0,maxWidth:"calc(100% - ".concat(C.opts.imageDefaultMargin,"px)"),textAlign:"left"}):e.css({"float":"right",marginRight:0,maxWidth:"calc(100% - ".concat(C.opts.imageDefaultMargin,"px)"),textAlign:"right"})):"block"==t&&(e.css({display:"block","float":"none",verticalAlign:"top",margin:"".concat(C.opts.imageDefaultMargin,"px auto"),textAlign:"center"}),"left"==a?e.css({marginLeft:0,textAlign:"left"}):"right"==a&&e.css({marginRight:0,textAlign:"right"}))}function he(e){if(void 0===e&&(e=Ae()),e){if(e.hasClass("fr-fil"))return"left";if(e.hasClass("fr-fir"))return"right";if(e.hasClass("fr-dib")||e.hasClass("fr-dii"))return"center";var t=e.css("float");if(e.css("float","none"),"block"==e.css("display")){if(e.css("float",""),e.css("float")!=t&&e.css("float",t),0===parseInt(e.css("margin-left"),10))return"left";if(0===parseInt(e.css("margin-right"),10))return"right"}else{if(e.css("float",""),e.css("float")!=t&&e.css("float",t),"left"==e.css("float"))return"left";if("right"==e.css("float"))return"right"}}return"center"}function ve(e){void 0===e&&(e=Ae());var t=e.css("float");return e.css("float","none"),"block"==e.css("display")?(e.css("float",""),e.css("float")!=t&&e.css("float",t),"block"):(e.css("float",""),e.css("float")!=t&&e.css("float",t),"inline")}function be(){var e=C.popups.get("image.insert");e||(e=V()),C.popups.isVisible("image.insert")||(z(),C.popups.refresh("image.insert"),C.popups.setContainer("image.insert",C.$sc));var t=Ae();Ce()&&(t=t.find(".fr-img-wrap"));var a=t.offset().left+t.outerWidth()/2,i=t.offset().top+t.outerHeight();C.popups.show("image.insert",a,i,t.outerHeight(!0),!0)}function ye(){if(S){C.events.disableBlur(),C.selection.clear();var e=C.doc.createRange();e.selectNode(S.get(0)),C.browser.msie&&e.collapse(!0),C.selection.get().addRange(e),C.events.enableBlur()}}function we(){return S}function Ae(){return Ce()?S.parents(".fr-img-caption").first():S}function Ce(){return!!S&&0<S.parents(".fr-img-caption").length}function Se(e){for(var t=document.createDocumentFragment();e.firstChild;){var a=e.removeChild(e.firstChild);t.appendChild(a)}e.parentNode.replaceChild(t,e)}return{_init:function Ee(){var i;(function e(){C.events.$on(C.$el,C._mousedown,"IMG"==C.el.tagName?null:'img:not([contenteditable="false"])',function(e){if("false"==E(this).parents("contenteditable").not(".fr-element").not(".fr-img-caption").not("body").first().attr("contenteditable"))return!0;C.helpers.isMobile()||C.selection.clear(),t=!0,C.popups.areVisible()&&C.events.disableBlur(),C.browser.msie&&(C.events.disableBlur(),C.$el.attr("contenteditable",!1)),C.draggable||"touchstart"==e.type||e.preventDefault(),e.stopPropagation()}),C.events.$on(C.$el,C._mousedown,".fr-img-caption .fr-inner",function(e){C.core.hasFocus()||C.events.focus(),e.stopPropagation()}),C.events.$on(C.$el,"paste",".fr-img-caption .fr-inner",function(e){!0===C.opts.toolbarInline&&(C.toolbar.hide(),e.stopPropagation())}),C.events.$on(C.$el,C._mouseup,"IMG"==C.el.tagName?null:'img:not([contenteditable="false"])',function(e){if("false"==E(this).parents("contenteditable").not(".fr-element").not(".fr-img-caption").not("body").first().attr("contenteditable"))return!0;t&&(t=!1,e.stopPropagation(),C.browser.msie&&(C.$el.attr("contenteditable",!0),C.events.enableBlur()))}),C.events.on("keyup",function(e){if(e.shiftKey&&""===C.selection.text().replace(/\n/g,"")&&C.keys.isArrow(e.which)){var t=C.selection.element(),a=C.selection.endElement();t&&"IMG"==t.tagName?k(E(t)):a&&"IMG"==a.tagName&&k(E(a))}},!0),C.events.on("drop",F),C.events.on("element.beforeDrop",G),C.events.on("mousedown window.mousedown",de),C.events.on("window.touchmove",me),C.events.on("mouseup window.mouseup",function(){if(S&&!C.helpers.isMobile())return ge(),!1;me()}),C.events.on("commands.mousedown",function(e){0<e.parents(".fr-toolbar").length&&ge()}),C.events.on("image.resizeEnd",function(){C.opts.iframe&&C.size.syncIframe()}),C.events.on("blur image.hideResizer commands.undo commands.redo element.dropped",function(){ge(!(t=!1))}),C.events.on("modals.hide",function(){S&&(ye(),C.selection.clear())}),C.events.on("image.resizeEnd",function(){C.win.getSelection&&k(S)}),C.opts.imageAddNewLine&&C.events.on("image.inserted",function(e){var t=e.get(0);for(t.nextSibling&&"BR"===t.nextSibling.tagName&&(t=t.nextSibling);t&&!C.node.isElement(t);)t=C.node.isLastSibling(t)?t.parentNode:null;C.node.isElement(t)&&(C.opts.enter===_e.ENTER_BR?e.after("<br>"):E(C.node.blockParent(e.get(0))).after("<".concat(C.html.defaultTag(),"><br></").concat(C.html.defaultTag(),">")))})})(),"IMG"==C.el.tagName&&C.$el.addClass("fr-view"),C.events.$on(C.$el,C.helpers.isMobile()&&!C.helpers.isWindowsPhone()?"touchend":"click","IMG"==C.el.tagName?null:'img:not([contenteditable="false"])',fe),C.helpers.isMobile()&&(C.events.$on(C.$el,"touchstart","IMG"==C.el.tagName?null:'img:not([contenteditable="false"])',function(){a=!1}),C.events.$on(C.$el,"touchmove",function(){a=!0})),C.$wp?(C.events.on("window.keydown keydown",ae,!0),C.events.on("keyup",function(e){if(S&&e.which==_e.KEYCODE.ENTER)return!1},!0),C.events.$on(C.$el,"keydown",function(){var e=C.selection.element();(e.nodeType===Node.TEXT_NODE||"BR"==e.tagName&&C.node.isLastSibling(e))&&(e=e.parentNode),C.node.hasClass(e,"fr-inner")||(C.node.hasClass(e,"fr-img-caption")||(e=E(e).parents(".fr-img-caption").get(0)),C.node.hasClass(e,"fr-img-caption")&&(E(e).after(_e.INVISIBLE_SPACE+_e.MARKERS),C.selection.restore()))})):C.events.$on(C.$win,"keydown",ae),C.events.on("toolbar.esc",function(){if(S){if(C.$wp)C.events.disableBlur(),C.events.focus();else{var e=S;ge(!0),C.selection.setAfter(e.get(0)),C.selection.restore()}return!1}},!0),C.events.on("toolbar.focusEditor",function(){if(S)return!1},!0),C.events.on("window.cut window.copy",function(e){if(S&&C.popups.isVisible("image.edit")&&!C.popups.get("image.edit").find(":focus").length){var t=Ae();Ce()?(t.before(_e.START_MARKER),t.after(_e.END_MARKER),C.selection.restore(),C.paste.saveCopiedText(t.get(0).outerHTML,t.text())):(ye(),C.paste.saveCopiedText(S.get(0).outerHTML,S.attr("alt"))),"copy"==e.type?setTimeout(function(){k(S)}):(ge(!0),C.undo.saveStep(),setTimeout(function(){C.undo.saveStep()},0))}},!0),C.browser.msie&&C.events.on("keydown",function(e){if(!C.selection.isCollapsed()||!S)return!0;var t=e.which;t==_e.KEYCODE.C&&C.keys.ctrlKey(e)?C.events.trigger("window.copy"):t==_e.KEYCODE.X&&C.keys.ctrlKey(e)&&C.events.trigger("window.cut")}),C.events.$on(E(C.o_win),"keydown",function(e){var t=e.which;if(S&&t==_e.KEYCODE.BACKSPACE)return e.preventDefault(),!1}),C.events.$on(C.$win,"keydown",function(e){var t=e.which;S&&S.hasClass("fr-uploading")&&t==_e.KEYCODE.ESC&&S.trigger("abortUpload")}),C.events.on("destroy",function(){S&&S.hasClass("fr-uploading")&&S.trigger("abortUpload")}),C.events.on("paste.before",le),C.events.on("paste.beforeCleanup",pe),C.events.on("paste.after",ne),C.events.on("html.set",h),C.events.on("html.inserted",h),h(),C.events.on("destroy",function(){s=[]}),C.events.on("html.processGet",ie),C.opts.imageOutputSize&&C.events.on("html.beforeGet",function(){i=C.el.querySelectorAll("img");for(var e=0;e<i.length;e++){var t=i[e].style.width||E(i[e]).width(),a=i[e].style.height||E(i[e]).height();t&&i[e].setAttribute("width","".concat(t).replace(/px/,"")),a&&i[e].setAttribute("height","".concat(a).replace(/px/,""))}}),C.opts.iframe&&C.events.on("image.loaded",C.size.syncIframe),C.$wp&&(v(),C.events.on("contentChanged",v)),C.events.$on(E(C.o_win),"orientationchange.image",function(){setTimeout(function(){S&&k(S)},100)}),P(!0),V(!0),Z(!0),j(!0),C.events.on("node.remove",function(e){if("IMG"==e.get(0).tagName)return te(e),!1})},showInsertPopup:function Re(){var e=C.$tb.find('.fr-command[data-cmd="insertImage"]'),t=C.popups.get("image.insert");if(t||(t=V()),z(),!t.hasClass("fr-active"))if(C.popups.refresh("image.insert"),C.popups.setContainer("image.insert",C.$tb),e.isVisible()){var a=C.button.getPosition(e),i=a.left,r=a.top;C.popups.show("image.insert",i,r,e.outerHeight())}else C.position.forSelection(t),C.popups.show("image.insert")},showLayer:function De(e){var t,a,i=C.popups.get("image.insert");if(S||C.opts.toolbarInline){if(S){var r=Ae();Ce()&&(r=r.find(".fr-img-wrap")),a=r.offset().top+r.outerHeight(),t=r.offset().left}}else{var n=C.$tb.find('.fr-command[data-cmd="insertImage"]');t=n.offset().left,a=n.offset().top+(C.opts.toolbarBottom?10:n.outerHeight()-10)}!S&&C.opts.toolbarInline&&(a=i.offset().top-C.helpers.getPX(i.css("margin-top")),i.hasClass("fr-above")&&(a+=i.outerHeight())),i.find(".fr-layer").removeClass("fr-active"),i.find(".fr-".concat(e,"-layer")).addClass("fr-active"),C.popups.show("image.insert",t,a,S?S.outerHeight():0),C.accessibility.focusPopup(i)},refreshUploadButton:function Ue(e){var t=C.popups.get("image.insert");t&&t.find(".fr-image-upload-layer").hasClass("fr-active")&&e.addClass("fr-active").attr("aria-pressed",!0)},refreshByURLButton:function xe(e){var t=C.popups.get("image.insert");t&&t.find(".fr-image-by-url-layer").hasClass("fr-active")&&e.addClass("fr-active").attr("aria-pressed",!0)},upload:W,insertByURL:function Te(){var e=C.popups.get("image.insert").find(".fr-image-by-url-layer input");if(0<e.val().length){I(),O(C.language.translate("Loading image"));var t=e.val().trim();if(C.opts.imageUploadRemoteUrls&&C.opts.imageCORSProxy&&C.opts.imageUpload){var a=new XMLHttpRequest;a.onload=function(){200==this.status?W([new Blob([this.response],{type:this.response.type||"image/png"})],S):$(i)},a.onerror=function(){L(t,!0,[],S)},a.open("GET","".concat(C.opts.imageCORSProxy,"/").concat(t),!0),a.responseType="blob",a.send()}else L(t,!0,[],S);e.val(""),e.blur()}},align:function $e(e){var t=Ae();t.removeClass("fr-fir fr-fil"),!C.opts.htmlUntouched&&C.opts.useClasses?"left"==e?t.addClass("fr-fil"):"right"==e&&t.addClass("fr-fir"):ue(t,ve(),e),ye(),x(),n(),C.selection.clear()},refreshAlign:function Pe(e){S&&e.find("> *").first().replaceWith(C.icon.create("image-align-".concat(he())))},refreshAlignOnShow:function Ie(e,t){S&&t.find('.fr-command[data-param1="'.concat(he(),'"]')).addClass("fr-active").attr("aria-selected",!0)},display:function ze(e){var t=Ae();t.removeClass("fr-dii fr-dib"),!C.opts.htmlUntouched&&C.opts.useClasses?"inline"==e?t.addClass("fr-dii"):"block"==e&&t.addClass("fr-dib"):ue(t,e,he()),ye(),x(),n(),C.selection.clear()},refreshDisplayOnShow:function Oe(e,t){S&&t.find('.fr-command[data-param1="'.concat(ve(),'"]')).addClass("fr-active").attr("aria-selected",!0)},replace:be,back:function e(){S?(C.events.disableBlur(),E(".fr-popup input:focus").blur(),k(S)):(C.events.disableBlur(),C.selection.restore(),C.events.enableBlur(),C.popups.hide("image.insert"),C.toolbar.showInline())},get:we,getEl:Ae,insert:L,showProgressBar:I,remove:te,hideProgressBar:z,applyStyle:function Be(e,t,a){if(void 0===t&&(t=C.opts.imageStyles),void 0===a&&(a=C.opts.imageMultipleStyles),!S)return!1;var i=Ae();if(!a){var r=Object.keys(t);r.splice(r.indexOf(e),1),i.removeClass(r.join(" "))}"object"==Me(t[e])?(i.removeAttr("style"),i.css(t[e].style)):i.toggleClass(e),k(S)},showAltPopup:q,showSizePopup:Q,setAlt:function ke(e){if(S){var t=C.popups.get("image.alt");S.attr("alt",e||t.find("input").val()||""),t.find("input:focus").blur(),k(S)}},setSize:function Ne(e,t){if(S){var a=C.popups.get("image.size");e=e||a.find('input[name="width"]').val()||"",t=t||a.find('input[name="height"]').val()||"";var i=/^[\d]+((px)|%)*$/g;S.removeAttr("width").removeAttr("height"),e.match(i)?S.css("width",e):S.css("width",""),t.match(i)?S.css("height",t):S.css("height",""),Ce()&&(S.parents(".fr-img-caption").removeAttr("width").removeAttr("height"),e.match(i)?S.parents(".fr-img-caption").css("width",e):S.parents(".fr-img-caption").css("width",""),t.match(i)?S.parents(".fr-img-caption").css("height",t):S.parents(".fr-img-caption").css("height","")),a&&a.find("input:focus").blur(),k(S)}},toggleCaption:function Le(){var e;if(S&&!Ce()){((e=S).parent().is("a")||S.parent().is("p"))&&(e=S.parent());var t,a,i=S.parents("ul")&&0<S.parents("ul").length?S.parents("ul"):S.parents("ol")&&0<S.parents("ol").length?S.parents("ol"):[];if(0<i.length){var r=i.find("li").length,n=S.parents("li"),o=document.createElement("li");r-1===n.index()&&(i.append(o),o.innerHTML="&nbsp;")}e.attr("style")?a=-1<(t=e.attr("style").split(":")).indexOf("width")?t[t.indexOf("width")+1].replace(";",""):"":e.attr("width")&&(a=e.attr("width"));var s=C.opts.imageResizeWithPercent?(-1<a.indexOf("px")?null:a)||"100%":S.width()+"px";e.wrap('<div class="fr-img-space-wrap"><span '+(C.browser.mozilla?"":'contenteditable="false"')+'class="fr-img-caption '+S.attr("class")+'" style="'+(C.opts.useClasses?"":e.attr("style"))+'" draggable="false"></span><p class="fr-img-space-wrap2">&nbsp;</p></div>'),e.wrap('<span class="fr-img-wrap"></span>'),S.after('<span class="fr-inner"'.concat(C.browser.mozilla?"":' contenteditable="true"',">").concat(_e.START_MARKER).concat(C.language.translate("Image Caption")).concat(_e.END_MARKER,"</span>")),S.parents(".fr-img-caption").css("width",s),1<S.parents(".fr-img-space-wrap").length&&(Se(document.querySelector(".fr-img-space-wrap")),Se(document.querySelector(".fr-img-space-wrap2"))),ge(!0),C.selection.restore()}else{if(e=Ae(),S.insertBefore(e),null!==e[0].querySelector("a")){for(var l,p=e[0].querySelector("a"),f=document.createElement("a"),g=0,c=p.attributes,d=c.length;g<d;g++)l=c[g],f.setAttribute(l.nodeName,l.nodeValue);S.wrap(f)}S.attr("class",e.attr("class").replace("fr-img-caption","")).attr("style",e.attr("style")),e.remove(),1<S.parents(".fr-img-space-wrap").length&&(Se(document.querySelector(".fr-img-space-wrap")),Se(document.querySelector(".fr-img-space-wrap2"))),k(S)}},hasCaption:Ce,exitEdit:ge,edit:k}},_e.DefineIcon("insertImage",{NAME:"image",SVG_KEY:"insertImage"}),_e.RegisterShortcut(_e.KEYCODE.P,"insertImage",null,"P"),_e.RegisterCommand("insertImage",{title:"Insert Image",undo:!1,focus:!0,refreshAfterCallback:!1,popup:!0,callback:function(){this.popups.isVisible("image.insert")?(this.$el.find(".fr-marker").length&&(this.events.disableBlur(),this.selection.restore()),this.popups.hide("image.insert")):this.image.showInsertPopup()},plugin:"image"}),_e.DefineIcon("imageUpload",{NAME:"upload",SVG_KEY:"upload"}),_e.RegisterCommand("imageUpload",{title:"Upload Image",undo:!1,focus:!1,toggle:!0,callback:function(){this.image.showLayer("image-upload")},refresh:function(e){this.image.refreshUploadButton(e)}}),_e.DefineIcon("imageByURL",{NAME:"link",SVG_KEY:"insertLink"}),_e.RegisterCommand("imageByURL",{title:"By URL",undo:!1,focus:!1,toggle:!0,callback:function(){this.image.showLayer("image-by-url")},refresh:function(e){this.image.refreshByURLButton(e)}}),_e.RegisterCommand("imageInsertByURL",{title:"Insert Image",undo:!0,refreshAfterCallback:!1,callback:function(){this.image.insertByURL()},refresh:function(e){this.image.get()?e.text(this.language.translate("Replace")):e.text(this.language.translate("Insert"))}}),_e.DefineIcon("imageDisplay",{NAME:"star",SVG_KEY:"imageDisplay"}),_e.RegisterCommand("imageDisplay",{title:"Display",type:"dropdown",options:{inline:"Inline",block:"Break Text"},callback:function(e,t){this.image.display(t)},refresh:function(e){this.opts.imageTextNear||e.addClass("fr-hidden")},refreshOnShow:function(e,t){this.image.refreshDisplayOnShow(e,t)}}),_e.DefineIcon("image-align",{NAME:"align-left",SVG_KEY:"alignLeft"}),_e.DefineIcon("image-align-left",{NAME:"align-left",SVG_KEY:"alignLeft"}),_e.DefineIcon("image-align-right",{NAME:"align-right",SVG_KEY:"alignRight"}),_e.DefineIcon("image-align-center",{NAME:"align-justify",SVG_KEY:"alignCenter"}),_e.DefineIcon("imageAlign",{NAME:"align-justify",SVG_KEY:"alignJustify"}),_e.RegisterCommand("imageAlign",{type:"dropdown",title:"Align",options:{left:"Align Left",center:"None",right:"Align Right"},html:function(){var e='<ul class="fr-dropdown-list" role="presentation">',t=_e.COMMANDS.imageAlign.options;for(var a in t)t.hasOwnProperty(a)&&(e+='<li role="presentation"><a class="fr-command fr-title" tabIndex="-1" role="option" data-cmd="imageAlign" data-param1="'.concat(a,'" title="').concat(this.language.translate(t[a]),'">').concat(this.icon.create("image-align-".concat(a)),'<span class="fr-sr-only">').concat(this.language.translate(t[a]),"</span></a></li>"));return e+="</ul>"},callback:function(e,t){this.image.align(t)},refresh:function(e){this.image.refreshAlign(e)},refreshOnShow:function(e,t){this.image.refreshAlignOnShow(e,t)}}),_e.DefineIcon("imageReplace",{NAME:"exchange",FA5NAME:"exchange-alt",SVG_KEY:"replaceImage"}),_e.RegisterCommand("imageReplace",{title:"Replace",undo:!1,focus:!1,popup:!0,refreshAfterCallback:!1,callback:function(){this.image.replace()}}),_e.DefineIcon("imageRemove",{NAME:"trash",SVG_KEY:"remove"}),_e.RegisterCommand("imageRemove",{title:"Remove",callback:function(){this.image.remove()}}),_e.DefineIcon("imageBack",{NAME:"arrow-left",SVG_KEY:"back"}),_e.RegisterCommand("imageBack",{title:"Back",undo:!1,focus:!1,back:!0,callback:function(){this.image.back()},refresh:function(e){this.$;this.image.get()||this.opts.toolbarInline?(e.removeClass("fr-hidden"),e.next(".fr-separator").removeClass("fr-hidden")):(e.addClass("fr-hidden"),e.next(".fr-separator").addClass("fr-hidden"))}}),_e.RegisterCommand("imageDismissError",{title:"OK",undo:!1,callback:function(){this.image.hideProgressBar(!0)}}),_e.DefineIcon("imageStyle",{NAME:"magic",SVG_KEY:"imageClass"}),_e.RegisterCommand("imageStyle",{title:"Style",type:"dropdown",html:function(){var e='<ul class="fr-dropdown-list" role="presentation">',t=this.opts.imageStyles;for(var a in t)if(t.hasOwnProperty(a)){var i=t[a];"object"==Me(i)&&(i=i.title),e+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="imageStyle" data-param1="'.concat(a,'">').concat(this.language.translate(i),"</a></li>")}return e+="</ul>"},callback:function(e,t){this.image.applyStyle(t)},refreshOnShow:function(e,t){var a=this.$,i=this.image.getEl();i&&t.find(".fr-command").each(function(){var e=a(this).data("param1"),t=i.hasClass(e);a(this).toggleClass("fr-active",t).attr("aria-selected",t)})}}),_e.DefineIcon("imageAlt",{NAME:"info",SVG_KEY:"imageAltText"}),_e.RegisterCommand("imageAlt",{undo:!1,focus:!1,popup:!0,title:"Alternative Text",callback:function(){this.image.showAltPopup()}}),_e.RegisterCommand("imageSetAlt",{undo:!0,focus:!1,title:"Update",refreshAfterCallback:!1,callback:function(){this.image.setAlt()}}),_e.DefineIcon("imageSize",{NAME:"arrows-alt",SVG_KEY:"imageSize"}),_e.RegisterCommand("imageSize",{undo:!1,focus:!1,popup:!0,title:"Change Size",callback:function(){this.image.showSizePopup()}}),_e.RegisterCommand("imageSetSize",{undo:!0,focus:!1,title:"Update",refreshAfterCallback:!1,callback:function(){this.image.setSize()}}),_e.DefineIcon("imageCaption",{NAME:"commenting",FA5NAME:"comment-alt",SVG_KEY:"imageCaption"}),_e.RegisterCommand("imageCaption",{undo:!0,focus:!1,title:"Image Caption",refreshAfterCallback:!0,callback:function(){this.image.toggleCaption()},refresh:function(e){this.image.get()&&e.toggleClass("fr-active",this.image.hasCaption())}})});
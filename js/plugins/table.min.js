/*!
 * froala_editor v2.8.2 (https://www.froala.com/wysiwyg-editor)
 * License https://froala.com/wysiwyg-editor/terms/
 * Copyright 2014-2018 Froala Labs
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("FroalaEditor")):"function"==typeof define&&define.amd?define(["FroalaEditor"],t):t(e.$.FroalaEditor)}(this,function(ee){"use strict";ee=ee&&ee.hasOwnProperty("default")?ee["default"]:ee,Object.assign(ee.POPUP_TEMPLATES,{"table.insert":"[_BUTTONS_][_ROWS_COLUMNS_]","table.edit":"[_BUTTONS_]","table.colors":"[_BUTTONS_][_COLORS_][_CUSTOM_COLOR_]"}),Object.assign(ee.DEFAULTS,{tableInsertMaxSize:10,tableEditButtons:["tableHeader","tableRemove","|","tableRows","tableColumns","tableStyle","-","tableCells","tableCellBackground","tableCellVerticalAlign","tableCellHorizontalAlign","tableCellStyle"],tableInsertButtons:["tableBack","|"],tableResizer:!0,tableDefaultWidth:"100%",tableResizerOffset:5,tableResizingLimit:30,tableColorsButtons:["tableBack","|"],tableColors:["#61BD6D","#1ABC9C","#54ACD2","#2C82C9","#9365B8","#475577","#CCCCCC","#41A85F","#00A885","#3D8EB9","#2969B0","#553982","#28324E","#000000","#F7DA64","#FBA026","#EB6B56","#E25041","#A38F84","#EFEFEF","#FFFFFF","#FAC51C","#F37934","#D14841","#B8312F","#7C706B","#D1D5D8","REMOVE"],tableColorsStep:7,tableCellStyles:{"fr-highlighted":"Highlighted","fr-thick":"Thick"},tableStyles:{"fr-dashed-borders":"Dashed Borders","fr-alternate-rows":"Alternate Rows"},tableCellMultipleStyles:!0,tableMultipleStyles:!0,tableInsertHelper:!0,tableInsertHelperOffset:15}),ee.PLUGINS.table=function(C){var E,o,s,r,l,n,w,O=C.$;function h(){var e=A();if(e){var t=C.popups.get("table.edit");if(t||(t=p()),t){C.popups.setContainer("table.edit",C.$sc);var a=I(e),l=(a.left+a.right)/2,s=a.bottom;C.popups.show("table.edit",l,s,a.bottom-a.top),C.edit.isDisabled()&&(1<Z().length&&C.toolbar.disable(),C.$el.removeClass("fr-no-selection"),C.edit.on(),C.button.bulkRefresh(),C.selection.setAtEnd(C.$el.find(".fr-selected-cell").last().get(0)),C.selection.restore())}}}function f(){var e,t,a,l,s=A();if(s){var r=C.popups.get("table.colors");r||(r=function(){var e="";0<C.opts.tableColorsButtons.length&&(e='<div class="fr-buttons fr-table-colors-buttons">'+C.button.buildList(C.opts.tableColorsButtons)+"</div>");var t="";C.opts.colorsHEXInput&&(t='<div class="fr-table-colors-hex-layer fr-active fr-layer" id="fr-table-colors-hex-layer-'+C.id+'"><div class="fr-input-line"><input maxlength="7" id="fr-table-colors-hex-layer-text-'+C.id+'" type="text" placeholder="'+C.language.translate("HEX Color")+'" tabIndex="1" aria-required="true"></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="tableCellBackgroundCustomColor" tabIndex="2" role="button">'+C.language.translate("OK")+"</button></div></div>");var a={buttons:e,colors:function(){for(var e='<div class="fr-table-colors">',t=0;t<C.opts.tableColors.length;t++)0!==t&&t%C.opts.tableColorsStep==0&&(e+="<br>"),"REMOVE"!=C.opts.tableColors[t]?e+='<span class="fr-command" style="background: '+C.opts.tableColors[t]+';" tabIndex="-1" role="button" data-cmd="tableCellBackgroundColor" data-param1="'+C.opts.tableColors[t]+'"><span class="fr-sr-only">'+C.language.translate("Color")+" "+C.opts.tableColors[t]+"&nbsp;&nbsp;&nbsp;</span></span>":e+='<span class="fr-command" data-cmd="tableCellBackgroundColor" tabIndex="-1" role="button" data-param1="REMOVE" title="'+C.language.translate("Clear Formatting")+'">'+C.icon.create("tableColorRemove")+'<span class="fr-sr-only">'+C.language.translate("Clear Formatting")+"</span></span>";return e+="</div>"}(),custom_color:t},l=C.popups.create("table.colors",a);return C.events.$on(C.$wp,"scroll.table-colors",function(){C.popups.isVisible("table.colors")&&f()}),u=l,C.events.on("popup.tab",function(e){var t=O(e.currentTarget);if(!C.popups.isVisible("table.colors")||!t.is("span"))return!0;var a=e.which,l=!0;if(ee.KEYCODE.TAB==a){var s=u.find(".fr-buttons");l=!C.accessibility.focusToolbar(s,!!e.shiftKey)}else if(ee.KEYCODE.ARROW_UP==a||ee.KEYCODE.ARROW_DOWN==a||ee.KEYCODE.ARROW_LEFT==a||ee.KEYCODE.ARROW_RIGHT==a){var r=t.parent().find("span.fr-command"),n=r.index(t),o=C.opts.colorsStep,i=Math.floor(r.length/o),f=n%o,c=Math.floor(n/o),d=c*o+f,p=i*o;ee.KEYCODE.ARROW_UP==a?d=((d-o)%p+p)%p:ee.KEYCODE.ARROW_DOWN==a?d=(d+o)%p:ee.KEYCODE.ARROW_LEFT==a?d=((d-1)%p+p)%p:ee.KEYCODE.ARROW_RIGHT==a&&(d=(d+1)%p);var h=O(r.get(d));C.events.disableBlur(),h.focus(),l=!1}else ee.KEYCODE.ENTER==a&&(C.button.exec(t),l=!1);return!1===l&&(e.preventDefault(),e.stopPropagation()),l},!0),l;var u}()),C.popups.setContainer("table.colors",C.$sc);var n=I(s),o=(n.left+n.right)/2,i=n.bottom;e=C.popups.get("table.colors"),t=C.$el.find(".fr-selected-cell").first(),a=C.helpers.RGBToHex(t.css("background-color")),l=e.find(".fr-table-colors-hex-layer input"),e.find(".fr-selected-color").removeClass("fr-selected-color fr-active-item"),e.find('span[data-param1="'+a+'"]').addClass("fr-selected-color fr-active-item"),l.val(a).trigger("change"),C.popups.show("table.colors",o,i,n.bottom-n.top)}}function i(){0===Z().length&&C.toolbar.enable()}function c(e){if(e)return C.popups.onHide("table.insert",function(){C.popups.get("table.insert").find('.fr-table-size .fr-select-table-size > span[data-row="1"][data-col="1"]').trigger("mouseenter")}),!0;var t="";0<C.opts.tableInsertButtons.length&&(t='<div class="fr-buttons">'+C.button.buildList(C.opts.tableInsertButtons)+"</div>");var a,l={buttons:t,rows_columns:function(){for(var e='<div class="fr-table-size"><div class="fr-table-size-info">1 &times; 1</div><div class="fr-select-table-size">',t=1;t<=C.opts.tableInsertMaxSize;t++){for(var a=1;a<=C.opts.tableInsertMaxSize;a++){var l="inline-block";2<t&&!C.helpers.isMobile()&&(l="none");var s="fr-table-cell ";1==t&&1==a&&(s+=" hover"),e+='<span class="fr-command '+s+'" tabIndex="-1" data-cmd="tableInsert" data-row="'+t+'" data-col="'+a+'" data-param1="'+t+'" data-param2="'+a+'" style="display: '+l+';" role="button"><span></span><span class="fr-sr-only">'+t+" &times; "+a+"&nbsp;&nbsp;&nbsp;</span></span>"}e+='<div class="new-line"></div>'}return e+="</div></div>"}()},s=C.popups.create("table.insert",l);return C.events.$on(s,"mouseover",".fr-table-size .fr-select-table-size .fr-table-cell",function(e){d(O(e.currentTarget))},!0),a=s,C.events.$on(a,"focus","[tabIndex]",function(e){var t=O(e.currentTarget);d(t)}),C.events.on("popup.tab",function(e){var t=O(e.currentTarget);if(!C.popups.isVisible("table.insert")||!t.is("span, a"))return!0;var a,l=e.which;if(ee.KEYCODE.ARROW_UP==l||ee.KEYCODE.ARROW_DOWN==l||ee.KEYCODE.ARROW_LEFT==l||ee.KEYCODE.ARROW_RIGHT==l){if(t.is("span.fr-table-cell")){var s=t.parent().find("span.fr-table-cell"),r=s.index(t),n=C.opts.tableInsertMaxSize,o=r%n,i=Math.floor(r/n);ee.KEYCODE.ARROW_UP==l?i=Math.max(0,i-1):ee.KEYCODE.ARROW_DOWN==l?i=Math.min(C.opts.tableInsertMaxSize-1,i+1):ee.KEYCODE.ARROW_LEFT==l?o=Math.max(0,o-1):ee.KEYCODE.ARROW_RIGHT==l&&(o=Math.min(C.opts.tableInsertMaxSize-1,o+1));var f=i*n+o,c=O(s.get(f));d(c),C.events.disableBlur(),c.focus(),a=!1}}else ee.KEYCODE.ENTER==l&&(C.button.exec(t),a=!1);return!1===a&&(e.preventDefault(),e.stopPropagation()),a},!0),s}function d(e){var t=parseInt(e.data("row"),10),a=parseInt(e.data("col"),10),l=e.parent();l.siblings(".fr-table-size-info").html(t+" &times; "+a),l.find("> span").removeClass("hover fr-active-item");for(var s=1;s<=C.opts.tableInsertMaxSize;s++)for(var r=0;r<=C.opts.tableInsertMaxSize;r++){var n=l.find('> span[data-row="'+s+'"][data-col="'+r+'"]');s<=t&&r<=a?n.addClass("hover"):s<=t+1||s<=2&&!C.helpers.isMobile()?n.css("display","inline-block"):2<s&&!C.helpers.isMobile()&&n.css("display","none")}e.addClass("fr-active-item")}function p(e){if(e)return C.popups.onHide("table.edit",i),!0;if(0<C.opts.tableEditButtons.length){var t={buttons:'<div class="fr-buttons">'+C.button.buildList(C.opts.tableEditButtons)+"</div>"},a=C.popups.create("table.edit",t);return C.events.$on(C.$wp,"scroll.table-edit",function(){C.popups.isVisible("table.edit")&&h()}),a}return!1}function u(){if(0<Z().length){var e=Q();C.selection.setBefore(e.get(0))||C.selection.setAfter(e.get(0)),C.selection.restore(),C.popups.hide("table.edit"),e.remove(),C.toolbar.enable()}}function b(e){var t=Q();if(0<t.length){if(0<C.$el.find("th.fr-selected-cell").length&&"above"==e)return;var a,l,s,r=A(),n=_(r);l="above"==e?n.min_i:n.max_i;var o="<tr>";for(a=0;a<r[l].length;a++)if("below"==e&&l<r.length-1&&r[l][a]==r[l+1][a]||"above"==e&&0<l&&r[l][a]==r[l-1][a]){if(0===a||0<a&&r[l][a]!=r[l][a-1]){var i=O(r[l][a]);i.attr("rowspan",parseInt(i.attr("rowspan"),10)+1)}}else o+="<td><br></td>";o+="</tr>",s=0<C.$el.find("th.fr-selected-cell").length&&"below"==e?O(t.find("tbody").not(t.find("> table tbody"))):O(t.find("tr").not(t.find("> table tr")).get(l)),"below"==e?s.get(0)&&"TBODY"==s.get(0).tagName?s.prepend(o):s.after(o):"above"==e&&(s.before(o),C.popups.isVisible("table.edit")&&h())}}function g(e,t,a){var l,s,r,n,o,i=0,f=A(a);if(e<(t=Math.min(t,f[0].length-1)))for(s=e;s<=t;s++)if(!(e<s&&f[0][s]==f[0][s-1])&&1<(n=Math.min(parseInt(f[0][s].getAttribute("colspan"),10)||1,t-e+1))&&f[0][s]==f[0][s+1])for(i=n-1,l=1;l<f.length;l++)if(f[l][s]!=f[l-1][s]){for(r=s;r<s+n;r++)if(1<(o=parseInt(f[l][r].getAttribute("colspan"),10)||1)&&f[l][r]==f[l][r+1])r+=i=Math.min(i,o-1);else if(!(i=Math.max(0,i-1)))break;if(!i)break}i&&v(f,i,"colspan",0,f.length-1,e,t)}function m(e,t,a){var l,s,r,n,o,i=0,f=A(a);if(e<(t=Math.min(t,f.length-1)))for(l=e;l<=t;l++)if(!(e<l&&f[l][0]==f[l-1][0])&&1<(n=Math.min(parseInt(f[l][0].getAttribute("rowspan"),10)||1,t-e+1))&&f[l][0]==f[l+1][0])for(i=n-1,s=1;s<f[0].length;s++)if(f[l][s]!=f[l][s-1]){for(r=l;r<l+n;r++)if(1<(o=parseInt(f[r][s].getAttribute("rowspan"),10)||1)&&f[r][s]==f[r+1][s])r+=i=Math.min(i,o-1);else if(!(i=Math.max(0,i-1)))break;if(!i)break}i&&v(f,i,"rowspan",e,t,0,f[0].length-1)}function v(e,t,a,l,s,r,n){var o,i,f;for(o=l;o<=s;o++)for(i=r;i<=n;i++)l<o&&e[o][i]==e[o-1][i]||r<i&&e[o][i]==e[o][i-1]||1<(f=parseInt(e[o][i].getAttribute(a),10)||1)&&(1<f-t?e[o][i].setAttribute(a,f-t):e[o][i].removeAttribute(a))}function R(e,t,a,l,s){m(e,t,s),g(a,l,s)}function t(e){var t=C.$el.find(".fr-selected-cell");"REMOVE"!=e?t.css("background-color",C.helpers.HEXtoRGB(e)):t.css("background-color",""),h()}function A(e){var f=[];return null==(e=e||null)&&0<Z().length&&(e=Q()),e&&e.findVisible("tr").not(e.find("> table tr")).each(function(o,e){var t=O(e),i=0;t.find("> th, > td").each(function(e,t){for(var a=O(t),l=parseInt(a.attr("colspan"),10)||1,s=parseInt(a.attr("rowspan"),10)||1,r=o;r<o+s;r++)for(var n=i;n<i+l;n++)f[r]||(f[r]=[]),f[r][n]?i++:f[r][n]=t;i+=l})}),f}function x(e,t){for(var a=0;a<t.length;a++)for(var l=0;l<t[a].length;l++)if(t[a][l]==e)return{row:a,col:l}}function y(e,t,a){for(var l=e+1,s=t+1;l<a.length;){if(a[l][t]!=a[e][t]){l--;break}l++}for(l==a.length&&l--;s<a[e].length;){if(a[e][s]!=a[e][t]){s--;break}s++}return s==a[e].length&&s--,{row:l,col:s}}function D(){C.el.querySelector(".fr-cell-fixed")&&C.el.querySelector(".fr-cell-fixed").classList.remove("fr-cell-fixed"),C.el.querySelector(".fr-cell-handler")&&C.el.querySelector(".fr-cell-handler").classList.remove("fr-cell-handler")}function $(){var e=C.$el.find(".fr-selected-cell");0<e.length&&e.each(function(){var e=O(this);e.removeClass("fr-selected-cell"),""===e.attr("class")&&e.removeAttr("class")}),D()}function M(){C.events.disableBlur(),C.selection.clear(),C.$el.addClass("fr-no-selection"),C.$el.blur(),C.events.enableBlur()}function _(e){var t=C.$el.find(".fr-selected-cell");if(0<t.length){var a,l=e.length,s=0,r=e[0].length,n=0;for(a=0;a<t.length;a++){var o=x(t[a],e),i=y(o.row,o.col,e);l=Math.min(o.row,l),s=Math.max(i.row,s),r=Math.min(o.col,r),n=Math.max(i.col,n)}return{min_i:l,max_i:s,min_j:r,max_j:n}}return null}function I(e){var t=_(e),a=O(e[t.min_i][t.min_j]),l=O(e[t.min_i][t.max_j]),s=O(e[t.max_i][t.min_j]);return{left:a.offset().left,right:l.offset().left+l.outerWidth(),top:a.offset().top,bottom:s.offset().top+s.outerHeight()}}function T(t,a){if(O(t).is(a))$(),O(t).addClass("fr-selected-cell");else{M(),C.edit.off();var l=A(),s=x(t,l),r=x(a,l),n=function e(t,a,l,s,r){var n,o,i,f,c=t,d=a,p=l,h=s;for(n=c;n<=d;n++)(1<(parseInt(O(r[n][p]).attr("rowspan"),10)||1)||1<(parseInt(O(r[n][p]).attr("colspan"),10)||1))&&(f=y((i=x(r[n][p],r)).row,i.col,r),c=Math.min(i.row,c),d=Math.max(f.row,d),p=Math.min(i.col,p),h=Math.max(f.col,h)),(1<(parseInt(O(r[n][h]).attr("rowspan"),10)||1)||1<(parseInt(O(r[n][h]).attr("colspan"),10)||1))&&(f=y((i=x(r[n][h],r)).row,i.col,r),c=Math.min(i.row,c),d=Math.max(f.row,d),p=Math.min(i.col,p),h=Math.max(f.col,h));for(o=p;o<=h;o++)(1<(parseInt(O(r[c][o]).attr("rowspan"),10)||1)||1<(parseInt(O(r[c][o]).attr("colspan"),10)||1))&&(f=y((i=x(r[c][o],r)).row,i.col,r),c=Math.min(i.row,c),d=Math.max(f.row,d),p=Math.min(i.col,p),h=Math.max(f.col,h)),(1<(parseInt(O(r[d][o]).attr("rowspan"),10)||1)||1<(parseInt(O(r[d][o]).attr("colspan"),10)||1))&&(f=y((i=x(r[d][o],r)).row,i.col,r),c=Math.min(i.row,c),d=Math.max(f.row,d),p=Math.min(i.col,p),h=Math.max(f.col,h));return c==t&&d==a&&p==l&&h==s?{min_i:t,max_i:a,min_j:l,max_j:s}:e(c,d,p,h,r)}(Math.min(s.row,r.row),Math.max(s.row,r.row),Math.min(s.col,r.col),Math.max(s.col,r.col),l);$(),t.classList.add("fr-cell-fixed"),a.classList.add("fr-cell-handler");for(var o=n.min_i;o<=n.max_i;o++)for(var i=n.min_j;i<=n.max_j;i++)O(l[o][i]).addClass("fr-selected-cell")}}function N(e){var t=null,a=O(e.target);return"TD"==e.target.tagName||"TH"==e.target.tagName?t=e.target:0<a.closest("td").length?t=a.closest("td").get(0):0<a.closest("th").length&&(t=a.closest("th").get(0)),C.$el.contains(t)?t:null}function S(){$(),C.popups.hide("table.edit")}function e(e){var t=N(e);if("false"==O(t).parents("[contenteditable]:not(.fr-element):not(.fr-img-caption):not(body)").first().attr("contenteditable"))return!0;if(0<Z().length&&!t&&S(),!C.edit.isDisabled()||C.popups.isVisible("table.edit"))if(1!=e.which||1==e.which&&C.helpers.isMac()&&e.ctrlKey)(3==e.which||1==e.which&&C.helpers.isMac()&&e.ctrlKey)&&t&&S();else if(r=!0,t){0<Z().length&&!e.shiftKey&&S(),e.stopPropagation(),C.events.trigger("image.hideResizer"),C.events.trigger("video.hideResizer"),s=!0;var a=t.tagName.toLowerCase();e.shiftKey&&0<C.$el.find(a+".fr-selected-cell").length?O(C.$el.find(a+".fr-selected-cell").closest("table")).is(O(t).closest("table"))?T(l,t):M():((C.keys.ctrlKey(e)||e.shiftKey)&&(1<Z().length||0===O(t).find(C.selection.element()).length&&!O(t).is(C.selection.element()))&&M(),l=t,0<C.opts.tableEditButtons.length&&T(l,l))}}function a(e){if(s||C.$tb.is(e.target)||C.$tb.is(O(e.target).closest(".fr-toolbar"))||(0<Z().length&&C.toolbar.enable(),$()),!(1!=e.which||1==e.which&&C.helpers.isMac()&&e.ctrlKey)){if(r=!1,s)s=!1,N(e)||1!=Z().length?0<Z().length&&(C.selection.isCollapsed()?h():$()):$();if(w){w=!1,E.removeClass("fr-moving"),C.$el.removeClass("fr-no-selection"),C.edit.on();var t=parseFloat(E.css("left"))+C.opts.tableResizerOffset+C.$wp.offset().left;C.opts.iframe&&(t-=C.$iframe.offset().left),E.data("release-position",t),E.removeData("max-left"),E.removeData("max-right"),function(){var e=E.data("origin"),t=E.data("release-position");if(e!==t){var a=E.data("first"),l=E.data("second"),s=E.data("table"),r=s.outerWidth();if(C.undo.canDo()||C.undo.saveStep(),null!==a&&null!==l){var n,o,i,f=A(s),c=[],d=[],p=[],h=[];for(n=0;n<f.length;n++)o=O(f[n][a]),i=O(f[n][l]),c[n]=o.outerWidth(),p[n]=i.outerWidth(),d[n]=c[n]/r*100,h[n]=p[n]/r*100;for(n=0;n<f.length;n++){if(o=O(f[n][a]),i=O(f[n][l]),f[n][a]!=f[n][l])var u=(d[n]*(c[n]+t-e)/c[n]).toFixed(4);o.css("width",u+"%"),i.css("width",(d[n]+h[n]-u).toFixed(4)+"%")}}else{var b,g=s.parent(),m=r/g.width()*100,v=(parseInt(s.css("margin-left"),10)||0)/g.width()*100,w=(parseInt(s.css("margin-right"),10)||0)/g.width()*100;"rtl"==C.opts.direction&&0===l||"rtl"!=C.opts.direction&&0!==l?(b=(r+t-e)/r*m,s.css("margin-right","calc(100% - "+Math.round(b).toFixed(4)+"% - "+Math.round(v).toFixed(4)+"%)")):("rtl"==C.opts.direction&&0!==l||"rtl"!=C.opts.direction&&0===l)&&(b=(r-t+e)/r*m,s.css("margin-left","calc(100% - "+Math.round(b).toFixed(4)+"% - "+Math.round(w).toFixed(4)+"%)")),s.css("width",Math.round(b).toFixed(4)+"%")}C.selection.restore(),C.undo.saveStep(),C.events.trigger("table.resized",[s.get(0)])}E.removeData("origin"),E.removeData("release-position"),E.removeData("first"),E.removeData("second"),E.removeData("table")}(),F()}}}function z(e){if(!0===s&&0<C.opts.tableEditButtons.length){if(O(e.currentTarget).closest("table").is(Q())){if("TD"==e.currentTarget.tagName&&0===C.$el.find("th.fr-selected-cell").length)return void T(l,e.currentTarget);if("TH"==e.currentTarget.tagName&&0===C.$el.find("td.fr-selected-cell").length)return void T(l,e.currentTarget)}M()}}function B(e,t,a,l){for(var s,r=t;r!=C.el&&"TD"!=r.tagName&&"TH"!=r.tagName&&("up"==l?s=r.previousElementSibling:"down"==l&&(s=r.nextElementSibling),!s);)r=r.parentNode;"TD"==r.tagName||"TH"==r.tagName?function(e,t){for(var a=e;a&&"TABLE"!=a.tagName&&a.parentNode!=C.el;)a=a.parentNode;if(a&&"TABLE"==a.tagName){var l=A(O(a));"up"==t?W(x(e,l),a,l):"down"==t&&k(x(e,l),a,l)}}(r,l):s&&("up"==l&&C.selection.setAtEnd(s),"down"==l&&C.selection.setAtStart(s))}function W(e,t,a){0<e.row?C.selection.setAtEnd(a[e.row-1][e.col]):B(0,t,0,"up")}function k(e,t,a){var l=parseInt(a[e.row][e.col].getAttribute("rowspan"),10)||1;e.row<a.length-l?C.selection.setAtStart(a[e.row+l][e.col]):B(0,t,0,"down")}function F(){E&&(E.find("div").css("opacity",0),E.css("top",0),E.css("left",0),E.css("height",0),E.find("div").css("height",0),E.hide())}function K(){o&&o.removeClass("fr-visible").css("left","-9999px")}function L(e,t){var a=O(t),l=a.closest("table"),s=l.parent();if(t&&"TD"!=t.tagName&&"TH"!=t.tagName&&(0<a.closest("td").length?t=a.closest("td"):0<a.closest("th").length&&(t=a.closest("th"))),!t||"TD"!=t.tagName&&"TH"!=t.tagName)E&&a.get(0)!=E.get(0)&&a.parent().get(0)!=E.get(0)&&C.core.sameInstance(E)&&F();else{if(a=O(t),!C.$el.contains(t))return!1;var r=a.offset().left-1,n=r+a.outerWidth();if(Math.abs(e.pageX-r)<=C.opts.tableResizerOffset||Math.abs(n-e.pageX)<=C.opts.tableResizerOffset){var o,i,f,c,d,p=A(l),h=x(t,p),u=y(h.row,h.col,p),b=l.offset().top,g=l.outerHeight()-1;"rtl"!=C.opts.direction?e.pageX-r<=C.opts.tableResizerOffset?(f=r,0<h.col?(c=r-V(h.col-1,p)+C.opts.tableResizingLimit,d=r+V(h.col,p)-C.opts.tableResizingLimit,o=h.col-1,i=h.col):(o=null,i=0,c=l.offset().left-1-parseInt(l.css("margin-left"),10),d=l.offset().left-1+l.width()-p[0].length*C.opts.tableResizingLimit)):n-e.pageX<=C.opts.tableResizerOffset&&(f=n,u.col<p[u.row].length&&p[u.row][u.col+1]?(c=n-V(u.col,p)+C.opts.tableResizingLimit,d=n+V(u.col+1,p)-C.opts.tableResizingLimit,o=u.col,i=u.col+1):(o=u.col,i=null,c=l.offset().left-1+p[0].length*C.opts.tableResizingLimit,d=s.offset().left-1+s.width()+parseFloat(s.css("padding-left")))):n-e.pageX<=C.opts.tableResizerOffset?(f=n,0<h.col?(c=n-V(h.col,p)+C.opts.tableResizingLimit,d=n+V(h.col-1,p)-C.opts.tableResizingLimit,o=h.col,i=h.col-1):(o=null,i=0,c=l.offset().left+p[0].length*C.opts.tableResizingLimit,d=s.offset().left-1+s.width()+parseFloat(s.css("padding-left")))):e.pageX-r<=C.opts.tableResizerOffset&&(f=r,u.col<p[u.row].length&&p[u.row][u.col+1]?(c=r-V(u.col+1,p)+C.opts.tableResizingLimit,d=r+V(u.col,p)-C.opts.tableResizingLimit,o=u.col+1,i=u.col):(o=u.col,i=null,c=s.offset().left+parseFloat(s.css("padding-left")),d=l.offset().left-1+l.width()-p[0].length*C.opts.tableResizingLimit)),E||(C.shared.$table_resizer||(C.shared.$table_resizer=O('<div class="fr-table-resizer"><div></div></div>')),E=C.shared.$table_resizer,C.events.$on(E,"mousedown",function(e){return!C.core.sameInstance(E)||(0<Z().length&&S(),1==e.which?(C.selection.save(),w=!0,E.addClass("fr-moving"),M(),C.edit.off(),E.find("div").css("opacity",1),!1):void 0)}),C.events.$on(E,"mousemove",function(e){if(!C.core.sameInstance(E))return!0;w&&(C.opts.iframe&&(e.pageX-=C.$iframe.offset().left),U(e))}),C.events.on("shared.destroy",function(){E.html("").removeData().remove(),E=null},!0),C.events.on("destroy",function(){C.$el.find(".fr-selected-cell").removeClass("fr-selected-cell"),E.hide().appendTo(O("body").first())},!0)),E.data("table",l),E.data("first",o),E.data("second",i),E.data("instance",C),C.$wp.append(E);var m=f-C.win.pageXOffset-C.opts.tableResizerOffset-C.$wp.offset().left,v=b-C.$wp.offset().top+C.$wp.scrollTop();C.opts.iframe&&(m+=C.$iframe.offset().left,v+=C.$iframe.offset().top,c+=C.$iframe.offset().left,d+=C.$iframe.offset().left),E.data("max-left",c),E.data("max-right",d),E.data("origin",f-C.win.pageXOffset),E.css("top",v),E.css("left",m),E.css("height",g),E.find("div").css("height",g),E.css("padding-left",C.opts.tableResizerOffset),E.css("padding-right",C.opts.tableResizerOffset),E.show()}else C.core.sameInstance(E)&&F()}}function H(e,t){if(C.$box.find(".fr-line-breaker").isVisible())return!1;o||G(),C.$box.append(o),o.data("instance",C);var a,l=O(t).find("tr").first(),s=e.pageX,r=0,n=0;C.opts.iframe&&(r+=C.$iframe.offset().left-C.helpers.scrollLeft(),n+=C.$iframe.offset().top-C.helpers.scrollTop()),l.find("th, td").each(function(){var e=O(this);return e.offset().left<=s&&s<e.offset().left+e.outerWidth()/2?(a=parseInt(o.find("a").css("width"),10),o.css("top",n+e.offset().top-C.$box.offset().top-C.win.pageYOffset-a-5),o.css("left",r+e.offset().left-C.$box.offset().left-C.win.pageXOffset-a/2),o.data("selected-cell",e),o.data("position","before"),o.addClass("fr-visible"),!1):e.offset().left+e.outerWidth()/2<=s&&s<e.offset().left+e.outerWidth()?(a=parseInt(o.find("a").css("width"),10),o.css("top",n+e.offset().top-C.$box.offset().top-C.win.pageYOffset-a-5),o.css("left",r+e.offset().left-C.$box.offset().left+e.outerWidth()-C.win.pageXOffset-a/2),o.data("selected-cell",e),o.data("position","after"),o.addClass("fr-visible"),!1):void 0})}function Y(e,t){if(C.$box.find(".fr-line-breaker").isVisible())return!1;o||G(),C.$box.append(o),o.data("instance",C);var a,l=O(t),s=e.pageY,r=0,n=0;C.opts.iframe&&(r+=C.$iframe.offset().left-C.helpers.scrollLeft(),n+=C.$iframe.offset().top-C.helpers.scrollTop()),l.find("tr").each(function(){var e=O(this);return e.offset().top<=s&&s<e.offset().top+e.outerHeight()/2?(a=parseInt(o.find("a").css("width"),10),o.css("top",n+e.offset().top-C.$box.offset().top-C.win.pageYOffset-a/2),o.css("left",r+e.offset().left-C.$box.offset().left-C.win.pageXOffset-a-5),o.data("selected-cell",e.find("td").first()),o.data("position","above"),o.addClass("fr-visible"),!1):e.offset().top+e.outerHeight()/2<=s&&s<e.offset().top+e.outerHeight()?(a=parseInt(o.find("a").css("width"),10),o.css("top",n+e.offset().top-C.$box.offset().top+e.outerHeight()-C.win.pageYOffset-a/2),o.css("left",r+e.offset().left-C.$box.offset().left-C.win.pageXOffset-a-5),o.data("selected-cell",e.find("td").first()),o.data("position","below"),o.addClass("fr-visible"),!1):void 0})}function j(e){n=null;var t=C.doc.elementFromPoint(e.pageX-C.win.pageXOffset,e.pageY-C.win.pageYOffset);C.opts.tableResizer&&(!C.popups.areVisible()||C.popups.areVisible()&&C.popups.isVisible("table.edit"))&&L(e,t),!C.opts.tableInsertHelper||C.popups.areVisible()||C.$tb.hasClass("fr-inline")&&C.$tb.isVisible()||function(e,t){if(0===Z().length){var a,l,s;if(t&&("HTML"==t.tagName||"BODY"==t.tagName||C.node.isElement(t)))for(a=1;a<=C.opts.tableInsertHelperOffset;a++){if(l=C.doc.elementFromPoint(e.pageX-C.win.pageXOffset,e.pageY-C.win.pageYOffset+a),O(l).hasClass("fr-tooltip"))return;if(l&&("TH"==l.tagName||"TD"==l.tagName||"TABLE"==l.tagName)&&(O(l).parents(".fr-wrapper").length||C.opts.iframe))return H(e,O(l).closest("table"));if(s=C.doc.elementFromPoint(e.pageX-C.win.pageXOffset+a,e.pageY-C.win.pageYOffset),O(s).hasClass("fr-tooltip"))return;if(s&&("TH"==s.tagName||"TD"==s.tagName||"TABLE"==s.tagName)&&(O(s).parents(".fr-wrapper").length||C.opts.iframe))return Y(e,O(s).closest("table"))}C.core.sameInstance(o)&&K()}}(e,t)}function P(){if(w){var e=E.data("table").offset().top-C.win.pageYOffset;C.opts.iframe&&(e+=C.$iframe.offset().top-C.helpers.scrollTop()),E.css("top",e)}}function V(e,t){var a,l=O(t[0][e]).outerWidth();for(a=1;a<t.length;a++)l=Math.min(l,O(t[a][e]).outerWidth());return l}function X(e,t,a){var l,s=0;for(l=e;l<=t;l++)s+=V(l,a);return s}function U(e){if(1<Z().length&&r&&M(),!1===r&&!1===s&&!1===w)n&&clearTimeout(n),C.edit.isDisabled()&&!C.popups.isVisible("table.edit")||(n=setTimeout(j,30,e));else if(w){var t=e.pageX-C.win.pageXOffset;C.opts.iframe&&(t+=C.$iframe.offset().left);var a=E.data("max-left"),l=E.data("max-right");a<=t&&t<=l?E.css("left",t-C.opts.tableResizerOffset-C.$wp.offset().left):t<a&&parseFloat(E.css("left"),10)>a-C.opts.tableResizerOffset?E.css("left",a-C.opts.tableResizerOffset-C.$wp.offset().left):l<t&&parseFloat(E.css("left"),10)<l-C.opts.tableResizerOffset&&E.css("left",l-C.opts.tableResizerOffset-C.$wp.offset().left)}else r&&K()}function q(e){C.node.isEmpty(e.get(0))?e.prepend(ee.MARKERS):e.prepend(ee.START_MARKER).append(ee.END_MARKER)}function G(){C.shared.$ti_helper||(C.shared.$ti_helper=O('<div class="fr-insert-helper"><a class="fr-floating-btn" role="button" tabIndex="-1" title="'+C.language.translate("Insert")+'"><svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M22,16.75 L16.75,16.75 L16.75,22 L15.25,22.000 L15.25,16.75 L10,16.75 L10,15.25 L15.25,15.25 L15.25,10 L16.75,10 L16.75,15.25 L22,15.25 L22,16.75 Z"/></svg></a></div>'),C.events.bindClick(C.shared.$ti_helper,"a",function(){var e=o.data("selected-cell"),t=o.data("position"),a=o.data("instance")||C;"before"==t?(C.undo.saveStep(),e.addClass("fr-selected-cell"),a.table.insertColumn(t),e.removeClass("fr-selected-cell"),C.undo.saveStep()):"after"==t?(C.undo.saveStep(),e.addClass("fr-selected-cell"),a.table.insertColumn(t),e.removeClass("fr-selected-cell"),C.undo.saveStep()):"above"==t?(C.undo.saveStep(),e.addClass("fr-selected-cell"),a.table.insertRow(t),e.removeClass("fr-selected-cell"),C.undo.saveStep()):"below"==t&&(C.undo.saveStep(),e.addClass("fr-selected-cell"),a.table.insertRow(t),e.removeClass("fr-selected-cell"),C.undo.saveStep()),K()}),C.events.on("shared.destroy",function(){C.shared.$ti_helper.html("").removeData().remove(),C.shared.$ti_helper=null},!0),C.events.$on(C.shared.$ti_helper,"mousemove",function(e){e.stopPropagation()},!0),C.events.$on(O(C.o_win),"scroll",function(){K()},!0),C.events.$on(C.$wp,"scroll",function(){K()},!0)),o=C.shared.$ti_helper,C.events.on("destroy",function(){o=null}),C.tooltip.bind(C.$box,".fr-insert-helper > a.fr-floating-btn")}function J(){l=null,clearTimeout(n)}function Z(){return C.el.querySelectorAll(".fr-selected-cell")}function Q(){var e=Z();if(e.length){for(var t=e[0];t&&"TABLE"!=t.tagName&&t.parentNode!=C.el;)t=t.parentNode;return t&&"TABLE"==t.tagName?O(t):O([])}return O([])}return{_init:function(){if(!C.$wp)return!1;if(!C.helpers.isMobile()){w=s=r=!1,C.events.$on(C.$el,"mousedown",e),C.popups.onShow("image.edit",function(){$(),s=r=!1}),C.popups.onShow("link.edit",function(){$(),s=r=!1}),C.events.on("commands.mousedown",function(e){0<e.parents(".fr-toolbar").length&&$()}),C.events.$on(C.$el,"mouseover","th, td",z),C.events.$on(C.$win,"mouseup",a),C.opts.iframe&&C.events.$on(O(C.o_win),"mouseup",a),C.events.$on(C.$win,"mousemove",U),C.events.$on(O(C.o_win),"scroll",P),C.events.on("contentChanged",function(){0<Z().length&&(h(),C.$el.find("img").on("load.selected-cells",function(){O(this).off("load.selected-cells"),0<Z().length&&h()}))}),C.events.$on(O(C.o_win),"resize",function(){$()}),C.events.on("toolbar.esc",function(){if(0<Z().length)return C.events.disableBlur(),C.events.focus(),!1},!0),C.events.$on(O(C.o_win),"keydown",function(){r&&s&&(s=r=!1,C.$el.removeClass("fr-no-selection"),C.edit.on(),C.selection.setAtEnd(C.$el.find(".fr-selected-cell").last().get(0)),C.selection.restore(),$())}),C.events.$on(C.$el,"keydown",function(e){e.shiftKey?!1===function(e){var t=Z();if(0<t.length){var a,l,s=A(),r=e.which;1==t.length?l=a=t[0]:(a=C.el.querySelector(".fr-cell-fixed"),l=C.el.querySelector(".fr-cell-handler"));var n=x(l,s);if(ee.KEYCODE.ARROW_RIGHT==r){if(n.col<s[0].length-1)return T(a,s[n.row][n.col+1]),!1}else if(ee.KEYCODE.ARROW_DOWN==r){if(n.row<s.length-1)return T(a,s[n.row+1][n.col]),!1}else if(ee.KEYCODE.ARROW_LEFT==r){if(0<n.col)return T(a,s[n.row][n.col-1]),!1}else if(ee.KEYCODE.ARROW_UP==r&&0<n.row)return T(a,s[n.row-1][n.col]),!1}}(e)&&setTimeout(function(){h()},0):function(e){var t=e.which,a=C.selection.blocks();if(a.length&&("TD"==(a=a[0]).tagName||"TH"==a.tagName)){for(var l=a;l&&"TABLE"!=l.tagName&&l.parentNode!=C.el;)l=l.parentNode;if(l&&"TABLE"==l.tagName&&(ee.KEYCODE.ARROW_LEFT==t||ee.KEYCODE.ARROW_UP==t||ee.KEYCODE.ARROW_RIGHT==t||ee.KEYCODE.ARROW_DOWN==t)&&(0<Z().length&&S(),C.browser.webkit&&(ee.KEYCODE.ARROW_UP==t||ee.KEYCODE.ARROW_DOWN==t))){var s=C.selection.ranges(0).startContainer;if(s.nodeType==Node.TEXT_NODE&&(ee.KEYCODE.ARROW_UP==t&&s.previousSibling||ee.KEYCODE.ARROW_DOWN==t&&s.nextSibling))return;e.preventDefault(),e.stopPropagation();var r=A(O(l)),n=x(a,r);ee.KEYCODE.ARROW_UP==t?W(n,l,r):ee.KEYCODE.ARROW_DOWN==t&&k(n,l,r),C.selection.restore()}}}(e)}),C.events.on("keydown",function(e){if(!1===function(e){if(e.which==ee.KEYCODE.TAB){var t;if(0<Z().length)t=C.$el.find(".fr-selected-cell").last();else{var a=C.selection.element();"TD"==a.tagName||"TH"==a.tagName?t=O(a):a!=C.el&&(0<O(a).parentsUntil(C.$el,"td").length?t=O(a).parents("td").first():0<O(a).parentsUntil(C.$el,"th").length&&(t=O(a).parents("th").first()))}if(t)return e.preventDefault(),!!(0<O(C.selection.element()).parentsUntil(C.$el,"ol, ul").length&&(0<O(C.selection.element()).parents("li").prev().length||O(C.selection.element()).is("li")&&0<O(C.selection.element()).prev().length))||(S(),e.shiftKey?0<t.prev().length?q(t.prev()):0<t.closest("tr").length&&0<t.closest("tr").prev().length?q(t.closest("tr").prev().find("td").last()):0<t.closest("tbody").length&&0<t.closest("table").find("thead tr").length&&q(t.closest("table").find("thead tr th").last()):0<t.next().length?q(t.next()):0<t.closest("tr").length&&0<t.closest("tr").next().length?q(t.closest("tr").next().find("td").first()):0<t.closest("thead").length&&0<t.closest("table").find("tbody tr").length?q(t.closest("table").find("tbody tr td").first()):(t.addClass("fr-selected-cell"),b("below"),$(),q(t.closest("tr").next().find("td").first())),C.selection.restore(),!1)}}(e))return!1;var t=Z();if(0<t.length){if(0<t.length&&C.keys.ctrlKey(e)&&e.which==ee.KEYCODE.A)return $(),C.popups.isVisible("table.edit")&&C.popups.hide("table.edit"),t=[],!0;if(e.which==ee.KEYCODE.ESC&&C.popups.isVisible("table.edit"))return $(),C.popups.hide("table.edit"),e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),!(t=[]);if(1<t.length&&(e.which==ee.KEYCODE.BACKSPACE||e.which==ee.KEYCODE.DELETE)){C.undo.saveStep();for(var a=0;a<t.length;a++)O(t[a]).html("<br>"),a==t.length-1&&O(t[a]).prepend(ee.MARKERS);return C.selection.restore(),C.undo.saveStep(),!(t=[])}if(1<t.length&&e.which!=ee.KEYCODE.F10&&!C.keys.isBrowserAction(e))return e.preventDefault(),!(t=[])}else if(!(t=[])===function(e){if(e.altKey&&e.which==ee.KEYCODE.SPACE){var t,a=C.selection.element();if("TD"==a.tagName||"TH"==a.tagName?t=a:0<O(a).closest("td").length?t=O(a).closest("td").get(0):0<O(a).closest("th").length&&(t=O(a).closest("th").get(0)),t)return e.preventDefault(),T(t,t),h(),!1}}(e))return!1},!0);var t=[];C.events.on("html.beforeGet",function(){t=Z();for(var e=0;e<t.length;e++)t[e].className=(t[e].className||"").replace(/fr-selected-cell/g,"")}),C.events.on("html.afterGet",function(){for(var e=0;e<t.length;e++)t[e].className=(t[e].className?t[e].className.trim()+" ":"")+"fr-selected-cell";t=[]}),c(!0),p(!0)}C.events.on("destroy",J)},insert:function(e,t){var a,l,s="<table "+(C.opts.tableDefaultWidth?'style="width: '+C.opts.tableDefaultWidth+';" ':"")+'class="fr-inserted-table"><tbody>',r=100/t;for(a=0;a<e;a++){for(s+="<tr>",l=0;l<t;l++)s+="<td"+(C.opts.tableDefaultWidth?' style="width: '+r.toFixed(4)+'%;"':"")+">",0===a&&0===l&&(s+=ee.MARKERS),s+="<br></td>";s+="</tr>"}s+="</tbody></table>",C.html.insert(s),C.selection.restore();var n=C.$el.find(".fr-inserted-table");n.removeClass("fr-inserted-table"),C.events.trigger("table.inserted",[n.get(0)])},remove:u,insertRow:b,deleteRow:function(){var e=Q();if(0<e.length){var t,a,l,s=A(),r=_(s);if(0===r.min_i&&r.max_i==s.length-1)u();else{for(t=r.max_i;t>=r.min_i;t--){for(l=O(e.find("tr").not(e.find("> table tr")).get(t)),a=0;a<s[t].length;a++)if(0===a||s[t][a]!=s[t][a-1]){var n=O(s[t][a]);if(1<parseInt(n.attr("rowspan"),10)){var o=parseInt(n.attr("rowspan"),10)-1;1==o?n.removeAttr("rowspan"):n.attr("rowspan",o)}if(t<s.length-1&&s[t][a]==s[t+1][a]&&(0===t||s[t][a]!=s[t-1][a])){for(var i=s[t][a],f=a;0<f&&s[t][f]==s[t][f-1];)f--;0===f?O(e.find("tr").not(e.find("> table tr")).get(t+1)).prepend(i):O(s[t+1][f-1]).after(i)}}var c=l.parent();l.remove(),0===c.find("tr").length&&c.remove(),s=A(e)}R(0,s.length-1,0,s[0].length-1,e),0<r.min_i?C.selection.setAtEnd(s[r.min_i-1][0]):C.selection.setAtEnd(s[0][0]),C.selection.restore(),C.popups.hide("table.edit")}}},insertColumn:function(i){var e=Q();if(0<e.length){var f,c=A(),t=_(c);f="before"==i?t.min_j:t.max_j;var a,d=100/c[0].length,p=100/(c[0].length+1);e.find("th, td").each(function(){(a=O(this)).data("old-width",a.outerWidth()/e.outerWidth()*100)}),e.find("tr").not(e.find(" > table tr")).each(function(e){for(var t,a=O(this),l=0,s=0;l-1<f;){if(!(t=a.find("> th, > td").get(s))){t=null;break}t==c[e][l]?(l+=parseInt(O(t).attr("colspan"),10)||1,s++):(l+=parseInt(O(c[e][l]).attr("colspan"),10)||1,"after"==i&&(t=0===s?-1:a.find("> th, > td").get(s-1)))}var r,n=O(t);if("after"==i&&f<l-1||"before"==i&&0<f&&c[e][f]==c[e][f-1]){if(0===e||0<e&&c[e][f]!=c[e-1][f]){var o=parseInt(n.attr("colspan"),10)+1;n.attr("colspan",o),n.css("width",(n.data("old-width")*p/d+p).toFixed(4)+"%"),n.removeData("old-width")}}else r=0<a.find("th").length?'<th style="width: '+p.toFixed(4)+'%;"><br></th>':'<td style="width: '+p.toFixed(4)+'%;"><br></td>',-1==t?a.prepend(r):null==t?a.append(r):"before"==i?n.before(r):"after"==i&&n.after(r)}),e.find("th, td").each(function(){(a=O(this)).data("old-width")&&(a.css("width",(a.data("old-width")*p/d).toFixed(4)+"%"),a.removeData("old-width"))}),C.popups.isVisible("table.edit")&&h()}},deleteColumn:function(){var e=Q();if(0<e.length){var t,a,l,s=A(),r=_(s);if(0===r.min_j&&r.max_j==s[0].length-1)u();else{var n=0;for(t=0;t<s.length;t++)for(a=0;a<s[0].length;a++)(l=O(s[t][a])).hasClass("fr-selected-cell")||(l.data("old-width",l.outerWidth()/e.outerWidth()*100),(a<r.min_j||a>r.max_j)&&(n+=l.outerWidth()/e.outerWidth()*100));for(n/=s.length,a=r.max_j;a>=r.min_j;a--)for(t=0;t<s.length;t++)if(0===t||s[t][a]!=s[t-1][a])if(l=O(s[t][a]),1<(parseInt(l.attr("colspan"),10)||1)){var o=parseInt(l.attr("colspan"),10)-1;1==o?l.removeAttr("colspan"):l.attr("colspan",o),l.css("width",(100*(l.data("old-width")-V(a,s))/n).toFixed(4)+"%"),l.removeData("old-width")}else{var i=O(l.parent().get(0));l.remove(),0===i.find("> th, > td").length&&(0===i.prev().length||0===i.next().length||i.prev().find("> th[rowspan], > td[rowspan]").length<i.prev().find("> th, > td").length)&&i.remove()}R(0,s.length-1,0,s[0].length-1,e),0<r.min_j?C.selection.setAtEnd(s[r.min_i][r.min_j-1]):C.selection.setAtEnd(s[r.min_i][0]),C.selection.restore(),C.popups.hide("table.edit"),e.find("th, td").each(function(){(l=O(this)).data("old-width")&&(l.css("width",(100*l.data("old-width")/n).toFixed(4)+"%"),l.removeData("old-width"))})}}},mergeCells:function(){if(1<Z().length&&(0===C.$el.find("th.fr-selected-cell").length||0===C.$el.find("td.fr-selected-cell").length)){D();var e,t,a=_(A()),l=C.$el.find(".fr-selected-cell"),s=O(l[0]),r=s.parent().find(".fr-selected-cell"),n=s.closest("table"),o=s.html(),i=0;for(e=0;e<r.length;e++)i+=O(r[e]).outerWidth();for(s.css("width",Math.min(100,i/n.outerWidth()*100).toFixed(4)+"%"),a.min_j<a.max_j&&s.attr("colspan",a.max_j-a.min_j+1),a.min_i<a.max_i&&s.attr("rowspan",a.max_i-a.min_i+1),e=1;e<l.length;e++)"<br>"!=(t=O(l[e])).html()&&""!==t.html()&&(o+="<br>"+t.html()),t.remove();s.html(o),C.selection.setAtEnd(s.get(0)),C.selection.restore(),C.toolbar.enable(),m(a.min_i,a.max_i,n);var f=n.find("tr:empty");for(e=f.length-1;0<=e;e--)O(f[e]).remove();g(a.min_j,a.max_j,n),h()}},splitCellVertically:function(){if(1==Z().length){var e=C.$el.find(".fr-selected-cell"),t=parseInt(e.attr("colspan"),10)||1,a=e.parent().outerWidth(),l=e.outerWidth(),s=e.clone().html("<br>"),r=A(),n=x(e.get(0),r);if(1<t){var o=Math.ceil(t/2);l=X(n.col,n.col+o-1,r)/a*100;var i=X(n.col+o,n.col+t-1,r)/a*100;1<o?e.attr("colspan",o):e.removeAttr("colspan"),1<t-o?s.attr("colspan",t-o):s.removeAttr("colspan"),e.css("width",l.toFixed(4)+"%"),s.css("width",i.toFixed(4)+"%")}else{var f;for(f=0;f<r.length;f++)if(0===f||r[f][n.col]!=r[f-1][n.col]){var c=O(r[f][n.col]);if(!c.is(e)){var d=(parseInt(c.attr("colspan"),10)||1)+1;c.attr("colspan",d)}}l=l/a*100/2,e.css("width",l.toFixed(4)+"%"),s.css("width",l.toFixed(4)+"%")}e.after(s.get(0)),$(),C.popups.hide("table.edit")}},splitCellHorizontally:function(){if(1==Z().length){var e=C.$el.find(".fr-selected-cell"),t=e.parent(),a=e.closest("table"),l=parseInt(e.attr("rowspan"),10),s=A(),r=x(e.get(0),s),n=e.clone().html("<br>");if(1<l){var o=Math.ceil(l/2);1<o?e.attr("rowspan",o):e.removeAttr("rowspan"),1<l-o?n.attr("rowspan",l-o):n.removeAttr("rowspan");for(var i=r.row+o,f=0===r.col?r.col:r.col-1;0<=f&&(s[i][f]==s[i][f-1]||0<i&&s[i][f]==s[i-1][f]);)f--;-1==f?O(a.find("tr").not(a.find("> table tr")).get(i)).prepend(n):O(s[i][f]).after(n.get(0))}else{var c,d=O(C.doc.createElement("TR")).append(n);for(c=0;c<s[0].length;c++)if(0===c||s[r.row][c]!=s[r.row][c-1]){var p=O(s[r.row][c]);p.is(e)||p.attr("rowspan",(parseInt(p.attr("rowspan"),10)||1)+1)}t.after(d.get(0))}$(),C.popups.hide("table.edit")}},addHeader:function(){var e=Q();if(0<e.length&&0===e.find("th").length){var t,a="<thead><tr>",l=0;for(e.find("tr").first().find("> td").each(function(){var e=O(this);l+=parseInt(e.attr("colspan"),10)||1}),t=0;t<l;t++)a+="<th><br></th>";a+="</tr></thead>",e.prepend(a),h()}},removeHeader:function(){var e=Q(),t=e.find("thead");if(0<t.length)if(0===e.find("tbody tr").length)u();else if(t.remove(),0<Z().length)h();else{C.popups.hide("table.edit");var a=e.find("tbody tr td").first().get(0);a&&(C.selection.setAtEnd(a),C.selection.restore())}},setBackground:t,showInsertPopup:function(){var e=C.$tb.find('.fr-command[data-cmd="insertTable"]'),t=C.popups.get("table.insert");if(t||(t=c()),!t.hasClass("fr-active")){C.popups.refresh("table.insert"),C.popups.setContainer("table.insert",C.$tb);var a=e.offset().left+e.outerWidth()/2,l=e.offset().top+(C.opts.toolbarBottom?10:e.outerHeight()-10);C.popups.show("table.insert",a,l,e.outerHeight())}},showEditPopup:h,showColorsPopup:f,back:function(){0<Z().length?h():(C.popups.hide("table.insert"),C.toolbar.showInline())},verticalAlign:function(e){C.$el.find(".fr-selected-cell").css("vertical-align",e)},horizontalAlign:function(e){C.$el.find(".fr-selected-cell").css("text-align",e)},applyStyle:function(e,t,a,l){if(0<t.length){if(!a){var s=Object.keys(l);s.splice(s.indexOf(e),1),t.removeClass(s.join(" "))}t.toggleClass(e)}},selectedTable:Q,selectedCells:Z,customColor:function(){var e=C.popups.get("table.colors").find(".fr-table-colors-hex-layer input");e.length&&t(e.val())},selectCells:T}},ee.DefineIcon("insertTable",{NAME:"table"}),ee.RegisterCommand("insertTable",{title:"Insert Table",undo:!1,focus:!0,refreshOnCallback:!1,popup:!0,callback:function(){this.popups.isVisible("table.insert")?(this.$el.find(".fr-marker").length&&(this.events.disableBlur(),this.selection.restore()),this.popups.hide("table.insert")):this.table.showInsertPopup()},plugin:"table"}),ee.RegisterCommand("tableInsert",{callback:function(e,t,a){this.table.insert(t,a),this.popups.hide("table.insert")}}),ee.DefineIcon("tableHeader",{NAME:"header",FA5NAME:"heading"}),ee.RegisterCommand("tableHeader",{title:"Table Header",focus:!1,toggle:!0,callback:function(){this.popups.get("table.edit").find('.fr-command[data-cmd="tableHeader"]').hasClass("fr-active")?this.table.removeHeader():this.table.addHeader()},refresh:function(e){var t=this.table.selectedTable();0<t.length&&(0===t.find("th").length?e.removeClass("fr-active").attr("aria-pressed",!1):e.addClass("fr-active").attr("aria-pressed",!0))}}),ee.DefineIcon("tableRows",{NAME:"bars"}),ee.RegisterCommand("tableRows",{type:"dropdown",focus:!1,title:"Row",options:{above:"Insert row above",below:"Insert row below","delete":"Delete row"},html:function(){var e='<ul class="fr-dropdown-list" role="presentation">',t=ee.COMMANDS.tableRows.options;for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="tableRows" data-param1="'+a+'" title="'+this.language.translate(t[a])+'">'+this.language.translate(t[a])+"</a></li>");return e+="</ul>"},callback:function(e,t){"above"==t||"below"==t?this.table.insertRow(t):this.table.deleteRow()}}),ee.DefineIcon("tableColumns",{NAME:"bars fa-rotate-90"}),ee.RegisterCommand("tableColumns",{type:"dropdown",focus:!1,title:"Column",options:{before:"Insert column before",after:"Insert column after","delete":"Delete column"},html:function(){var e='<ul class="fr-dropdown-list" role="presentation">',t=ee.COMMANDS.tableColumns.options;for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="tableColumns" data-param1="'+a+'" title="'+this.language.translate(t[a])+'">'+this.language.translate(t[a])+"</a></li>");return e+="</ul>"},callback:function(e,t){"before"==t||"after"==t?this.table.insertColumn(t):this.table.deleteColumn()}}),ee.DefineIcon("tableCells",{NAME:"square-o",FA5NAME:"square"}),ee.RegisterCommand("tableCells",{type:"dropdown",focus:!1,title:"Cell",options:{merge:"Merge cells","vertical-split":"Vertical split","horizontal-split":"Horizontal split"},html:function(){var e='<ul class="fr-dropdown-list" role="presentation">',t=ee.COMMANDS.tableCells.options;for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="tableCells" data-param1="'+a+'" title="'+this.language.translate(t[a])+'">'+this.language.translate(t[a])+"</a></li>");return e+="</ul>"},callback:function(e,t){"merge"==t?this.table.mergeCells():"vertical-split"==t?this.table.splitCellVertically():this.table.splitCellHorizontally()},refreshOnShow:function(e,t){1<this.$el.find(".fr-selected-cell").length?(t.find('a[data-param1="vertical-split"]').addClass("fr-disabled").attr("aria-disabled",!0),t.find('a[data-param1="horizontal-split"]').addClass("fr-disabled").attr("aria-disabled",!0),t.find('a[data-param1="merge"]').removeClass("fr-disabled").attr("aria-disabled",!1)):(t.find('a[data-param1="merge"]').addClass("fr-disabled").attr("aria-disabled",!0),t.find('a[data-param1="vertical-split"]').removeClass("fr-disabled").attr("aria-disabled",!1),t.find('a[data-param1="horizontal-split"]').removeClass("fr-disabled").attr("aria-disabled",!1))}}),ee.DefineIcon("tableRemove",{NAME:"trash"}),ee.RegisterCommand("tableRemove",{title:"Remove Table",focus:!1,callback:function(){this.table.remove()}}),ee.DefineIcon("tableStyle",{NAME:"paint-brush"}),ee.RegisterCommand("tableStyle",{title:"Table Style",type:"dropdown",focus:!1,html:function(){var e='<ul class="fr-dropdown-list" role="presentation">',t=this.opts.tableStyles;for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="tableStyle" data-param1="'+a+'" title="'+this.language.translate(t[a])+'">'+this.language.translate(t[a])+"</a></li>");return e+="</ul>"},callback:function(e,t){this.table.applyStyle(t,this.$el.find(".fr-selected-cell").closest("table"),this.opts.tableMultipleStyles,this.opts.tableStyles)},refreshOnShow:function(e,t){var a=this.$el.find(".fr-selected-cell").closest("table");a&&t.find(".fr-command").each(function(){var e=$(this).data("param1"),t=a.hasClass(e);$(this).toggleClass("fr-active",t).attr("aria-selected",t)})}}),ee.DefineIcon("tableCellBackground",{NAME:"tint"}),ee.RegisterCommand("tableCellBackground",{title:"Cell Background",focus:!1,popup:!0,callback:function(){this.table.showColorsPopup()}}),ee.RegisterCommand("tableCellBackgroundColor",{undo:!0,focus:!1,callback:function(e,t){this.table.setBackground(t)}}),ee.DefineIcon("tableBack",{NAME:"arrow-left"}),ee.RegisterCommand("tableBack",{title:"Back",undo:!1,focus:!1,back:!0,callback:function(){this.table.back()},refresh:function(e){0!==this.table.selectedCells().length||this.opts.toolbarInline?(e.removeClass("fr-hidden"),e.next(".fr-separator").removeClass("fr-hidden")):(e.addClass("fr-hidden"),e.next(".fr-separator").addClass("fr-hidden"))}}),ee.DefineIcon("tableCellVerticalAlign",{NAME:"arrows-v",FA5NAME:"arrows-alt-v"}),ee.RegisterCommand("tableCellVerticalAlign",{type:"dropdown",focus:!1,title:"Vertical Align",options:{Top:"Align Top",Middle:"Align Middle",Bottom:"Align Bottom"},html:function(){var e='<ul class="fr-dropdown-list" role="presentation">',t=ee.COMMANDS.tableCellVerticalAlign.options;for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="tableCellVerticalAlign" data-param1="'+a.toLowerCase()+'" title="'+this.language.translate(t[a])+'">'+this.language.translate(a)+"</a></li>");return e+="</ul>"},callback:function(e,t){this.table.verticalAlign(t)},refreshOnShow:function(e,t){t.find('.fr-command[data-param1="'+this.$el.find(".fr-selected-cell").css("vertical-align")+'"]').addClass("fr-active").attr("aria-selected",!0)}}),ee.DefineIcon("tableCellHorizontalAlign",{NAME:"align-left"}),ee.DefineIcon("align-left",{NAME:"align-left"}),ee.DefineIcon("align-right",{NAME:"align-right"}),ee.DefineIcon("align-center",{NAME:"align-center"}),ee.DefineIcon("align-justify",{NAME:"align-justify"}),ee.RegisterCommand("tableCellHorizontalAlign",{type:"dropdown",focus:!1,title:"Horizontal Align",options:{left:"Align Left",center:"Align Center",right:"Align Right",justify:"Align Justify"},html:function(){var e='<ul class="fr-dropdown-list" role="presentation">',t=ee.COMMANDS.tableCellHorizontalAlign.options;for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e+='<li role="presentation"><a class="fr-command fr-title" tabIndex="-1" role="option" data-cmd="tableCellHorizontalAlign" data-param1="'+a+'" title="'+this.language.translate(t[a])+'">'+this.icon.create("align-"+a)+'<span class="fr-sr-only">'+this.language.translate(t[a])+"</span></a></li>");return e+="</ul>"},callback:function(e,t){this.table.horizontalAlign(t)},refresh:function(e){var t=this.table.selectedCells();t.length&&e.find("> *").first().replaceWith(this.icon.create("align-"+this.helpers.getAlignment(t[0])))},refreshOnShow:function(e,t){t.find('.fr-command[data-param1="'+this.helpers.getAlignment(this.$el.find(".fr-selected-cell").first())+'"]').addClass("fr-active").attr("aria-selected",!0)}}),ee.DefineIcon("tableCellStyle",{NAME:"magic"}),ee.RegisterCommand("tableCellStyle",{title:"Cell Style",type:"dropdown",focus:!1,html:function(){var e='<ul class="fr-dropdown-list" role="presentation">',t=this.opts.tableCellStyles;for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="tableCellStyle" data-param1="'+a+'" title="'+this.language.translate(t[a])+'">'+this.language.translate(t[a])+"</a></li>");return e+="</ul>"},callback:function(e,t){this.table.applyStyle(t,this.$el.find(".fr-selected-cell"),this.opts.tableCellMultipleStyles,this.opts.tableCellStyles)},refreshOnShow:function(e,t){var a=this.$el.find(".fr-selected-cell").first();a&&t.find(".fr-command").each(function(){var e=$(this).data("param1"),t=a.hasClass(e);$(this).toggleClass("fr-active",t).attr("aria-selected",t)})}}),ee.RegisterCommand("tableCellBackgroundCustomColor",{title:"OK",undo:!0,callback:function(){this.table.customColor()}}),ee.DefineIcon("tableColorRemove",{NAME:"eraser"})});
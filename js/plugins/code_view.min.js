/*!
 * froala_editor v2.0.0-rc.1 (https://www.froala.com/wysiwyg-editor/v2.0)
 * License http://editor.froala.com/license
 * Copyright 2014-2015 Froala Labs
 */
!function(a){"use strict";a.extend(a.FroalaEditor.DEFAULTS,{codeMirror:!0,codeMirrorOptions:{lineNumbers:!0,tabMode:"indent",indentWithTabs:!0,lineWrapping:!0,mode:"text/html",tabSize:2},codeBeautifier:!0}),a.FroalaEditor.PLUGINS.codeView=function(b){function c(){return b.$box.hasClass("fr-code-view")}function d(a){b.html.set(k?k.getValue():j.val()),b.$el.blur(),b.$tb.find(" > .fr-command").not(a).removeClass("fr-disabled"),a.removeClass("fr-active"),b.events.focus(!0),b.placeholder.refresh(),b.undo.saveStep()}function e(a,c){!k&&b.opts.codeMirror&&"undefined"!=typeof CodeMirror&&(k=CodeMirror.fromTextArea(j.get(0),b.opts.codeMirrorOptions)),b.undo.saveStep(),b.html.cleanWhiteTags(!0),b.selection.save(),b.$el.find('.fr-marker[data-type="true"]:first').replaceWith("FROALA-SM"),b.$el.find('.fr-marker[data-type="false"]:last').replaceWith("FROALA-EM"),b.$el.blur();var d=b.html.get();if(b.opts.codeBeautifier&&(d=i(d,{end_with_newline:!0,indent_inner_html:!0,extra_liners:["p","h1","h2","h3","h4","h5","h6","blockquote","pre","ul","ol","table"],brace_style:"expand",indent_char:"	",indent_size:1,wrap_line_length:0})),k){var e=d.indexOf("FROALA-SM"),f=d.indexOf("FROALA-EM");e>f?e=f:f-=9,d=d.replace(/FROALA-SM/g,"").replace(/FROALA-EM/g,"");var g=d.substring(0,e).length-d.substring(0,e).replace(/\n/g,"").length,h=d.substring(0,f).length-d.substring(0,f).replace(/\n/g,"").length,e=d.substring(0,e).length-d.substring(0,d.substring(0,e).lastIndexOf("\n")+1).length,f=d.substring(0,f).length-d.substring(0,d.substring(0,f).lastIndexOf("\n")+1).length;k.setSize(null,c),k.setValue(d),k.focus(),k.setSelection({line:g,ch:e},{line:h,ch:f}),k.refresh(),k.clearHistory()}else{var e=d.indexOf("FROALA-SM"),f=d.indexOf("FROALA-EM")-9;j.css("height",c),j.val(d.replace(/FROALA-SM/g,"").replace(/FROALA-EM/g,"")),j.focus(),j.get(0).setSelectionRange(e,f)}b.$tb.find(" > .fr-command").not(a).addClass("fr-disabled"),a.addClass("fr-active"),!b.helpers.isMobile()&&b.opts.toolbarInline&&b.toolbar.hide()}function f(){var a=b.$tb.find('.fr-command[data-cmd="html"]');if(c())b.$box.toggleClass("fr-code-view",!1),d(a);else{b.popups.hideAll();var f=b.$wp.outerHeight();b.$box.toggleClass("fr-code-view",!0),e(a,f)}}function g(){c()&&(f(b.$tb.find('button[data-cmd="html"]')),j.val("").removeData().remove())}function h(){if(!b.$wp)return!1;j=a('<textarea class="fr-code" tabindex="-1">'),b.$wp.append(j),j.attr("dir",b.opts.direction);var d=function(){return!c()};if(b.opts.toolbarInline){var e=a('<a data-cmd="html" title="Code View" class="fr-command fr-btn html-switch'+(b.helpers.isMobile()?"":" fr-desktop")+'" role="button" tabindex="-1"><i class="fa fa-code"></i></button>');b.$box.append(e),b.events.bindClick(b.$box,"a.html-switch",function(){f(b.$tb.find('button[data-cmd="html"]'))})}b.events.on("buttons.refresh",d),b.events.on("copy",d,!0),b.events.on("cut",d,!0),b.events.on("paste",d,!0),b.events.on("destroy",g,!0),b.events.on("form.submit",function(){c()&&f(b.$tb.find('button[data-cmd="html"]'))})}function i(a,b){function c(a){return a.replace(/^\s+/g,"")}function d(a){return a.replace(/\s+$/g,"")}function e(){return this.pos=0,this.token="",this.current_mode="CONTENT",this.tags={parent:"parent1",parentcount:1,parent1:""},this.tag_type="",this.token_text=this.last_token=this.last_text=this.token_type="",this.newlines=0,this.indent_content=g,this.Utils={whitespace:"\n\r	 ".split(""),single_token:"br,input,link,meta,source,!doctype,basefont,base,area,hr,wbr,param,img,isindex,embed".split(","),extra_liners:s,in_array:function(a,b){for(var c=0;c<b.length;c++)if(a==b[c])return!0;return!1}},this.is_whitespace=function(a){for(var b=0;b<a.length;a++)if(!this.Utils.in_array(a.charAt(b),this.Utils.whitespace))return!1;return!0},this.traverse_whitespace=function(){var a="";if(a=this.input.charAt(this.pos),this.Utils.in_array(a,this.Utils.whitespace)){for(this.newlines=0;this.Utils.in_array(a,this.Utils.whitespace);)m&&"\n"==a&&this.newlines<=n&&(this.newlines+=1),this.pos++,a=this.input.charAt(this.pos);return!0}return!1},this.space_or_wrap=function(a){this.line_char_count>=this.wrap_line_length?(this.print_newline(!1,a),this.print_indentation(a)):(this.line_char_count++,a.push(" "))},this.get_content=function(){for(var a="",b=[];"<"!=this.input.charAt(this.pos);){if(this.pos>=this.input.length)return b.length?b.join(""):["","TK_EOF"];if(this.traverse_whitespace())this.space_or_wrap(b);else{if(o){var c=this.input.substr(this.pos,3);if("{{#"==c||"{{/"==c)break;if("{{!"==c)return[this.get_tag(),"TK_TAG_HANDLEBARS_COMMENT"];if("{{"==this.input.substr(this.pos,2)&&"{{else}}"==this.get_tag(!0))break}a=this.input.charAt(this.pos),this.pos++,this.line_char_count++,b.push(a)}}return b.length?b.join(""):""},this.get_contents_to=function(a){if(this.pos==this.input.length)return["","TK_EOF"];var b="",c=new RegExp("</"+a+"\\s*>","igm");c.lastIndex=this.pos;var d=c.exec(this.input),e=d?d.index:this.input.length;return this.pos<e&&(b=this.input.substring(this.pos,e),this.pos=e),b},this.record_tag=function(a){this.tags[a+"count"]?(this.tags[a+"count"]++,this.tags[a+this.tags[a+"count"]]=this.indent_level):(this.tags[a+"count"]=1,this.tags[a+this.tags[a+"count"]]=this.indent_level),this.tags[a+this.tags[a+"count"]+"parent"]=this.tags.parent,this.tags.parent=a+this.tags[a+"count"]},this.retrieve_tag=function(a){if(this.tags[a+"count"]){for(var b=this.tags.parent;b&&a+this.tags[a+"count"]!=b;)b=this.tags[b+"parent"];b&&(this.indent_level=this.tags[a+this.tags[a+"count"]],this.tags.parent=this.tags[b+"parent"]),delete this.tags[a+this.tags[a+"count"]+"parent"],delete this.tags[a+this.tags[a+"count"]],1==this.tags[a+"count"]?delete this.tags[a+"count"]:this.tags[a+"count"]--}},this.indent_to_tag=function(a){if(this.tags[a+"count"]){for(var b=this.tags.parent;b&&a+this.tags[a+"count"]!=b;)b=this.tags[b+"parent"];b&&(this.indent_level=this.tags[a+this.tags[a+"count"]])}},this.get_tag=function(a){var b,c,d,e="",f=[],g="",h=!1,j=!0,k=this.pos,m=this.line_char_count;a=void 0!==a?a:!1;do{if(this.pos>=this.input.length)return a&&(this.pos=k,this.line_char_count=m),f.length?f.join(""):["","TK_EOF"];if(e=this.input.charAt(this.pos),this.pos++,this.Utils.in_array(e,this.Utils.whitespace))h=!0;else{if(("'"==e||'"'==e)&&(e+=this.get_unformatted(e),h=!0),"="==e&&(h=!1),f.length&&"="!=f[f.length-1]&&">"!=e&&h){if(this.space_or_wrap(f),h=!1,!j&&"force"==p&&"/"!=e){this.print_newline(!0,f),this.print_indentation(f);for(var n=0;q>n;n++)f.push(i)}for(var r=0;r<f.length;r++)if(" "==f[r]){j=!1;break}}if(o&&"<"==d&&e+this.input.charAt(this.pos)=="{{"&&(e+=this.get_unformatted("}}"),f.length&&" "!=f[f.length-1]&&"<"!=f[f.length-1]&&(e=" "+e),h=!0),"<"!=e||d||(b=this.pos-1,d="<"),o&&!d&&f.length>=2&&"{"==f[f.length-1]&&"{"==f[f.length-2]&&(b="#"==e||"/"==e||"!"==e?this.pos-3:this.pos-2,d="{"),this.line_char_count++,f.push(e),f[1]&&("!"==f[1]||"?"==f[1]||"%"==f[1])){f=[this.get_comment(b)];break}if(o&&f[1]&&"{"==f[1]&&f[2]&&"!"==f[2]){f=[this.get_comment(b)];break}if(o&&"{"==d&&f.length>2&&"}"==f[f.length-2]&&"}"==f[f.length-1])break}}while(">"!=e);var s,t,u=f.join("");s=u.indexOf(-1!=u.indexOf(" ")?" ":"{"==u[0]?"}":">"),t="<"!=u[0]&&o?"#"==u[2]?3:2:1;var v=u.substring(t,s).toLowerCase();return"/"==u.charAt(u.length-2)||this.Utils.in_array(v,this.Utils.single_token)?a||(this.tag_type="SINGLE"):o&&"{"==u[0]&&"else"==v?a||(this.indent_to_tag("if"),this.tag_type="HANDLEBARS_ELSE",this.indent_content=!0,this.traverse_whitespace()):this.is_unformatted(v,l)?(g=this.get_unformatted("</"+v+">",u),f.push(g),c=this.pos-1,this.tag_type="SINGLE"):"script"==v&&(-1==u.search("type")||u.search("type")>-1&&u.search(/\b(text|application)\/(x-)?(javascript|ecmascript|jscript|livescript)/)>-1)?a||(this.record_tag(v),this.tag_type="SCRIPT"):"style"==v&&(-1==u.search("type")||u.search("type")>-1&&u.search("text/css")>-1)?a||(this.record_tag(v),this.tag_type="STYLE"):"!"==v.charAt(0)?a||(this.tag_type="SINGLE",this.traverse_whitespace()):a||("/"==v.charAt(0)?(this.retrieve_tag(v.substring(1)),this.tag_type="END"):(this.record_tag(v),"html"!=v.toLowerCase()&&(this.indent_content=!0),this.tag_type="START"),this.traverse_whitespace()&&this.space_or_wrap(f),this.Utils.in_array(v,this.Utils.extra_liners)&&(this.print_newline(!1,this.output),this.output.length&&"\n"!=this.output[this.output.length-2]&&this.print_newline(!0,this.output))),a&&(this.pos=k,this.line_char_count=m),f.join("")},this.get_comment=function(a){var b="",c=">",d=!1;this.pos=a;var e=this.input.charAt(this.pos);for(this.pos++;this.pos<=this.input.length&&(b+=e,b[b.length-1]!=c[c.length-1]||-1==b.indexOf(c));)!d&&b.length<10&&(0===b.indexOf("<![if")?(c="<![endif]>",d=!0):0===b.indexOf("<![cdata[")?(c="]]>",d=!0):0===b.indexOf("<![")?(c="]>",d=!0):0===b.indexOf("<!--")?(c="-->",d=!0):0===b.indexOf("{{!")?(c="}}",d=!0):0===b.indexOf("<?")?(c="?>",d=!0):0===b.indexOf("<%")&&(c="%>",d=!0)),e=this.input.charAt(this.pos),this.pos++;return b},this.get_unformatted=function(a,b){if(b&&-1!=b.toLowerCase().indexOf(a))return"";var c="",d="",e=0,f=!0;do{if(this.pos>=this.input.length)return d;if(c=this.input.charAt(this.pos),this.pos++,this.Utils.in_array(c,this.Utils.whitespace)){if(!f){this.line_char_count--;continue}if("\n"==c||"\r"==c){d+="\n",this.line_char_count=0;continue}}d+=c,this.line_char_count++,f=!0,o&&"{"==c&&d.length&&"{"==d[d.length-2]&&(d+=this.get_unformatted("}}"),e=d.length)}while(-1==d.toLowerCase().indexOf(a,e));return d},this.get_token=function(){var a;if("TK_TAG_SCRIPT"==this.last_token||"TK_TAG_STYLE"==this.last_token){var b=this.last_token.substr(7);return a=this.get_contents_to(b),"string"!=typeof a?a:[a,"TK_"+b]}if("CONTENT"==this.current_mode)return a=this.get_content(),"string"!=typeof a?a:[a,"TK_CONTENT"];if("TAG"==this.current_mode){if(a=this.get_tag(),"string"!=typeof a)return a;var c="TK_TAG_"+this.tag_type;return[a,c]}},this.get_full_indent=function(a){return a=this.indent_level+a||0,1>a?"":new Array(a+1).join(this.indent_string)},this.is_unformatted=function(a,b){if(!this.Utils.in_array(a,b))return!1;if("a"!=a.toLowerCase()||!this.Utils.in_array("a",b))return!0;var c=this.get_tag(!0),d=(c||"").match(/^\s*<\s*\/?([a-z]*)\s*[^>]*>\s*$/);return!d||this.Utils.in_array(d,b)?!0:!1},this.printer=function(a,b,e,f,g){this.input=a||"",this.output=[],this.indent_character=b,this.indent_string="",this.indent_size=e,this.brace_style=g,this.indent_level=0,this.wrap_line_length=f,this.line_char_count=0;for(var h=0;h<this.indent_size;h++)this.indent_string+=this.indent_character;this.print_newline=function(a,b){this.line_char_count=0,b&&b.length&&(a||"\n"!=b[b.length-1])&&("\n"!=b[b.length-1]&&(b[b.length-1]=d(b[b.length-1])),b.push("\n"))},this.print_indentation=function(a){for(var b=0;b<this.indent_level;b++)a.push(this.indent_string),this.line_char_count+=this.indent_string.length},this.print_token=function(a){(!this.is_whitespace(a)||this.output.length)&&((a||""!==a)&&this.output.length&&"\n"==this.output[this.output.length-1]&&(this.print_indentation(this.output),a=c(a)),this.print_token_raw(a))},this.print_token_raw=function(a){this.newlines>0&&(a=d(a)),a&&""!==a&&(a.length>1&&"\n"==a[a.length-1]?(this.output.push(a.slice(0,-1)),this.print_newline(!1,this.output)):this.output.push(a));for(var b=0;b<this.newlines;b++)this.print_newline(b>0,this.output);this.newlines=0},this.indent=function(){this.indent_level++},this.unindent=function(){this.indent_level>0&&this.indent_level--}},this}var f,g,h,i,j,k,l,m,n,o,p,q,r,s;for(b=b||{},void 0!==b.wrap_line_length&&0!==parseInt(b.wrap_line_length,10)||void 0===b.max_char||0===parseInt(b.max_char,10)||(b.wrap_line_length=b.max_char),g=void 0===b.indent_inner_html?!1:b.indent_inner_html,h=void 0===b.indent_size?4:parseInt(b.indent_size,10),i=void 0===b.indent_char?" ":b.indent_char,k=void 0===b.brace_style?"collapse":b.brace_style,j=0===parseInt(b.wrap_line_length,10)?32786:parseInt(b.wrap_line_length||250,10),l=b.unformatted||["a","span","img","bdo","em","strong","dfn","code","samp","kbd","var","cite","abbr","acronym","q","sub","sup","tt","i","b","big","small","u","s","strike","font","ins","del","address","dt","pre"],m=void 0===b.preserve_newlines?!0:b.preserve_newlines,n=m?isNaN(parseInt(b.max_preserve_newlines,10))?32786:parseInt(b.max_preserve_newlines,10):0,o=void 0===b.indent_handlebars?!1:b.indent_handlebars,p=void 0===b.wrap_attributes?"auto":b.wrap_attributes,q=void 0===b.wrap_attributes_indent_size?h:parseInt(b.wrap_attributes_indent_size,10)||h,r=void 0===b.end_with_newline?!1:b.end_with_newline,s=Array.isArray(b.extra_liners)?b.extra_liners.concat():"string"==typeof b.extra_liners?b.extra_liners.split(","):"head,body,/html".split(","),b.indent_with_tabs&&(i="	",h=1),f=new e,f.printer(a,i,h,j,k);;){var t=f.get_token();if(f.token_text=t[0],f.token_type=t[1],"TK_EOF"==f.token_type)break;switch(f.token_type){case"TK_TAG_START":f.print_newline(!1,f.output),f.print_token(f.token_text),f.indent_content&&(f.indent(),f.indent_content=!1),f.current_mode="CONTENT";break;case"TK_TAG_STYLE":case"TK_TAG_SCRIPT":f.print_newline(!1,f.output),f.print_token(f.token_text),f.current_mode="CONTENT";break;case"TK_TAG_END":if("TK_CONTENT"==f.last_token&&""===f.last_text){var u=f.token_text.match(/\w+/)[0],v=null;f.output.length&&(v=f.output[f.output.length-1].match(/(?:<|{{#)\s*(\w+)/)),(null==v||v[1]!=u&&!f.Utils.in_array(v[1],l))&&f.print_newline(!1,f.output)}f.print_token(f.token_text),f.current_mode="CONTENT";break;case"TK_TAG_SINGLE":var w=f.token_text.match(/^\s*<([a-z-]+)/i);w&&f.Utils.in_array(w[1],l)||f.print_newline(!1,f.output),f.print_token(f.token_text),f.current_mode="CONTENT";break;case"TK_TAG_HANDLEBARS_ELSE":f.print_token(f.token_text),f.indent_content&&(f.indent(),f.indent_content=!1),f.current_mode="CONTENT";break;case"TK_TAG_HANDLEBARS_COMMENT":f.print_token(f.token_text),f.current_mode="TAG";break;case"TK_CONTENT":f.print_token(f.token_text),f.current_mode="TAG";break;case"TK_STYLE":case"TK_SCRIPT":if(""!==f.token_text){f.print_newline(!1,f.output);var x,y=f.token_text,z=1;"TK_SCRIPT"==f.token_type?x="function"==typeof js_beautify&&js_beautify:"TK_STYLE"==f.token_type&&(x="function"==typeof css_beautify&&css_beautify),"keep"==b.indent_scripts?z=0:"separate"==b.indent_scripts&&(z=-f.indent_level);var A=f.get_full_indent(z);if(x)y=x(y.replace(/^\s*/,A),b);else{var B=y.match(/^\s*/)[0],C=B.match(/[^\n\r]*$/)[0].split(f.indent_string).length-1,D=f.get_full_indent(z-C);y=y.replace(/^\s*/,A).replace(/\r\n|\r|\n/g,"\n"+D).replace(/\s+$/,"")}y&&(f.print_token_raw(y),f.print_newline(!0,f.output))}f.current_mode="TAG";break;default:""!==f.token_text&&f.print_token(f.token_text)}f.last_token=f.token_type,f.last_text=f.token_text}var E=f.output.join("").replace(/[\r\n\t ]+$/,"");return r&&(E+="\n"),E}var j,k;return{_init:h,toggle:f,beautify:i}},a.FroalaEditor.RegisterCommand("html",{title:"Code View",undo:!1,focus:!1,forcedRefresh:!0,callback:function(){this.codeView.toggle()}}),a.FroalaEditor.DefineIcon("html",{NAME:"code"})}(jQuery);
/*!
 * froala_editor v2.8.0 (https://www.froala.com/wysiwyg-editor)
 * License https://froala.com/wysiwyg-editor/terms/
 * Copyright 2014-2018 Froala Labs
 */

!function(n){"function"==typeof define&&define.amd?define(["jquery"],n):"object"==typeof module&&module.exports?module.exports=function(e,t){return t===undefined&&(t="undefined"!=typeof window?require("jquery"):require("jquery")(e)),n(t)}:n(window.jQuery)}(function(b){b.extend(b.FE.POPUP_TEMPLATES,{"embedly.insert":"[_BUTTONS_][_URL_LAYER_]","embedly.edit":"[_BUTTONS_]"}),b.extend(b.FE.DEFAULTS,{embedlyKey:null,embedlyInsertButtons:["embedlyBack","|"],embedlyEditButtons:["embedlyRemove"],embedlyScriptPath:"https://cdn.embedly.com/widgets/platform.js"}),b.FE.PLUGINS.embedly=function(o){function t(){o.events.on("html.processGet",d),o.events.$on(o.$el,"click touchend","div.fr-embedly",r),o.events.on("mousedown window.mousedown",u),o.events.on("window.touchmove",m),o.events.on("mouseup window.mouseup",f),o.events.on("commands.mousedown",function(e){0<e.parents(".fr-toolbar").length&&f()}),o.events.on("blur video.hideResizer commands.undo commands.redo element.dropped",function(){f(!0)}),o.events.on("element.beforeDrop",function(e){if(e.hasClass("fr-embedly"))return e.html(e.attr("data-original-embed")),e}),o.events.on("keydown",function(e){var t=e.which;return!s||t!=b.FE.KEYCODE.BACKSPACE&&t!=b.FE.KEYCODE.DELETE?s&&t==b.FE.KEYCODE.ESC?(f(!0),e.preventDefault(),!1):s&&t!=b.FE.KEYCODE.F10&&!o.keys.isBrowserAction(e)?(e.preventDefault(),!1):void 0:(e.preventDefault(),a(),!1)},!0),o.events.on("toolbar.esc",function(){if(s)return o.events.disableBlur(),o.events.focus(),!1},!0),o.events.on("toolbar.focusEditor",function(){if(s)return!1},!0),o.events.on("snapshot.after",function(e){var t=o.doc.createElement("div");t.innerHTML=e.html,d(t),e.html=t.innerHTML}),o.win.embedly&&o.win.embedly("on","card.resize",function(e){var t=b(e);t.parents(".fr-embedly").attr("contenteditable",!1).attr("draggable",!0).css("height",t.height()).addClass("fr-draggable")}),i(!0)}var s,n;function r(e){s=b(this),function(){n||function(){o.shared.$embedly_resizer?(n=o.shared.$embedly_resizer,o.shared.$embedly_overlay,o.events.on("destroy",function(){n.appendTo(b("body:first"))},!0)):(o.shared.$embedly_resizer=b('<div class="fr-embedly-resizer"></div>'),n=o.shared.$embedly_resizer,o.events.$on(n,"mousedown",function(e){e.stopPropagation()},!0));o.events.on("shared.destroy",function(){n.html("").removeData().remove(),n=null},!0)}();(o.$wp||o.$sc).append(n),n.data("instance",o),n.css("top",(o.opts.iframe?s.offset().top-1+o.$iframe.position().top:s.offset().top-o.$wp.offset().top-1)+o.$wp.scrollTop()).css("left",(o.opts.iframe?s.offset().left-1:s.offset().left-o.$wp.offset().left-1)+o.$wp.scrollLeft()).css("width",s.outerWidth()).css("height",s.height()).addClass("fr-active")}(),function(){var e=o.popups.get("embedly.edit");e||(e=function(){var e="";if(0<o.opts.embedlyEditButtons.length){e+='<div class="fr-buttons">',e+=o.button.buildList(o.opts.embedlyEditButtons);var t={buttons:e+="</div>"},n=o.popups.create("embedly.edit",t);return o.events.$on(o.$wp,"scroll.emebdly-edit",function(){s&&o.popups.isVisible("embedly.edit")&&(o.events.disableBlur(),r.call(s.get(0)))}),n}return!1}());if(e){o.popups.setContainer("embedly.edit",o.$sc),o.popups.refresh("embedly.edit");var t=s.offset().left+s.outerWidth()/2,n=s.offset().top+s.outerHeight();o.popups.show("embedly.edit",t,n,s.outerHeight())}}()}function d(e){if(e&&o.node.hasClass(e,"fr-embedly"))e.innerHTML=e.getAttribute("data-original-embed"),e.removeAttribute("draggable"),e.removeAttribute("contenteditable"),e.setAttribute("class",(e.getAttribute("class")||"").replace("fr-draggable",""));else if(e&&e.nodeType==Node.ELEMENT_NODE)for(var t=e.querySelectorAll(".fr-embedly"),n=0;n<t.length;n++)d(t[n])}function i(e){if(e)return o.popups.onRefresh("embedly.insert",l),!0;var t="";0<o.opts.embedlyInsertButtons.length&&(t+='<div class="fr-buttons">',t+=o.button.buildList(o.opts.embedlyInsertButtons),t+="</div>");var n={buttons:t,url_layer:'<div class="fr-embedly-layer fr-active fr-layer" id="fr-embedly-layer-'+o.id+'"><div class="fr-input-line"><input id="fr-embedly-layer-text-'+o.id+'" type="text" placeholder="'+o.language.translate("Paste in a URL to embed")+'" tabIndex="1" aria-required="true"></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="embedlyInsert" tabIndex="2" role="button">'+o.language.translate("Insert")+"</button></div></div>"};return o.popups.create("embedly.insert",n)}function l(){o.popups.get("embedly.insert").find(".fr-embedly-layer input").val("").trigger("change")}function e(e){if(e.length){var t="<a href='"+e+"' class='embedly-card'"+(o.opts.embedlyKey?" data-card-key='"+o.opts.embedlyKey+"'":"")+"></a>";o.html.insert('<div class="fr-embedly fr-draggable" draggable="true" contenteditable="false" data-original-embed="'+t+'">'+t+"</div>"),o.popups.hideAll()}}function a(){if(s&&!1!==o.events.trigger("embedly.beforeRemove",[s])){var e=s;o.popups.hideAll(),f(!0),o.selection.setBefore(e.get(0))||o.selection.setAfter(e.get(0)),e.remove(),o.selection.restore(),o.html.fillEmptyBlocks(),o.undo.saveStep(),o.events.trigger("video.removed",[e])}}function f(e){s&&(o.shared.embedly_exit_flag||!0===e)&&(n.removeClass("fr-active"),o.toolbar.enable(),s.removeClass("fr-active"),s=null,m())}function u(){o.shared.embedly_exit_flag=!0}function m(){o.shared.embedly_exit_flag=!1}return o.shared.embedly_exit_flag=!1,{_init:function(){if(!o.$wp)return!1;if("undefined"!=typeof embedly)t();else if(o.shared.embedlyLoaded||(o.shared.embedlyCallbacks=[]),o.shared.embedlyCallbacks.push(t),!o.shared.embedlyLoaded){o.shared.embedlyLoaded=!0;var e=o.doc.createElement("script");e.type="text/javascript",e.src=o.opts.embedlyScriptPath,e.innerText="",e.onload=function(){for(var e=0;e<o.shared.embedlyCallbacks.length;e++)o.shared.embedlyCallbacks[e]()},o.doc.getElementsByTagName("head")[0].appendChild(e)}},showInsertPopup:function(){var e=o.$tb.find('.fr-command[data-cmd="embedly"]'),t=o.popups.get("embedly.insert");if(t||(t=i()),!t.hasClass("fr-active"))if(o.popups.refresh("embedly.insert"),o.popups.setContainer("embedly.insert",o.$tb),e.is(":visible")){var n=e.offset().left+e.outerWidth()/2,s=e.offset().top+(o.opts.toolbarBottom?10:e.outerHeight()-10);o.popups.show("embedly.insert",n,s,e.outerHeight())}else o.position.forSelection(t),o.popups.show("embedly.insert")},insert:function(){e(o.popups.get("embedly.insert").find(".fr-embedly-layer input").val())},remove:a,get:function(){return s},add:e,back:function(){s?(o.events.disableBlur(),s.trigger("click")):(o.events.disableBlur(),o.selection.restore(),o.events.enableBlur(),o.popups.hide("embedly.insert"),o.toolbar.showInline())}}},b.FE.DefineIcon("embedly",{NAME:"share-alt"}),b.FE.RegisterCommand("embedly",{undo:!0,focus:!0,title:"Embed URL",popup:!0,callback:function(){this.popups.isVisible("embedly.insert")?(this.$el.find(".fr-marker").length&&(this.events.disableBlur(),this.selection.restore()),this.popups.hide("embedly.insert")):this.embedly.showInsertPopup()},plugin:"embedly"}),b.FE.RegisterCommand("embedlyInsert",{undo:!0,focus:!0,callback:function(){this.embedly.insert()}}),b.FE.DefineIcon("embedlyRemove",{NAME:"trash"}),b.FE.RegisterCommand("embedlyRemove",{title:"Remove",undo:!1,callback:function(){this.embedly.remove()}}),b.FE.DefineIcon("embedlyBack",{NAME:"arrow-left"}),b.FE.RegisterCommand("embedlyBack",{title:"Back",undo:!1,focus:!1,back:!0,callback:function(){this.embedly.back()},refresh:function(e){this.embedly.get()||this.opts.toolbarInline?(e.removeClass("fr-hidden"),e.next(".fr-separator").removeClass("fr-hidden")):(e.addClass("fr-hidden"),e.next(".fr-separator").addClass("fr-hidden"))}})});
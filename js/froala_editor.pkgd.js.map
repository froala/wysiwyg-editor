{"version":3,"file":"froala_editor.pkgd.js","sources":["../../src/js/jquery_helper.js","../../src/js/polyfills.js","../../src/js/defaults.js","../../src/js/editor_v2.js","../../src/js/modules/helpers.js","../../src/js/modules/events.js","../../src/js/modules/accessibility.js","../../src/js/modules/dom/node.js","../../src/js/modules/clean.js","../../src/js/modules/commands.js","../../src/js/modules/edit.js","../../src/js/modules/dom/spaces.js","../../src/js/modules/dom/markers.js","../../src/js/modules/dom/selection.js","../../src/js/modules/options/language.js","../../src/js/modules/options/placeholder.js","../../src/js/modules/html.js","../../src/js/modules/core.js","../../src/js/modules/cursor_lists.js","../../src/js/modules/cursor.js","../../src/js/modules/data.min.js","../../src/js/modules/format.js","../../src/js/modules/keys.js","../../src/js/modules/paste.js","../../src/js/modules/shortcuts.js","../../src/js/modules/snapshot.js","../../src/js/modules/undo.js","../../src/js/modules/options/size.js","../../src/js/modules/ui/tooltip.js","../../src/js/modules/ui/button.js","../../src/js/modules/ui/icon.js","../../src/js/modules/ui/modals.js","../../src/js/modules/ui/popups.js","../../src/js/modules/ui/position.js","../../src/js/modules/ui/refresh.js","../../src/js/modules/ui/text_edit.js","../../src/js/modules/ui/toolbar.js","../../src/js/index.js","../../src/js/plugins/align.js","../../src/js/plugins/char_counter.js","../../src/js/plugins/code_beautifier.js","../../src/js/plugins/code_view.js","../../src/js/plugins/colors.js","../../src/js/plugins/draggable.js","../../src/js/plugins/emoticons.js","../../src/js/plugins/entities.js","../../src/js/plugins/file.js","../../src/js/plugins/font_family.js","../../src/js/plugins/font_size.js","../../src/js/plugins/forms.js","../../src/js/plugins/fullscreen.js","../../src/js/plugins/help.js","../../src/js/plugins/image.js","../../src/js/plugins/image_manager.js","../../src/js/plugins/inline_style.js","../../src/js/plugins/line_breaker.js","../../src/js/plugins/link.js","../../src/js/plugins/lists.js","../../src/js/plugins/paragraph_format.js","../../src/js/plugins/paragraph_style.js","../../src/js/plugins/print.js","../../src/js/plugins/quick_insert.js","../../src/js/plugins/quote.js","../../src/js/plugins/save.js","../../src/js/plugins/special_characters.js","../../src/js/plugins/table.js","../../src/js/plugins/url.js","../../src/js/plugins/video.js","../../src/js/plugins/word_paste.js"],"sourcesContent":["import $ from 'jquery'\n\n$.prototype.contains = function (obj) {\n  if (!obj) return false;\n\n  if (Array.isArray(obj)) {\n    for (var i = 0; i < obj.length; i++) {\n      if (this.contains(obj[i]) && this != obj[i]) return true;\n    }\n\n    return false;\n  }\n\n  for (var i = 0; i < this.length; i++) {\n    if (this[i].nodeType == Node.ELEMENT_NODE && this[i].contains(obj) && this[i] != obj) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\n\n$.prototype.findVisible = function (selector) {\n  var $els = this.find(selector);\n\n  for (var i = $els.length - 1; i >= 0; i--) {\n    if (!$($els[i]).isVisible()) {\n      $els.splice(i, 1);\n    }\n  }\n\n  return $els;\n}\n\n$.prototype.isVisible = function () {\n  return this.css('display') != 'none' && this.css('visiblity') != 'hidden' && this.attr('type') != 'hidden';\n}","// Closest polyfill.\nif (!Element.prototype.matches)\n    Element.prototype.matches = Element.prototype.msMatchesSelector ||\n                                Element.prototype.webkitMatchesSelector;\n\nif (!Element.prototype.closest)\n  Element.prototype.closest = function(s) {\n    var el = this;\n    if (!document.documentElement.contains(el)) return null;\n    do {\n        if (el.matches(s)) return el;\n        el = el.parentElement || el.parentNode;\n    } while (el !== null && el.nodeType === 1);\n    return null;\n};\n\n// Matches polyfill.\nif (!Element.prototype.matches) {\n    Element.prototype.matches =\n        Element.prototype.matchesSelector ||\n        Element.prototype.mozMatchesSelector ||\n        Element.prototype.msMatchesSelector ||\n        Element.prototype.oMatchesSelector ||\n        Element.prototype.webkitMatchesSelector ||\n        function(s) {\n            var matches = (this.document || this.ownerDocument).querySelectorAll(s),\n                i = matches.length;\n            while (--i >= 0 && matches.item(i) !== this) {}\n            return i > -1;\n        };\n}\n\n// isArray polyfill.\nif (!Array.isArray) {\n  Array.isArray = function(arg) {\n    return Object.prototype.toString.call(arg) === '[object Array]';\n  };\n}\n\n// firstElementChild polyfill.\n;(function(constructor) {\n    if (constructor &&\n        constructor.prototype &&\n        constructor.prototype.firstElementChild == null) {\n        Object.defineProperty(constructor.prototype, 'firstElementChild', {\n            get: function() {\n                var node, nodes = this.childNodes, i = 0;\n                while (node = nodes[i++]) {\n                    if (node.nodeType === 1) {\n                        return node;\n                    }\n                }\n                return null;\n            }\n        });\n    }\n})(window.Node || window.Element);","export default {\n  DEFAULTS: {\n    initOnClick: false,\n    pluginsEnabled: null\n  },\n\n  MODULES: {},\n\n  PLUGINS: {},\n\n  VERSION: '@VERSION',\n\n  INSTANCES: [],\n\n  OPTS_MAPPING: {},\n\n  SHARED: {},\n\n  ID: 0\n}","import './jquery_helper'\nimport './polyfills'\n\nimport $ from 'jquery'\nimport defaults from './defaults'\n\nfunction FroalaEditor(el, options) {\n  return new FroalaEditor.Bootstrap(el, options)\n}\n\n$.fn.froalaEditor = function (option) {\n var arg_list = [];\n\n for (var i = 0; i < arguments.length; i++) {\n   arg_list.push(arguments[i]);\n }\n\n if (typeof option == 'string') {\n   var returns = [];\n\n   this.each(function () {\n     var $this = $(this);\n     var editor = $this.data('froala.editor');\n\n     if (!editor) {\n\n       return console.warn('Editor should be initialized before calling the ' + option + ' method.');\n     }\n\n     var context;\n     var nm;\n\n     // Might do a module call.\n     if (option.indexOf('.') > 0 && editor[option.split('.')[0]]) {\n       if (editor[option.split('.')[0]]) {\n         context = editor[option.split('.')[0]];\n       }\n       nm = option.split('.')[1];\n     }\n     else {\n       context = editor;\n       nm = option.split('.')[0]\n     }\n\n     if (context[nm]) {\n       var returned_value = context[nm].apply(editor, arg_list.slice(1));\n\n       if (returned_value === undefined) {\n         returns.push(this);\n       }\n       else if (returns.length === 0) {\n         returns.push(returned_value);\n       }\n     }\n     else {\n\n       return $.error('Method ' + option + ' does not exist in Froala Editor.');\n     }\n   });\n\n   return (returns.length == 1) ? returns[0] : returns;\n }\n else if (typeof option === 'object' || !option) {\n\n   return this.each(function () {\n     var editor = $(this).data('froala.editor');\n\n     if (!editor) {\n       var that = this;\n       new FroalaEditor(that, option);\n     }\n   });\n }\n}\n\nObject.assign(FroalaEditor, defaults);\n\n$.fn.froalaEditor.Constructor = FroalaEditor;\n$.FroalaEditor = FroalaEditor;\n$.FE = FroalaEditor;\n\nexport default FroalaEditor\n","import $ from 'jquery'\nimport FE from 'froala_editor'\n\nFE.XS = 0\nFE.SM = 1\nFE.MD = 2\nFE.LG = 3\n\n// Chars to allow.\nconst x = 'a-z\\\\u0080-\\\\u009f\\\\u00a1-\\\\uffff0-9-_\\\\.'\n\n// Common regex to avoid double chars.\nFE.LinkRegExCommon = `[${x}]{1,}`\n\n// PORT:something_else.php\nFE.LinkRegExEnd = '((:[0-9]{1,5})|)(((\\\\/|\\\\?|#)[a-z\\\\u00a1-\\\\uffff0-9@?\\\\|!^=%&amp;\\\\/~+#-\\\\\\'*-_{}]*)|())'\n\n// Common TLD\nFE.LinkRegExTLD = `((${FE.LinkRegExCommon})(\\\\.(com|net|org|edu|mil|gov|co|biz|info|me|dev)))`\n\n// Starts with HTTP.\nFE.LinkRegExHTTP = `((ftp|http|https):\\\\/\\\\/${FE.LinkRegExCommon})`\n\n// Authenticate with HTTP.\nFE.LinkRegExAuth = `((ftp|http|https):\\\\/\\\\/[\\\\u0021-\\\\uffff]{1,}@${FE.LinkRegExCommon})`\n\n// Starts with WWWW.\nFE.LinkRegExWWW = `(www\\\\.${FE.LinkRegExCommon}\\\\.[a-z0-9-]{2,24})`\n\n// Join.\nFE.LinkRegEx =  `(${FE.LinkRegExTLD}|${FE.LinkRegExHTTP}|${FE.LinkRegExWWW}|${FE.LinkRegExAuth})${FE.LinkRegExEnd}`\n\n// Link protocols.\nFE.LinkProtocols = ['mailto', 'tel', 'sms', 'notes', 'data']\n\n// https://davidcel.is/posts/stop-validating-email-addresses-with-regex/\nFE.MAIL_REGEX = /.+@.+\\..+/i\n\nFE.MODULES.helpers = function (editor) {\n  /**\n   * Get the IE version.\n   */\n  function _ieVersion() {\n\n    /* global navigator */\n    let rv = -1\n    let ua\n    let re\n\n    if (navigator.appName === 'Microsoft Internet Explorer') {\n      ua = navigator.userAgent\n      re = new RegExp('MSIE ([0-9]{1,}[\\\\.0-9]{0,})')\n\n      if (re.exec(ua) !== null) {\n        rv = parseFloat(RegExp.$1)\n      }\n    }\n    else if (navigator.appName === 'Netscape') {\n      ua = navigator.userAgent\n      re = new RegExp('Trident/.*rv:([0-9]{1,}[\\\\.0-9]{0,})')\n\n      if (re.exec(ua) !== null) {\n        rv = parseFloat(RegExp.$1)\n      }\n    }\n\n    return rv\n  }\n\n  /**\n   * Determine the browser.\n   */\n  function _browser() {\n    const browser = {}\n    const ie_version = _ieVersion()\n\n    if (ie_version > 0) {\n      browser.msie = true\n    }\n    else {\n      const ua = navigator.userAgent.toLowerCase()\n\n      const match =\n          /(edge)[ /]([\\w.]+)/.exec(ua) ||\n          /(chrome)[ /]([\\w.]+)/.exec(ua) ||\n          /(webkit)[ /]([\\w.]+)/.exec(ua) ||\n          /(opera)(?:.*version|)[ /]([\\w.]+)/.exec(ua) ||\n          /(msie) ([\\w.]+)/.exec(ua) ||\n          ua.indexOf('compatible') < 0 && /(mozilla)(?:.*? rv:([\\w.]+)|)/.exec(ua) ||\n          []\n\n      const matched = {\n        browser: match[1] || '',\n        version: match[2] || '0'\n      }\n\n      if (match[1]) {\n        browser[matched.browser] = true\n      }\n\n      // Chrome is Webkit, but Webkit is also Safari.\n      if (browser.chrome) {\n        browser.webkit = true\n      }\n      else if (browser.webkit) {\n        browser.safari = true\n      }\n    }\n\n    if (browser.msie) {\n      browser.version = ie_version\n    }\n\n    return browser\n  }\n\n  function isIOS() {\n\n    return /(iPad|iPhone|iPod)/g.test(navigator.userAgent) && !isWindowsPhone()\n  }\n\n  function isAndroid() {\n\n    return /(Android)/g.test(navigator.userAgent) && !isWindowsPhone()\n  }\n\n  function isBlackberry() {\n\n    return /(Blackberry)/g.test(navigator.userAgent)\n  }\n\n  function isWindowsPhone() {\n\n    return /(Windows Phone)/gi.test(navigator.userAgent)\n  }\n\n  function isMobile() {\n\n    return isAndroid() || isIOS() || isBlackberry()\n  }\n\n  function requestAnimationFrame() {\n\n    return window.requestAnimationFrame ||\n        window.webkitRequestAnimationFrame ||\n        window.mozRequestAnimationFrame ||\n\n        function (callback) {\n          window.setTimeout(callback, 1000 / 60)\n        }\n  }\n\n  function getPX(val) {\n\n    return parseInt(val, 10) || 0\n  }\n\n  function screenSize() {\n    const $test = $(editor.doc.createElement('DIV'))\n    $test.addClass('fr-visibility-helper')\n\n    $('body').first().append($test)\n\n    try {\n      const size = getPX($test.css('margin-left'))\n      $test.remove()\n\n      return size\n    }\n    catch (ex) {\n      return FE.LG\n    }\n  }\n\n  function isTouch() {\n\n    return 'ontouchstart' in window || window.DocumentTouch && document instanceof window.DocumentTouch\n  }\n\n  function isURL(url) {\n    // Check if it starts with http.\n    if (!/^(https?:|ftps?:|)\\/\\//i.test(url)) {\n      return false\n    }\n\n    url = String(url)\n        .replace(/</g, '%3C')\n        .replace(/>/g, '%3E')\n        .replace(/\"/g, '%22')\n        .replace(/ /g, '%20')\n\n    const test_reg = new RegExp(`^${FE.LinkRegExHTTP}${FE.LinkRegExEnd}$`, 'gi')\n\n    return test_reg.test(url)\n  }\n\n  function isEmail(url) {\n    if (/^(https?:|ftps?:|)\\/\\//i.test(url)) {\n      return false\n    }\n\n    return FE.MAIL_REGEX.test(url)\n  }\n\n  // Sanitize URL.\n  function sanitizeURL(url) {\n    const local_path = /^([A-Za-z]:(\\\\){1,2}|[A-Za-z]:((\\\\){1,2}[^\\\\]+)+)(\\\\)?$/i\n\n    if (/^(https?:|ftps?:|)\\/\\//i.test(url)) {\n      return url\n    }\n    else if (local_path.test(url)) {\n      return url\n    }\n    else if (new RegExp(`^(${FE.LinkProtocols.join('|')}):\\\\/\\\\/`, 'i').test(url)) {\n      return url\n    }\n\n    url = encodeURIComponent(url)\n          .replace(/%23/g, '#')\n          .replace(/%2F/g, '/')\n          .replace(/%25/g, '%')\n          .replace(/mailto%3A/gi, 'mailto:')\n          .replace(/file%3A/gi, 'file:')\n          .replace(/sms%3A/gi, 'sms:')\n          .replace(/tel%3A/gi, 'tel:')\n          .replace(/notes%3A/gi, 'notes:')\n          .replace(/data%3Aimage/gi, 'data:image')\n          .replace(/blob%3A/gi, 'blob:')\n          .replace(/webkit-fake-url%3A/gi, 'webkit-fake-url:')\n          .replace(/%3F/g, '?')\n          .replace(/%3D/g, '=')\n          .replace(/%26/g, '&')\n          .replace(/&amp;/g, '&')\n          .replace(/%2C/g, ',')\n          .replace(/%3B/g, ';')\n          .replace(/%2B/g, '+')\n          .replace(/%40/g, '@')\n          .replace(/%5B/g, '[')\n          .replace(/%5D/g, ']')\n          .replace(/%7B/g, '{')\n          .replace(/%7D/g, '}')\n\n\n    return url\n  }\n\n  function isArray(obj) {\n\n    return obj && !Object.prototype.propertyIsEnumerable.call(obj, 'length') &&\n\n        typeof obj === 'object' && typeof obj.length === 'number'\n  }\n\n  /*\n   * Transform RGB color to hex value.\n   */\n  function RGBToHex(rgb) {\n    function hex(x) {\n\n      return `0${parseInt(x, 10).toString(16)}`.slice(-2)\n    }\n\n    try {\n\n      if (!rgb || rgb === 'transparent') {\n        return ''\n      }\n\n      if (/^#[0-9A-F]{6}$/i.test(rgb)) {\n        return rgb\n      }\n\n      rgb = rgb.match(/^rgb\\((\\d+),\\s*(\\d+),\\s*(\\d+)\\)$/)\n\n      return `#${hex(rgb[1])}${hex(rgb[2])}${hex(rgb[3])}`.toUpperCase()\n    }\n    catch (ex) {\n\n      return null\n    }\n  }\n\n  function HEXtoRGB(hex) {\n\n    // Expand shorthand form (e.g. \"03F\") to full form (e.g. \"0033FF\")\n    const shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i\n\n    hex = hex.replace(shorthandRegex, (m, r, g, b) => r + r + g + g + b + b)\n\n    const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex)\n\n    return result ? `rgb(${parseInt(result[1], 16)}, ${parseInt(result[2], 16)}, ${parseInt(result[3], 16)})` : ''\n  }\n\n  /*\n   * Get block alignment.\n   */\n  let default_alignment\n\n  function getAlignment($block) {\n    if (!$block.css) {\n      $block = $($block)\n    }\n\n    let alignment = ($block.css('text-align') || '').replace(/-(.*)-/g, '')\n\n    // Detect rtl.\n    if (['left', 'right', 'justify', 'center'].indexOf(alignment) < 0) {\n      if (!default_alignment) {\n        const $div = $(`<div dir=\"${editor.opts.direction === 'rtl' ? 'rtl' : 'auto'}\" style=\"text-align: ${editor.$el.css('text-align')}; position: fixed; left: -3000px;\"><span id=\"s1\">.</span><span id=\"s2\">.</span></div>`)\n        $('body:first').append($div)\n\n        const l1 = $div.find('#s1').get(0).getBoundingClientRect().left\n        const l2 = $div.find('#s2').get(0).getBoundingClientRect().left\n\n        $div.remove()\n\n        default_alignment = l1 < l2 ? 'left' : 'right'\n      }\n\n      alignment = default_alignment\n    }\n\n    return alignment\n  }\n\n  /**\n   * Check if is mac.\n   */\n  let is_mac = null\n\n  function isMac() {\n    if (is_mac === null) {\n      is_mac = navigator.platform.toUpperCase().indexOf('MAC') >= 0\n    }\n\n    return is_mac\n  }\n\n  // https://github.com/lazd/scopedQuerySelectorShim/blob/master/src/scopedQuerySelectorShim.js\n  function _scopeShim() {\n    // Match usage of scope\n    const scopeRE = /^\\s*:scope/gi\n\n    // A temporary element to query against for elements not currently in the DOM\n    // We'll also use this element to test for :scope support\n    const container = editor.o_doc.createElement('div')\n\n    // Overrides\n    function overrideNodeMethod(prototype, methodName) {\n\n      // Store the old method for use later\n      const oldMethod = prototype[methodName]\n\n      // Override the method\n      prototype[methodName] = function (query) {\n        let nodeList\n        let gaveId = false\n        let gaveContainer = false\n\n        if (query && query.match(scopeRE)) {\n\n          // Remove :scope\n          query = query.replace(scopeRE, '')\n\n          if (!this.parentNode) {\n\n            // Add to temporary container\n            container.appendChild(this)\n            gaveContainer = true\n          }\n\n          const parentNode = this.parentNode\n\n          if (!this.id) {\n\n            // Give temporary ID\n            this.id = `rootedQuerySelector_id_${(new Date()).getTime()}`\n            gaveId = true\n          }\n\n          // Find elements against parent node\n          nodeList = oldMethod.call(parentNode, `#${this.id} ${query}`)\n\n          // Reset the ID\n          if (gaveId) {\n            this.id = ''\n          }\n\n          // Remove from temporary container\n          if (gaveContainer) {\n            container.removeChild(this)\n          }\n\n          return nodeList\n        }\n\n\n          // No immediate child selector used\n\n        return oldMethod.call(this, query)\n\n      }\n    }\n\n    // Check if the browser supports :scope\n    try {\n\n      // Browser supports :scope, do nothing\n      container.querySelectorAll(':scope *')\n    }\n    catch (e) {\n      // Browser doesn't support :scope, add polyfill\n      overrideNodeMethod(Element.prototype, 'querySelector')\n      overrideNodeMethod(Element.prototype, 'querySelectorAll')\n      overrideNodeMethod(HTMLElement.prototype, 'querySelector')\n      overrideNodeMethod(HTMLElement.prototype, 'querySelectorAll')\n    }\n  }\n\n  function scrollTop() {\n\n    // Firefox, Chrome, Opera, Safari\n    if (editor.o_win.pageYOffset) {\n      return editor.o_win.pageYOffset\n    }\n\n    // Internet Explorer 6 - standards mode\n    if (editor.o_doc.documentElement && editor.o_doc.documentElement.scrollTop) {\n      return editor.o_doc.documentElement.scrollTop\n    }\n\n    // Internet Explorer 6, 7 and 8\n    if (editor.o_doc.body.scrollTop) {\n      return editor.o_doc.body.scrollTop\n    }\n\n    return 0\n  }\n\n  function scrollLeft() {\n\n    // Firefox, Chrome, Opera, Safari\n    if (editor.o_win.pageXOffset) {\n      return editor.o_win.pageXOffset\n    }\n\n    // Internet Explorer 6 - standards mode\n    if (editor.o_doc.documentElement && editor.o_doc.documentElement.scrollLeft) {\n      return editor.o_doc.documentElement.scrollLeft\n    }\n\n    // Internet Explorer 6, 7 and 8\n    if (editor.o_doc.body.scrollLeft) {\n      return editor.o_doc.body.scrollLeft\n    }\n\n    return 0\n  }\n\n  // https://stackoverflow.com/a/7557433/1806855\n  function isInViewPort(el) {\n    const rect = el.getBoundingClientRect()\n\n    return (\n        rect.top >= 0 && rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) || // Top is higher than 0 and bottom is smaller than the window height.\n        rect.top <= 0 && rect.bottom >= (window.innerHeight || document.documentElement.clientHeight) // Top is smaller than 0 and bottom is higher than window height.\n      )\n  }\n\n  /**\n   * Tear up.\n   */\n  function _init() {\n    editor.browser = _browser()\n    _scopeShim()\n  }\n\n  return {\n    _init,\n    isIOS,\n    isMac,\n    isAndroid,\n    isBlackberry,\n    isWindowsPhone,\n    isMobile,\n    isEmail,\n    requestAnimationFrame,\n    getPX,\n    screenSize,\n    isTouch,\n    sanitizeURL,\n    isArray,\n    RGBToHex,\n    HEXtoRGB,\n    isURL,\n    getAlignment,\n    scrollTop,\n    scrollLeft,\n    isInViewPort\n  }\n}\n","import './helpers.js'\n\nimport $ from 'jquery'\nimport FE from 'froala_editor'\n\nFE.MODULES.events = function (editor) {\n  const _events = {}\n  let _do_blur\n\n  function _assignEvent($el, evs, handler) {\n    $on($el, evs, handler)\n  }\n\n  function _forPaste() {\n    _assignEvent(editor.$el, 'cut copy paste beforepaste', (e) => {\n      trigger(e.type, [e])\n    })\n  }\n\n  function _forElement() {\n    _assignEvent(editor.$el, 'click mouseup mousedown touchstart touchend dragenter dragover dragleave dragend drop dragstart', (e) => {\n      trigger(e.type, [e])\n    })\n\n    on('mousedown', () => {\n      for (let i = 0; i < FE.INSTANCES.length; i++) {\n        if (FE.INSTANCES[i] !== editor && FE.INSTANCES[i].popups && FE.INSTANCES[i].popups.areVisible()) {\n          FE.INSTANCES[i].$el.find('.fr-marker').remove()\n        }\n      }\n    })\n  }\n\n  function _forKeys() {\n\n    // Map events.\n    _assignEvent(editor.$el, 'keydown keypress keyup input', (e) => {\n      trigger(e.type, [e])\n    })\n  }\n\n  function _forWindow() {\n    _assignEvent(editor.$win, editor._mousedown, (e) => {\n      trigger('window.mousedown', [e])\n      enableBlur()\n    })\n\n    _assignEvent(editor.$win, editor._mouseup, (e) => {\n      trigger('window.mouseup', [e])\n    })\n\n    _assignEvent(editor.$win, 'cut copy keydown keyup touchmove touchend', (e) => {\n      trigger(`window.${e.type}`, [e])\n    })\n  }\n\n  function _forDocument() {\n    _assignEvent(editor.$doc, 'dragend drop', (e) => {\n      trigger(`document.${e.type}`, [e])\n    })\n  }\n\n  function focus(do_focus) {\n    let info\n\n    if (typeof do_focus === 'undefined') {\n      do_focus = true\n    }\n\n    if (!editor.$wp) {\n      return false\n    }\n\n    // Focus the editor window.\n    if (editor.helpers.isIOS()) {\n      editor.$win.get(0).focus()\n    }\n\n    // If there is focus, stop.\n    if (editor.core.hasFocus()) {\n      return false\n    }\n\n    // If there is no focus, then force focus.\n    if (!editor.core.hasFocus() && do_focus) {\n      const st = editor.$win.scrollTop()\n\n      // Hack to prevent scrolling.\n      if (editor.browser.msie && editor.$box) {\n        editor.$box.css('position', 'fixed')\n      }\n\n      // hack to prevent scrolling.\n      if (editor.browser.msie && editor.$wp) {\n        editor.$wp.css('overflow', 'visible')\n      }\n\n      disableBlur()\n      editor.el.focus()\n      editor.events.trigger('focus')\n      enableBlur()\n\n      // Revert position.\n      if (editor.browser.msie && editor.$box) {\n        editor.$box.css('position', '')\n      }\n\n      // Revert scroll.\n      if (editor.browser.msie && editor.$wp) {\n        editor.$wp.css('overflow', 'auto')\n      }\n\n      if (st !== editor.$win.scrollTop()) {\n        editor.$win.scrollTop(st)\n      }\n\n      info = editor.selection.info(editor.el)\n\n      // If selection is at start, we should make sure we're in the first block tag.\n      if (!info.atStart) {\n        return false\n      }\n    }\n\n    // Don't go further if we haven't focused or there are markers.\n    if (!editor.core.hasFocus() || editor.$el.find('.fr-marker').length > 0) {\n\n      return false\n    }\n\n    info = editor.selection.info(editor.el)\n\n    if (info.atStart && editor.selection.isCollapsed()) {\n      if (editor.html.defaultTag() !== null) {\n        const marker = editor.markers.insert()\n\n        if (marker && !editor.node.blockParent(marker)) {\n          $(marker).remove()\n\n          const element = editor.$el.find(editor.html.blockTagsQuery()).get(0)\n\n          if (element) {\n            $(element).prepend(FE.MARKERS)\n            editor.selection.restore()\n          }\n        }\n        else if (marker) {\n          $(marker).remove()\n        }\n      }\n    }\n  }\n\n  let focused = false\n\n  function _forFocus() {\n    _assignEvent(editor.$el, 'focus', (e) => {\n      if (blurActive()) {\n        focus(false)\n\n        if (focused === false) {\n          trigger(e.type, [e])\n        }\n      }\n    })\n\n    _assignEvent(editor.$el, 'blur', (e) => {\n      if (blurActive() /* && document.activeElement !== this */) {\n        if (focused === true) {\n          trigger(e.type, [e])\n          enableBlur()\n        }\n      }\n    })\n\n    on('focus', () => {\n      focused = true\n    })\n\n    on('blur', () => {\n      focused = false\n    })\n  }\n\n  function _forMouse() {\n    if (editor.helpers.isMobile()) {\n      editor._mousedown = 'touchstart'\n      editor._mouseup = 'touchend'\n      editor._move = 'touchmove'\n      editor._mousemove = 'touchmove'\n    }\n    else {\n      editor._mousedown = 'mousedown'\n      editor._mouseup = 'mouseup'\n      editor._move = ''\n      editor._mousemove = 'mousemove'\n    }\n  }\n\n  function _buttonMouseDown(e) {\n    const $btn = $(e.currentTarget)\n\n    if (editor.edit.isDisabled() || editor.node.hasClass($btn.get(0), 'fr-disabled')) {\n      e.preventDefault()\n\n      return false\n    }\n\n    // Not click button.\n    if (e.type === 'mousedown' && e.which !== 1) {\n      return true\n    }\n\n    // Scroll in list.\n    if (!editor.helpers.isMobile()) {\n      e.preventDefault()\n    }\n\n    if ((editor.helpers.isAndroid() || editor.helpers.isWindowsPhone()) && $btn.parents('.fr-dropdown-menu').length === 0) {\n      e.preventDefault()\n      e.stopPropagation()\n    }\n\n    // Simulate click.\n    $btn.addClass('fr-selected')\n\n    editor.events.trigger('commands.mousedown', [$btn])\n  }\n\n  function _buttonMouseUp(e, handler) {\n    const $btn = $(e.currentTarget)\n\n    if (editor.edit.isDisabled() || editor.node.hasClass($btn.get(0), 'fr-disabled')) {\n      e.preventDefault()\n\n      return false\n    }\n\n    if (e.type === 'mouseup' && e.which !== 1) {\n      return true\n    }\n\n    if (!editor.node.hasClass($btn.get(0), 'fr-selected')) {\n      return true\n    }\n\n    if (e.type !== 'touchmove') {\n      e.stopPropagation()\n      e.stopImmediatePropagation()\n      e.preventDefault()\n\n      // Simulate click.\n      if (!editor.node.hasClass($btn.get(0), 'fr-selected')) {\n        editor.button.getButtons('.fr-selected', true).removeClass('fr-selected')\n\n        return false\n      }\n      editor.button.getButtons('.fr-selected', true).removeClass('fr-selected')\n\n      if ($btn.data('dragging') || $btn.attr('disabled')) {\n        $btn.removeData('dragging')\n\n        return false\n      }\n\n      const timeout = $btn.data('timeout')\n\n      if (timeout) {\n        clearTimeout(timeout)\n        $btn.removeData('timeout')\n      }\n\n      handler.apply(editor, [e])\n    }\n    else if (!$btn.data('timeout')) {\n      $btn.data('timeout', setTimeout(() => {\n        $btn.data('dragging', true)\n      }, 100))\n    }\n  }\n\n  function enableBlur() {\n    _do_blur = true\n  }\n\n  function disableBlur() {\n    _do_blur = false\n  }\n\n  function blurActive() {\n    return _do_blur\n  }\n\n  /**\n   * Bind click on an element.\n   */\n  function bindClick($element, selector, handler) {\n    $on($element, editor._mousedown, selector, (e) => {\n      if (!editor.edit.isDisabled()) {\n        _buttonMouseDown(e)\n      }\n    }, true)\n\n    $on($element, `${editor._mouseup} ${editor._move}`, selector, (e) => {\n      if (!editor.edit.isDisabled()) {\n        _buttonMouseUp(e, handler)\n      }\n    }, true)\n\n    $on($element, 'mousedown click mouseup', selector, (e) => {\n      if (!editor.edit.isDisabled()) {\n        e.stopPropagation()\n      }\n    }, true)\n\n    on('window.mouseup', () => {\n      if (!editor.edit.isDisabled()) {\n        $element.find(selector).removeClass('fr-selected')\n        enableBlur()\n      }\n    })\n  }\n\n  /**\n   * Add event.\n   */\n  function on(name, callback, first) {\n    const names = name.split(' ')\n\n    if (names.length > 1) {\n      for (let i = 0; i < names.length; i++) {\n        on(names[i], callback, first)\n      }\n\n      return true\n    }\n\n    if (typeof first === 'undefined') {\n      first = false\n    }\n\n    let callbacks\n\n    if (name.indexOf('shared.') !== 0) {\n      _events[name] = _events[name] || []\n      callbacks = _events[name]\n    }\n    else {\n      editor.shared._events[name] = editor.shared._events[name] || []\n      callbacks = editor.shared._events[name]\n    }\n\n    if (first) {\n      callbacks.unshift(callback)\n    }\n    else {\n      callbacks.push(callback)\n    }\n  }\n\n  let $_events = []\n\n  function $on($el, evs, selector, callback, shared) {\n    if (typeof selector === 'function') {\n      shared = callback\n      callback = selector\n      selector = false\n    }\n\n    const ary = !shared ? $_events : editor.shared.$_events\n    const id = !shared ? editor.id : editor.sid\n\n    const eventName = `${evs.trim().split(' ').join(`.ed${id} `)}.ed${id}`\n\n    if (!selector) {\n      $el.on(eventName, callback)\n    }\n    else {\n      $el.on(eventName, selector, callback)\n    }\n\n    ary.push([$el, eventName])\n  }\n\n  function _$off(evs) {\n    for (let i = 0; i < evs.length; i++) {\n      evs[i][0].off(evs[i][1])\n    }\n  }\n\n  function $off() {\n    _$off($_events)\n    $_events = []\n\n    if (editor.shared.count === 0) {\n      _$off(editor.shared.$_events)\n      editor.shared.$_events = []\n    }\n  }\n\n  /**\n   * Trigger an event.\n   */\n  function trigger(name, args, force) {\n    if (!editor.edit.isDisabled() || force) {\n      let callbacks\n\n      if (name.indexOf('shared.') !== 0) {\n        callbacks = _events[name]\n      }\n      else {\n        if (editor.shared.count > 0) {\n          return false\n        }\n\n        callbacks = editor.shared._events[name]\n      }\n\n      let val\n\n      if (callbacks) {\n        for (let i = 0; i < callbacks.length; i++) {\n          val = callbacks[i].apply(editor, args)\n\n          if (val === false) {\n            return false\n          }\n        }\n      }\n\n      if (editor.opts.events && editor.opts.events[name]) {\n        val = editor.opts.events[name].apply(editor, args)\n\n        if (val === false) {\n          return false\n        }\n      }\n\n      // Trigger event outside.\n      val = editor.$oel.triggerHandler(`froalaEditor.${name}`, $.merge([editor], args || []))\n\n      if (val === false) {\n        return false\n      }\n\n      return val\n    }\n  }\n\n  function chainTrigger(name, param, force) {\n    if (!editor.edit.isDisabled() || force) {\n      let callbacks\n\n      if (name.indexOf('shared.') !== 0) {\n        callbacks = _events[name]\n      }\n      else {\n        if (editor.shared.count > 0) {\n          return false\n        }\n        callbacks = editor.shared._events[name]\n      }\n\n      let resp\n\n      if (callbacks) {\n        for (let i = 0; i < callbacks.length; i++) {\n\n          // Get the callback response.\n          resp = callbacks[i].apply(editor, [param])\n\n          // If callback response is defined then assign it to param.\n          if (typeof resp !== 'undefined') {\n            param = resp\n          }\n        }\n      }\n\n      // Trigger event outside.\n      resp = editor.$oel.triggerHandler(`froalaEditor.${name}`, $.merge([editor], [param]))\n\n      // If callback response is defined then assign it to param.\n      if (typeof resp !== 'undefined') {\n        param = resp\n      }\n\n      return param\n    }\n  }\n\n  /**\n   * Destroy\n   */\n  function _destroy() {\n\n    // Clear the events list.\n    for (const k in _events) {\n      if (Object.prototype.hasOwnProperty.call(_events, k)) {\n        delete _events[k]\n      }\n    }\n  }\n\n  function _sharedDestroy() {\n    for (const k in editor.shared._events) {\n      if (Object.prototype.hasOwnProperty.call(editor.shared._events, k)) {\n        delete editor.shared._events[k]\n      }\n    }\n  }\n\n  /**\n   * Tear up.\n   */\n  function _init() {\n    editor.shared.$_events = editor.shared.$_events || []\n    editor.shared._events = {}\n\n    _forMouse()\n\n    _forElement()\n    _forWindow()\n    _forDocument()\n    _forKeys()\n\n    _forFocus()\n    enableBlur()\n\n    _forPaste()\n\n    on('destroy', _destroy)\n    on('shared.destroy', _sharedDestroy)\n  }\n\n  return {\n    _init,\n    on,\n    trigger,\n    bindClick,\n    disableBlur,\n    enableBlur,\n    blurActive,\n    focus,\n    chainTrigger,\n    $on,\n    $off\n  }\n}\n","import './events.js'\n\nimport $ from 'jquery'\nimport FE from 'froala_editor'\n\nFE.MODULES.accessibility = function (editor) {\n\n  // Flag to tell if mouseenter can blur popup elements with tabindex. This is in case that popup shows over the cursor so mouseenter should not blur immediately.\n  // FireFox issue.\n  let can_blur = true\n\n  /*\n   * Focus an element.\n   */\n  function focusToolbarElement($el) {\n\n    // Check if it is empty.\n    // https://github.com/froala/wysiwyg-editor/issues/2427.\n    if (!$el || !$el.length || editor.$el.find('[contenteditable=\"true\"]').is(':focus')) {\n      return\n    }\n\n    // Add blur event handler on the element that do not reside on a popup.\n    if (!$el.data('blur-event-set') && !$el.parents('.fr-popup').length) {\n\n      // Set shared event for blur on element because it resides in a popup.\n      editor.events.$on($el, 'blur', () => {\n\n        // Get current instance.\n        const inst = $el.parents('.fr-toolbar, .fr-popup').data('instance') || editor\n\n        // Check if we should actually trigger blur.\n        if (inst.events.blurActive()) {\n          inst.events.trigger('blur')\n        }\n\n        // Allow blur.\n        // IE hack.\n        setTimeout(() => {\n          inst.events.enableBlur()\n        }, 100)\n      }, true)\n\n      $el.data('blur-event-set', true)\n    }\n\n    // Get current instance.\n    const inst = $el.parents('.fr-toolbar, .fr-popup').data('instance') || editor\n\n    // Do not allow blur on the editor until element focus.\n    inst.events.disableBlur()\n    $el.get(0).focus()\n\n    // Store it as the current focused element.\n    editor.shared.$f_el = $el\n  }\n\n  /*\n   * Focus first or last toolbar button.\n   */\n  function focusToolbar($tb, last) {\n    const position = last ? 'last' : 'first'\n    const $btn = $tb.findVisible('button:not(.fr-disabled), .fr-group span.fr-command')[position]()\n\n    if ($btn.length) {\n      focusToolbarElement($btn)\n\n      return true\n    }\n  }\n\n  /*\n   * Focus a popup content element.\n   */\n  function focusContentElement($el) {\n\n    // Save editor selection only if the element we want to focus is input text or textarea.\n    if ($el.is('input, textarea, select')) {\n      saveSelection()\n    }\n\n    editor.events.disableBlur()\n    $el.get(0).focus()\n\n    return true\n  }\n\n  /*\n   * Focus popup's content.\n   */\n  function focusContent($content, backward) {\n\n    // First input.\n    let $first_input = $content.find('input, textarea, button, select').filter(function () {\n      return $(this).isVisible()\n    }).not(':disabled')\n\n    $first_input = backward ? $first_input.last() : $first_input.first()\n\n    if ($first_input.length) {\n      return focusContentElement($first_input)\n    }\n\n    if (editor.shared.with_kb) {\n\n      // Active item.\n      const $active_item = $content.findVisible('.fr-active-item').first()\n\n      if ($active_item.length) {\n        return focusContentElement($active_item)\n      }\n\n      // First element with tabindex.\n      const $first_tab_index = $content.findVisible('[tabIndex]').first()\n\n      if ($first_tab_index.length) {\n        return focusContentElement($first_tab_index)\n      }\n    }\n  }\n\n  function saveSelection() {\n    if (editor.$el.find('.fr-marker').length === 0 && editor.core.hasFocus()) {\n      editor.selection.save()\n    }\n  }\n\n  function restoreSelection() {\n\n    // Restore selection.\n    if (editor.$el.find('.fr-marker').length) {\n      editor.events.disableBlur()\n      editor.selection.restore()\n      editor.events.enableBlur()\n    }\n  }\n\n  /*\n   * Focus popup.\n   */\n  function focusPopup($popup) {\n\n    // Get popup content without fr-buttons toolbar.\n    const $popup_content = $popup.children().not('.fr-buttons')\n\n    // Blur popup on mouseenter.\n    if (!$popup_content.data('mouseenter-event-set')) {\n      editor.events.$on($popup_content, 'mouseenter', '[tabIndex]', (e) => {\n        const inst = $popup.data('instance') || editor\n\n        // FireFox issue.\n        if (!can_blur) {\n\n          // Popup showed over the cursor.\n          e.stopPropagation()\n          e.preventDefault()\n\n          return\n        }\n        const $focused_item = $popup_content.find(':focus').first()\n\n        if ($focused_item.length && !$focused_item.is('input, button, textarea, select')) {\n          inst.events.disableBlur()\n          $focused_item.blur()\n          inst.events.disableBlur()\n          inst.events.focus()\n        }\n      })\n\n      $popup_content.data('mouseenter-event-set', true)\n    }\n\n    // Focus content if possible, else focus toolbar if the popup is opened with keyboard.\n    if (!focusContent($popup_content) && editor.shared.with_kb) {\n      focusToolbar($popup.find('.fr-buttons'))\n    }\n  }\n\n  /*\n   * Focus modal.\n   */\n  function focusModal($modal) {\n\n    // Make sure we have focus on editing area.\n    if (!editor.core.hasFocus()) {\n      editor.events.disableBlur()\n      editor.events.focus()\n    }\n\n    // Save selection.\n    editor.accessibility.saveSelection()\n    editor.events.disableBlur()\n\n    // Blur editor and clear selection to enable arrow keys scrolling.\n    editor.el.blur()\n    editor.selection.clear()\n\n    editor.events.disableBlur()\n\n    if (editor.shared.with_kb) {\n      $modal.find('.fr-command[tabIndex], [tabIndex]').first().focus()\n    }\n    else {\n      $modal.find('[tabIndex]').first().focus()\n    }\n  }\n\n  /*\n   * Focus popup toolbar or main toolbar.\n   */\n  function focusToolbars() {\n\n    // Look for active popup.\n    const $popup = editor.popups.areVisible()\n\n    if ($popup) {\n      const $tb = $popup.find('.fr-buttons')\n\n      if (!$tb.find('button:focus, .fr-group span:focus').length) {\n        return !focusToolbar($tb)\n      }\n\n      return !focusToolbar($popup.data('instance').$tb)\n\n    }\n\n    // Focus main toolbar if no others were found.\n    return !focusToolbar(editor.$tb)\n  }\n\n  /*\n   * Get the dropdown button that is active and is focused or is active and its commands are focused.\n   */\n  function _getActiveFocusedDropdown() {\n    let $activeDropdown = null\n\n    // Is active and focused.\n    if (editor.shared.$f_el.is('.fr-dropdown.fr-active')) {\n      $activeDropdown = editor.shared.$f_el\n    }\n\n    // Is active and its commands are focused. editor.shared.$f_el is a dropdown command.\n    else if (editor.shared.$f_el.closest('.fr-dropdown-menu').prev().is('.fr-dropdown.fr-active')) {\n      $activeDropdown = editor.shared.$f_el.closest('.fr-dropdown-menu').prev()\n    }\n\n    return $activeDropdown\n  }\n\n  function _moveHorizontally($tb, tab_key, forward) {\n    if (editor.shared.$f_el) {\n      const $activeDropdown = _getActiveFocusedDropdown()\n\n      // A focused active dropdown button.\n      if ($activeDropdown) {\n\n        // Unclick.\n        editor.button.click($activeDropdown)\n        editor.shared.$f_el = $activeDropdown\n      }\n\n      // Focus the next/previous button.\n\n      // Get all toobar buttons.\n      const $buttons = $tb.findVisible('button:not(.fr-disabled), .fr-group span.fr-command')\n\n      // Get focused button position.\n      const index = $buttons.index(editor.shared.$f_el)\n\n      // Last or first button reached.\n      if (index === 0 && !forward || index === $buttons.length - 1 && forward) {\n        let status\n\n        // Focus content if last or first toolbar button is reached.\n        if (tab_key) {\n          if ($tb.parent().is('.fr-popup')) {\n            const $popup_content = $tb.parent().children().not('.fr-buttons')\n            status = !focusContent($popup_content, !forward)\n          }\n\n          if (status === false) {\n            editor.shared.$f_el = null\n          }\n        }\n\n        // Arrow used or popup listeners were not active.\n        if (!tab_key || status !== false) {\n\n          // Focus to the opposite side button of the toolbar.\n          focusToolbar($tb, !forward)\n        }\n      }\n      else {\n\n        // Focus next or previous button.\n        focusToolbarElement($($buttons.get(index + (forward ? 1 : -1))))\n      }\n\n      return false\n    }\n  }\n\n  function moveForward($tb, tab_key) {\n    return _moveHorizontally($tb, tab_key, true)\n  }\n\n  function moveBackward($tb, tab_key) {\n    return _moveHorizontally($tb, tab_key)\n  }\n\n  function _moveVertically(down) {\n    if (editor.shared.$f_el) {\n\n      let $destination\n\n      // Dropdown button.\n      if (editor.shared.$f_el.is('.fr-dropdown.fr-active')) {\n\n        // Focus the first/last dropdown command.\n        if (down) {\n          $destination = editor.shared.$f_el.next().find('.fr-command:not(.fr-disabled)').first()\n        }\n        else {\n          $destination = editor.shared.$f_el.next().find('.fr-command:not(.fr-disabled)').last()\n        }\n\n        focusToolbarElement($destination)\n\n        return false\n      }\n\n      // Dropdown command.\n      else if (editor.shared.$f_el.is('a.fr-command')) {\n\n        // Focus the previous/next dropdown command.\n        if (down) {\n          $destination = editor.shared.$f_el.closest('li').nextAllVisible().first().find('.fr-command:not(.fr-disabled)').first()\n        }\n        else {\n          $destination = editor.shared.$f_el.closest('li').prevAllVisible().first().find('.fr-command:not(.fr-disabled)').first()\n        }\n\n        // Last or first button reached: Focus to the opposite side element of the dropdown.\n        if (!$destination.length) {\n          if (down) {\n            $destination = editor.shared.$f_el.closest('.fr-dropdown-menu').find('.fr-command:not(.fr-disabled)').first()\n          }\n          else {\n            $destination = editor.shared.$f_el.closest('.fr-dropdown-menu').find('.fr-command:not(.fr-disabled)').last()\n          }\n        }\n\n        focusToolbarElement($destination)\n\n        return false\n      }\n    }\n  }\n\n  function moveDown() {\n\n    // Also enable dropdown opening on arrow down.\n    if (editor.shared.$f_el && editor.shared.$f_el.is('.fr-dropdown:not(.fr-active)')) {\n      return enter()\n    }\n\n    return _moveVertically(true)\n\n  }\n\n  function moveUp() {\n    return _moveVertically()\n  }\n\n  function enter() {\n    if (editor.shared.$f_el) {\n\n      // Check if the focused element is a dropdown button.\n      if (editor.shared.$f_el.hasClass('fr-dropdown')) {\n\n        // Do click and focus the first dropdown item.\n        editor.button.click(editor.shared.$f_el)\n      }\n      else if (editor.shared.$f_el.is('button.fr-back')) {\n        if (editor.opts.toolbarInline) {\n          editor.events.disableBlur()\n          editor.events.focus()\n        }\n        const $popup = editor.popups.areVisible(editor)\n\n        // Previous popup will show up so we need to not default focus the popup because back popup button have to be focused.\n        if ($popup) {\n          editor.shared.with_kb = false\n        }\n\n        editor.button.click(editor.shared.$f_el)\n\n        // Focus back popup button.\n        focusPopupButton($popup)\n      }\n      else {\n        editor.events.disableBlur()\n        editor.button.click(editor.shared.$f_el)\n\n        if (editor.shared.$f_el.attr('data-popup')) {\n\n          // Attach button to visible popup.\n          const $visible_popup = editor.popups.areVisible(editor)\n\n          if ($visible_popup) {\n            $visible_popup.data('popup-button', editor.shared.$f_el)\n          }\n        }\n        else if (editor.shared.$f_el.attr('data-modal')) {\n\n          // Attach button to visible modal.\n          const $visible_modal = editor.modals.areVisible(editor)\n\n          if ($visible_modal) {\n            $visible_modal.data('modal-button', editor.shared.$f_el)\n          }\n        }\n\n        editor.shared.$f_el = null\n      }\n\n      return false\n    }\n  }\n\n  function focusEditor() {\n    if (editor.shared.$f_el) {\n      editor.events.disableBlur()\n      editor.shared.$f_el.blur()\n      editor.shared.$f_el = null\n    }\n\n    // Trigger custom behavior.\n    if (editor.events.trigger('toolbar.focusEditor') === false) {\n      return\n    }\n\n    editor.events.disableBlur()\n    editor.$el.get(0).focus()\n    editor.events.focus()\n  }\n\n  function esc($tb) {\n    if (editor.shared.$f_el) {\n      const $activeDropdown = _getActiveFocusedDropdown()\n\n      // Active focused dropdown.\n      if ($activeDropdown) {\n\n        // Unclick.\n        editor.button.click($activeDropdown)\n\n        // Focus the unactive dropdown.\n        focusToolbarElement($activeDropdown)\n      }\n\n      // Toolbar contains a back button.\n      else if ($tb.parent().findVisible('.fr-back').length) {\n        editor.shared.with_kb = false\n\n        if (editor.opts.toolbarInline) {\n\n          // Toolbar inline needs focus in order to show up.\n          editor.events.disableBlur()\n          editor.events.focus()\n        }\n        editor.button.exec($tb.parent().findVisible('.fr-back')).first()\n\n        // Focus back popup button.\n        focusPopupButton($tb.parent())\n      }\n\n      // A toolbar that gets opened from the editable area.\n      else if (editor.shared.$f_el.is('button, .fr-group span')) {\n        if ($tb.parent().is('.fr-popup')) {\n\n          // Restore selection.\n          editor.accessibility.restoreSelection()\n          editor.shared.$f_el = null\n\n          // Trigger custom behaviour.\n          if (editor.events.trigger('toolbar.esc') !== false) {\n\n            // Default behaviour.\n            // Hide popup.\n            editor.popups.hide($tb.parent())\n\n            // Show inline toolbar.\n            if (editor.opts.toolbarInline) {\n              editor.toolbar.showInline(null, true)\n            }\n\n            // Focus back popup button.\n            focusPopupButton($tb.parent())\n          }\n        }\n        else {\n          focusEditor()\n        }\n      }\n\n      return false\n    }\n  }\n\n  /*\n   * Execute shortcut.\n   */\n  function exec(e, $tb) {\n    const ctrlKey = navigator.userAgent.indexOf('Mac OS X') !== -1 ? e.metaKey : e.ctrlKey\n\n    const keycode = e.which\n\n    let status = false\n\n    // Tab.\n    if (keycode === FE.KEYCODE.TAB && !ctrlKey && !e.shiftKey && !e.altKey) {\n      status = moveForward($tb, true)\n    }\n\n    // Arrow right -> .\n    else if (keycode === FE.KEYCODE.ARROW_RIGHT && !ctrlKey && !e.shiftKey && !e.altKey) {\n      status = moveForward($tb)\n    }\n\n    // Shift + Tab.\n    else if (keycode === FE.KEYCODE.TAB && !ctrlKey && e.shiftKey && !e.altKey) {\n      status = moveBackward($tb, true)\n    }\n\n    // Arrow left <- .\n    else if (keycode === FE.KEYCODE.ARROW_LEFT && !ctrlKey && !e.shiftKey && !e.altKey) {\n      status = moveBackward($tb)\n    }\n\n    // Arrow up.\n    else if (keycode === FE.KEYCODE.ARROW_UP && !ctrlKey && !e.shiftKey && !e.altKey) {\n      status = moveUp()\n    }\n\n    // Arrow down.\n    else if (keycode === FE.KEYCODE.ARROW_DOWN && !ctrlKey && !e.shiftKey && !e.altKey) {\n      status = moveDown()\n    }\n\n    // Enter.\n    else if ((keycode === FE.KEYCODE.ENTER || keycode === FE.KEYCODE.SPACE) && !ctrlKey && !e.shiftKey && !e.altKey) {\n      status = enter()\n    }\n\n    // Esc.\n    else if (keycode === FE.KEYCODE.ESC && !ctrlKey && !e.shiftKey && !e.altKey) {\n      status = esc($tb)\n    }\n\n    // Alt + F10.\n    else if (keycode === FE.KEYCODE.F10 && !ctrlKey && !e.shiftKey && e.altKey) {\n      status = focusToolbars()\n    }\n\n    // No focused element and no action done. Eg: popup is opened.\n    if (!editor.shared.$f_el && typeof status === 'undefined') {\n      status = true\n    }\n\n    // Check if key event is a browser action. Eg: Ctrl + R.\n    if (!status && editor.keys.isBrowserAction(e)) {\n      status = true\n    }\n\n    // Propagate to the next key listeners.\n    if (status) {\n      return true\n    }\n\n    e.preventDefault()\n    e.stopPropagation()\n\n    return false\n\n  }\n\n  /*\n   * Register a toolbar to keydown event.\n   */\n  function registerToolbar($tb) {\n    if (!$tb || !$tb.length) {\n      return\n    }\n\n    // Hitting keydown on toolbar.\n    editor.events.$on($tb, 'keydown', (e) => {\n      // Allow only buttons.fr-command.\n      if (!$(e.target).is('a.fr-command, button.fr-command, .fr-group span.fr-command')) {\n        return true\n      }\n\n      // Get the current editor instance for the popup.\n      const inst = $tb.parents('.fr-popup').data('instance') || $tb.data('instance') || editor\n\n      // Keyboard used.\n      editor.shared.with_kb = true\n      const status = inst.accessibility.exec(e, $tb)\n      editor.shared.with_kb = false\n\n      return status\n    }, true)\n\n    // Unfocus the toolbar on mouseenter.\n    editor.events.$on($tb, 'mouseenter', '[tabIndex]', (e) => {\n      const inst = $tb.parents('.fr-popup').data('instance') || $tb.data('instance') || editor\n\n      // FireFox issue.\n      if (!can_blur) {\n\n        // Popup showed over the cursor.\n        e.stopPropagation()\n        e.preventDefault()\n\n        return\n      }\n\n      const $hovered_el = $(e.currentTarget)\n\n      if (inst.shared.$f_el && inst.shared.$f_el.not($hovered_el)) {\n        inst.accessibility.focusEditor()\n      }\n\n    }, true)\n  }\n\n  /*\n   * Register a popup to a keydown event.\n   */\n  function registerPopup(id) {\n    const $popup = editor.popups.get(id)\n    const ev = _getPopupEvents(id)\n\n    // Register popup toolbar.\n    registerToolbar($popup.find('.fr-buttons'))\n\n    // Clear popup button on mouseenter.\n    editor.events.$on($popup, 'mouseenter', 'tabIndex', ev._tiMouseenter, true)\n\n    // Keydown handler on every element that has tabIndex.\n    editor.events.$on($popup.children().not('.fr-buttons'), 'keydown', '[tabIndex]', ev._tiKeydown, true)\n\n    // Restore selection on popups hide for the current active popup.\n    editor.popups.onHide(id, () => {\n      const inst = $popup.data('instance') || editor\n      inst.accessibility.restoreSelection()\n    })\n\n    // FireFox issue: Prevent immediate popup bluring. Popup could show up over the cursor.\n    editor.popups.onShow(id, () => {\n      can_blur = false\n      setTimeout(() => {\n        can_blur = true\n      }, 0)\n    })\n  }\n\n  /*\n   * Get popup events.\n   */\n  function _getPopupEvents(id) {\n    const $popup = editor.popups.get(id)\n\n    return {\n      /**\n       * Keydown on an input.\n       */\n      _tiKeydown(e) {\n        const inst = $popup.data('instance') || editor\n\n        // See if plugins listeners are active.\n        if (inst.events.trigger('popup.tab', [e]) === false) {\n          return false\n        }\n\n        const key_code = e.which\n\n        const $focused_item = $popup.find(':focus').first()\n\n        // Tabbing.\n        if (FE.KEYCODE.TAB === key_code) {\n          e.preventDefault()\n\n          // Focus next/previous input.\n          const $popup_content = $popup.children().not('.fr-buttons')\n          const inputs = $popup_content.findVisible('input, textarea, button, select').not('.fr-no-touch input, .fr-no-touch textarea, .fr-no-touch button, .fr-no-touch select, :disabled').toArray()\n          const idx = inputs.indexOf(this) + (e.shiftKey ? -1 : 1)\n\n          if (idx >= 0 && idx < inputs.length) {\n            inst.events.disableBlur()\n            $(inputs[idx]).focus()\n\n            e.stopPropagation()\n\n            return false\n          }\n\n          // Focus toolbar.\n          const $tb = $popup.find('.fr-buttons')\n\n          if ($tb.length && focusToolbar($tb, Boolean(e.shiftKey))) {\n            e.stopPropagation()\n\n            return false\n          }\n\n          // Focus content.\n          if (focusContent($popup_content)) {\n            e.stopPropagation()\n\n            return false\n          }\n        }\n\n        // ENTER.\n        else if (FE.KEYCODE.ENTER === key_code && e.target && e.target.tagName !== 'TEXTAREA') {\n          let $active_button = null\n\n          if ($popup.findVisible('.fr-submit').length > 0) {\n            $active_button = $popup.findVisible('.fr-submit').first()\n          }\n          else if ($popup.findVisible('.fr-dismiss').length) {\n            $active_button = $popup.findVisible('.fr-dismiss').first()\n          }\n\n          if ($active_button) {\n            e.preventDefault()\n            e.stopPropagation()\n            inst.events.disableBlur()\n            inst.button.exec($active_button)\n          }\n        }\n\n        // ESC.\n        else if (FE.KEYCODE.ESC === key_code) {\n          e.preventDefault()\n          e.stopPropagation()\n\n          // Restore selection.\n          inst.accessibility.restoreSelection()\n\n          if (inst.popups.isVisible(id) && $popup.findVisible('.fr-back').length) {\n            if (inst.opts.toolbarInline) {\n\n              // Toolbar inline needs focus in order to show up.\n              inst.events.disableBlur()\n              inst.events.focus()\n            }\n            inst.button.exec($popup.findVisible('.fr-back').first())\n\n            // Focus back popup button.\n            focusPopupButton($popup)\n          }\n          else if (inst.popups.isVisible(id) && $popup.findVisible('.fr-dismiss').length) {\n            inst.button.exec($popup.findVisible('.fr-dismiss').first())\n          }\n          else {\n            inst.popups.hide(id)\n\n            if (inst.opts.toolbarInline) {\n              inst.toolbar.showInline(null, true)\n            }\n\n            // Focus back popup button.\n            focusPopupButton($popup)\n          }\n\n          return false\n        }\n\n        // Allow space.\n        else if (FE.KEYCODE.SPACE === key_code && ($focused_item.is('.fr-submit') || $focused_item.is('.fr-dismiss'))) {\n          e.preventDefault()\n          e.stopPropagation()\n          inst.events.disableBlur()\n          inst.button.exec($focused_item)\n\n          return true\n        }\n\n        // Other KEY. Stop propagation to the window.\n        else {\n\n          // Check if key event is a browser action. Eg: Ctrl + R.\n          if (inst.keys.isBrowserAction(e)) {\n            e.stopPropagation()\n\n            return\n          }\n\n          if ($focused_item.is('input[type=text], textarea')) {\n            e.stopPropagation()\n\n            return\n          }\n\n          if (FE.KEYCODE.SPACE === key_code && ($focused_item.is('.fr-link-attr') || $focused_item.is('input[type=file]'))) {\n            e.stopPropagation()\n\n            return\n          }\n          e.stopPropagation()\n          e.preventDefault()\n\n          return false\n        }\n      },\n\n      _tiMouseenter() {\n        const inst = $popup.data('instance') || editor\n\n        _clearPopupButton(inst)\n      }\n    }\n  }\n\n  /*\n   * Focus the button from which the popup was showed.\n   */\n  function focusPopupButton($popup) {\n    const $popup_button = $popup.data('popup-button')\n\n    if ($popup_button) {\n      setTimeout(() => {\n        focusToolbarElement($popup_button)\n        $popup.data('popup-button', null)\n      }, 0)\n    }\n  }\n\n  /*\n   * Focus the button from which the modal was showed.\n   */\n  function focusModalButton($modal) {\n    const $modal_button = $modal.data('modal-button')\n\n    if ($modal_button) {\n      setTimeout(() => {\n        focusToolbarElement($modal_button)\n        $modal.data('modal-button', null)\n      }, 0)\n    }\n  }\n\n  function hasFocus() {\n    return editor.shared.$f_el !== null\n  }\n\n  function _clearPopupButton(inst) {\n    const $visible_popup = editor.popups.areVisible(inst)\n\n    if ($visible_popup) {\n      $visible_popup.data('popup-button', null)\n    }\n  }\n\n  function _editorKeydownHandler(e) {\n    const ctrlKey = navigator.userAgent.indexOf('Mac OS X') !== -1 ? e.metaKey : e.ctrlKey\n    const keycode = e.which\n\n    // Alt + F10.\n    if (keycode === FE.KEYCODE.F10 && !ctrlKey && !e.shiftKey && e.altKey) {\n\n      // Keyboard used.\n      editor.shared.with_kb = true\n\n      // Focus active popup content inside the current editor if possible, else focus an available toolbar.\n      const $visible_popup = editor.popups.areVisible(editor)\n      let focused_content = false\n\n      if ($visible_popup) {\n        focused_content = focusContent($visible_popup.children().not('.fr-buttons'))\n      }\n\n      if (!focused_content) {\n        focusToolbars()\n      }\n\n      editor.shared.with_kb = false\n\n      e.preventDefault()\n      e.stopPropagation()\n\n      return false\n    }\n\n    return true\n  }\n\n  /**\n   * Initialize.\n   */\n  function _init() {\n\n    // Key down on the editing area.\n    if (editor.$wp) {\n      editor.events.on('keydown', _editorKeydownHandler, true)\n    }\n    else {\n      editor.events.$on(editor.$win, 'keydown', _editorKeydownHandler, true)\n    }\n\n    // Mousedown on the editing area.\n    editor.events.on('mousedown', (e) => {\n      _clearPopupButton(editor)\n\n      if (editor.shared.$f_el) {\n        editor.accessibility.restoreSelection()\n        e.stopPropagation()\n        editor.events.disableBlur()\n        editor.shared.$f_el = null\n      }\n    }, true)\n\n    // Blur on the editing area.\n    editor.events.on('blur', () => {\n      editor.shared.$f_el = null\n      _clearPopupButton(editor)\n    }, true)\n  }\n\n  return {\n    _init,\n    registerPopup,\n    registerToolbar,\n    focusToolbarElement,\n    focusToolbar,\n    focusContent,\n    focusPopup,\n    focusModal,\n    focusEditor,\n    focusPopupButton,\n    focusModalButton,\n    hasFocus,\n    exec,\n    saveSelection,\n    restoreSelection\n  }\n}\n","import $ from 'jquery'\nimport FE from 'froala_editor'\n\nFE.MODULES.node = function (editor) {\n  function getContents(node) {\n    if (!node || node.tagName === 'IFRAME') {\n      return []\n    }\n\n    return Array.prototype.slice.call(node.childNodes || [])\n  }\n\n  /**\n   * Determine if the node is a block tag.\n   */\n  function isBlock(node) {\n    if (!node) {\n      return false\n    }\n\n    if (node.nodeType !== Node.ELEMENT_NODE) {\n      return false\n    }\n\n    return FE.BLOCK_TAGS.indexOf(node.tagName.toLowerCase()) >= 0\n  }\n\n  /**\n   * Determine if the node is a link tag.\n   */\n  function isLink(node) {\n    if (!node) {\n      return false\n    }\n\n    if (node.nodeType !== Node.ELEMENT_NODE) {\n      return false\n    }\n\n    return node.tagName.toLowerCase() === 'a'\n  }\n\n  /**\n   * Check if a DOM element is empty.\n   */\n  function isEmpty(el, ignore_markers) {\n    if (!el) {\n      return true\n    }\n\n    if (el.querySelector('table')) {\n      return false\n    }\n\n    // Get element contents.\n    let contents = getContents(el)\n\n    // Check if there is a block tag.\n    if (contents.length === 1 && isBlock(contents[0])) {\n      contents = getContents(contents[0])\n    }\n\n    let has_br = false\n\n    for (let i = 0; i < contents.length; i++) {\n      const node = contents[i]\n\n      if (ignore_markers && editor.node.hasClass(node, 'fr-marker')) {\n        continue\n      }\n\n      if (node.nodeType === Node.TEXT_NODE && node.textContent.length === 0) {\n        continue\n      }\n\n      if (node.tagName !== 'BR' && (node.textContent || '').replace(/\\u200B/gi, '').replace(/\\n/g, '').length > 0) {\n        return false\n      }\n\n      if (has_br) {\n        return false\n      }\n      else if (node.tagName === 'BR') {\n        has_br = true\n      }\n    }\n\n    // Look for void nodes.\n    if (el.querySelectorAll(FE.VOID_ELEMENTS.join(',')).length - el.querySelectorAll('br').length) {\n      return false\n    }\n\n    // Look for empty allowed tags.\n    if (el.querySelector(`${editor.opts.htmlAllowedEmptyTags.join(':not(.fr-marker),')}:not(.fr-marker)`)) {\n      return false\n    }\n\n    // Look for block tags.\n    if (el.querySelectorAll(FE.BLOCK_TAGS.join(',')).length > 1) {\n      return false\n    }\n\n    // Look for do not wrap tags.\n    if (el.querySelector(`${editor.opts.htmlDoNotWrapTags.join(':not(.fr-marker),')}:not(.fr-marker)`)) {\n      return false\n    }\n\n\n    return true\n  }\n\n  /**\n   * Get the block parent.\n   */\n  function blockParent(node) {\n    while (node && node.parentNode !== editor.el && !(node.parentNode && editor.node.hasClass(node.parentNode, 'fr-inner'))) {\n      node = node.parentNode\n\n      if (isBlock(node)) {\n        return node\n      }\n    }\n\n    return null\n  }\n\n  /**\n   * Get deepest parent till the element.\n   */\n  function deepestParent(node, until, simple_enter) {\n    if (typeof until === 'undefined') {\n      until = []\n    }\n\n    if (typeof simple_enter === 'undefined') {\n      simple_enter = true\n    }\n    until.push(editor.el)\n\n    if (until.indexOf(node.parentNode) >= 0 || node.parentNode && editor.node.hasClass(node.parentNode, 'fr-inner') || node.parentNode && FE.SIMPLE_ENTER_TAGS.indexOf(node.parentNode.tagName) >= 0 && simple_enter) {\n      return null\n    }\n\n    // 1. Before until.\n    // 2. Parent node doesn't has class fr-inner.\n    // 3. Parent node is not a simple enter tag or quote.\n    // 4. Parent node is not a block tag\n    while (until.indexOf(node.parentNode) < 0 && node.parentNode && !editor.node.hasClass(node.parentNode, 'fr-inner') && (FE.SIMPLE_ENTER_TAGS.indexOf(node.parentNode.tagName) < 0 || !simple_enter) && (!(isBlock(node) && isBlock(node.parentNode)) || !simple_enter)) {\n      node = node.parentNode\n    }\n\n    return node\n  }\n\n  function rawAttributes(node) {\n    const attrs = {}\n\n    const atts = node.attributes\n\n    if (atts) {\n      for (let i = 0; i < atts.length; i++) {\n        const att = atts[i]\n        attrs[att.nodeName] = att.value\n      }\n    }\n\n    return attrs\n  }\n\n  /**\n   * Get attributes for a node as a string.\n   */\n  function attributes(node) {\n    let str = ''\n    const atts = rawAttributes(node)\n\n    const keys = Object.keys(atts).sort()\n\n    for (let i = 0; i < keys.length; i++) {\n      const nodeName = keys[i]\n      let value = atts[nodeName]\n\n      // Double quote + no single quote. (\")\n      if (value.indexOf('\\'') < 0 && value.indexOf('\"') >= 0) {\n        str += ` ${nodeName}='${value}'`\n      }\n\n      // Double quote + single quote. (\"')\n      else if (value.indexOf('\"') >= 0 && value.indexOf('\\'') >= 0) {\n        value = value.replace(/\"/g, '&quot;')\n        str += ` ${nodeName}=\"${value}\"`\n      }\n\n      // Single quote or no quote at all.\n      else {\n        str += ` ${nodeName}=\"${value}\"`\n      }\n    }\n\n    return str\n  }\n\n  function clearAttributes(node) {\n    const atts = node.attributes\n\n    for (let i = atts.length - 1; i >= 0; i--) {\n      const att = atts[i]\n      node.removeAttribute(att.nodeName)\n    }\n  }\n\n  /**\n   * Open string for a node.\n   */\n  function openTagString(node) {\n    return `<${node.tagName.toLowerCase()}${attributes(node)}>`\n  }\n\n  /**\n   * Close string for a node.\n   */\n  function closeTagString(node) {\n    return `</${node.tagName.toLowerCase()}>`\n  }\n\n  /**\n   * Determine if the node has any left sibling.\n   */\n  function isFirstSibling(node, ignore_markers) {\n    if (typeof ignore_markers === 'undefined') {\n      ignore_markers = true\n    }\n    let sibling = node.previousSibling\n\n    while (sibling && ignore_markers && editor.node.hasClass(sibling, 'fr-marker')) {\n      sibling = sibling.previousSibling\n    }\n\n    if (!sibling) {\n      return true\n    }\n\n    if (sibling.nodeType === Node.TEXT_NODE && sibling.textContent === '') {\n      return isFirstSibling(sibling)\n    }\n\n    return false\n  }\n\n  /**\n   * Determine if the node has any right sibling.\n   */\n  function isLastSibling(node, ignore_markers) {\n    if (typeof ignore_markers === 'undefined') {\n      ignore_markers = true\n    }\n    let sibling = node.nextSibling\n\n    while (sibling && ignore_markers && editor.node.hasClass(sibling, 'fr-marker')) {\n      sibling = sibling.nextSibling\n    }\n\n    if (!sibling) {\n      return true\n    }\n\n    if (sibling.nodeType === Node.TEXT_NODE && sibling.textContent === '') {\n      return isLastSibling(sibling)\n    }\n\n    return false\n  }\n\n  function isVoid(node) {\n    return node && node.nodeType === Node.ELEMENT_NODE && FE.VOID_ELEMENTS.indexOf((node.tagName || '').toLowerCase()) >= 0\n  }\n\n  /**\n   * Check if the node is a list.\n   */\n  function isList(node) {\n    if (!node) {\n      return false\n    }\n\n    return ['UL', 'OL'].indexOf(node.tagName) >= 0\n  }\n\n  /**\n   * Check if the node is the editable element.\n   */\n  function isElement(node) {\n    return node === editor.el\n  }\n\n  /**\n   * Check if the node is the editable element.\n   */\n  function isDeletable(node) {\n    return node && node.nodeType === Node.ELEMENT_NODE && node.getAttribute('class') && (node.getAttribute('class') || '').indexOf('fr-deletable') >= 0\n  }\n\n  /**\n   * Check if the node has focus.\n   */\n  function hasFocus(node) {\n    return node === editor.doc.activeElement && (!editor.doc.hasFocus || editor.doc.hasFocus()) && Boolean(isElement(node) || node.type || node.href || ~node.tabIndex)\n  }\n\n  function isEditable(node) {\n    return (!node.getAttribute || node.getAttribute('contenteditable') !== 'false')\n              && ['STYLE', 'SCRIPT'].indexOf(node.tagName) < 0\n  }\n\n  function hasClass(el, cls) {\n    if (el instanceof $) {\n      el = el.get(0)\n    }\n\n    return el && el.classList && el.classList.contains(cls)\n  }\n\n  function filter(callback) {\n    if (editor.browser.msie) {\n\n      return callback\n    }\n\n\n    return {\n      acceptNode: callback\n    }\n\n  }\n\n  return {\n    isBlock,\n    isEmpty,\n    blockParent,\n    deepestParent,\n    rawAttributes,\n    attributes,\n    clearAttributes,\n    openTagString,\n    closeTagString,\n    isFirstSibling,\n    isLastSibling,\n    isList,\n    isLink,\n    isElement,\n    contents: getContents,\n    isVoid,\n    hasFocus,\n    isEditable,\n    isDeletable,\n    hasClass,\n    filter\n  }\n}\n","import './dom/node.js'\n\nimport $ from 'jquery'\nimport FE from 'froala_editor'\n\n// Extend defaults.\nObject.assign(FE.DEFAULTS, {\n\n  // Tags that describe head from HEAD http://www.w3schools.com/html/html_head.asp.\n  htmlAllowedTags: ['a', 'abbr', 'address', 'area', 'article', 'aside', 'audio', 'b', 'base', 'bdi', 'bdo', 'blockquote', 'br', 'button', 'canvas', 'caption', 'cite', 'code', 'col', 'colgroup', 'datalist', 'dd', 'del', 'details', 'dfn', 'dialog', 'div', 'dl', 'dt', 'em', 'embed', 'fieldset', 'figcaption', 'figure', 'footer', 'form', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'header', 'hgroup', 'hr', 'i', 'iframe', 'img', 'input', 'ins', 'kbd', 'keygen', 'label', 'legend', 'li', 'link', 'main', 'map', 'mark', 'menu', 'menuitem', 'meter', 'nav', 'noscript', 'object', 'ol', 'optgroup', 'option', 'output', 'p', 'param', 'pre', 'progress', 'queue', 'rp', 'rt', 'ruby', 's', 'samp', 'script', 'style', 'section', 'select', 'small', 'source', 'span', 'strike', 'strong', 'sub', 'summary', 'sup', 'table', 'tbody', 'td', 'textarea', 'tfoot', 'th', 'thead', 'time', 'tr', 'track', 'u', 'ul', 'var', 'video', 'wbr'],\n  htmlRemoveTags: ['script', 'style'],\n  htmlAllowedAttrs: ['accept', 'accept-charset', 'accesskey', 'action', 'align', 'allowfullscreen', 'allowtransparency', 'alt', 'async', 'autocomplete', 'autofocus', 'autoplay', 'autosave', 'background', 'bgcolor', 'border', 'charset', 'cellpadding', 'cellspacing', 'checked', 'cite', 'class', 'color', 'cols', 'colspan', 'content', 'contenteditable', 'contextmenu', 'controls', 'coords', 'data', 'data-.*', 'datetime', 'default', 'defer', 'dir', 'dirname', 'disabled', 'download', 'draggable', 'dropzone', 'enctype', 'for', 'form', 'formaction', 'frameborder', 'headers', 'height', 'hidden', 'high', 'href', 'hreflang', 'http-equiv', 'icon', 'id', 'ismap', 'itemprop', 'keytype', 'kind', 'label', 'lang', 'language', 'list', 'loop', 'low', 'max', 'maxlength', 'media', 'method', 'min', 'mozallowfullscreen', 'multiple', 'muted', 'name', 'novalidate', 'open', 'optimum', 'pattern', 'ping', 'placeholder', 'playsinline', 'poster', 'preload', 'pubdate', 'radiogroup', 'readonly', 'rel', 'required', 'reversed', 'rows', 'rowspan', 'sandbox', 'scope', 'scoped', 'scrolling', 'seamless', 'selected', 'shape', 'size', 'sizes', 'span', 'src', 'srcdoc', 'srclang', 'srcset', 'start', 'step', 'summary', 'spellcheck', 'style', 'tabindex', 'target', 'title', 'type', 'translate', 'usemap', 'value', 'valign', 'webkitallowfullscreen', 'width', 'wrap'],\n  htmlAllowedStyleProps: ['.*'],\n  htmlAllowComments: true,\n  htmlUntouched: false,\n  fullPage: false // Will also turn iframe on.\n})\n\nFE.HTML5Map = {\n  B: 'STRONG',\n  I: 'EM',\n  STRIKE: 'S'\n}\n\nFE.MODULES.clean = function (editor) {\n  let allowedTagsRE\n  let removeTagsRE\n  let allowedAttrsRE\n  let allowedStylePropsRE\n\n  function _removeInvisible(node) {\n    if (node.nodeType === Node.ELEMENT_NODE && node.getAttribute('class') && node.getAttribute('class').indexOf('fr-marker') >= 0) {\n      return false\n    }\n\n    // Get node contents.\n    let contents = editor.node.contents(node)\n    let markers = []\n    let i\n\n    // Loop through contents.\n    for (i = 0; i < contents.length; i++) {\n\n      // If node is not void.\n      if (contents[i].nodeType === Node.ELEMENT_NODE && !editor.node.isVoid(contents[i])) {\n\n        // There are invisible spaces.\n        if (contents[i].textContent.replace(/\\u200b/g, '').length !== contents[i].textContent.length) {\n\n          // Do remove invisible spaces.\n          _removeInvisible(contents[i])\n        }\n      }\n\n      // If node is text node, replace invisible spaces.\n      else if (contents[i].nodeType === Node.TEXT_NODE) {\n        contents[i].textContent = contents[i].textContent.replace(/\\u200b/g, '')\n\n        // .replace(/&/g, '&amp;');\n      }\n    }\n\n    // Reasess contents after cleaning invisible spaces.\n    if (node.nodeType === Node.ELEMENT_NODE && !editor.node.isVoid(node)) {\n      node.normalize()\n      contents = editor.node.contents(node)\n      markers = node.querySelectorAll('.fr-marker')\n\n      // All we have left are markers.\n      if (contents.length - markers.length === 0) {\n\n        // Make sure contents are all markers.\n        for (i = 0; i < contents.length; i++) {\n          if (contents[i].nodeType === Node.ELEMENT_NODE && (contents[i].getAttribute('class') || '').indexOf('fr-marker') < 0) {\n\n            return false\n          }\n        }\n\n        for (i = 0; i < markers.length; i++) {\n          node.parentNode.insertBefore(markers[i].cloneNode(true), node)\n        }\n        node.parentNode.removeChild(node)\n\n        return false\n      }\n    }\n  }\n\n  function _toHTML(el, is_pre) {\n    if (el.nodeType === Node.COMMENT_NODE) {\n      return `<!--${el.nodeValue}-->`\n    }\n\n    if (el.nodeType === Node.TEXT_NODE) {\n\n      if (is_pre) {\n\n        return el.textContent.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;')\n      }\n\n      return el.textContent.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\\u00A0/g, '&nbsp;').replace(/\\u0009/g, '')\n    }\n\n    if (el.nodeType !== Node.ELEMENT_NODE) {\n      return el.outerHTML\n    }\n\n    if (el.nodeType === Node.ELEMENT_NODE && ['STYLE', 'SCRIPT', 'NOSCRIPT'].indexOf(el.tagName) >= 0) {\n      return el.outerHTML\n    }\n\n    if (el.nodeType === Node.ELEMENT_NODE && el.tagName === 'svg') {\n      const temp = document.createElement('div')\n      const node_clone = el.cloneNode(true)\n      temp.appendChild(node_clone)\n\n      return temp.innerHTML\n    }\n\n    if (el.tagName === 'IFRAME') {\n      return el.outerHTML.replace(/&lt;/g, '<').replace(/&gt;/g, '>')\n    }\n\n    const contents = el.childNodes\n\n    if (contents.length === 0) {\n      return el.outerHTML\n    }\n\n    let str = ''\n\n    for (let i = 0; i < contents.length; i++) {\n\n      if (el.tagName === 'PRE') {\n        is_pre = true\n      }\n\n      str += _toHTML(contents[i], is_pre)\n    }\n\n\n    return editor.node.openTagString(el) + str + editor.node.closeTagString(el)\n  }\n\n  let scripts = []\n\n  function _encode(dirty_html) {\n\n    // Replace script tag with comments.\n    scripts = []\n\n    dirty_html = dirty_html.replace(/<script\\b[^<]*(?:(?!<\\/script>)<[^<]*)*<\\/script>/gi, (str) => {\n      scripts.push(str)\n\n      return `[FROALA.EDITOR.SCRIPT ${scripts.length - 1}]`\n\n    })\n\n    dirty_html = dirty_html.replace(/<noscript\\b[^<]*(?:(?!<\\/noscript>)<[^<]*)*<\\/noscript>/gi, (str) => {\n      scripts.push(str)\n\n      return `[FROALA.EDITOR.NOSCRIPT ${scripts.length - 1}]`\n    })\n\n    dirty_html = dirty_html.replace(/<meta((?:[\\w\\W]*?)) http-equiv=\"/g, '<meta$1 data-fr-http-equiv=\"')\n\n    dirty_html = dirty_html.replace(/<img((?:[\\w\\W]*?)) src=\"/g, '<img$1 data-fr-src=\"')\n\n    return dirty_html\n  }\n\n  function _decode(dirty_html) {\n\n    // Replace script comments with the original script.\n    dirty_html = dirty_html.replace(/\\[FROALA\\.EDITOR\\.SCRIPT ([\\d]*)\\]/gi, (str, a1) => {\n      if (editor.opts.htmlRemoveTags.indexOf('script') >= 0) {\n        return ''\n      }\n\n      return scripts[parseInt(a1, 10)]\n\n    })\n\n    dirty_html = dirty_html.replace(/\\[FROALA\\.EDITOR\\.NOSCRIPT ([\\d]*)\\]/gi, (str, a1) => {\n      if (editor.opts.htmlRemoveTags.indexOf('noscript') >= 0) {\n        return ''\n      }\n\n      return scripts[parseInt(a1, 10)].replace(/&lt;/g, '<').replace(/&gt;/g, '>')\n\n    })\n\n    dirty_html = dirty_html.replace(/<img((?:[\\w\\W]*?)) data-fr-src=\"/g, '<img$1 src=\"')\n\n    return dirty_html\n  }\n\n  /*\n   * Clean style attribute.\n   */\n  function _cleanStyle(style) {\n    let cleaned_style = style.replace(/;;/gi, ';')\n    cleaned_style = cleaned_style.replace(/^;/gi, '')\n\n    if (cleaned_style.charAt(cleaned_style.length) !== ';') {\n      cleaned_style += ';'\n    }\n\n    return cleaned_style\n  }\n\n  function _cleanAttrs(attrs) {\n    let nm\n\n    for (nm in attrs) {\n\n      if (Object.prototype.hasOwnProperty.call(attrs, nm)) {\n\n        // Check if attr is allowed.\n        const is_attr_allowed = nm.match(allowedAttrsRE)\n\n        // Check for allowed style properties.\n        let allowed_style_props_matches = null\n\n        // There are allowed style props.\n        if (nm === 'style' && editor.opts.htmlAllowedStyleProps.length) {\n          allowed_style_props_matches = attrs[nm].match(allowedStylePropsRE)\n        }\n\n        // Attribute is allowed and there are style matches.\n        if (is_attr_allowed && allowed_style_props_matches) {\n\n          // Override attr value with only the allowed properties.\n          attrs[nm] = _cleanStyle(allowed_style_props_matches.join(';'))\n        }\n        else if (!is_attr_allowed || nm === 'style' && !allowed_style_props_matches) {\n          delete attrs[nm]\n        }\n      }\n    }\n\n    let str = ''\n    const keys = Object.keys(attrs).sort()\n\n    for (let i = 0; i < keys.length; i++) {\n      nm = keys[i]\n\n      // Make sure we don't break any HTML.\n      if (attrs[nm].indexOf('\"') < 0) {\n        str += ` ${nm}=\"${attrs[nm]}\"`\n      }\n      else {\n        str += ` ${nm}='${attrs[nm]}'`\n      }\n    }\n\n    return str\n  }\n\n  function _rebuild(body_html, head_html, original_html) {\n    if (editor.opts.fullPage) {\n\n      // Get DOCTYPE.\n      const doctype = editor.html.extractDoctype(original_html)\n\n      // Get HTML attributes.\n      const html_attrs = _cleanAttrs(editor.html.extractNodeAttrs(original_html, 'html'))\n\n      // Get HEAD data.\n      head_html = head_html === null ? editor.html.extractNode(original_html, 'head') || '<title></title>' : head_html\n      const head_attrs = _cleanAttrs(editor.html.extractNodeAttrs(original_html, 'head'))\n\n      // Get BODY attributes.\n      const body_attrs = _cleanAttrs(editor.html.extractNodeAttrs(original_html, 'body'))\n\n      return `${doctype}<html${html_attrs}><head${head_attrs}>${head_html}</head><body${body_attrs}>${body_html}</body></html>`\n    }\n\n    return body_html\n  }\n\n  function _process(html, func) {\n    let i\n\n    const doc  = document.implementation.createHTMLDocument('Froala DOC')\n    const el = doc.createElement('DIV')\n    $(el).append(html)\n\n    let new_html = ''\n\n    if (el) {\n      let els = editor.node.contents(el)\n\n      for (i = 0; i < els.length; i++) {\n        func(els[i])\n      }\n\n      els = editor.node.contents(el)\n\n      for (i = 0; i < els.length; i++) {\n        new_html += _toHTML(els[i])\n      }\n    }\n\n    return new_html\n  }\n\n  function exec(html, func, parse_head) {\n    html = _encode(html)\n    let b_html = html\n    let h_html = null\n\n    if (editor.opts.fullPage) {\n\n      // Get BODY data.\n      b_html = editor.html.extractNode(html, 'body') || (html.indexOf('<body') >= 0 ? '' : html)\n\n      if (parse_head) {\n        h_html = editor.html.extractNode(html, 'head') || ''\n      }\n    }\n\n    b_html = _process(b_html, func)\n\n    if (h_html) {\n      h_html = _process(h_html, func)\n    }\n\n    const new_html = _rebuild(b_html, h_html, html)\n\n    return _decode(new_html)\n  }\n\n  function invisibleSpaces(dirty_html) {\n    if (dirty_html.replace(/\\u200b/g, '').length === dirty_html.length) {\n      return dirty_html\n    }\n\n    return editor.clean.exec(dirty_html, _removeInvisible)\n  }\n\n  function toHTML5() {\n    const els = editor.el.querySelectorAll(Object.keys(FE.HTML5Map).join(','))\n\n    if (els.length) {\n      let sel_saved = false\n\n      if (!editor.el.querySelector('.fr-marker')) {\n        editor.selection.save()\n        sel_saved = true\n      }\n\n      for (let i = 0; i < els.length; i++) {\n        if (editor.node.attributes(els[i]) === '') {\n          $(els[i]).replaceWith(`<${FE.HTML5Map[els[i].tagName]}>${els[i].innerHTML}</${FE.HTML5Map[els[i].tagName]}>`)\n        }\n      }\n\n      if (sel_saved) {\n        editor.selection.restore()\n      }\n    }\n  }\n\n  // Fixes paths coming as HTML entities which are later on converted to their coresponding chars.\n  function _convertHref(href) {\n    const div = editor.doc.createElement('DIV')\n    div.innerText = href\n\n    return div.textContent\n  }\n\n  function _node(node) {\n\n    // Skip when we're dealing with markers.\n    if (node.tagName === 'SPAN' && (node.getAttribute('class') || '').indexOf('fr-marker') >= 0) {\n      return false\n    }\n\n    if (node.tagName === 'PRE') {\n      _cleanPre(node)\n    }\n\n    if (node.nodeType === Node.ELEMENT_NODE) {\n      if (node.getAttribute('data-fr-src') && node.getAttribute('data-fr-src').indexOf('blob:') !== 0) {\n        node.setAttribute('data-fr-src', editor.helpers.sanitizeURL(_convertHref(node.getAttribute('data-fr-src'))))\n      }\n\n      if (node.getAttribute('href')) {\n        node.setAttribute('href', editor.helpers.sanitizeURL(_convertHref(node.getAttribute('href'))))\n      }\n\n      if (node.getAttribute('src')) {\n        node.setAttribute('src', editor.helpers.sanitizeURL(_convertHref(node.getAttribute('src'))))\n      }\n\n      if (['TABLE', 'TBODY', 'TFOOT', 'TR'].indexOf(node.tagName) >= 0) {\n        node.innerHTML = node.innerHTML.trim()\n      }\n    }\n\n    // Remove local images if option they are not allowed.\n    if (!editor.opts.pasteAllowLocalImages && node.nodeType === Node.ELEMENT_NODE && node.tagName === 'IMG' && node.getAttribute('data-fr-src') && node.getAttribute('data-fr-src').indexOf('file://') === 0) {\n      node.parentNode.removeChild(node)\n\n      return false\n    }\n\n    if (node.nodeType === Node.ELEMENT_NODE && FE.HTML5Map[node.tagName] && editor.node.attributes(node) === '') {\n      const tg = FE.HTML5Map[node.tagName]\n      const new_node = `<${tg}>${node.innerHTML}</${tg}>`\n      node.insertAdjacentHTML('beforebegin', new_node)\n      node = node.previousSibling\n      node.parentNode.removeChild(node.nextSibling)\n    }\n\n    if (!editor.opts.htmlAllowComments && node.nodeType === Node.COMMENT_NODE) {\n\n      // Do not remove FROALA.EDITOR comments.\n      if (node.data.indexOf('[FROALA.EDITOR') !== 0) {\n        node.parentNode.removeChild(node)\n      }\n    }\n\n    // Remove completely tags in denied tags.\n    else if (node.tagName && node.tagName.match(removeTagsRE)) {\n      node.parentNode.removeChild(node)\n    }\n\n    // Unwrap tags not in allowed tags.\n    else if (node.tagName && !node.tagName.match(allowedTagsRE)) {\n\n      // https://github.com/froala/wysiwyg-editor/issues/1711 . If svg is not allowed then remove it because it is a leaf node.\n      if (node.tagName === 'svg') {\n        node.parentNode.removeChild(node)\n      }\n\n      // Ignore path tag nodes that are inside a svg tag node.\n      else if (!(editor.browser.safari && node.tagName === 'path' && node.parentNode && node.parentNode.tagName === 'svg')) {\n        node.outerHTML = node.innerHTML\n      }\n\n    }\n\n    // Check denied attributes.\n    else {\n      const attrs = node.attributes\n\n      if (attrs) {\n\n        for (let i = attrs.length - 1; i >= 0; i--) {\n          const attr = attrs[i]\n\n          // Check if attr is allowed.\n          const is_attr_allowed = attr.nodeName.match(allowedAttrsRE)\n\n          // Check for allowed style properties.\n          let allowed_style_props_matches = null\n\n          // There are allowed style props.\n          if (attr.nodeName === 'style' && editor.opts.htmlAllowedStyleProps.length) {\n            allowed_style_props_matches = attr.value.match(allowedStylePropsRE)\n          }\n\n          // Attribute is allowed and there are style matches.\n          if (is_attr_allowed && allowed_style_props_matches) {\n\n            // Override attr value with only the allowed properties.\n            attr.value = _cleanStyle(allowed_style_props_matches.join(';'))\n          }\n          else if (!is_attr_allowed || attr.nodeName === 'style' && !allowed_style_props_matches) {\n            node.removeAttribute(attr.nodeName)\n          }\n        }\n      }\n    }\n  }\n\n  function _run(node) {\n    const contents = editor.node.contents(node)\n\n    for (let i = 0; i < contents.length; i++) {\n      if (contents[i].nodeType !== Node.TEXT_NODE) {\n        _run(contents[i])\n      }\n    }\n\n    _node(node)\n  }\n\n  /**\n   * Clean pre.\n   */\n  function _cleanPre(pre) {\n    const content = pre.innerHTML\n\n    if (content.indexOf('\\n') >= 0) {\n      pre.innerHTML = content.replace(/\\n/g, '<br>')\n    }\n  }\n\n  /**\n   * Clean the html input.\n   */\n  function html(dirty_html, denied_tags, denied_attrs, full_page) {\n    if (typeof denied_tags === 'undefined') {\n      denied_tags = []\n    }\n\n    if (typeof denied_attrs === 'undefined') {\n      denied_attrs = []\n    }\n\n    if (typeof full_page === 'undefined') {\n      full_page = false\n    }\n\n    // Empty spaces after BR always collapse.\n    // dirty_html = dirty_html.replace(/<br> */g, '<br>');\n\n    // Build the allowed tags array.\n    const allowed_tags = $.merge([], editor.opts.htmlAllowedTags)\n    let i\n\n    for (i = 0; i < denied_tags.length; i++) {\n      if (allowed_tags.indexOf(denied_tags[i]) >= 0) {\n        allowed_tags.splice(allowed_tags.indexOf(denied_tags[i]), 1)\n      }\n    }\n\n    // Build the allowed attrs array.\n    const allowed_attrs = $.merge([], editor.opts.htmlAllowedAttrs)\n\n    for (i = 0; i < denied_attrs.length; i++) {\n      if (allowed_attrs.indexOf(denied_attrs[i]) >= 0) {\n        allowed_attrs.splice(allowed_attrs.indexOf(denied_attrs[i]), 1)\n      }\n    }\n\n    // We should allow data-fr.\n    allowed_attrs.push('data-fr-.*')\n    allowed_attrs.push('fr-.*')\n\n    // Generate cleaning RegEx.\n    allowedTagsRE = new RegExp(`^${allowed_tags.join('$|^')}$`, 'gi')\n    allowedAttrsRE = new RegExp(`^${allowed_attrs.join('$|^')}$`, 'gi')\n    removeTagsRE = new RegExp(`^${editor.opts.htmlRemoveTags.join('$|^')}$`, 'gi')\n\n    if (editor.opts.htmlAllowedStyleProps.length) {\n      allowedStylePropsRE = new RegExp(`((^|;|\\\\s)${editor.opts.htmlAllowedStyleProps.join(':.+?(?=;|$))|((^|;|\\\\s)')}:.+?(?=(;)|$))`, 'gi')\n    }\n    else {\n      allowedStylePropsRE = null\n    }\n\n    dirty_html = exec(dirty_html, _run, true)\n\n    return dirty_html\n  }\n\n  function _tablesWrapTHEAD() {\n    const trs = editor.el.querySelectorAll('tr')\n\n    // Make sure the TH lives inside thead.\n    for (let i = 0; i < trs.length; i++) {\n\n      // Search for th inside tr.\n      const children = trs[i].children\n      let ok = true\n\n      for (let j = 0; j < children.length; j++) {\n        if (children[j].tagName !== 'TH') {\n          ok = false\n          break\n        }\n      }\n\n      // If there is something else than TH.\n      if (ok === false || children.length === 0) {\n        continue\n      }\n\n      let tr = trs[i]\n\n      while (tr && tr.tagName !== 'TABLE' && tr.tagName !== 'THEAD') {\n        tr = tr.parentNode\n      }\n\n      let thead = tr\n\n      if (thead.tagName !== 'THEAD') {\n        thead = editor.doc.createElement('THEAD')\n        tr.insertBefore(thead, tr.firstChild)\n      }\n\n      thead.appendChild(trs[i])\n    }\n  }\n\n  /**\n   * Clean tables.\n   */\n  function tables() {\n    _tablesWrapTHEAD()\n  }\n\n  function _listsWrapMissplacedLI() {\n\n    // Find missplaced list items.\n    let lis = []\n    function filterListItem(li) {\n\n      return !editor.node.isList(li.parentNode)\n    }\n\n    do {\n      if (lis.length) {\n        let li = lis[0]\n        const ul = editor.doc.createElement('ul')\n        li.parentNode.insertBefore(ul, li)\n\n        do {\n          const tmp = li\n          li = li.nextSibling\n          ul.appendChild(tmp)\n        } while (li && li.tagName === 'LI')\n      }\n\n      lis = []\n      const li_sel = editor.el.querySelectorAll('li')\n\n      for (let i = 0; i < li_sel.length; i++) {\n        if (filterListItem(li_sel[i])) {\n          lis.push(li_sel[i])\n        }\n      }\n    } while (lis.length > 0)\n  }\n\n  function _listsJoinSiblings() {\n\n    // Join lists.\n    const sibling_lists = editor.el.querySelectorAll('ol + ol, ul + ul')\n\n    for (let k = 0; k < sibling_lists.length; k++) {\n      const list = sibling_lists[k]\n\n      if (editor.node.isList(list.previousSibling) && editor.node.openTagString(list) === editor.node.openTagString(list.previousSibling)) {\n        const childs = editor.node.contents(list)\n\n        for (let i = 0; i < childs.length; i++) {\n          list.previousSibling.appendChild(childs[i])\n        }\n        list.parentNode.removeChild(list)\n      }\n    }\n  }\n\n  function _listsRemoveEmpty() {\n\n    let i\n\n    // Remove empty lists.\n    let do_remove\n\n    function removeEmptyList(lst) {\n      if (!lst.querySelector('LI')) {\n        do_remove = true\n        lst.parentNode.removeChild(lst)\n      }\n    }\n\n    do {\n      do_remove = false\n\n      // Remove empty li.\n      const empty_lis = editor.el.querySelectorAll('li:empty')\n\n      for (i = 0; i < empty_lis.length; i++) {\n        empty_lis[i].parentNode.removeChild(empty_lis[i])\n      }\n\n      // Remove empty ul and ol.\n      const remaining_lists = editor.el.querySelectorAll('ul, ol')\n\n      for (i = 0; i < remaining_lists.length; i++) {\n        removeEmptyList(remaining_lists[i])\n      }\n    } while (do_remove === true)\n  }\n\n  function _listsWrapLists() {\n\n    // Do not allow list directly inside another list.\n    const direct_lists = editor.el.querySelectorAll('ul > ul, ol > ol, ul > ol, ol > ul')\n\n    for (let i = 0; i < direct_lists.length; i++) {\n      const list = direct_lists[i]\n      const prev_li = list.previousSibling\n\n      if (prev_li) {\n        if (prev_li.tagName === 'LI') {\n          prev_li.appendChild(list)\n        }\n        else {\n          $(list).wrap('<li></li>')\n        }\n      }\n    }\n  }\n\n  function _listsNoTagAfterNested() {\n\n    // Check if nested lists don't have HTML after them.\n    const nested_lists = editor.el.querySelectorAll('li > ul, li > ol')\n\n    for (let i = 0; i < nested_lists.length; i++) {\n      const lst = nested_lists[i]\n\n      if (lst.nextSibling) {\n        let node = lst.nextSibling\n        const $new_li = $(editor.doc.createElement('LI'))\n        $(lst.parentNode).after($new_li)\n\n        do {\n          const tmp = node\n          node = node.nextSibling\n          $new_li.append(tmp)\n        } while (node)\n      }\n    }\n  }\n\n  function _listsTypeInNested() {\n\n    // Make sure we can type in nested list.\n    const nested_lists = editor.el.querySelectorAll('li > ul, li > ol')\n\n    for (let i = 0; i < nested_lists.length; i++) {\n      const lst = nested_lists[i]\n\n      // List is the first in the LI.\n      if (editor.node.isFirstSibling(lst)) {\n        $(lst).before('<br/>')\n      }\n\n      // Make sure we don't leave BR before list.\n      else if (lst.previousSibling && lst.previousSibling.tagName === 'BR') {\n        let prev_node = lst.previousSibling.previousSibling\n\n        // Skip markers.\n        while (prev_node && editor.node.hasClass(prev_node, 'fr-marker')) {\n          prev_node = prev_node.previousSibling\n        }\n\n        // Remove BR only if there is something else than BR.\n        if (prev_node && prev_node.tagName !== 'BR') {\n          $(lst.previousSibling).remove()\n        }\n      }\n    }\n  }\n\n  function _listsRemoveEmptyLI() {\n\n    // Remove empty li.\n    const empty_lis = editor.el.querySelectorAll('li:empty')\n\n    for (let i = 0; i < empty_lis.length; i++) {\n      $(empty_lis[i]).remove()\n    }\n  }\n\n  function _listsFindMissplacedText() {\n    const lists = editor.el.querySelectorAll('ul, ol')\n\n    for (let i = 0; i < lists.length; i++) {\n      const contents = editor.node.contents(lists[i])\n      let $li = null\n\n      for (let j = contents.length - 1; j >= 0; j--) {\n\n        if (contents[j].tagName !== 'LI') {\n          if (!$li) {\n            $li = $(editor.doc.createElement('LI'))\n            $li.insertBefore(contents[j])\n          }\n\n          $li.prepend(contents[j])\n        }\n        else {\n          $li = null\n        }\n      }\n    }\n  }\n\n  /**\n   * Clean lists.\n   */\n  function lists() {\n    _listsWrapMissplacedLI()\n\n    _listsJoinSiblings()\n\n    _listsFindMissplacedText()\n\n    _listsRemoveEmpty()\n\n    _listsWrapLists()\n\n    _listsNoTagAfterNested()\n\n    _listsTypeInNested()\n\n    _listsRemoveEmptyLI()\n  }\n\n  /**\n   * Initialize\n   */\n  function _init() {\n\n    // If fullPage is on allow head and title.\n    if (editor.opts.fullPage) {\n      $.merge(editor.opts.htmlAllowedTags, ['head', 'title', 'style', 'link', 'base', 'body', 'html', 'meta'])\n    }\n  }\n\n  return {\n    _init,\n    html,\n    toHTML5,\n    tables,\n    lists,\n    invisibleSpaces,\n    exec\n  }\n}\n","import $ from 'jquery'\nimport FE from 'froala_editor'\n\nObject.assign(FE.DEFAULTS, {\n  indentMargin: 20\n})\n\nFE.COMMANDS = {\n  bold: {\n    title: 'Bold',\n    toggle: true,\n    refresh($btn) {\n      const format = this.format.is('strong')\n      $btn.toggleClass('fr-active', format).attr('aria-pressed', format)\n    }\n  },\n  italic: {\n    title: 'Italic',\n    toggle: true,\n    refresh($btn) {\n      const format = this.format.is('em')\n      $btn.toggleClass('fr-active', format).attr('aria-pressed', format)\n    }\n  },\n  underline: {\n    title: 'Underline',\n    toggle: true,\n    refresh($btn) {\n      const format = this.format.is('u')\n      $btn.toggleClass('fr-active', format).attr('aria-pressed', format)\n    }\n  },\n  strikeThrough: {\n    title: 'Strikethrough',\n    toggle: true,\n    refresh($btn) {\n      const format = this.format.is('s')\n      $btn.toggleClass('fr-active', format).attr('aria-pressed', format)\n    }\n  },\n  subscript: {\n    title: 'Subscript',\n    toggle: true,\n    refresh($btn) {\n      const format = this.format.is('sub')\n      $btn.toggleClass('fr-active', format).attr('aria-pressed', format)\n    }\n  },\n  superscript: {\n    title: 'Superscript',\n    toggle: true,\n    refresh($btn) {\n      const format = this.format.is('sup')\n      $btn.toggleClass('fr-active', format).attr('aria-pressed', format)\n    }\n  },\n  outdent: {\n    title: 'Decrease Indent'\n  },\n  indent: {\n    title: 'Increase Indent'\n  },\n  undo: {\n    title: 'Undo',\n    undo: false,\n    forcedRefresh: true,\n    disabled: true\n  },\n  redo: {\n    title: 'Redo',\n    undo: false,\n    forcedRefresh: true,\n    disabled: true\n  },\n  insertHR: {\n    title: 'Insert Horizontal Line'\n  },\n  clearFormatting: {\n    title: 'Clear Formatting'\n  },\n  selectAll: {\n    title: 'Select All',\n    undo: false\n  }\n}\n\nFE.RegisterCommand = function (name, info) {\n  FE.COMMANDS[name] = info\n}\n\nFE.MODULES.commands = function (editor) {\n  function _createDefaultTag(empty) {\n    if (editor.html.defaultTag()) {\n      empty = `<${editor.html.defaultTag()}>${empty}</${editor.html.defaultTag()}>`\n    }\n\n    return empty\n  }\n\n  const mapping = {\n    bold() {\n      _execCommand('bold', 'strong')\n    },\n\n    subscript() {\n\n      // Remove sup.\n      if (editor.format.is('sup')) {\n        editor.format.remove('sup')\n      }\n\n      _execCommand('subscript', 'sub')\n    },\n\n    superscript() {\n\n      // Remove sub.\n      if (editor.format.is('sub')) {\n        editor.format.remove('sub')\n      }\n\n      _execCommand('superscript', 'sup')\n    },\n\n    italic() {\n      _execCommand('italic', 'em')\n    },\n\n    strikeThrough() {\n      _execCommand('strikeThrough', 's')\n    },\n\n    underline() {\n      _execCommand('underline', 'u')\n    },\n\n    undo() {\n      editor.undo.run()\n    },\n\n    redo() {\n      editor.undo.redo()\n    },\n\n    indent() {\n      _processIndent(1)\n    },\n\n    outdent() {\n      _processIndent(-1)\n    },\n\n    show() {\n      if (editor.opts.toolbarInline) {\n        editor.toolbar.showInline(null, true)\n      }\n    },\n\n    insertHR() {\n      editor.selection.remove()\n\n      let empty = ''\n\n      if (editor.core.isEmpty()) {\n        empty = '<br>'\n        empty = _createDefaultTag(empty)\n      }\n\n      editor.html.insert(`<hr id=\"fr-just\">${empty}`)\n      const $hr = editor.$el.find('hr#fr-just')\n      $hr.removeAttr('id')\n      let check\n\n      // Make sure we can type after HR.\n      if ($hr.next().length === 0) {\n        const default_tag = editor.html.defaultTag()\n\n        if (default_tag) {\n          $hr.after($(editor.doc.createElement(default_tag)).append('<br>').get(0))\n        }\n        else {\n          $hr.after('<br>')\n        }\n      }\n\n      if ($hr.prev().is('hr')) {\n        check = editor.selection.setAfter($hr.get(0), false)\n      }\n      else if ($hr.next().is('hr')) {\n        check = editor.selection.setBefore($hr.get(0), false)\n      }\n      else {\n        if (!editor.selection.setAfter($hr.get(0), false)) {\n          editor.selection.setBefore($hr.get(0), false)\n        }\n      }\n\n      // Added fix for this issue https://github.com/froala-labs/froala-editor-js-2/issues/384\n      if (!check && typeof check !== 'undefined') {\n        empty = `${FE.MARKERS}<br>`\n        empty = _createDefaultTag(empty)\n        $hr.after(empty)\n      }\n\n      editor.selection.restore()\n    },\n\n    clearFormatting() {\n      editor.format.remove()\n    },\n\n    selectAll() {\n      editor.doc.execCommand('selectAll', false, false)\n    }\n  }\n\n  /**\n   * Exec command.\n   */\n  function exec(cmd, params) {\n\n    // Trigger before command to see if to execute the default callback.\n    if (editor.events.trigger('commands.before', $.merge([cmd], params || [])) !== false) {\n\n      // Get the callback.\n      const callback = FE.COMMANDS[cmd] && FE.COMMANDS[cmd].callback || mapping[cmd]\n\n      let focus = true\n      let accessibilityFocus = false\n\n      if (FE.COMMANDS[cmd]) {\n        if (typeof FE.COMMANDS[cmd].focus !== 'undefined') {\n          focus = FE.COMMANDS[cmd].focus\n        }\n\n        if (typeof FE.COMMANDS[cmd].accessibilityFocus !== 'undefined') {\n          accessibilityFocus = FE.COMMANDS[cmd].accessibilityFocus\n        }\n      }\n\n      // Make sure we have focus.\n      if (\n        !editor.core.hasFocus() && focus && !editor.popups.areVisible() ||\n        !editor.core.hasFocus() && accessibilityFocus && editor.accessibility.hasFocus()\n      ) {\n\n        // Focus in the editor at any position.\n        editor.events.focus(true)\n      }\n\n      // Callback.\n      // Save undo step.\n      if (FE.COMMANDS[cmd] && FE.COMMANDS[cmd].undo !== false) {\n        if (editor.$el.find('.fr-marker').length) {\n          editor.events.disableBlur()\n          editor.selection.restore()\n        }\n\n        editor.undo.saveStep()\n      }\n\n      if (callback) {\n        callback.apply(editor, $.merge([cmd], params || []))\n      }\n\n      // Trigger after command.\n      editor.events.trigger('commands.after', $.merge([cmd], params || []))\n\n      // Save undo step again.\n      if (FE.COMMANDS[cmd] && FE.COMMANDS[cmd].undo !== false) {\n        editor.undo.saveStep()\n      }\n    }\n  }\n\n  /**\n   * Exex default.\n   */\n  function _execCommand(cmd, tag) {\n    editor.format.toggle(tag)\n  }\n\n  function _processIndent(indent) {\n    editor.selection.save()\n    editor.html.wrap(true, true, true, true)\n    editor.selection.restore()\n\n    const blocks = editor.selection.blocks()\n\n    for (let i = 0; i < blocks.length; i++) {\n      if (blocks[i].tagName !== 'LI' && blocks[i].parentNode.tagName !== 'LI') {\n        const $block = $(blocks[i])\n\n        const prop = editor.opts.direction === 'rtl' || $block.css('direction') === 'rtl' ? 'margin-right' : 'margin-left'\n\n        const margin_left = editor.helpers.getPX($block.css(prop))\n\n        // Do not allow text to go out of the editor view.\n        if ($block.width() < 2 * editor.opts.indentMargin && indent > 0) {\n          continue\n        }\n\n        $block.css(prop, Math.max(margin_left + indent * editor.opts.indentMargin, 0) || '')\n        $block.removeClass('fr-temp-div')\n      }\n    }\n\n    editor.selection.save()\n    editor.html.unwrap()\n    editor.selection.restore()\n  }\n\n  function callExec(k) {\n    return function () {\n      exec(k)\n    }\n  }\n\n  const resp = {}\n\n  for (const k in mapping) {\n    if (Object.prototype.hasOwnProperty.call(mapping, k)) {\n      resp[k] = callExec(k)\n    }\n  }\n\n  function _init() {\n\n    // Prevent typing in HR.\n    editor.events.on('keydown', (e) => {\n      const el = editor.selection.element()\n\n      if (el && el.tagName === 'HR' && !editor.keys.isArrow(e.which)) {\n        e.preventDefault()\n\n        return false\n      }\n    })\n\n    editor.events.on('keyup', (e) => {\n      const el = editor.selection.element()\n\n      if (el && el.tagName === 'HR') {\n        if (e.which === FE.KEYCODE.ARROW_LEFT || e.which === FE.KEYCODE.ARROW_UP) {\n          if (el.previousSibling) {\n            if (!editor.node.isBlock(el.previousSibling)) {\n              $(el).before(FE.MARKERS)\n            }\n            else {\n              editor.selection.setAtEnd(el.previousSibling)\n            }\n\n            editor.selection.restore()\n\n            return false\n          }\n        }\n        else if (e.which === FE.KEYCODE.ARROW_RIGHT || e.which === FE.KEYCODE.ARROW_DOWN) {\n          if (el.nextSibling) {\n            if (!editor.node.isBlock(el.nextSibling)) {\n              $(el).after(FE.MARKERS)\n            }\n            else {\n              editor.selection.setAtStart(el.nextSibling)\n            }\n\n            editor.selection.restore()\n\n            return false\n          }\n        }\n      }\n    })\n\n    // Do not allow mousedown on HR.\n    editor.events.on('mousedown', (e) => {\n      if (e.target && e.target.tagName === 'HR') {\n        e.preventDefault()\n        e.stopPropagation()\n\n        return false\n      }\n    })\n\n    // If somehow focus gets in HR remove it.\n    editor.events.on('mouseup', () => {\n      const s_el = editor.selection.element()\n      const e_el = editor.selection.endElement()\n\n      if (s_el === e_el && s_el && s_el.tagName === 'HR') {\n        if (s_el.nextSibling) {\n          if (!editor.node.isBlock(s_el.nextSibling)) {\n            $(s_el).after(FE.MARKERS)\n          }\n          else {\n            editor.selection.setAtStart(s_el.nextSibling)\n          }\n        }\n\n        editor.selection.restore()\n      }\n    })\n  }\n\n  return Object.assign(resp, {\n    exec,\n    _init\n  })\n}\n","import FE from 'froala_editor'\n\nFE.MODULES.edit = function (editor) {\n  /**\n   * Disable editing design.\n   */\n  function disableDesign() {\n    if (editor.browser.mozilla) {\n      try {\n        editor.doc.execCommand('enableObjectResizing', false, 'false')\n        editor.doc.execCommand('enableInlineTableEditing', false, 'false')\n      }\n      catch (ex) {\n        // ok.\n      }\n    }\n\n    if (editor.browser.msie) {\n      try {\n        editor.doc.body.addEventListener('mscontrolselect', (e) => {\n          e.preventDefault()\n\n          return false\n        })\n      }\n      catch (ex) {\n        // ok.\n      }\n    }\n  }\n\n  let disabled = false\n\n  /**\n   * Add contneteditable attribute.\n   */\n  function on() {\n    if (editor.$wp) {\n      editor.$el.attr('contenteditable', true)\n      editor.$el.removeClass('fr-disabled').attr('aria-disabled', false)\n\n      if (editor.$tb) {\n        editor.$tb.removeClass('fr-disabled').removeAttr('aria-disabled')\n      }\n      disableDesign()\n    }\n    else if (editor.$el.is('a')) {\n      editor.$el.attr('contenteditable', true)\n    }\n\n    disabled = false\n  }\n\n  /**\n   * Remove contenteditable attribute.\n   */\n  function off() {\n    editor.events.disableBlur()\n\n    if (editor.$wp) {\n      editor.$el.attr('contenteditable', false)\n      editor.$el.addClass('fr-disabled').attr('aria-disabled', true)\n\n      if (editor.$tb) {\n        editor.$tb.addClass('fr-disabled').attr('aria-disabled', true)\n      }\n    }\n    else if (editor.$el.is('a')) {\n      editor.$el.attr('contenteditable', false)\n    }\n\n    editor.events.enableBlur()\n\n    disabled = true\n  }\n\n  function isDisabled() {\n    return disabled\n  }\n\n  function _init() {\n    // When there are multiple editor instances and shared toolbar make sure we can edit.\n    editor.events.on('focus', () => {\n      if (isDisabled()) {\n        editor.edit.off()\n      }\n      else {\n        editor.edit.on()\n      }\n    })\n  }\n\n  return {\n    _init,\n    on,\n    off,\n    disableDesign,\n    isDisabled\n  }\n}\n","import FE from 'froala_editor'\n\nFE.MODULES.spaces = function (editor) {\n\n  function _normalizeNode(node, browser_way) {\n    const p_node = node.previousSibling\n    const n_node = node.nextSibling\n    let txt = node.textContent\n    const parent_node = node.parentNode\n\n    if (editor.html.isPreformatted(parent_node)) {\n      return\n    }\n\n    if (browser_way) {\n      txt = txt.replace(/[\\f\\n\\r\\t\\v ]{2,}/g, ' ')\n\n      // No node after.\n      if ((!n_node || n_node.tagName === 'BR' || editor.node.isBlock(n_node)) && (editor.node.isBlock(parent_node) || editor.node.isLink(parent_node) && !parent_node.nextSibling || editor.node.isElement(parent_node))) {\n        txt = txt.replace(/[\\f\\n\\r\\t\\v ]{1,}$/g, '')\n      }\n\n      if ((!p_node || p_node.tagName === 'BR' || editor.node.isBlock(p_node)) && (editor.node.isBlock(parent_node) || editor.node.isLink(parent_node) && !parent_node.previousSibling || editor.node.isElement(parent_node))) {\n        txt = txt.replace(/^[\\f\\n\\r\\t\\v ]{1,}/g, '')\n      }\n\n      // https://github.com/froala/wysiwyg-editor/issues/1767 .\n      if (txt === ' ' && (p_node && editor.node.isVoid(p_node) || n_node && editor.node.isVoid(n_node))) {\n        txt = ''\n      }\n    }\n\n    // Collapse spaces when we have nested blocks.\n    if ((!p_node && editor.node.isBlock(n_node) || !n_node && editor.node.isBlock(p_node)) && editor.node.isBlock(parent_node) && parent_node !== editor.el) {\n      txt = txt.replace(/^[\\f\\n\\r\\t\\v ]{1,}/g, '')\n    }\n\n    // Convert all non breaking to breaking spaces.\n    if (!browser_way) {\n      txt = txt.replace(new RegExp(FE.UNICODE_NBSP, 'g'), ' ')\n    }\n\n    let new_text = ''\n\n    for (let t = 0; t < txt.length; t++) {\n      if (txt.charCodeAt(t) === 32 && (t === 0 || new_text.charCodeAt(t - 1) === 32)) {\n        new_text += FE.UNICODE_NBSP\n      }\n      else {\n        new_text += txt[t]\n      }\n    }\n\n    // Ending spaces should be NBSP or spaces before block tags.\n    // 1. No node after. (and the parent node is block tag.)\n    // 2. Next block is block tag.\n    // 3. Next element has display block.\n    if (!n_node || n_node && editor.node.isBlock(n_node) || n_node && n_node.nodeType === Node.ELEMENT_NODE && editor.win.getComputedStyle(n_node) && editor.win.getComputedStyle(n_node).display === 'block') {\n      new_text = new_text.replace(/ $/, FE.UNICODE_NBSP)\n    }\n\n    // Previous sibling is not void or block.\n    if (p_node && !editor.node.isVoid(p_node) && !editor.node.isBlock(p_node)) {\n      new_text = new_text.replace(/^\\u00A0([^ $])/, ' $1')\n\n      // https://github.com/froala/wysiwyg-editor/issues/1355.\n      if (new_text.length === 1 && new_text.charCodeAt(0) === 160 && n_node && !editor.node.isVoid(n_node) && !editor.node.isBlock(n_node)) {\n        new_text = ' '\n      }\n    }\n\n    // Convert middle nbsp to spaces.\n    if (!browser_way) {\n      new_text = new_text.replace(/([^ \\u00A0])\\u00A0([^ \\u00A0])/g, '$1 $2')\n    }\n\n    if (node.textContent !== new_text) {\n      node.textContent = new_text\n    }\n  }\n\n  function normalize(el, browser_way) {\n    if (typeof el === 'undefined' || !el) {\n      el = editor.el\n    }\n\n    if (typeof browser_way === 'undefined') {\n      browser_way = false\n    }\n\n    // Ignore contenteditable.\n    if (el.getAttribute && el.getAttribute('contenteditable') === 'false') {\n      return\n    }\n\n    if (el.nodeType === Node.TEXT_NODE) {\n      _normalizeNode(el, browser_way)\n    }\n    else if (el.nodeType === Node.ELEMENT_NODE) {\n      const walker = editor.doc.createTreeWalker(el, NodeFilter.SHOW_TEXT, editor.node.filter((node) => {\n\n        // Store the current parent node.\n        let temp_node = node.parentNode\n\n        // Loop through the nodes to see if it is PRE tag, go to the highest parent until editable element.\n        while (temp_node && temp_node !== editor.el) {\n\n          if (temp_node.tagName === 'STYLE' || temp_node.tagName === 'IFRAME') {\n            return false\n          }\n\n          if (temp_node.tagName !== 'PRE') {\n\n            // Check next parent.\n            temp_node = temp_node.parentNode\n          }\n          else {\n\n            // If inside a PRE tag return false and move to next element.\n            return false\n          }\n        }\n\n        // If not PRE tag start matching for chars that need to be removed from all other html tags.\n        return node.textContent.match(/([ \\u00A0\\f\\n\\r\\t\\v]{2,})|(^[ \\u00A0\\f\\n\\r\\t\\v]{1,})|([ \\u00A0\\f\\n\\r\\t\\v]{1,}$)/g) !== null && !editor.node.hasClass(node.parentNode, 'fr-marker')\n      }), false)\n\n      while (walker.nextNode()) {\n        _normalizeNode(walker.currentNode, browser_way)\n      }\n    }\n  }\n\n  function normalizeAroundCursor() {\n    const nodes = []\n    const markers = editor.el.querySelectorAll('.fr-marker')\n\n    // Get the deep parent node of each marker.\n    for (let i = 0; i < markers.length; i++) {\n      let node = null\n      const p_node = editor.node.blockParent(markers[i])\n\n      if (p_node) {\n        node = p_node\n      }\n      else {\n        node = markers[i]\n      }\n\n      let next_node = node.nextSibling\n      let prev_node = node.previousSibling\n\n      while (next_node && next_node.tagName === 'BR') {\n        next_node = next_node.nextSibling\n      }\n\n      while (prev_node && prev_node.tagName === 'BR') {\n        prev_node = prev_node.previousSibling\n      }\n\n      // Push current node, prev and next one.\n      if (node && nodes.indexOf(node) < 0) {\n        nodes.push(node)\n      }\n\n      if (prev_node && nodes.indexOf(prev_node) < 0) {\n        nodes.push(prev_node)\n      }\n\n      if (next_node && nodes.indexOf(next_node) < 0) {\n        nodes.push(next_node)\n      }\n    }\n\n    for (let j = 0; j < nodes.length; j++) {\n      normalize(nodes[j])\n    }\n  }\n\n  return {\n    normalize,\n    normalizeAroundCursor\n  }\n}\n","import $ from 'jquery'\nimport FE from 'froala_editor'\n\nFE.INVISIBLE_SPACE = '&#8203;'\nFE.START_MARKER = `<span class=\"fr-marker\" data-id=\"0\" data-type=\"true\" style=\"display: none; line-height: 0;\">${FE.INVISIBLE_SPACE}</span>`\nFE.END_MARKER = `<span class=\"fr-marker\" data-id=\"0\" data-type=\"false\" style=\"display: none; line-height: 0;\">${FE.INVISIBLE_SPACE}</span>`\nFE.MARKERS = FE.START_MARKER + FE.END_MARKER\n\nFE.MODULES.markers = function (editor) {\n  /**\n   * Build marker element.\n   */\n  function _build(marker, id) {\n    const $span = $(editor.doc.createElement('SPAN'))\n    $span\n      .addClass('fr-marker')\n      .attr('data-id', id)\n      .attr('data-type', marker)\n      .attr('style', `display: ${editor.browser.safari ? 'none' : 'inline-block'}; line-height: 0;`)\n      .html(FE.INVISIBLE_SPACE)\n\n    return $span.get(0)\n  }\n\n  /**\n   * Place marker.\n   */\n  function place(range, marker, id) {\n    let mk\n    let contents\n    let sibling\n\n    try {\n      const boundary = range.cloneRange()\n      boundary.collapse(marker)\n\n      boundary.insertNode(_build(marker, id))\n\n      if (marker === true) {\n        mk = editor.$el.find(`span.fr-marker[data-type=\"true\"][data-id=\"${id}\"]`).get(0)\n        sibling = mk.nextSibling\n\n        // Clean empty spaces.\n        while (sibling && sibling.nodeType === Node.TEXT_NODE && sibling.textContent.length === 0) {\n          $(sibling).remove()\n          sibling = mk.nextSibling\n        }\n      }\n\n      if (marker === true && !range.collapsed) {\n\n        // Move markers outside of something like this:\n        // <p><strong>fooM</strong>bar</p>\n        while (!editor.node.isElement(mk.parentNode) && !sibling) {\n          $(mk.parentNode).after(mk)\n          sibling = mk.nextSibling\n        }\n\n        if (sibling && sibling.nodeType === Node.ELEMENT_NODE && editor.node.isBlock(sibling) && sibling.tagName !== 'HR') {\n\n          // Place the marker deep inside the block tags.\n          contents = [sibling]\n\n          do {\n            sibling = contents[0]\n            contents = editor.node.contents(sibling)\n          } while (contents[0] && editor.node.isBlock(contents[0]))\n\n          $(sibling).prepend($(mk))\n        }\n      }\n\n      if (marker === false && !range.collapsed) {\n        mk = editor.$el.find(`span.fr-marker[data-type=\"false\"][data-id=\"${id}\"]`).get(0)\n        sibling = mk.previousSibling\n\n        if (sibling && sibling.nodeType === Node.ELEMENT_NODE && editor.node.isBlock(sibling) && sibling.tagName !== 'HR') {\n\n          // Place the marker deep inside the block tags.\n          contents = [sibling]\n\n          do {\n            sibling = contents[contents.length - 1]\n            contents = editor.node.contents(sibling)\n          } while (contents[contents.length - 1] && editor.node.isBlock(contents[contents.length - 1]))\n\n          $(sibling).append($(mk))\n        }\n\n        // https://github.com/froala/wysiwyg-editor/issues/705\n        if (mk.parentNode && ['TD', 'TH'].indexOf(mk.parentNode.tagName) >= 0) {\n          if (mk.parentNode.previousSibling && !mk.previousSibling) {\n            $(mk.parentNode.previousSibling).append(mk)\n          }\n        }\n      }\n\n      const dom_marker = editor.$el.find(`span.fr-marker[data-type=\"${marker}\"][data-id=\"${id}\"]`).get(0)\n\n      // If image is at the top of the editor in an empty P\n      // and floated to right, the text will be pushed down\n      // when trying to insert an image.\n      if (dom_marker) {\n        dom_marker.style.display = 'none'\n      }\n\n      return dom_marker\n    }\n    catch (ex) {\n      return null\n    }\n  }\n\n  /**\n   * Insert a single marker.\n   */\n  function insert() {\n    if (!editor.$wp) {\n      return null\n    }\n\n    try {\n      const range = editor.selection.ranges(0)\n      const container = range.commonAncestorContainer\n\n      // Check if selection is inside editor.\n      if (container !== editor.el && !editor.$el.contains(container)) {\n        return null\n      }\n\n      const boundary = range.cloneRange()\n      const original_range = range.cloneRange()\n      boundary.collapse(true)\n\n      let mk = $(editor.doc.createElement('SPAN'))\n                  .addClass('fr-marker')\n                  .attr('style', 'display: none; line-height: 0;')\n                  .html(FE.INVISIBLE_SPACE)\n                  .get(0)\n\n      boundary.insertNode(mk)\n\n      mk = editor.$el.find('span.fr-marker').get(0)\n\n      if (mk) {\n        let sibling = mk.nextSibling\n\n        while (sibling && sibling.nodeType === Node.TEXT_NODE && sibling.textContent.length === 0) {\n          $(sibling).remove()\n          sibling = editor.$el.find('span.fr-marker').get(0).nextSibling\n        }\n\n        // Keep original selection.\n        editor.selection.clear()\n        editor.selection.get().addRange(original_range)\n\n        return mk\n      }\n\n      return null\n\n    }\n    catch (ex) {\n      console.warn('MARKER', ex)\n    }\n  }\n\n  /**\n   * Split HTML at the marker position.\n   */\n  function split() {\n    if (!editor.selection.isCollapsed()) {\n      editor.selection.remove()\n    }\n\n    let marker = editor.$el.find('.fr-marker').get(0)\n\n    if (marker === null) {\n      marker = insert()\n    }\n\n    if (marker === null) {\n      return null\n    }\n\n    let deep_parent = editor.node.deepestParent(marker)\n\n    if (!deep_parent) {\n      deep_parent = editor.node.blockParent(marker)\n\n      if (deep_parent && deep_parent.tagName !== 'LI') {\n        deep_parent = null\n      }\n    }\n\n    if (deep_parent) {\n      if (editor.node.isBlock(deep_parent) && editor.node.isEmpty(deep_parent)) {\n\n        // https://github.com/froala/wysiwyg-editor/issues/1730.\n        // https://github.com/froala/wysiwyg-editor/issues/1970.\n        if (deep_parent.tagName === 'LI' && (deep_parent.parentNode.firstElementChild === deep_parent && !editor.node.isEmpty(deep_parent.parentNode))) {\n          $(deep_parent).append('<span class=\"fr-marker\"></span>')\n        }\n        else {\n          $(deep_parent).replaceWith('<span class=\"fr-marker\"></span>')\n        }\n      }\n      else if (editor.cursor.isAtStart(marker, deep_parent)) {\n        $(deep_parent).before('<span class=\"fr-marker\"></span>')\n        $(marker).remove()\n      }\n      else if (editor.cursor.isAtEnd(marker, deep_parent)) {\n        $(deep_parent).after('<span class=\"fr-marker\"></span>')\n        $(marker).remove()\n      }\n      else {\n        let node = marker\n        let close_str = ''\n        let open_str = ''\n\n        do {\n          node = node.parentNode\n          close_str += editor.node.closeTagString(node)\n          open_str = editor.node.openTagString(node) + open_str\n        } while (node !== deep_parent)\n\n        $(marker).replaceWith('<span id=\"fr-break\"></span>')\n        let h = editor.node.openTagString(deep_parent) + $(deep_parent).html() + editor.node.closeTagString(deep_parent)\n        h = h.replace(/<span id=\"fr-break\"><\\/span>/g, `${close_str}<span class=\"fr-marker\"></span>${open_str}`)\n\n        $(deep_parent).replaceWith(h)\n      }\n    }\n\n    return editor.$el.find('.fr-marker').get(0)\n  }\n\n  /**\n   * Insert marker at point from event.\n   *\n   * http://stackoverflow.com/questions/11191136/set-a-selection-range-from-a-to-b-in-absolute-position\n   * https://developer.mozilla.org/en-US/docs/Web/API/this.document.caretPositionFromPoint\n   */\n  function insertAtPoint(e) {\n    const x = e.clientX\n    const y = e.clientY\n\n    // Clear markers.\n    remove()\n\n    let start\n    let range = null\n\n    // Default.\n    if (typeof editor.doc.caretPositionFromPoint !== 'undefined') {\n      start = editor.doc.caretPositionFromPoint(x, y)\n      range = editor.doc.createRange()\n\n      range.setStart(start.offsetNode, start.offset)\n      range.setEnd(start.offsetNode, start.offset)\n    }\n\n    // Webkit.\n    else if (typeof editor.doc.caretRangeFromPoint !== 'undefined') {\n      start = editor.doc.caretRangeFromPoint(x, y)\n      range = editor.doc.createRange()\n\n      range.setStart(start.startContainer, start.startOffset)\n      range.setEnd(start.startContainer, start.startOffset)\n    }\n\n    // Set ranges.\n    if (range !== null && typeof editor.win.getSelection !== 'undefined') {\n      const sel = editor.win.getSelection()\n      sel.removeAllRanges()\n      sel.addRange(range)\n    }\n\n    // MSIE.\n    else if (typeof editor.doc.body.createTextRange !== 'undefined') {\n      try {\n        range = editor.doc.body.createTextRange()\n        range.moveToPoint(x, y)\n        const end_range = range.duplicate()\n        end_range.moveToPoint(x, y)\n        range.setEndPoint('EndToEnd', end_range)\n        range.select()\n      }\n      catch (ex) {\n        return false\n      }\n    }\n\n    insert()\n  }\n\n  /**\n   * Remove markers.\n   */\n  function remove() {\n    editor.$el.find('.fr-marker').remove()\n  }\n\n  return {\n    place,\n    insert,\n    split,\n    insertAtPoint,\n    remove\n  }\n}\n","import './markers.js'\n\nimport $ from 'jquery'\nimport FE from 'froala_editor'\n\nFE.MODULES.selection = function (editor) {\n  /**\n   * Get selection text.\n   */\n  function text() {\n    let text = ''\n\n    if (editor.win.getSelection) {\n      text = editor.win.getSelection()\n    }\n    else if (editor.doc.getSelection) {\n      text = editor.doc.getSelection()\n    }\n    else if (editor.doc.selection) {\n      text = editor.doc.selection.createRange().text\n    }\n\n    return text.toString()\n  }\n\n  /**\n   * Get the selection object.\n   */\n  function get() {\n    let selection = ''\n\n    if (editor.win.getSelection) {\n      selection = editor.win.getSelection()\n    }\n    else if (editor.doc.getSelection) {\n      selection = editor.doc.getSelection()\n    }\n    else {\n      selection = editor.doc.selection.createRange()\n    }\n\n    return selection\n  }\n\n  /**\n   * Get the selection ranges or a single range at a specified index.\n   */\n  function ranges(index) {\n    const sel = get()\n    let ranges = []\n\n    // Get ranges.\n    if (sel && sel.getRangeAt && sel.rangeCount) {\n      ranges = []\n\n      for (let i = 0; i < sel.rangeCount; i++) {\n        ranges.push(sel.getRangeAt(i))\n      }\n    }\n    else if (editor.doc.createRange) {\n      ranges = [editor.doc.createRange()]\n    }\n    else {\n      ranges = []\n    }\n\n    return typeof index !== 'undefined' ? ranges[index] : ranges\n  }\n\n  /**\n   * Clear selection.\n   */\n  function clear() {\n    const sel = get()\n\n    try {\n      if (sel.removeAllRanges) {\n        sel.removeAllRanges()\n      }\n      else if (sel.empty) { // IE?\n        sel.empty()\n      }\n      else if (sel.clear) {\n        sel.clear()\n      }\n    }\n    catch (ex) {\n      // ok.\n    }\n  }\n\n  /**\n   * Selection element.\n   */\n  function element() {\n    const sel = get()\n\n    try {\n      if (sel.rangeCount) {\n        const range = ranges(0)\n        let node = range.startContainer\n        let child\n\n        // https://github.com/froala/wysiwyg-editor/issues/1399.\n        if (node.nodeType === Node.TEXT_NODE && range.startOffset === (node.textContent || '').length && node.nextSibling) {\n          node = node.nextSibling\n        }\n\n        // Get parrent if node type is not DOM.\n        if (node.nodeType === Node.ELEMENT_NODE) {\n          let node_found = false\n\n          // Search for node deeper.\n          if (node.childNodes.length > 0 && node.childNodes[range.startOffset]) {\n            child = node.childNodes[range.startOffset]\n\n            while (child && child.nodeType === Node.TEXT_NODE && child.textContent.length === 0) {\n              child = child.nextSibling\n            }\n\n            if (child && child.textContent.replace(/\\u200B/g, '') === text().replace(/\\u200B/g, '')) {\n              node = child\n              node_found = true\n            }\n\n            // Look back maybe me missed something.\n            if (!node_found && node.childNodes.length > 1 && range.startOffset > 0 && node.childNodes[range.startOffset - 1]) {\n              child = node.childNodes[range.startOffset - 1]\n\n              while (child && child.nodeType === Node.TEXT_NODE && child.textContent.length === 0) {\n                child = child.nextSibling\n              }\n\n              if (child && child.textContent.replace(/\\u200B/g, '') === text().replace(/\\u200B/g, '')) {\n                node = child\n                node_found = true\n              }\n            }\n          }\n\n          // Selection starts just at the end of the node.\n          else if (!range.collapsed && node.nextSibling && node.nextSibling.nodeType === Node.ELEMENT_NODE) {\n            child = node.nextSibling\n\n            if (child && child.textContent.replace(/\\u200B/g, '') === text().replace(/\\u200B/g, '')) {\n              node = child\n              node_found = true\n            }\n          }\n\n          if (!node_found && node.childNodes.length > 0 && $(node.childNodes[0]).text().replace(/\\u200B/g, '') === text().replace(/\\u200B/g, '') && ['BR', 'IMG', 'HR'].indexOf(node.childNodes[0].tagName) < 0) {\n            node = node.childNodes[0]\n          }\n        }\n\n        while (node.nodeType !== Node.ELEMENT_NODE && node.parentNode) {\n          node = node.parentNode\n        }\n\n        // Make sure the node is in editor.\n        let p = node\n\n        while (p && p.tagName !== 'HTML') {\n          if (p === editor.el) {\n            return node\n          }\n\n          p = $(p).parent()[0]\n        }\n      }\n    }\n    catch (ex) {\n      // ok.\n    }\n\n    return editor.el\n  }\n\n  /**\n   * Selection element.\n   */\n  function endElement() {\n    const sel = get()\n\n    try {\n      if (sel.rangeCount) {\n        const range = ranges(0)\n        let node = range.endContainer\n        let child\n\n        // Get parrent if node type is not DOM.\n        if (node.nodeType === Node.ELEMENT_NODE) {\n          let node_found = false\n\n          // Search for node deeper.\n          if (node.childNodes.length > 0 && node.childNodes[range.endOffset] && $(node.childNodes[range.endOffset]).text() === text()) {\n            node = node.childNodes[range.endOffset]\n            node_found = true\n          }\n\n          // Selection starts just at the end of the node.\n          else if (!range.collapsed && node.previousSibling && node.previousSibling.nodeType === Node.ELEMENT_NODE) {\n            child = node.previousSibling\n\n            if (child && child.textContent.replace(/\\u200B/g, '') === text().replace(/\\u200B/g, '')) {\n              node = child\n              node_found = true\n            }\n          }\n\n          // Browser sees selection at the beginning of the next node.\n          else if (!range.collapsed && node.childNodes.length > 0 && node.childNodes[range.endOffset]) {\n            child = node.childNodes[range.endOffset].previousSibling\n\n            if (child.nodeType === Node.ELEMENT_NODE) {\n\n              if (child && child.textContent.replace(/\\u200B/g, '') === text().replace(/\\u200B/g, '')) {\n                node = child\n                node_found = true\n              }\n            }\n          }\n\n          if (!node_found && node.childNodes.length > 0 && $(node.childNodes[node.childNodes.length - 1]).text() === text() && ['BR', 'IMG', 'HR'].indexOf(node.childNodes[node.childNodes.length - 1].tagName) < 0) {\n            node = node.childNodes[node.childNodes.length - 1]\n          }\n        }\n\n        if (node.nodeType === Node.TEXT_NODE && range.endOffset === 0 && node.previousSibling && node.previousSibling.nodeType === Node.ELEMENT_NODE) {\n          node = node.previousSibling\n        }\n\n        while (node.nodeType !== Node.ELEMENT_NODE && node.parentNode) {\n          node = node.parentNode\n        }\n\n        // Make sure the node is in editor.\n        let p = node\n\n        while (p && p.tagName !== 'HTML') {\n\n          if (p === editor.el) {\n            return node\n          }\n\n          p = $(p).parent()[0]\n        }\n      }\n    }\n    catch (ex) {\n      // ok.\n    }\n\n    return editor.el\n  }\n\n  /**\n   * Get the ELEMENTS node where the selection starts.\n   * By default TEXT node might be selected.\n   */\n  function rangeElement(rangeContainer, offset) {\n    let node = rangeContainer\n\n    if (node.nodeType === Node.ELEMENT_NODE) {\n\n      // Search for node deeper.\n      if (node.childNodes.length > 0 && node.childNodes[offset]) {\n        node = node.childNodes[offset]\n      }\n    }\n\n    if (node.nodeType === Node.TEXT_NODE) {\n      node = node.parentNode\n    }\n\n    return node\n  }\n\n  /**\n   * Search for the current selected blocks.\n   */\n  function blocks() {\n    const blks = []\n    let i\n    let block_parent\n\n    const sel = get()\n\n    // Selection must be inside editor.\n    if (inEditor() && sel.rangeCount) {\n\n      // Loop through ranges.\n      const rngs = ranges()\n\n      for (i = 0; i < rngs.length; i++) {\n        const range = rngs[i]\n\n        // Get start node and end node for range.\n        const start_node = rangeElement(range.startContainer, range.startOffset)\n        const end_node = rangeElement(range.endContainer, range.endOffset)\n\n        // Add the start node.\n        if ((editor.node.isBlock(start_node) || editor.node.hasClass(start_node, 'fr-inner')) && blks.indexOf(start_node) < 0) {\n          blks.push(start_node)\n        }\n\n        // Check for the parent node of the start node.\n        block_parent = editor.node.blockParent(start_node)\n\n        if (block_parent && blks.indexOf(block_parent) < 0) {\n          blks.push(block_parent)\n        }\n\n        // Do not add nodes where we've been once.\n        const was_into = []\n\n        // Loop until we reach end.\n        let next_node = start_node\n\n        while (next_node !== end_node && next_node !== editor.el) {\n\n          // Get deeper into the current node.\n          if (was_into.indexOf(next_node) < 0 && next_node.children && next_node.children.length) {\n            was_into.push(next_node)\n            next_node = next_node.children[0]\n          }\n\n          // Get next sibling.\n          else if (next_node.nextSibling) {\n            next_node = next_node.nextSibling\n          }\n\n          // Get parent node.\n          else if (next_node.parentNode) {\n            next_node = next_node.parentNode\n            was_into.push(next_node)\n          }\n\n          // Add node to the list.\n          if (editor.node.isBlock(next_node) && was_into.indexOf(next_node) < 0 && blks.indexOf(next_node) < 0) {\n            if (next_node !== end_node || range.endOffset > 0) {\n              blks.push(next_node)\n            }\n          }\n        }\n\n        // Add the end node.\n        if (editor.node.isBlock(end_node) && blks.indexOf(end_node) < 0 && range.endOffset > 0) {\n          blks.push(end_node)\n        }\n\n        // Check for the parent node of the end node.\n        block_parent = editor.node.blockParent(end_node)\n\n        if (block_parent && blks.indexOf(block_parent) < 0) {\n          blks.push(block_parent)\n        }\n      }\n    }\n\n    // Remove blocks that we don't need.\n    for (i = blks.length - 1; i > 0; i--) {\n      // Nodes that contain another node. Don't do it for LI, but remove them if there is a single child and has format.\n      if ($(blks[i]).contains(blks)) {\n        blks.splice(i, 1)\n      }\n    }\n\n    return blks\n  }\n\n  /**\n   * Save selection.\n   */\n  function save() {\n    if (editor.$wp) {\n      editor.markers.remove()\n\n      const rgs = ranges()\n      const new_ranges = []\n      let range\n      let i\n\n      for (i = 0; i < rgs.length; i++) {\n\n        // 2nd condition is for https://github.com/froala/wysiwyg-editor/issues/1750.\n        if (rgs[i].startContainer !== editor.doc || editor.browser.msie) {\n          range = rgs[i]\n\n          const collapsed = range.collapsed\n          const start_m = editor.markers.place(range, true, i) // Start.\n          const end_m = editor.markers.place(range, false, i) // End.\n\n          // Put selection at the end when there is no marker.\n          if ((typeof start_m === 'undefined' || !start_m) && collapsed) {\n            $('.fr-marker').remove()\n            editor.selection.setAtEnd(editor.el)\n          }\n\n          // https://github.com/froala/wysiwyg-editor/issues/1398.\n          editor.el.normalize()\n\n          if (editor.browser.safari && !collapsed) {\n            try {\n              range = editor.doc.createRange()\n              range.setStartAfter(start_m)\n              range.setEndBefore(end_m)\n              new_ranges.push(range)\n            }\n            catch (ex) {\n              // Leave this empty.\n            }\n          }\n        }\n      }\n\n      if (editor.browser.safari && new_ranges.length) {\n        editor.selection.clear()\n\n        for (i = 0; i < new_ranges.length; i++) {\n          editor.selection.get().addRange(new_ranges[i])\n        }\n      }\n    }\n  }\n\n  /**\n   * Restore selection.\n   */\n  function restore() {\n    let i\n\n    // Get markers.\n    const markers = editor.el.querySelectorAll('.fr-marker[data-type=\"true\"]')\n\n    if (!editor.$wp) {\n      editor.markers.remove()\n\n      return false\n    }\n\n    // No markers.\n    if (markers.length === 0) {\n\n      return false\n    }\n\n    if (editor.browser.msie || editor.browser.edge) {\n      for (i = 0; i < markers.length; i++) {\n        markers[i].style.display = 'inline-block'\n      }\n    }\n\n    // Focus.\n    if (!editor.core.hasFocus() && !editor.browser.msie && !editor.browser.webkit) {\n      editor.$el.focus()\n    }\n\n    clear()\n    const sel = get()\n\n    // Add ranges.\n    for (i = 0; i < markers.length; i++) {\n      const id = $(markers[i]).data('id')\n      let start_marker = markers[i]\n      const range = editor.doc.createRange()\n      let end_marker = editor.$el.find(`.fr-marker[data-type=\"false\"][data-id=\"${id}\"]`)\n\n      if (editor.browser.msie || editor.browser.edge) {\n        end_marker.css('display', 'inline-block')\n      }\n\n      let ghost = null\n\n      // Make sure there is an start marker.\n      if (end_marker.length > 0) {\n        end_marker = end_marker[0]\n\n        try {\n          // If we have markers one next to each other inside text, then we should normalize text by joining it.\n          let special_case = false\n\n          // Clear empty text nodes.\n          let s_node = start_marker.nextSibling\n\n          let tmp = null\n          while (s_node && s_node.nodeType === Node.TEXT_NODE && s_node.textContent.length === 0) {\n            tmp = s_node\n            s_node = s_node.nextSibling\n            $(tmp).remove()\n          }\n\n          let e_node = end_marker.nextSibling\n\n          while (e_node && e_node.nodeType === Node.TEXT_NODE && e_node.textContent.length === 0) {\n            tmp = e_node\n            e_node = e_node.nextSibling\n            $(tmp).remove()\n          }\n\n          if (start_marker.nextSibling === end_marker || end_marker.nextSibling === start_marker) {\n\n            // Decide which is first and which is last between markers.\n            const first_node = start_marker.nextSibling === end_marker ? start_marker : end_marker\n            const last_node = first_node === start_marker ? end_marker : start_marker\n\n            // Previous node.\n            let prev_node = first_node.previousSibling\n\n            while (prev_node && prev_node.nodeType === Node.TEXT_NODE && prev_node.length === 0) {\n              tmp = prev_node\n              prev_node = prev_node.previousSibling\n              $(tmp).remove()\n            }\n\n            // Normalize text before.\n            if (prev_node && prev_node.nodeType === Node.TEXT_NODE) {\n\n              while (prev_node && prev_node.previousSibling && prev_node.previousSibling.nodeType === Node.TEXT_NODE) {\n                prev_node.previousSibling.textContent += prev_node.textContent\n                prev_node = prev_node.previousSibling\n                $(prev_node.nextSibling).remove()\n              }\n            }\n\n            // Next node.\n            let next_node = last_node.nextSibling\n\n            while (next_node && next_node.nodeType === Node.TEXT_NODE && next_node.length === 0) {\n              tmp = next_node\n              next_node = next_node.nextSibling\n              $(tmp).remove()\n            }\n\n            // Normalize text after.\n            if (next_node && next_node.nodeType === Node.TEXT_NODE) {\n\n              while (next_node && next_node.nextSibling && next_node.nextSibling.nodeType === Node.TEXT_NODE) {\n                next_node.nextSibling.textContent = next_node.textContent + next_node.nextSibling.textContent\n                next_node = next_node.nextSibling\n                $(next_node.previousSibling).remove()\n              }\n            }\n\n            if (prev_node && (editor.node.isVoid(prev_node) || editor.node.isBlock(prev_node))) {\n              prev_node = null\n            }\n\n            if (next_node && (editor.node.isVoid(next_node) || editor.node.isBlock(next_node))) {\n              next_node = null\n            }\n\n            // Previous node and next node are both text.\n            if (prev_node && next_node && prev_node.nodeType === Node.TEXT_NODE && next_node.nodeType === Node.TEXT_NODE) {\n\n              // Remove markers.\n              $(start_marker).remove()\n              $(end_marker).remove()\n\n              // Save cursor position.\n              const len = prev_node.textContent.length\n              prev_node.textContent += next_node.textContent\n              $(next_node).remove()\n\n              // Normalize spaces.\n              if (!editor.opts.htmlUntouched) {\n                editor.spaces.normalize(prev_node)\n              }\n\n              // Restore position.\n              range.setStart(prev_node, len)\n              range.setEnd(prev_node, len)\n\n              special_case = true\n            }\n            else if (!prev_node && next_node && next_node.nodeType === Node.TEXT_NODE) {\n\n              // Remove markers.\n              $(start_marker).remove()\n              $(end_marker).remove()\n\n              // Normalize spaces.\n              if (!editor.opts.htmlUntouched) {\n                editor.spaces.normalize(next_node)\n              }\n\n              ghost = $(editor.doc.createTextNode('\\u200B')).get(0)\n              $(next_node).before(ghost)\n\n              // Restore position.\n              range.setStart(next_node, 0)\n              range.setEnd(next_node, 0)\n              special_case = true\n            }\n            else if (!next_node && prev_node && prev_node.nodeType === Node.TEXT_NODE) {\n\n              // Remove markers.\n              $(start_marker).remove()\n              $(end_marker).remove()\n\n              // Normalize spaces.\n              if (!editor.opts.htmlUntouched) {\n                editor.spaces.normalize(prev_node)\n              }\n\n              ghost = $(editor.doc.createTextNode('\\u200B')).get(0)\n              $(prev_node).after(ghost)\n\n              // Restore position.\n              range.setStart(prev_node, prev_node.textContent.length)\n              range.setEnd(prev_node, prev_node.textContent.length)\n\n              special_case = true\n            }\n          }\n\n          if (!special_case) {\n            let x\n            let y\n\n            // DO NOT TOUCH THIS OR IT WILL BREAK!!!\n            if ((editor.browser.chrome || editor.browser.edge) && start_marker.nextSibling === end_marker) {\n              x = _normalizedMarker(end_marker, range, true) || range.setStartAfter(end_marker)\n              y = _normalizedMarker(start_marker, range, false) || range.setEndBefore(start_marker)\n            }\n            else {\n              if (start_marker.previousSibling === end_marker) {\n                start_marker = end_marker\n                end_marker = start_marker.nextSibling\n              }\n\n              // https://github.com/froala/wysiwyg-editor/issues/759\n              if (!(end_marker.nextSibling && end_marker.nextSibling.tagName === 'BR') &&\n                !(!end_marker.nextSibling && editor.node.isBlock(start_marker.previousSibling)) &&\n                !(start_marker.previousSibling && start_marker.previousSibling.tagName === 'BR')) {\n                start_marker.style.display = 'inline'\n                end_marker.style.display = 'inline'\n                ghost = $(editor.doc.createTextNode('\\u200B')).get(0)\n              }\n\n              // https://github.com/froala/wysiwyg-editor/issues/1120 . TODO Check again the below statement on which !editor.opts.enter === FE.ENTER_BR is returing false always.\n              // var p_node = start_marker.previousSibling;\n              // if (p_node && p_node.style && editor.win.getComputedStyle(p_node).display === 'block' && !editor.opts.enter === FE.ENTER_BR) {\n              //   range.setEndAfter(p_node);\n              //   range.setStartAfter(p_node);\n              // }\n              // else {\n              //   x = _normalizedMarker(start_marker, range, true) || ($(start_marker).before(ghost) && range.setStartBefore(start_marker));\n              //   y = _normalizedMarker(end_marker, range, false) || ($(end_marker).after(ghost) && range.setEndAfter(end_marker));\n              // }\n              x = _normalizedMarker(start_marker, range, true) || $(start_marker).before(ghost) && range.setStartBefore(start_marker)\n              y = _normalizedMarker(end_marker, range, false) || $(end_marker).after(ghost) && range.setEndAfter(end_marker)\n            }\n\n            if (typeof x === 'function') {\n              x()\n            }\n\n            if (typeof y === 'function') {\n              y()\n            }\n          }\n        }\n        catch (ex) {\n          console.warn('RESTORE RANGE', ex)\n        }\n      }\n\n      if (ghost) {\n        $(ghost).remove()\n      }\n\n      try {\n        sel.addRange(range)\n      }\n      catch (ex) {\n        console.warn('ADD RANGE', ex)\n      }\n    }\n\n    // Remove used markers.\n    editor.markers.remove()\n  }\n\n  /**\n   * Normalize marker when restoring selection.\n   */\n  function _normalizedMarker(marker, range, start) {\n    let len\n    const prev_node = marker.previousSibling\n    const next_node = marker.nextSibling\n\n    // Prev and next node are both text nodes.\n    if (prev_node && next_node && prev_node.nodeType === Node.TEXT_NODE && next_node.nodeType === Node.TEXT_NODE) {\n      len = prev_node.textContent.length\n\n      if (start) {\n        next_node.textContent = prev_node.textContent + next_node.textContent\n        $(prev_node).remove()\n        $(marker).remove()\n\n        if (!editor.opts.htmlUntouched) {\n          editor.spaces.normalize(next_node)\n        }\n\n        return function () {\n          range.setStart(next_node, len)\n        }\n      }\n\n      prev_node.textContent += next_node.textContent\n      $(next_node).remove()\n      $(marker).remove()\n\n      if (!editor.opts.htmlUntouched) {\n        editor.spaces.normalize(prev_node)\n      }\n\n      return function () {\n        range.setEnd(prev_node, len)\n      }\n\n    }\n\n    // Prev node is text node.\n    else if (prev_node && !next_node && prev_node.nodeType === Node.TEXT_NODE) {\n      len = prev_node.textContent.length\n\n      if (start) {\n        if (!editor.opts.htmlUntouched) {\n          editor.spaces.normalize(prev_node)\n        }\n\n        return function () {\n          range.setStart(prev_node, len)\n        }\n      }\n\n      if (!editor.opts.htmlUntouched) {\n        editor.spaces.normalize(prev_node)\n      }\n\n      return function () {\n        range.setEnd(prev_node, len)\n      }\n\n    }\n\n    // Next node is text node.\n    else if (next_node && !prev_node && next_node.nodeType === Node.TEXT_NODE) {\n\n      if (start) {\n        if (!editor.opts.htmlUntouched) {\n          editor.spaces.normalize(next_node)\n        }\n\n        return function () {\n          range.setStart(next_node, 0)\n        }\n      }\n\n      if (!editor.opts.htmlUntouched) {\n        editor.spaces.normalize(next_node)\n      }\n\n      return function () {\n        range.setEnd(next_node, 0)\n      }\n\n    }\n\n    return false\n  }\n\n  /**\n   * Determine if we can do delete.\n   */\n  function _canDelete() {\n\n    // Check if there are markers inside conteneditable=\"false\".\n    const markers = editor.$el.find('.fr-marker')\n\n    for (let i = 0; i < markers.length; i++) {\n      if ($(markers[i]).parentsUntil('.fr-element, [contenteditable=\"true\"]', '[contenteditable=\"false\"]').length) {\n        return false\n      }\n    }\n\n    return true\n  }\n\n  /**\n   * Check if selection is collapsed.\n   */\n  function isCollapsed() {\n    const rgs = ranges()\n\n    for (let i = 0; i < rgs.length; i++) {\n      if (!rgs[i].collapsed) {\n        return false\n      }\n    }\n\n    return true\n  }\n\n  // From: http://www.coderexception.com/0B1B33z1NyQxUQSJ/contenteditable-div-how-can-i-determine-if-the-cursor-is-at-the-start-or-end-of-the-content\n  function info(el) {\n    let atStart = false\n    let atEnd = false\n    let selRange\n    let testRange\n\n    if (editor.win.getSelection) {\n      const sel = editor.win.getSelection()\n\n      if (sel.rangeCount) {\n        selRange = sel.getRangeAt(0)\n        testRange = selRange.cloneRange()\n\n        testRange.selectNodeContents(el)\n        testRange.setEnd(selRange.startContainer, selRange.startOffset)\n        atStart = testRange.toString() === ''\n\n        testRange.selectNodeContents(el)\n        testRange.setStart(selRange.endContainer, selRange.endOffset)\n        atEnd = testRange.toString() === ''\n      }\n    }\n    else if (editor.doc.selection && editor.doc.selection.type !== 'Control') {\n      selRange = editor.doc.selection.createRange()\n      testRange = selRange.duplicate()\n\n      testRange.moveToElementText(el)\n      testRange.setEndPoint('EndToStart', selRange)\n      atStart = testRange.text === ''\n\n      testRange.moveToElementText(el)\n      testRange.setEndPoint('StartToEnd', selRange)\n      atEnd = testRange.text === ''\n    }\n\n    return {\n      atStart,\n      atEnd\n    }\n  }\n\n  /**\n   * Check if everything is selected inside the editor.\n   */\n  function isFull() {\n    if (isCollapsed()) {\n      return false\n    }\n\n    editor.selection.save()\n\n    // https://github.com/froala/wysiwyg-editor/issues/710\n    let els = editor.el.querySelectorAll('td, th, img, br')\n    let i\n\n    for (i = 0; i < els.length; i++) {\n      if (els[i].nextSibling) {\n        els[i].innerHTML = `<span class=\"fr-mk\">${FE.INVISIBLE_SPACE}</span>${els[i].innerHTML}`\n      }\n    }\n\n    let full = false\n    const inf = info(editor.el)\n\n    if (inf.atStart && inf.atEnd) {\n      full = true\n    }\n\n    // https://github.com/froala/wysiwyg-editor/issues/710\n    els = editor.el.querySelectorAll('.fr-mk')\n\n    for (i = 0; i < els.length; i++) {\n      els[i].parentNode.removeChild(els[i])\n    }\n\n    editor.selection.restore()\n\n    return full\n  }\n\n  /**\n   * Remove HTML from inner nodes when we deal with keepFormatOnDelete option.\n   */\n  function _emptyInnerNodes(node, first) {\n    if (typeof first === 'undefined') {\n      first = true\n    }\n\n    // Remove invisible spaces.\n    const h = $(node).html()\n\n    if (h && h.replace(/\\u200b/g, '').length !== h.length) {\n      $(node).html(h.replace(/\\u200b/g, ''))\n    }\n\n    // Loop contents.\n    const contents = editor.node.contents(node)\n\n    for (let j = 0; j < contents.length; j++) {\n\n      // Remove text nodes.\n      if (contents[j].nodeType !== Node.ELEMENT_NODE) {\n        $(contents[j]).remove()\n      }\n\n      // Empty inner nodes further.\n      else {\n\n        // j === 0 determines if the node is the first one and we should keep format.\n        _emptyInnerNodes(contents[j], j === 0)\n\n        // There are inner nodes, ignore the current one.\n        if (j === 0) {\n          first = false\n        }\n      }\n    }\n\n    // First node is a text node, so replace it with a span.\n    if (node.nodeType === Node.TEXT_NODE) {\n      $(node).replaceWith('<span data-first=\"true\" data-text=\"true\"></span>')\n    }\n\n    // Add the first node marker so that we add selection in it later on.\n    else if (first) {\n      $(node).attr('data-first', true)\n    }\n  }\n\n  /**\n   * TODO: check again this function because it will always return true because fr-inner tag does not exist.\n   */\n  function _filterFrInner() {\n    return $(this).find('fr-inner').length === 0\n  }\n\n  /**\n   * Process deleting nodes.\n   */\n  function _processNodeDelete($node, should_delete) {\n    const contents = editor.node.contents($node.get(0))\n\n    // Node is TD or TH.\n    if (['TD', 'TH'].indexOf($node.get(0).tagName) >= 0 && $node.find('.fr-marker').length === 1 && editor.node.hasClass(contents[0], 'fr-marker')) {\n      $node.attr('data-del-cell', true)\n    }\n\n    for (let i = 0; i < contents.length; i++) {\n      const node = contents[i]\n\n      // We found a marker.\n      if (editor.node.hasClass(node, 'fr-marker')) {\n        should_delete = (should_delete + 1) % 2\n      }\n      else if (should_delete) {\n\n        // Check if we have a marker inside it.\n        if ($(node).find('.fr-marker').length > 0) {\n          should_delete = _processNodeDelete($(node), should_delete)\n        }\n        else {\n\n          // TD, TH or inner, then go further.\n          if (['TD', 'TH'].indexOf(node.tagName) < 0 && !editor.node.hasClass(node, 'fr-inner')) {\n\n            if (!editor.opts.keepFormatOnDelete || editor.$el.find('[data-first]').length > 0 || editor.node.isVoid(node)) {\n              $(node).remove()\n            }\n            else {\n              _emptyInnerNodes(node)\n            }\n          }\n          else if (editor.node.hasClass(node, 'fr-inner')) {\n            if ($(node).find('.fr-inner').length === 0) {\n              $(node).html('<br>')\n            }\n            else {\n              $(node).find('.fr-inner').filter(_filterFrInner).html('<br>')\n            }\n          }\n          else {\n            $(node).empty()\n            $(node).attr('data-del-cell', true)\n          }\n        }\n      }\n      else if ($(node).find('.fr-marker').length > 0) {\n        should_delete = _processNodeDelete($(node), should_delete)\n      }\n    }\n\n    return should_delete\n  }\n\n  /**\n   * Determine if selection is inside the editor.\n   */\n  function inEditor() {\n    try {\n      if (!editor.$wp) {\n        return false\n      }\n\n      const range = ranges(0)\n      let container = range.commonAncestorContainer\n\n      while (container && !editor.node.isElement(container)) {\n        container = container.parentNode\n      }\n\n      if (editor.node.isElement(container)) {\n        return true\n      }\n\n      return false\n    }\n    catch (ex) {\n      return false\n    }\n  }\n\n  /**\n   * Remove the current selection html.\n   */\n  function remove() {\n    if (isCollapsed()) {\n      return true\n    }\n\n    let i\n\n    save()\n\n    // Get the previous sibling normalized.\n    function _prevSibling(node) {\n      let prev_node = node.previousSibling\n\n      while (prev_node && prev_node.nodeType === Node.TEXT_NODE && prev_node.textContent.length === 0) {\n        const tmp = prev_node\n        prev_node = prev_node.previousSibling\n        $(tmp).remove()\n      }\n\n      return prev_node\n    }\n\n    // Get the next sibling normalized.\n    function _nextSibling(node) {\n      let next_node = node.nextSibling\n\n      while (next_node && next_node.nodeType === Node.TEXT_NODE && next_node.textContent.length === 0) {\n        const tmp = next_node\n        next_node = next_node.nextSibling\n        $(tmp).remove()\n      }\n\n      return next_node\n    }\n\n    // Normalize start markers.\n    let start_markers = editor.$el.find('.fr-marker[data-type=\"true\"]')\n\n    for (i = 0; i < start_markers.length; i++) {\n      const sm = start_markers[i]\n\n      while (!_prevSibling(sm) && !editor.node.isBlock(sm.parentNode) && !editor.$el.is(sm.parentNode) && !editor.node.hasClass(sm.parentNode, 'fr-inner')) {\n        $(sm.parentNode).before(sm)\n      }\n    }\n\n    // Normalize end markers.\n    const end_markers = editor.$el.find('.fr-marker[data-type=\"false\"]')\n\n    for (i = 0; i < end_markers.length; i++) {\n      const em = end_markers[i]\n\n      while (!_nextSibling(em) && !editor.node.isBlock(em.parentNode) && !editor.$el.is(em.parentNode) && !editor.node.hasClass(em.parentNode, 'fr-inner')) {\n        $(em.parentNode).after(em)\n      }\n\n      // Last node is empty and has a BR in it.\n      if (em.parentNode && editor.node.isBlock(em.parentNode) && editor.node.isEmpty(em.parentNode) && !editor.$el.is(em.parentNode) && !editor.node.hasClass(em.parentNode, 'fr-inner') && editor.opts.keepFormatOnDelete) {\n        $(em.parentNode).after(em)\n      }\n    }\n\n    // Check if selection can be deleted.\n    if (_canDelete()) {\n      _processNodeDelete(editor.$el, 0)\n\n      // Look for selection marker.\n      const $first_node = editor.$el.find('[data-first=\"true\"]')\n\n      if ($first_node.length) {\n\n        // Remove markers.\n        editor.$el.find('.fr-marker').remove()\n\n        // Add markers in the node that we marked as the first one.\n        $first_node\n          .append(FE.INVISIBLE_SPACE + FE.MARKERS)\n          .removeAttr('data-first')\n\n        // Remove span with data-text if there is one.\n        if ($first_node.attr('data-text')) {\n          $first_node.replaceWith($first_node.html())\n        }\n      }\n      else {\n        // Remove tables.\n        editor.$el.find('table').filter(function () {\n          const ok = $(this).find('[data-del-cell]').length > 0 && $(this).find('[data-del-cell]').length === $(this).find('td, th').length\n\n          return ok\n        }).remove()\n        editor.$el.find('[data-del-cell]').removeAttr('data-del-cell')\n\n        // Merge contents between markers.\n        start_markers = editor.$el.find('.fr-marker[data-type=\"true\"]')\n\n        for (i = 0; i < start_markers.length; i++) {\n\n          // Get start marker.\n          const start_marker = start_markers[i]\n\n          // Get the next node after start marker.\n          let next_node = start_marker.nextSibling\n\n          // Get the end node.\n          let end_marker = editor.$el.find(`.fr-marker[data-type=\"false\"][data-id=\"${$(start_marker).data('id')}\"]`).get(0)\n\n          if (end_marker) {\n\n            // Markers are not next to other.\n            if (start_marker && !(next_node && next_node === end_marker)) {\n\n              // Get the parents of the nodes.\n              let start_parent = editor.node.blockParent(start_marker)\n              let end_parent = editor.node.blockParent(end_marker)\n\n              // https://github.com/froala/wysiwyg-editor/issues/1233\n              let list_start = false\n              let list_end = false\n\n              if (start_parent && ['UL', 'OL'].indexOf(start_parent.tagName) >= 0) {\n                start_parent = null\n                list_start = true\n              }\n\n              if (end_parent && ['UL', 'OL'].indexOf(end_parent.tagName) >= 0) {\n                end_parent = null\n                list_end = true\n              }\n\n              // Move end marker next to start marker.\n              $(start_marker).after(end_marker)\n\n              // The block parent of the start marker is the element itself. We're not in the same parent or moving marker is not enough.\n              if (start_parent !== end_parent) {\n                if (start_parent === null && !list_start) {\n                  const deep_parent = editor.node.deepestParent(start_marker)\n\n                  // There is a parent for the marker. Move the end html to it.\n                  if (deep_parent) {\n                    $(deep_parent).after($(end_parent).html())\n                    $(end_parent).remove()\n                  }\n\n                  // There is no parent for the marker.\n                  else if ($(end_parent).parentsUntil(editor.$el, 'table').length === 0) {\n                    $(start_marker).next().after($(end_parent).html())\n                    $(end_parent).remove()\n                  }\n                }\n\n                // End marker is inside element. We don't merge in table.\n                else if (end_parent === null && !list_end && $(start_parent).parentsUntil(editor.$el, 'table').length === 0) {\n\n                  // Get the node that has a next sibling.\n                  next_node = start_parent\n\n                  while (!next_node.nextSibling && next_node.parentNode !== editor.el) {\n                    next_node = next_node.parentNode\n                  }\n                  next_node = next_node.nextSibling\n\n                  // Join HTML inside the start node.\n                  while (next_node && next_node.tagName !== 'BR') {\n                    const tmp_node = next_node.nextSibling\n                    $(start_parent).append(next_node)\n                    next_node = tmp_node\n                  }\n\n                  if (next_node && next_node.tagName === 'BR') {\n                    $(next_node).remove()\n                  }\n                }\n\n                // Join end block with start block.\n                else if (start_parent && end_parent && $(start_parent).parentsUntil(editor.$el, 'table').length === 0 && $(end_parent).parentsUntil(editor.$el, 'table').length === 0 && !$(start_parent).contains(end_parent) && !$(end_parent).contains(start_parent)) {\n                  $(start_parent).append($(end_parent).html())\n                  $(end_parent).remove()\n                }\n              }\n            }\n          }\n          else {\n            end_marker = $(start_marker).clone().attr('data-type', false)\n            $(start_marker).after(end_marker)\n          }\n        }\n      }\n    }\n\n    if (!editor.opts.keepFormatOnDelete) {\n      editor.html.fillEmptyBlocks()\n    }\n\n    editor.html.cleanEmptyTags(true)\n\n    if (!editor.opts.htmlUntouched) {\n      editor.clean.lists()\n      editor.spaces.normalize()\n    }\n\n    // https://github.com/froala/wysiwyg-editor/issues/1379 &&\n\n    const last_marker = editor.$el.find('.fr-marker').last().get(0)\n    const first_marker = editor.$el.find('.fr-marker').first().get(0)\n\n    // https://github.com/froala-labs/froala-editor-js-2/issues/491\n    if (typeof last_marker !== 'undefined' && typeof first_marker !== 'undefined' && !last_marker.nextSibling && first_marker.previousSibling && first_marker.previousSibling.tagName === 'BR' && editor.node.isElement(last_marker.parentNode) && editor.node.isElement(first_marker.parentNode)) {\n\n      editor.$el.append('<br>')\n    }\n\n    restore()\n  }\n\n  function setAtStart(node, deep) {\n    if (!node || node.getElementsByClassName('fr-marker').length > 0) {\n      return false\n    }\n\n    let child = node.firstChild\n\n    while (child && (editor.node.isBlock(child) || deep && !editor.node.isVoid(child) && child.nodeType === Node.ELEMENT_NODE)) {\n      node = child\n      child = child.firstChild\n    }\n\n    node.innerHTML = FE.MARKERS + node.innerHTML\n  }\n\n  function setAtEnd(node, deep) {\n    if (!node || node.getElementsByClassName('fr-marker').length > 0) {\n      return false\n    }\n\n    let child = node.lastChild\n\n    while (child && (editor.node.isBlock(child) || deep && !editor.node.isVoid(child) && child.nodeType === Node.ELEMENT_NODE)) {\n      node = child\n      child = child.lastChild\n    }\n\n    const span = editor.doc.createElement('SPAN')\n    span.setAttribute('id', 'fr-sel-markers')\n    span.innerHTML = FE.MARKERS\n    node.appendChild(span)\n    const nd = node.querySelector('#fr-sel-markers')\n    nd.outerHTML = nd.innerHTML\n  }\n\n  function setBefore(node, use_current_node) {\n    if (typeof use_current_node === 'undefined') {\n      use_current_node = true\n    }\n\n    // Check if there is any previous sibling by skipping the empty text ones.\n    let prev_node = node.previousSibling\n\n    while (prev_node && prev_node.nodeType === Node.TEXT_NODE && prev_node.textContent.length === 0) {\n      prev_node = prev_node.previousSibling\n    }\n\n    // There is a previous node.\n    if (prev_node) {\n\n      // Previous node is block so set the focus at the end of it.\n      if (editor.node.isBlock(prev_node)) {\n        setAtEnd(prev_node)\n      }\n\n      // Previous node is BR, so place markers before it.\n      else if (prev_node.tagName === 'BR') {\n        $(prev_node).before(FE.MARKERS)\n      }\n\n      // Just place marker.\n      else {\n        $(prev_node).after(FE.MARKERS)\n      }\n\n      return true\n    }\n\n    // Use current node.\n    else if (use_current_node) {\n\n      // Current node is block, set selection at start.\n      if (editor.node.isBlock(node)) {\n        setAtStart(node)\n      }\n\n      // Just place markers.\n      else {\n        $(node).before(FE.MARKERS)\n      }\n\n      return true\n    }\n\n\n    return false\n\n  }\n\n  function setAfter(node, use_current_node) {\n    if (typeof use_current_node === 'undefined') {\n      use_current_node = true\n    }\n\n    // Check if there is any previous sibling by skipping the empty text ones.\n    let next_node = node.nextSibling\n\n    while (next_node && next_node.nodeType === Node.TEXT_NODE && next_node.textContent.length === 0) {\n      next_node = next_node.nextSibling\n    }\n\n    // There is a next node.\n    if (next_node) {\n\n      // Next node is block so set the focus at the end of it.\n      if (editor.node.isBlock(next_node)) {\n        setAtStart(next_node)\n      }\n\n      // Just place marker.\n      else {\n        $(next_node).before(FE.MARKERS)\n      }\n\n      return true\n    }\n\n    // Use current node.\n    else if (use_current_node) {\n\n      // Current node is block, set selection at end.\n      if (editor.node.isBlock(node)) {\n        setAtEnd(node)\n      }\n\n      // Just place markers.\n      else {\n        $(node).after(FE.MARKERS)\n      }\n\n      return true\n    }\n\n\n    return false\n\n  }\n\n  return {\n    text,\n    get,\n    ranges,\n    clear,\n    element,\n    endElement,\n    save,\n    restore,\n    isCollapsed,\n    isFull,\n    inEditor,\n    remove,\n    blocks,\n    info,\n    setAtEnd,\n    setAtStart,\n    setBefore,\n    setAfter,\n    rangeElement\n  }\n}\n","import FE from 'froala_editor'\n\n// Extend defaults.\nObject.assign(FE.DEFAULTS, {\n  language: null\n})\n\nFE.LANGUAGE = {}\n\nFE.MODULES.language = function (editor) {\n  let lang\n\n  /**\n   * Translate.\n   */\n  function translate(str) {\n    if (lang && lang.translation[str] && lang.translation[str].length) {\n      return lang.translation[str]\n    }\n\n    return str\n\n  }\n\n  /* Initialize */\n  function _init() {\n\n    // Load lang.\n    if (FE.LANGUAGE) {\n      lang = FE.LANGUAGE[editor.opts.language]\n    }\n\n    // Set direction.\n    if (lang && lang.direction) {\n      editor.opts.direction = lang.direction\n    }\n  }\n\n  return {\n    _init,\n    translate\n  }\n}\n\n","import './language.js'\n\nimport $ from 'jquery'\nimport FE from 'froala_editor'\n\n// Extend defaults.\nObject.assign(FE.DEFAULTS, {\n  placeholderText: 'Type something'\n})\n\nFE.MODULES.placeholder = function (editor) {\n  /* Show placeholder. */\n  function show() {\n    if (!editor.$placeholder) {\n      _add()\n    }\n\n    const margin_offset = editor.opts.iframe ? editor.$iframe.prev().outerHeight(true) : editor.$el.prev().outerHeight(true)\n\n    // Determine the placeholder position based on the first element inside editor.\n    let margin_top = 0\n    let margin_left = 0\n    let margin_right = 0\n    let padding_top = 0\n    let padding_left = 0\n    let padding_right = 0\n    const contents = editor.node.contents(editor.el)\n\n    const alignment = $(editor.selection.element()).css('text-align')\n\n    if (contents.length && contents[0].nodeType === Node.ELEMENT_NODE) {\n\n      const $first_node = $(contents[0])\n\n      if ((!editor.opts.toolbarInline || editor.$el.prev().length > 0) && editor.ready) {\n        margin_top = editor.helpers.getPX($first_node.css('margin-top'))\n        padding_top = editor.helpers.getPX($first_node.css('padding-top'))\n        margin_left = editor.helpers.getPX($first_node.css('margin-left'))\n        margin_right = editor.helpers.getPX($first_node.css('margin-right'))\n        padding_left = editor.helpers.getPX($first_node.css('padding-left'))\n        padding_right = editor.helpers.getPX($first_node.css('padding-right'))\n      }\n\n      editor.$placeholder.css('font-size', $first_node.css('font-size'))\n      editor.$placeholder.css('line-height', $first_node.css('line-height'))\n    }\n    else {\n      editor.$placeholder.css('font-size', editor.$el.css('font-size'))\n      editor.$placeholder.css('line-height', editor.$el.css('line-height'))\n    }\n\n    editor.$wp.addClass('show-placeholder')\n    editor.$placeholder\n      .css({\n        marginTop: Math.max(editor.helpers.getPX(editor.$el.css('margin-top')), margin_top) + (margin_offset ? margin_offset : 0),\n        paddingTop: Math.max(editor.helpers.getPX(editor.$el.css('padding-top')), padding_top),\n        paddingLeft: Math.max(editor.helpers.getPX(editor.$el.css('padding-left')), padding_left),\n        marginLeft: Math.max(editor.helpers.getPX(editor.$el.css('margin-left')), margin_left),\n        paddingRight: Math.max(editor.helpers.getPX(editor.$el.css('padding-right')), padding_right),\n        marginRight: Math.max(editor.helpers.getPX(editor.$el.css('margin-right')), margin_right),\n        textAlign: alignment\n      })\n      .text(editor.language.translate(editor.opts.placeholderText || editor.$oel.attr('placeholder') || ''))\n\n    editor.$placeholder.html(editor.$placeholder.text().replace(/\\n/g, '<br>'))\n  }\n\n  /* Hide placeholder. */\n  function hide() {\n    editor.$wp.removeClass('show-placeholder')\n  }\n\n  /* Check if placeholder is visible */\n  function isVisible() {\n    return !editor.$wp ? true : editor.node.hasClass(editor.$wp.get(0), 'show-placeholder')\n  }\n\n  /* Refresh placeholder. */\n  function refresh() {\n    if (!editor.$wp) {\n      return false\n    }\n\n    if (editor.core.isEmpty()) {\n      show()\n    }\n    else {\n      hide()\n    }\n  }\n\n  function _add() {\n    editor.$placeholder = $(editor.doc.createElement('SPAN')).addClass('fr-placeholder')\n    editor.$wp.append(editor.$placeholder)\n  }\n\n  /* Initialize. */\n  function _init() {\n    if (!editor.$wp) {\n      return false\n    }\n\n    editor.events.on('init input keydown keyup contentChanged initialized', refresh)\n  }\n\n  return {\n    _init,\n    show,\n    hide,\n    refresh,\n    isVisible\n  }\n}\n","import './edit.js'\nimport './dom/spaces.js'\nimport './dom/selection.js'\nimport './options/placeholder.js'\n\nimport $ from 'jquery'\nimport FE from 'froala_editor'\n\nFE.UNICODE_NBSP = String.fromCharCode(160)\n\n// Void Elements http://www.w3.org/html/wg/drafts/html/master/syntax.html#void-elements\nFE.VOID_ELEMENTS = ['area', 'base', 'br', 'col', 'embed', 'hr', 'img', 'input', 'keygen', 'link', 'menuitem', 'meta', 'param', 'source', 'track', 'wbr']\n\nFE.BLOCK_TAGS = ['address', 'article', 'aside', 'audio', 'blockquote', 'canvas', 'details', 'dd', 'div', 'dl', 'dt', 'fieldset', 'figcaption', 'figure', 'footer', 'form', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'header', 'hgroup', 'hr', 'li', 'main', 'nav', 'noscript', 'ol', 'output', 'p', 'pre', 'section', 'table', 'tbody', 'td', 'tfoot', 'th', 'thead', 'tr', 'ul', 'video']\n\n// Extend defaults.\nObject.assign(FE.DEFAULTS, {\n  htmlAllowedEmptyTags: ['textarea', 'a', 'iframe', 'object', 'video', 'style', 'script', '.fa', '.fr-emoticon', '.fr-inner', 'path', 'line'],\n  htmlDoNotWrapTags: ['script', 'style'],\n  htmlSimpleAmpersand: false,\n  htmlIgnoreCSSProperties: [],\n  htmlExecuteScripts: true\n})\n\nFE.MODULES.html = function (editor) {\n  /**\n   * Determine the default block tag.\n   */\n  function defaultTag() {\n    if (editor.opts.enter === FE.ENTER_P) {\n      return 'p'\n    }\n    if (editor.opts.enter === FE.ENTER_DIV) {\n      return 'div'\n    }\n\n    if (editor.opts.enter === FE.ENTER_BR) {\n      return null\n    }\n  }\n\n  /**\n   * Tells if the node keeps text formating.\n   */\n  function isPreformatted(node, look_up) {\n    // Stop condition.\n    if (!node || node === editor.el) {\n      return false\n    }\n\n    // Check only first level.\n    if (!look_up) {\n      // Is preformatted.\n      return ['PRE', 'SCRIPT', 'STYLE'].indexOf(node.tagName) !== -1\n    }\n\n    if (['PRE', 'SCRIPT', 'STYLE'].indexOf(node.tagName) !== -1) {\n      return true\n    }\n\n    return isPreformatted(node.parentNode, look_up)\n\n\n  }\n\n  /**\n   * Get the empty blocs.\n   */\n  function emptyBlocks(around_markers) {\n\n    const empty_blocks = []\n    let i\n\n    // Block tag elements.\n    let els = []\n\n    if (around_markers) {\n      const markers = editor.el.querySelectorAll('.fr-marker')\n\n      for (i = 0; i < markers.length; i++) {\n        const p_node = editor.node.blockParent(markers[i]) || markers[i]\n\n        if (p_node) {\n          const next_node = p_node.nextSibling\n          const prev_node = p_node.previousSibling\n\n          // Push current node, prev and next one.\n          if (p_node && els.indexOf(p_node) < 0 && editor.node.isBlock(p_node)) {\n            els.push(p_node)\n          }\n\n          if (prev_node && editor.node.isBlock(prev_node) && els.indexOf(prev_node) < 0) {\n            els.push(prev_node)\n          }\n\n          if (next_node && editor.node.isBlock(next_node) && els.indexOf(next_node) < 0) {\n            els.push(next_node)\n          }\n        }\n      }\n    }\n    else {\n      els = editor.el.querySelectorAll(blockTagsQuery())\n    }\n\n    let qr = blockTagsQuery()\n    qr += `,${FE.VOID_ELEMENTS.join(',')}`\n    qr += ', .fr-inner'\n    qr += `,${editor.opts.htmlAllowedEmptyTags.join(':not(.fr-marker),')}:not(.fr-marker)`\n\n    // Check if there are empty block tags with markers.\n    for (i = els.length - 1; i >= 0; i--) {\n\n      // If the block tag has text content, ignore it.\n      if (els[i].textContent && els[i].textContent.replace(/\\u200B|\\n/g, '').length > 0) {\n        continue\n      }\n\n      if (els[i].querySelectorAll(qr).length > 0) {\n        continue\n      }\n\n      // We're checking text from here on.\n      const contents = editor.node.contents(els[i])\n\n      let found = false\n\n      for (let j = 0; j < contents.length; j++) {\n        if (contents[j].nodeType === Node.COMMENT_NODE) {\n          continue\n        }\n\n        // Text node that is not empty.\n        if (contents[j].textContent && contents[j].textContent.replace(/\\u200B|\\n/g, '').length > 0) {\n          found = true\n\n          break\n        }\n      }\n\n      // Make sure we don't add TABLE and TD at the same time for instance.\n      if (!found) {\n        empty_blocks.push(els[i])\n      }\n    }\n\n    return empty_blocks\n  }\n\n  /**\n   * Create jQuery query for empty block tags.\n   */\n  function emptyBlockTagsQuery() {\n\n    return `${FE.BLOCK_TAGS.join(':empty, ')}:empty`\n  }\n\n  /**\n   * Create jQuery query for selecting block tags.\n   */\n  function blockTagsQuery() {\n\n    return FE.BLOCK_TAGS.join(', ')\n  }\n\n  /**\n   * Remove empty elements that are not VOID elements.\n   */\n  function cleanEmptyTags(remove_blocks) {\n    let els = $.merge([], FE.VOID_ELEMENTS)\n    els = $.merge(els, editor.opts.htmlAllowedEmptyTags)\n\n    if (typeof remove_blocks === 'undefined') {\n      els = $.merge(els, FE.BLOCK_TAGS)\n    }\n    else {\n      els = $.merge(els, FE.NO_DELETE_TAGS)\n    }\n\n    let elms\n    let ok\n\n    elms = editor.el.querySelectorAll(`*:empty:not(${els.join('):not(')}):not(.fr-marker)`)\n\n    do {\n      ok = false\n\n      // Remove those elements that have no attributes.\n      for (let i = 0; i < elms.length; i++) {\n        if (elms[i].attributes.length === 0 || typeof elms[i].getAttribute('href') !== 'undefined') {\n          elms[i].parentNode.removeChild(elms[i])\n          ok = true\n        }\n      }\n\n      elms = editor.el.querySelectorAll(`*:empty:not(${els.join('):not(')}):not(.fr-marker)`)\n    } while (elms.length && ok)\n  }\n\n  /**\n   * Wrap the content inside the element passed as argument.\n   */\n  function _wrapElement(el, temp) {\n    let default_tag = defaultTag()\n\n    if (temp) {\n      default_tag = 'div'\n    }\n\n    if (default_tag) {\n\n      // Rewrite the entire content.\n      const main_doc = editor.doc.createDocumentFragment()\n\n      // Anchor.\n      let anchor = null\n\n      // If we found anything inside the current anchor.\n      let found = false\n\n      let node = el.firstChild\n\n      let changed = false\n\n      // Loop through contents.\n      while (node) {\n        const next_node = node.nextSibling\n\n        // Current node is a block node.\n        // Or it is a do not wrap node and not a fr-marker.\n        if (node.nodeType === Node.ELEMENT_NODE && (editor.node.isBlock(node) || editor.opts.htmlDoNotWrapTags.indexOf(node.tagName.toLowerCase()) >= 0 && !editor.node.hasClass(node, 'fr-marker'))) {\n          anchor = null\n          main_doc.appendChild(node.cloneNode(true))\n        }\n\n        // Other node types than element and text.\n        else if (node.nodeType !== Node.ELEMENT_NODE && node.nodeType !== Node.TEXT_NODE) {\n          anchor = null\n          main_doc.appendChild(node.cloneNode(true))\n        }\n\n        // Current node is BR.\n        else if (node.tagName === 'BR') {\n\n          // There is no anchor.\n          if (anchor === null) {\n            anchor = editor.doc.createElement(default_tag)\n            changed = true\n\n            if (temp) {\n              anchor.setAttribute('class', 'fr-temp-div')\n              anchor.setAttribute('data-empty', true)\n            }\n\n            anchor.appendChild(node.cloneNode(true))\n\n            main_doc.appendChild(anchor)\n          }\n\n          // There is anchor. Just remove BR.\n          // There is nothing else except markers and BR inside the new formed tag.\n          else if (found === false) {\n            anchor.appendChild(editor.doc.createElement('br'))\n\n            if (temp) {\n              anchor.setAttribute('class', 'fr-temp-div')\n              anchor.setAttribute('data-empty', true)\n            }\n          }\n\n          anchor = null\n        }\n\n        // Text node or other node type.\n        else {\n          const txt = node.textContent\n\n          // Node is not text node.\n          // Node is text node and it doesn't contain only spaces and NL.\n          // There are empty spaces but no new lines.\n          if (node.nodeType !== Node.TEXT_NODE || (txt.replace(/\\n/g, '').replace(/(^ *)|( *$)/g, '').length > 0 || txt.length && txt.indexOf('\\n') < 0)) {\n\n            // No anchor.\n            if (anchor === null) {\n              anchor = editor.doc.createElement(default_tag)\n              changed = true\n\n              if (temp) {\n                anchor.setAttribute('class', 'fr-temp-div')\n              }\n              main_doc.appendChild(anchor)\n\n              found = false\n            }\n\n            // Add node to anchor.\n            anchor.appendChild(node.cloneNode(true))\n\n            // Check if maybe we have a non empty node.\n            if (!found && (!editor.node.hasClass(node, 'fr-marker') && !(node.nodeType === Node.TEXT_NODE && txt.replace(/ /g, '').length === 0))) {\n              found = true\n            }\n          }\n\n          // Else skip the node because it's empty.\n        }\n\n        node = next_node\n      }\n\n      if (changed) {\n        el.innerHTML = ''\n        el.appendChild(main_doc)\n      }\n    }\n  }\n\n  function _wrapElements(els, temp) {\n    for (let i = els.length - 1; i >= 0; i--) {\n      _wrapElement(els[i], temp)\n    }\n  }\n\n  /**\n   * Wrap the direct content inside the default block tag.\n   */\n  function _wrap(temp, tables, blockquote, inner, li) {\n    if (!editor.$wp) {\n      return false\n    }\n\n    if (typeof temp === 'undefined') {\n      temp = false\n    }\n\n    if (typeof tables === 'undefined') {\n      tables = false\n    }\n\n    if (typeof blockquote === 'undefined') {\n      blockquote = false\n    }\n\n    if (typeof inner === 'undefined') {\n      inner = false\n    }\n\n    if (typeof li === 'undefined') {\n      li = false\n    }\n\n    // Wrap element.\n    const wp_st = editor.$wp.scrollTop()\n\n    _wrapElement(editor.el, temp)\n\n    if (inner) {\n      _wrapElements(editor.el.querySelectorAll('.fr-inner'), temp)\n    }\n\n    // Wrap table contents.\n    if (tables) {\n      _wrapElements(editor.el.querySelectorAll('td, th'), temp)\n    }\n\n    // Wrap table contents.\n    if (blockquote) {\n      _wrapElements(editor.el.querySelectorAll('blockquote'), temp)\n    }\n\n    if (li) {\n      _wrapElements(editor.el.querySelectorAll('li'), temp)\n    }\n\n    if (wp_st !== editor.$wp.scrollTop()) {\n      editor.$wp.scrollTop(wp_st)\n    }\n  }\n\n  /**\n   * Unwrap temporary divs.\n   */\n  function unwrap() {\n    editor.$el.find('div.fr-temp-div').each(function () {\n      if (this.previousSibling && this.previousSibling.nodeType === Node.TEXT_NODE) {\n        $(this).before('<br>')\n      }\n\n      if ($(this).attr('data-empty') || !this.nextSibling || editor.node.isBlock(this.nextSibling) && !$(this.nextSibling).hasClass('fr-temp-div')) {\n        $(this).replaceWith($(this).html())\n      }\n      else {\n        $(this).replaceWith(`${$(this).html()}<br>`)\n      }\n    })\n\n    // Remove temp class from other blocks.\n    editor.$el.find('.fr-temp-div').removeClass('fr-temp-div').filter(function () {\n\n      return $(this).attr('class') === ''\n    }).removeAttr('class')\n  }\n\n  /**\n   * Add BR inside empty elements.\n   */\n  function fillEmptyBlocks(around_markers) {\n    const blocks = emptyBlocks(around_markers)\n\n    if (editor.node.isEmpty(editor.el) && editor.opts.enter === FE.ENTER_BR) {\n      blocks.push(editor.el)\n    }\n\n    for (let i = 0; i < blocks.length; i++) {\n      const block = blocks[i]\n\n      if (block.getAttribute('contenteditable') !== 'false' &&\n          !block.querySelector(`${editor.opts.htmlAllowedEmptyTags.join(':not(.fr-marker),')}:not(.fr-marker)`) &&\n          !editor.node.isVoid(block)) {\n        if (block.tagName !== 'TABLE' && block.tagName !== 'TBODY' && block.tagName !== 'TR' && block.tagName !== 'UL' && block.tagName !== 'OL') {\n          block.appendChild(editor.doc.createElement('br'))\n        }\n      }\n    }\n\n    // Fix for https://github.com/froala/wysiwyg-editor/issues/1166#issuecomment-204549406.\n    if (editor.browser.msie && editor.opts.enter === FE.ENTER_BR) {\n      const contents = editor.node.contents(editor.el)\n\n      if (contents.length && contents[contents.length - 1].nodeType === Node.TEXT_NODE) {\n        editor.$el.append('<br>')\n      }\n    }\n  }\n\n  /**\n   * Get the blocks inside the editable area.\n   */\n  function blocks() {\n\n    return editor.$el.get(0).querySelectorAll(blockTagsQuery())\n  }\n\n  /**\n   * Clean the blank spaces between the block tags.\n   */\n  function cleanBlankSpaces(el) {\n    if (typeof el === 'undefined') {\n      el = editor.el\n    }\n\n    if (el && ['SCRIPT', 'STYLE', 'PRE'].indexOf(el.tagName) >= 0) {\n      return false\n    }\n\n    const walker = editor.doc.createTreeWalker(el, NodeFilter.SHOW_TEXT, editor.node.filter((node) => node.textContent.match(/([ \\n]{2,})|(^[ \\n]{1,})|([ \\n]{1,}$)/g) !== null), false)\n\n    while (walker.nextNode()) {\n\n      const node = walker.currentNode\n\n      if (isPreformatted(node.parentNode, true)) {\n        continue\n      }\n\n      const is_block_or_element = editor.node.isBlock(node.parentNode) || editor.node.isElement(node.parentNode)\n\n      // Remove middle spaces.\n      // Replace new lines with spaces.\n      // Replace begin/end spaces.\n      let txt = node.textContent\n        .replace(/(?!^)( ){2,}(?!$)/g, ' ')\n        .replace(/\\n/g, ' ')\n        .replace(/^[ ]{2,}/g, ' ')\n        .replace(/[ ]{2,}$/g, ' ')\n\n      if (is_block_or_element) {\n        const p_node = node.previousSibling\n        const n_node = node.nextSibling\n\n        if (p_node && n_node && txt === ' ') {\n          if (editor.node.isBlock(p_node) && editor.node.isBlock(n_node)) {\n            txt = ''\n          }\n          else {\n            txt = ' '\n          }\n        }\n        else {\n\n          // No previous siblings.\n          if (!p_node) {\n            txt = txt.replace(/^ */, '')\n          }\n\n          // No next siblings.\n          if (!n_node) {\n            txt = txt.replace(/ *$/, '')\n          }\n        }\n      }\n\n      node.textContent = txt\n    }\n  }\n\n  /**\n   * Extract a specific match for a RegEx.\n   */\n  function _extractMatch(html, re, id) {\n    const reg_exp = new RegExp(re, 'gi')\n    const matches = reg_exp.exec(html)\n\n    if (matches) {\n\n      return matches[id]\n    }\n\n    return null\n  }\n\n  /**\n   * Create new doctype.\n   */\n  function _newDoctype(string, doc) {\n    const matches = string.match(/<!DOCTYPE ?([^ ]*) ?([^ ]*) ?\"?([^\"]*)\"? ?\"?([^\"]*)\"?>/i)\n\n    if (matches) {\n\n      return doc.implementation.createDocumentType(\n        matches[1],\n        matches[3],\n        matches[4]\n      )\n    }\n\n\n    return doc.implementation.createDocumentType('html')\n\n  }\n\n  /**\n   * Get string doctype of a document.\n   */\n  function getDoctype(doc) {\n    const node = doc.doctype\n    let doctype = '<!DOCTYPE html>'\n\n    if (node) {\n      doctype = `<!DOCTYPE ${\n                 node.name\n                 }${node.publicId ? ` PUBLIC \"${node.publicId}\"` : ''\n                 }${!node.publicId && node.systemId ? ' SYSTEM' : ''\n                 }${node.systemId ? ` \"${node.systemId}\"` : ''\n                 }>`\n    }\n\n    return doctype\n  }\n\n  function _processBR(br) {\n    const parent_node = br.parentNode\n\n    if (parent_node && (editor.node.isBlock(parent_node) || editor.node.isElement(parent_node)) && ['TD', 'TH'].indexOf(parent_node.tagName) < 0) {\n      let prev_node = br.previousSibling\n      const next_node = br.nextSibling\n\n      // Ignore non characters.\n      while (prev_node && (prev_node.nodeType === Node.TEXT_NODE && prev_node.textContent.replace(/\\n|\\r/g, '').length === 0 || editor.node.hasClass(prev_node, 'fr-tmp'))) {\n        prev_node = prev_node.previousSibling\n      }\n\n      if (next_node) {\n        return false\n      }\n\n      // Previous node.\n      // Previous node is not BR.\n      // Previoues node is not block tag.\n      // No next node.\n      // Parent node has text.\n      // Previous node has text.\n      if (prev_node && parent_node && prev_node.tagName !== 'BR' && !editor.node.isBlock(prev_node) && !next_node && parent_node.textContent.replace(/\\u200B/g, '').length > 0 && prev_node.textContent.length > 0 && !editor.node.hasClass(prev_node, 'fr-marker')) {\n        // Fix for https://github.com/froala/wysiwyg-editor/issues/1166#issuecomment-204549406.\n        if (!(editor.el === parent_node && !next_node && editor.opts.enter === FE.ENTER_BR && editor.browser.msie)) {\n          br.parentNode.removeChild(br)\n        }\n      }\n    }\n\n    // Regular node.\n    else if (parent_node && !(editor.node.isBlock(parent_node) || editor.node.isElement(parent_node))) {\n\n      // Check if we have something else than BR.\n      if (!br.previousSibling && !br.nextSibling && editor.node.isDeletable(br.parentNode)) {\n        _processBR(br.parentNode)\n      }\n    }\n  }\n\n  function cleanBRs() {\n    const brs = editor.el.getElementsByTagName('br')\n\n    for (let i = 0; i < brs.length; i++) {\n      _processBR(brs[i])\n    }\n  }\n\n  /**\n   * Normalize.\n   */\n  function _normalize() {\n    if (!editor.opts.htmlUntouched) {\n\n      // Remove empty tags.\n      cleanEmptyTags()\n\n      // Wrap possible text.\n      _wrap()\n\n      // Clean blank spaces.\n      cleanBlankSpaces()\n\n      // Normalize spaces.\n      editor.spaces.normalize(null, true)\n\n      // Add BR tag where it is necessary.\n      editor.html.fillEmptyBlocks()\n\n      // Clean lists.\n      editor.clean.lists()\n\n      // Clean tables.\n      editor.clean.tables()\n\n      // Convert to HTML5.\n      editor.clean.toHTML5()\n\n      // Remove unecessary brs.\n      editor.html.cleanBRs()\n    }\n\n    // Restore selection.\n    editor.selection.restore()\n\n    // Check if editor is empty and add placeholder.\n    checkIfEmpty()\n\n    // Refresh placeholder.\n    editor.placeholder.refresh()\n  }\n\n  function checkIfEmpty() {\n    if (editor.node.isEmpty(editor.el)) {\n      if (defaultTag() !== null) {\n\n        // There is no block tag inside the editor.\n        if (!editor.el.querySelector(blockTagsQuery()) &&\n              !editor.el.querySelector(`${editor.opts.htmlDoNotWrapTags.join(':not(.fr-marker),')}:not(.fr-marker)`)) {\n          if (editor.core.hasFocus()) {\n            editor.$el.html(`<${defaultTag()}>${FE.MARKERS}<br/></${defaultTag()}>`)\n            editor.selection.restore()\n          }\n          else {\n            editor.$el.html(`<${defaultTag()}><br/></${defaultTag()}>`)\n          }\n        }\n      }\n      else {\n\n        // There is nothing in the editor.\n        if (!editor.el.querySelector('*:not(.fr-marker):not(br)')) {\n          if (editor.core.hasFocus()) {\n            editor.$el.html(`${FE.MARKERS}<br/>`)\n            editor.selection.restore()\n          }\n          else {\n            editor.$el.html('<br/>')\n          }\n        }\n      }\n    }\n  }\n\n  function extractNode(html, tag) {\n\n    return _extractMatch(html, `<${tag}[^>]*?>([\\\\w\\\\W]*)</${tag}>`, 1)\n  }\n\n  function extractNodeAttrs(html, tag) {\n    const $dv = $(`<div ${_extractMatch(html, `<${tag}([^>]*?)>`, 1) || ''}>`)\n\n    return editor.node.rawAttributes($dv.get(0))\n  }\n\n  function extractDoctype(html) {\n\n    return (_extractMatch(html, '<!DOCTYPE([^>]*?)>', 0) || '<!DOCTYPE html>').replace(/\\n/g, ' ').replace(/ {2,}/g, ' ')\n  }\n\n  /*\n   * Set html to node.\n   */\n  function _setHtml($node, html) {\n\n    if (editor.opts.htmlExecuteScripts) {\n      $node.html(html)\n    }\n    else {\n      $node.get(0).innerHTML = html\n    }\n  }\n\n  /**\n   * Set HTML.\n   */\n  function set(html) {\n    const clean_html = editor.clean.html((html || '').trim(), [], [], editor.opts.fullPage)\n\n    if (!editor.opts.fullPage) {\n      _setHtml(editor.$el, clean_html)\n    }\n    else {\n\n      // Get BODY data.\n      const body_html = extractNode(clean_html, 'body') || (clean_html.indexOf('<body') >= 0 ? '' : clean_html)\n      const body_attrs = extractNodeAttrs(clean_html, 'body')\n\n      // Get HEAD data.\n      let head_html = extractNode(clean_html, 'head') || '<title></title>'\n      const head_attrs = extractNodeAttrs(clean_html, 'head')\n\n      // Get HTML that might be in <head> other than meta tags.\n      // https://github.com/froala/wysiwyg-editor/issues/1208\n      const $dv = $('<div>')\n\n      $dv.append(head_html)\n          .contents().each(function () {\n            if (this.nodeType === Node.COMMENT_NODE || ['BASE', 'LINK', 'META', 'NOSCRIPT', 'SCRIPT', 'STYLE', 'TEMPLATE', 'TITLE'].indexOf(this.tagName) >= 0) {\n              this.parentNode.removeChild(this)\n            }\n          })\n\n      const head_bad_html = $dv.html().trim()\n\n      // Filter and keep only meta tags in <head>.\n      // https://html.spec.whatwg.org/multipage/dom.html#metadata-content-2\n      head_html = $('<div>')\n                            .append(head_html)\n                            .contents().map(function () {\n                              if (this.nodeType === Node.COMMENT_NODE) {\n\n                                return `<!--${this.nodeValue}-->`\n                              }\n                              else if (['BASE', 'LINK', 'META', 'NOSCRIPT', 'SCRIPT', 'STYLE', 'TEMPLATE', 'TITLE'].indexOf(this.tagName) >= 0) {\n                                return this.outerHTML\n                              }\n\n\n                              return ''\n\n                            }).toArray()\n.join('')\n\n      // Get DOCTYPE.\n      const doctype = extractDoctype(clean_html)\n\n      // Get HTML attributes.\n      const html_attrs = extractNodeAttrs(clean_html, 'html')\n\n      _setHtml(editor.$el, `${head_bad_html}\\n${body_html}`)\n      editor.node.clearAttributes(editor.el)\n      editor.$el.attr(body_attrs)\n      editor.$el.addClass('fr-view')\n      editor.$el.attr('spellcheck', editor.opts.spellcheck)\n      editor.$el.attr('dir', editor.opts.direction)\n\n      _setHtml(editor.$head, head_html)\n      editor.node.clearAttributes(editor.$head.get(0))\n      editor.$head.attr(head_attrs)\n\n      editor.node.clearAttributes(editor.$html.get(0))\n\n      editor.$html.attr(html_attrs)\n\n      editor.iframe_document.doctype.parentNode.replaceChild(\n        _newDoctype(doctype, editor.iframe_document),\n        editor.iframe_document.doctype\n      )\n    }\n\n    // Make sure the content is editable.\n    const disabled = editor.edit.isDisabled()\n    editor.edit.on()\n\n    editor.core.injectStyle(editor.opts.iframeDefaultStyle + editor.opts.iframeStyle)\n\n    _normalize()\n\n    if (!editor.opts.useClasses) {\n\n      // Restore orignal attributes if present.\n      editor.$el.find('[fr-original-class]').each(function () {\n        this.setAttribute('class', this.getAttribute('fr-original-class'))\n        this.removeAttribute('fr-original-class')\n      })\n\n      editor.$el.find('[fr-original-style]').each(function () {\n        this.setAttribute('style', this.getAttribute('fr-original-style'))\n        this.removeAttribute('fr-original-style')\n      })\n    }\n\n    if (disabled) {\n      editor.edit.off()\n    }\n\n    editor.events.trigger('html.set')\n  }\n\n  function _specifity(selector) {\n    const idRegex = /(#[^\\s+>~.[:]+)/g\n    const attributeRegex = /(\\[[^]]+\\])/g\n    const classRegex = /(\\.[^\\s+>~.[:]+)/g\n    const pseudoElementRegex = /(::[^\\s+>~.[:]+|:first-line|:first-letter|:before|:after)/gi\n    const pseudoClassWithBracketsRegex = /(:[\\w-]+\\([^)]*\\))/gi\n\n    // A regex for other pseudo classes, which don't have brackets\n    const pseudoClassRegex = /(:[^\\s+>~.[:]+)/g\n    const elementRegex = /([^\\s+>~.[:]+)/g;\n\n    // Remove the negation psuedo-class (:not) but leave its argument because specificity is calculated on its argument\n    (function () {\n      const regex = /:not\\(([^)]*)\\)/g\n\n      if (regex.test(selector)) {\n        selector = selector.replace(regex, '     $1 ')\n      }\n    }())\n\n    let s = (selector.match(idRegex) || []).length * 100 +\n            (selector.match(attributeRegex) || []).length * 10 +\n            (selector.match(classRegex) || []).length * 10 +\n            (selector.match(pseudoClassWithBracketsRegex) || []).length * 10 +\n            (selector.match(pseudoClassRegex) || []).length * 10 +\n            (selector.match(pseudoElementRegex) || []).length\n\n    // Remove universal selector and separator characters\n    selector = selector.replace(/[*\\s+>~]/g, ' ')\n\n    // Remove any stray dots or hashes which aren't attached to words\n    // These may be present if the user is live-editing this selector\n    selector = selector.replace(/[#.]/g, ' ')\n\n    s += (selector.match(elementRegex) || []).length\n\n    return s\n  }\n\n  /**\n   * Do processing on the final html.\n   */\n  function _processOnGet(el) {\n    editor.events.trigger('html.processGet', [el])\n\n    // Remove class attribute when empty.\n    if (el && el.getAttribute && el.getAttribute('class') === '') {\n      el.removeAttribute('class')\n    }\n\n    if (el && el.getAttribute && el.getAttribute('style') === '') {\n      el.removeAttribute('style')\n    }\n\n    // Look at inner nodes that have no class set.\n    if (el && el.nodeType === Node.ELEMENT_NODE) {\n      const els = el.querySelectorAll('[class=\"\"],[style=\"\"]')\n      let i\n\n      for (i = 0; i < els.length; i++) {\n        const _el = els[i]\n\n        if (_el.getAttribute('class') === '') {\n          _el.removeAttribute('class')\n        }\n\n        if (_el.getAttribute('style') === '') {\n          _el.removeAttribute('style')\n        }\n      }\n\n      if (el.tagName === 'BR') {\n        _processBR(el)\n      }\n      else {\n        const brs = el.querySelectorAll('br')\n\n        for (i = 0; i < brs.length; i++) {\n          _processBR(brs[i])\n        }\n      }\n    }\n  }\n\n  /**\n   * Sort elements by spec.\n   */\n  function _sortElementsBySpec(a, b) {\n    return a[3] - b[3]\n  }\n\n  /**\n   * Get HTML.\n   */\n  function get(keep_markers, keep_classes) {\n    if (!editor.$wp) {\n\n      return editor.$oel.clone()\n              .removeClass('fr-view')\n              .removeAttr('contenteditable')\n              .get(0).outerHTML\n    }\n\n    let html = ''\n\n    editor.events.trigger('html.beforeGet')\n\n    // Convert STYLE from CSS files to inline style.\n    const updated_elms = []\n    const elms_info = {}\n    let i\n    let j\n    const elems_specs = []\n\n    // Sync inputs when getting the HTML.\n    const inputs = editor.el.querySelectorAll('input, textarea')\n\n    for (i = 0; i < inputs.length; i++) {\n      inputs[i].setAttribute('value', inputs[i].value)\n    }\n\n    if (!editor.opts.useClasses && !keep_classes) {\n      const ignoreRegEx = new RegExp(`^${editor.opts.htmlIgnoreCSSProperties.join('$|^')}$`, 'gi')\n\n      for (i = 0; i < editor.doc.styleSheets.length; i++) {\n        let rules\n        let head_style = 0\n\n        try {\n          rules = editor.doc.styleSheets[i].cssRules\n\n          if (editor.doc.styleSheets[i].ownerNode && editor.doc.styleSheets[i].ownerNode.nodeType === 'STYLE') {\n            head_style = 1\n          }\n        }\n        catch (ex) {\n          // keep empty.\n        }\n\n        if (rules) {\n          for (let idx = 0, len = rules.length; idx < len; idx++) {\n            if (rules[idx].selectorText) {\n              if (rules[idx].style.cssText.length > 0) {\n                const selector = rules[idx].selectorText.replace(/body |\\.fr-view /g, '').replace(/::/g, ':')\n                let elms\n\n                try {\n                  elms = editor.el.querySelectorAll(selector)\n                }\n                catch (ex) {\n                  elms = []\n                }\n\n                for (j = 0; j < elms.length; j++) {\n\n                  // Save original style.\n                  if (!elms[j].getAttribute('fr-original-style') && elms[j].getAttribute('style')) {\n                    elms[j].setAttribute('fr-original-style', elms[j].getAttribute('style'))\n                    updated_elms.push(elms[j])\n                  }\n                  else if (!elms[j].getAttribute('fr-original-style')) {\n                    elms[j].setAttribute('fr-original-style', '')\n                    updated_elms.push(elms[j])\n                  }\n\n                  if (!elms_info[elms[j]]) {\n                    elms_info[elms[j]] = {}\n                  }\n\n                  // Compute specification.\n                  const spec = head_style * 1000 + _specifity(rules[idx].selectorText)\n\n                  // Get CSS text of the rule.\n                  const css_text = rules[idx].style.cssText.split(';')\n\n                  // Get each rule.\n                  for (let k = 0; k < css_text.length; k++) {\n\n                    // Rule.\n                    const rule = css_text[k].trim().split(':')[0]\n\n                    if (!rule) {\n                      continue\n                    }\n\n                    // Ignore the CSS rules we don't need.\n                    if (rule.match(ignoreRegEx)) {\n                      continue\n                    }\n\n                    if (!elms_info[elms[j]][rule]) {\n                      elms_info[elms[j]][rule] = 0\n\n                      if ((elms[j].getAttribute('fr-original-style') || '').indexOf(`${rule}:`) >= 0) {\n                        elms_info[elms[j]][rule] = 10000\n                      }\n                    }\n\n                    // Current spec is higher than the existing one.\n                    if (spec >= elms_info[elms[j]][rule]) {\n                      elms_info[elms[j]][rule] = spec\n\n                      if (css_text[k].trim().length) {\n\n                        const info = css_text[k].trim().split(':')\n                        info.splice(0, 1)\n\n                        // Add elements with css values and spec. This will be sorted later.\n                        elems_specs.push([elms[j], rule.trim(), info.join(':').trim(), spec])\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n\n      // Sort elements by spec.\n      elems_specs.sort(_sortElementsBySpec)\n\n      // Add style to elements in the order of specification.\n      for (i = 0; i < elems_specs.length; i++) {\n        const specs_elem = elems_specs[i]\n        specs_elem[0].style[specs_elem[1]] = specs_elem[2]\n      }\n\n      // Save original class.\n      for (i = 0; i < updated_elms.length; i++) {\n        if (updated_elms[i].getAttribute('class')) {\n          updated_elms[i].setAttribute('fr-original-class', updated_elms[i].getAttribute('class'))\n          updated_elms[i].removeAttribute('class')\n        }\n\n        // Make sure that we have the inline style first.\n        if ((updated_elms[i].getAttribute('fr-original-style') || '').trim().length > 0) {\n          const original_rules = updated_elms[i].getAttribute('fr-original-style').split(';')\n\n          for (j = 0; j < original_rules.length; j++) {\n            if (original_rules[j].indexOf(':') > 0) {\n              const splits = original_rules[j].split(':')\n              const original_rule = splits[0]\n              splits.splice(0, 1)\n\n              updated_elms[i].style[original_rule.trim()] = splits.join(':').trim()\n            }\n          }\n        }\n      }\n    }\n\n    // If editor is not empty.\n    if (!editor.node.isEmpty(editor.el)) {\n      if (typeof keep_markers === 'undefined') {\n        keep_markers = false\n      }\n\n      if (!editor.opts.fullPage) {\n        html = editor.$el.html()\n      }\n      else {\n        html = getDoctype(editor.iframe_document)\n        editor.$el.removeClass('fr-view')\n        const heightMin = editor.opts.heightMin\n        editor.opts.heightMin = null\n        editor.size.refresh()\n        html += `<html${editor.node.attributes(editor.$html.get(0))}>${editor.$html.html()}</html>`\n        editor.opts.heightMin = heightMin\n        editor.size.refresh()\n        editor.$el.addClass('fr-view')\n      }\n    }\n    else if (editor.opts.fullPage) {\n      html = getDoctype(editor.iframe_document)\n      html += `<html${editor.node.attributes(editor.$html.get(0))}>${editor.$html.find('head').get(0).outerHTML}<body></body></html>`\n    }\n\n    // Remove unwanted attributes.\n    if (!editor.opts.useClasses && !keep_classes) {\n      for (i = 0; i < updated_elms.length; i++) {\n        if (updated_elms[i].getAttribute('fr-original-class')) {\n          updated_elms[i].setAttribute('class', updated_elms[i].getAttribute('fr-original-class'))\n          updated_elms[i].removeAttribute('fr-original-class')\n        }\n\n        if (updated_elms[i].getAttribute('fr-original-style') !== null && typeof updated_elms[i].getAttribute('fr-original-style') !== 'undefined') {\n          if (updated_elms[i].getAttribute('fr-original-style').length !== 0) {\n            updated_elms[i].setAttribute('style', updated_elms[i].getAttribute('fr-original-style'))\n          }\n          else {\n            updated_elms[i].removeAttribute('style')\n          }\n\n          updated_elms[i].removeAttribute('fr-original-style')\n        }\n        else {\n          updated_elms[i].removeAttribute('style')\n        }\n      }\n    }\n\n    // Clean helpers.\n    if (editor.opts.fullPage) {\n      html = html.replace(/<style data-fr-style=\"true\">(?:[\\w\\W]*?)<\\/style>/g, '')\n      html = html.replace(/<link([^>]*)data-fr-style=\"true\"([^>]*)>/g, '')\n      html = html.replace(/<style(?:[\\w\\W]*?)class=\"firebugResetStyles\"(?:[\\w\\W]*?)>(?:[\\w\\W]*?)<\\/style>/g, '')\n      html = html.replace(/<body((?:[\\w\\W]*?)) spellcheck=\"true\"((?:[\\w\\W]*?))>((?:[\\w\\W]*?))<\\/body>/g, '<body$1$2>$3</body>')\n      html = html.replace(/<body((?:[\\w\\W]*?)) contenteditable=\"(true|false)\"((?:[\\w\\W]*?))>((?:[\\w\\W]*?))<\\/body>/g, '<body$1$3>$4</body>')\n\n      html = html.replace(/<body((?:[\\w\\W]*?)) dir=\"([\\w]*)\"((?:[\\w\\W]*?))>((?:[\\w\\W]*?))<\\/body>/g, '<body$1$3>$4</body>')\n      html = html.replace(/<body((?:[\\w\\W]*?))class=\"([\\w\\W]*?)(fr-rtl|fr-ltr)([\\w\\W]*?)\"((?:[\\w\\W]*?))>((?:[\\w\\W]*?))<\\/body>/g, '<body$1class=\"$2$4\"$5>$6</body>')\n      html = html.replace(/<body((?:[\\w\\W]*?)) class=\"\"((?:[\\w\\W]*?))>((?:[\\w\\W]*?))<\\/body>/g, '<body$1$2>$3</body>')\n    }\n\n    // Ampersand fix.\n    if (editor.opts.htmlSimpleAmpersand) {\n      html = html.replace(/&amp;/gi, '&')\n    }\n\n    editor.events.trigger('html.afterGet')\n\n    // Remove markers.\n    if (!keep_markers) {\n      html = html.replace(/<span[^>]*? class\\s*=\\s*[\"']?fr-marker[\"']?[^>]+>\\u200b<\\/span>/gi, '')\n    }\n\n    html = editor.clean.invisibleSpaces(html)\n\n    html = editor.clean.exec(html, _processOnGet)\n\n    const new_html = editor.events.chainTrigger('html.get', html)\n\n    if (typeof new_html === 'string') {\n      html = new_html\n    }\n\n    // Deal with pre.\n    html = html.replace(/<pre(?:[\\w\\W]*?)>(?:[\\w\\W]*?)<\\/pre>/g, (str) => str.replace(/<br>/g, '\\n'))\n\n    // Keep META.\n    html = html.replace(/<meta((?:[\\w\\W]*?)) data-fr-http-equiv=\"/g, '<meta$1 http-equiv=\"')\n\n    return html\n  }\n\n  /**\n   * Get selected HTML.\n   */\n  function getSelected() {\n    function wrapSelection(container, node) {\n      while (node && (node.nodeType === Node.TEXT_NODE || !editor.node.isBlock(node)) && !editor.node.isElement(node) && !editor.node.hasClass(node, 'fr-inner')) {\n        if (node && node.nodeType !== Node.TEXT_NODE) {\n          $(container).wrapInner(editor.node.openTagString(node) + editor.node.closeTagString(node))\n        }\n\n        node = node.parentNode\n      }\n\n      if (node && container.innerHTML === node.innerHTML) {\n        container.innerHTML = node.outerHTML\n      }\n    }\n\n    function selectionParent() {\n      let parent = null\n      let sel\n\n      if (editor.win.getSelection) {\n        sel = editor.win.getSelection()\n\n        if (sel && sel.rangeCount) {\n          parent = sel.getRangeAt(0).commonAncestorContainer\n\n          if (parent.nodeType !== Node.ELEMENT_NODE) {\n            parent = parent.parentNode\n          }\n        }\n      }\n      else if ((sel = editor.doc.selection) && sel.type !== 'Control') {\n        parent = sel.createRange().parentElement()\n      }\n\n      if (parent !== null && ($(parent).parents().toArray().indexOf(editor.el) >= 0 || parent === editor.el)) {\n\n        return parent\n      }\n\n\n      return null\n\n    }\n\n    let html = ''\n\n    if (typeof editor.win.getSelection !== 'undefined') {\n\n      // Multiple ranges hack.\n      if (editor.browser.mozilla) {\n        editor.selection.save()\n\n        if (editor.$el.find('.fr-marker[data-type=\"false\"]').length > 1) {\n          editor.$el.find('.fr-marker[data-type=\"false\"][data-id=\"0\"]').remove()\n          editor.$el.find('.fr-marker[data-type=\"false\"]:last').attr('data-id', '0')\n          editor.$el.find('.fr-marker').not('[data-id=\"0\"]').remove()\n        }\n        editor.selection.restore()\n      }\n\n      const ranges = editor.selection.ranges()\n\n      for (let i = 0; i < ranges.length; i++) {\n        let container = document.createElement('div')\n        container.appendChild(ranges[i].cloneContents())\n\n        wrapSelection(container, selectionParent())\n\n        // Fix for https://github.com/froala/wysiwyg-editor/issues/1010.\n        if ($(container).find('.fr-element').length > 0) {\n          container = editor.el\n        }\n\n        html += container.innerHTML\n      }\n    }\n    else if (typeof editor.doc.selection !== 'undefined') {\n      if (editor.doc.selection.type === 'Text') {\n        html = editor.doc.selection.createRange().htmlText\n      }\n    }\n\n    return html\n  }\n\n  function _hasBlockTags(html) {\n    const tmp = editor.doc.createElement('div')\n    tmp.innerHTML = html\n\n    return tmp.querySelector(blockTagsQuery()) !== null\n  }\n\n  function _setCursorAtEnd(html) {\n    const tmp = editor.doc.createElement('div')\n    tmp.innerHTML = html\n\n    editor.selection.setAtEnd(tmp)\n\n    return tmp.innerHTML\n  }\n\n  function escapeEntities(str) {\n\n    return str.replace(/</gi, '&lt;')\n              .replace(/>/gi, '&gt;')\n              .replace(/\"/gi, '&quot;')\n              .replace(/'/gi, '&#39;')\n  }\n\n  function _unwrapForLists(html) {\n    if (!editor.html.defaultTag()) {\n      return html\n    }\n\n    const tmp = editor.doc.createElement('div')\n    tmp.innerHTML = html\n\n    // https://github.com/froala/wysiwyg-editor/issues/1553. Unwrap default tags from lists.\n    const default_tag_els = tmp.querySelectorAll(`:scope > ${editor.html.defaultTag()}`)\n\n    for (let i = default_tag_els.length - 1; i >= 0; i--) {\n      const el = default_tag_els[i]\n\n      if (!editor.node.isBlock(el.previousSibling)) {\n\n        // Check previous sibling in order to add br.\n        if (el.previousSibling && !editor.node.isEmpty(el)) {\n          $('<br>').insertAfter(el.previousSibling)\n        }\n\n        // Unwrap.\n        el.outerHTML = el.innerHTML\n      }\n    }\n\n    return tmp.innerHTML\n  }\n\n  /**\n   * Insert HTML.\n   */\n  function insert(dirty_html, clean, do_split) {\n\n    // There is no selection.\n    if (!editor.selection.isCollapsed()) {\n      editor.selection.remove()\n    }\n\n    let clean_html\n\n    if (!clean) {\n      clean_html = editor.clean.html(dirty_html)\n    }\n    else {\n      clean_html = dirty_html\n    }\n\n    if (dirty_html.indexOf('class=\"fr-marker\"') < 0) {\n      clean_html = _setCursorAtEnd(clean_html)\n    }\n\n    // Editor is empty and there are block tags in the pasted HTML.\n    if (editor.node.isEmpty(editor.el) && !editor.opts.keepFormatOnDelete && _hasBlockTags(clean_html)) {\n      editor.el.innerHTML = clean_html\n    }\n    else {\n\n      // Insert a marker.\n      let marker = editor.markers.insert()\n\n      if (!marker) {\n        editor.el.innerHTML += clean_html\n      }\n      else {\n\n        // Do not insert html inside emoticon.\n        if (editor.node.isLastSibling(marker) && $(marker).parent().hasClass('fr-deletable')) {\n\n          $(marker).insertAfter($(marker).parent())\n        }\n\n        // Check if HTML contains block tags and if so then break the current HTML.\n        const block_parent = editor.node.blockParent(marker)\n\n        if ((_hasBlockTags(clean_html) || do_split) && (editor.node.deepestParent(marker) || block_parent && block_parent.tagName === 'LI')) {\n          if (block_parent && block_parent.tagName === 'LI') {\n            clean_html = _unwrapForLists(clean_html)\n          }\n\n          marker = editor.markers.split()\n\n          if (!marker) {\n            return false\n          }\n          marker.outerHTML = clean_html\n        }\n        else {\n          marker.outerHTML = clean_html\n        }\n      }\n    }\n\n    _normalize()\n    editor.keys.positionCaret()\n\n    editor.events.trigger('html.inserted')\n  }\n\n  /**\n   * Clean those tags that have an invisible space inside.\n   */\n  function cleanWhiteTags(ignore_selection) {\n    let current_el = null\n\n    if (typeof ignore_selection === 'undefined') {\n      current_el = editor.selection.element()\n    }\n\n    if (editor.opts.keepFormatOnDelete) {\n      return false\n    }\n\n    const current_white = current_el ? (current_el.textContent.match(/\\u200B/g) || []).length - current_el.querySelectorAll('.fr-marker').length : 0\n    const total_white = (editor.el.textContent.match(/\\u200B/g) || []).length - editor.el.querySelectorAll('.fr-marker').length\n\n    if (total_white === current_white) {\n      return false\n    }\n\n    let possible_elements\n    let removed\n\n    do {\n      removed = false\n      possible_elements = editor.el.querySelectorAll('*:not(.fr-marker)')\n\n      for (let i = 0; i < possible_elements.length; i++) {\n        const el = possible_elements[i]\n\n        if (current_el === el) {\n          continue\n        }\n\n        const text = el.textContent\n\n        if (el.children.length === 0 && text.length === 1 && text.charCodeAt(0) === 8203 && el.tagName !== 'TD') {\n          $(el).remove()\n          removed = true\n        }\n      }\n    } while (removed)\n  }\n\n  function _cleanTags() {\n    cleanWhiteTags()\n\n    if (editor.placeholder) {\n      setTimeout(editor.placeholder.refresh, 0)\n    }\n  }\n\n  /**\n   * Initialization.\n   */\n  function _init() {\n    if (editor.$wp) {\n      editor.events.on('mouseup', _cleanTags)\n      editor.events.on('keydown', _cleanTags)\n      editor.events.on('contentChanged', checkIfEmpty)\n    }\n  }\n\n  return {\n    defaultTag,\n    isPreformatted,\n    emptyBlocks,\n    emptyBlockTagsQuery,\n    blockTagsQuery,\n    fillEmptyBlocks,\n    cleanEmptyTags,\n    cleanWhiteTags,\n    cleanBlankSpaces,\n    blocks,\n    getDoctype,\n    set,\n    get,\n    getSelected,\n    insert,\n    wrap: _wrap,\n    unwrap,\n    escapeEntities,\n    checkIfEmpty,\n    extractNode,\n    extractNodeAttrs,\n    extractDoctype,\n    cleanBRs,\n    _init\n  }\n}\n\n","import './html.js'\n\nimport $ from 'jquery'\nimport FE from 'froala_editor'\n\n// Extend defaults.\nObject.assign(FE.DEFAULTS, {\n  editorClass: null,\n  typingTimer: 500,\n  iframe: false,\n  requestWithCORS: true,\n  requestWithCredentials: false,\n  requestHeaders: {},\n  useClasses: true,\n  spellcheck: true,\n  iframeDefaultStyle: 'html{margin:0px;height:auto;}body{height:auto;padding:10px;background:transparent;color:#000000;position:relative;z-index: 2;-webkit-user-select:auto;margin:0px;overflow:hidden;min-height:20px;}body:after{content:\"\";display:block;clear:both;}body::-moz-selection{background:#b5d6fd;color:#000;}body::selection{background:#b5d6fd;color:#000;}',\n  iframeStyle: '',\n  iframeStyleFiles: [],\n  direction: 'auto',\n  zIndex: 1,\n  tabIndex: null,\n  disableRightClick: false,\n  scrollableContainer: 'body',\n  keepFormatOnDelete: false,\n  theme: null\n})\n\nFE.MODULES.core = function (editor) {\n  function injectStyle(style) {\n    if (editor.opts.iframe) {\n      editor.$head.find('style[data-fr-style], link[data-fr-style]').remove()\n      editor.$head.append(`<style data-fr-style=\"true\">${style}</style>`)\n\n      for (let i = 0; i < editor.opts.iframeStyleFiles.length; i++) {\n        const $link = $(`<link data-fr-style=\"true\" rel=\"stylesheet\" href=\"${editor.opts.iframeStyleFiles[i]}\">`)\n\n        // Listen to the load event in order to sync iframe.\n        $link.get(0).addEventListener('load', editor.size.syncIframe)\n\n        // Append to the head.\n        editor.$head.append($link)\n      }\n    }\n  }\n\n  function _initElementStyle() {\n    if (!editor.opts.iframe) {\n      editor.$el.addClass('fr-element fr-view')\n    }\n  }\n\n  /**\n   * Init the editor style.\n   */\n\n  function _initStyle() {\n    editor.$box.addClass(`fr-box${editor.opts.editorClass ? ` ${editor.opts.editorClass}` : ''}`)\n    editor.$box.attr('role', 'application')\n    editor.$wp.addClass('fr-wrapper')\n\n    _initElementStyle()\n\n    if (editor.opts.iframe) {\n      editor.$iframe.addClass('fr-iframe')\n      editor.$el.addClass('fr-view')\n\n      for (let i = 0; i < editor.o_doc.styleSheets.length; i++) {\n        let rules\n\n        try {\n          rules = editor.o_doc.styleSheets[i].cssRules\n        }\n        catch (ex) {\n          // ok.\n        }\n\n        if (rules) {\n          for (let idx = 0, len = rules.length; idx < len; idx++) {\n            if (rules[idx].selectorText && (rules[idx].selectorText.indexOf('.fr-view') === 0 || rules[idx].selectorText.indexOf('.fr-element') === 0)) {\n              if (rules[idx].style.cssText.length > 0) {\n                if (rules[idx].selectorText.indexOf('.fr-view') === 0) {\n                  editor.opts.iframeStyle += `${rules[idx].selectorText.replace(/\\.fr-view/g, 'body')}{${rules[idx].style.cssText}}`\n                }\n                else {\n                  editor.opts.iframeStyle += `${rules[idx].selectorText.replace(/\\.fr-element/g, 'body')}{${rules[idx].style.cssText}}`\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n\n    if (editor.opts.direction !== 'auto') {\n      editor.$box.removeClass('fr-ltr fr-rtl').addClass(`fr-${editor.opts.direction}`)\n    }\n    editor.$el.attr('dir', editor.opts.direction)\n    editor.$wp.attr('dir', editor.opts.direction)\n\n    if (editor.opts.zIndex > 1) {\n      editor.$box.css('z-index', editor.opts.zIndex)\n    }\n\n    if (editor.opts.theme) {\n      editor.$box.addClass(`${editor.opts.theme}-theme`)\n    }\n\n    // Set tabIndex option.\n    editor.opts.tabIndex = editor.opts.tabIndex || editor.$oel.attr('tabIndex')\n\n    if (editor.opts.tabIndex) {\n      editor.$el.attr('tabIndex', editor.opts.tabIndex)\n    }\n  }\n\n  /**\n   * Determine if the editor is empty.\n   */\n\n  function isEmpty() {\n    return editor.node.isEmpty(editor.el)\n  }\n\n  /**\n   * Check if the browser allows drag and init it.\n   */\n\n  function _initDrag() {\n\n    // Drag and drop support.\n    editor.drag_support = {\n      filereader: typeof FileReader !== 'undefined',\n      formdata: Boolean(editor.win.FormData),\n      progress: 'upload' in new XMLHttpRequest()\n    }\n  }\n\n  /**\n   * Return an XHR object.\n   */\n\n  function getXHR(url, method) {\n    const xhr = new XMLHttpRequest()\n\n    // Make it async.\n    xhr.open(method, url, true)\n\n    // Set with credentials.\n    if (editor.opts.requestWithCredentials) {\n      xhr.withCredentials = true\n    }\n\n    // Set headers.\n    for (const header in editor.opts.requestHeaders) {\n      if (Object.prototype.hasOwnProperty.call(editor.opts.requestHeaders, header)) {\n        xhr.setRequestHeader(header, editor.opts.requestHeaders[header])\n      }\n    }\n\n    return xhr\n  }\n\n  function _destroy(html) {\n    if (editor.$oel.get(0).tagName === 'TEXTAREA') {\n      editor.$oel.val(html)\n    }\n\n    if (editor.$box) {\n      editor.$box.removeAttr('role')\n    }\n\n    if (editor.$wp) {\n      if (editor.$oel.get(0).tagName === 'TEXTAREA') {\n        editor.$el.html('')\n        editor.$wp.html('')\n        editor.$box.replaceWith(editor.$oel)\n        editor.$oel.show()\n      }\n      else {\n        editor.$wp.replaceWith(html)\n        editor.$el.html('')\n        editor.$box.removeClass(`fr-view fr-ltr fr-box ${editor.opts.editorClass || ''}`)\n\n        if (editor.opts.theme) {\n          editor.$box.addClass(`${editor.opts.theme}-theme`)\n        }\n      }\n    }\n\n    this.$wp = null\n    this.$el = null\n    this.el = null\n    this.$box = null\n  }\n\n  function hasFocus() {\n    if (editor.browser.mozilla && editor.helpers.isMobile()) {\n      return editor.selection.inEditor()\n    }\n\n    return editor.node.hasFocus(editor.el) || editor.$el.find('*:focus').length > 0\n  }\n\n  function sameInstance($obj) {\n    if (!$obj) {\n      return false\n    }\n\n    const inst = $obj.data('instance')\n\n    return inst ? inst.id === editor.id : false\n  }\n\n  /**\n   * Tear up.\n   */\n\n  function _init() {\n    FE.INSTANCES.push(editor)\n\n    _initDrag()\n\n    // Call initialization methods.\n    if (editor.$wp) {\n      _initStyle()\n      editor.html.set(editor._original_html)\n\n      // Set spellcheck.\n      editor.$el.attr('spellcheck', editor.opts.spellcheck)\n\n      // Disable autocomplete.\n      if (editor.helpers.isMobile()) {\n        editor.$el.attr('autocomplete', editor.opts.spellcheck ? 'on' : 'off')\n        editor.$el.attr('autocorrect', editor.opts.spellcheck ? 'on' : 'off')\n        editor.$el.attr('autocapitalize', editor.opts.spellcheck ? 'on' : 'off')\n      }\n\n      // Disable right click.\n      if (editor.opts.disableRightClick) {\n        editor.events.$on(editor.$el, 'contextmenu', (e) => {\n          if (e.button === 2) {\n\n            return false\n          }\n        })\n      }\n\n      try {\n        editor.doc.execCommand('styleWithCSS', false, false)\n      }\n      catch (ex) {\n        // ok.\n      }\n    }\n\n    if (editor.$oel.get(0).tagName === 'TEXTAREA') {\n\n      // Sync on contentChanged.\n      editor.events.on('contentChanged', () => {\n        editor.$oel.val(editor.html.get())\n      })\n\n      // Set HTML on form submit.\n      editor.events.on('form.submit', () => {\n        editor.$oel.val(editor.html.get())\n      })\n\n      editor.events.on('form.reset', () => {\n        editor.html.set(editor._original_html)\n      })\n\n      editor.$oel.val(editor.html.get())\n    }\n\n    // iOS focus fix.\n    if (editor.helpers.isIOS()) {\n      editor.events.$on(editor.$doc, 'selectionchange', () => {\n        if (!editor.$doc.get(0).hasFocus()) {\n          editor.$win.get(0).focus()\n        }\n      })\n    }\n\n    editor.events.trigger('init')\n\n    // Autofocus.\n    if (editor.opts.autofocus && !editor.opts.initOnClick && editor.$wp) {\n      editor.events.on('initialized', () => {\n        editor.events.focus(true)\n      })\n    }\n  }\n\n  return {\n    _init,\n    destroy: _destroy,\n    isEmpty,\n    getXHR,\n    injectStyle,\n    hasFocus,\n    sameInstance\n  }\n}\n","import $ from 'jquery'\nimport FE from 'froala_editor'\n\nFE.MODULES.cursorLists = function (editor) {\n  /**\n   * Find the first li parent.\n   */\n  function _firstParentLI(node) {\n    let p_node = node\n\n    while (p_node.tagName !== 'LI') {\n      p_node = p_node.parentNode\n    }\n\n    return p_node\n  }\n\n  /**\n   * Find the first list parent.\n   */\n  function _firstParentList(node) {\n    let p_node = node\n\n    while (!editor.node.isList(p_node)) {\n      p_node = p_node.parentNode\n    }\n\n    return p_node\n  }\n\n\n  /**\n   * Do enter at the beginning of a list item.\n   */\n  function _startEnter(marker) {\n    const li = _firstParentLI(marker)\n\n    // Get previous and next siblings.\n    const next_li = li.nextSibling\n    const prev_li = li.previousSibling\n    const default_tag = editor.html.defaultTag()\n\n    let ul\n\n    // We are in a list item at the middle of the list or an list item that is not empty.\n    if (editor.node.isEmpty(li, true) && next_li) {\n      let o_str = ''\n      let c_str = ''\n      let p_node = marker.parentNode\n\n      // Create open / close string.\n      while (!editor.node.isList(p_node) && p_node.parentNode && p_node.parentNode.tagName !== 'LI') {\n        o_str = editor.node.openTagString(p_node) + o_str\n        c_str += editor.node.closeTagString(p_node)\n        p_node = p_node.parentNode\n      }\n\n      o_str = editor.node.openTagString(p_node) + o_str\n      c_str += editor.node.closeTagString(p_node)\n\n      let str = ''\n\n      if (p_node.parentNode && p_node.parentNode.tagName === 'LI') {\n        str = `${c_str}<li>${FE.MARKERS}<br>${o_str}`\n      }\n      else if (default_tag) {\n        str = `${c_str}<${default_tag}>${FE.MARKERS}<br></${default_tag}>${o_str}`\n      }\n      else {\n        str = `${c_str + FE.MARKERS}<br>${o_str}`\n      }\n\n      $(li).html('<span id=\"fr-break\"></span>')\n\n      while (['UL', 'OL'].indexOf(p_node.tagName) < 0 || p_node.parentNode && p_node.parentNode.tagName === 'LI') {\n        p_node = p_node.parentNode\n      }\n      let html = editor.node.openTagString(p_node) + $(p_node).html() + editor.node.closeTagString(p_node)\n      html = html.replace(/<span id=\"fr-break\"><\\/span>/g, str)\n\n      $(p_node).replaceWith(html)\n\n      editor.$el.find('li:empty').remove()\n    }\n    else if (prev_li && next_li || !editor.node.isEmpty(li, true)) {\n\n      let br_str = '<br>'\n      let nd = marker.parentNode\n\n      while (nd && nd.tagName !== 'LI') {\n        br_str = editor.node.openTagString(nd) + br_str + editor.node.closeTagString(nd)\n        nd = nd.parentNode\n      }\n\n      $(li).before(`<li>${br_str}</li>`)\n      $(marker).remove()\n    }\n\n    // There is no previous list item so transform the current list item to an empty line.\n    else if (!prev_li) {\n      ul = _firstParentList(li)\n\n      // We are in a nested list so add a new li before it.\n      if (ul.parentNode && ul.parentNode.tagName === 'LI') {\n        if (next_li) {\n          $(ul.parentNode).before(`${editor.node.openTagString(li) + FE.MARKERS}<br></li>`)\n        }\n        else {\n          $(ul.parentNode).after(`${editor.node.openTagString(li) + FE.MARKERS}<br></li>`)\n        }\n      }\n\n      // We are in a normal list. Add a new line before.\n      else if (default_tag) {\n        $(ul).before(`<${default_tag}>${FE.MARKERS}<br></${default_tag}>`)\n      }\n      else {\n        $(ul).before(`${FE.MARKERS}<br>`)\n      }\n\n      // Remove the current li.\n      $(li).remove()\n    }\n\n    // There is no next_li item so transform the current list item to an empty line.\n    else {\n      ul = _firstParentList(li)\n\n      let new_str = `${FE.MARKERS}<br>`\n      let ndx = marker.parentNode\n\n      while (ndx && ndx.tagName !== 'LI') {\n        new_str = editor.node.openTagString(ndx) + new_str + editor.node.closeTagString(ndx)\n        ndx = ndx.parentNode\n      }\n\n      // We are in a nested lists so add a new li after it.\n      if (ul.parentNode && ul.parentNode.tagName === 'LI') {\n        $(ul.parentNode).after(`<li>${new_str}</li>`)\n      }\n\n      // We are in a normal list. Add a new line after.\n      else if (default_tag) {\n        $(ul).after(`<${default_tag}>${new_str}</${default_tag}>`)\n      }\n      else {\n        $(ul).after(new_str)\n      }\n\n      // Remove the current li.\n      $(li).remove()\n    }\n  }\n\n  /**\n   * Enter at the middle of a list.\n   */\n  function _middleEnter(marker) {\n    const li = _firstParentLI(marker)\n\n    // Build the closing / opening list item string.\n    let str = ''\n    let node = marker\n    let o_str = ''\n    let c_str = ''\n\n    while (node !== li) {\n      node = node.parentNode\n\n      const cls = node.tagName === 'A' && editor.cursor.isAtEnd(marker, node) ? 'fr-to-remove' : ''\n\n      o_str = editor.node.openTagString($(node).clone().addClass(cls).get(0)) + o_str\n      c_str = editor.node.closeTagString(node) + c_str\n    }\n\n    // Add markers.\n    str = c_str + str + o_str + FE.MARKERS + (editor.opts.keepFormatOnDelete ? FE.INVISIBLE_SPACE : '')\n\n    // Build HTML.\n    $(marker).replaceWith('<span id=\"fr-break\"></span>')\n    let html = editor.node.openTagString(li) + $(li).html() + editor.node.closeTagString(li)\n    html = html.replace(/<span id=\"fr-break\"><\\/span>/g, str)\n\n    // Replace the current list item.\n    $(li).replaceWith(html)\n  }\n\n  /**\n   * Enter at the end of a list item.\n   */\n  function _endEnter(marker) {\n    const li = _firstParentLI(marker)\n\n    let end_str = FE.MARKERS\n    let start_str = ''\n    let node = marker\n\n    let add_invisible = false\n\n    while (node !== li) {\n      node = node.parentNode\n\n      const cls = node.tagName === 'A' && editor.cursor.isAtEnd(marker, node) ? 'fr-to-remove' : ''\n\n      if (!add_invisible && node !== li && !editor.node.isBlock(node)) {\n        add_invisible = true\n        start_str += FE.INVISIBLE_SPACE\n      }\n\n      start_str = editor.node.openTagString($(node).clone().addClass(cls).get(0)) + start_str\n      end_str += editor.node.closeTagString(node)\n    }\n\n    const str = start_str + end_str\n\n    $(marker).remove()\n    $(li).after(str)\n  }\n\n  /**\n   * Do backspace on a list item. This method is called only when wer are at the beginning of a LI.\n   */\n  function _backspace(marker) {\n    const li = _firstParentLI(marker)\n\n    // Get previous sibling.\n    let prev_li = li.previousSibling\n\n    // There is a previous li.\n    if (prev_li) {\n\n      // Get the li inside a nested list or inner block tags.\n      prev_li = $(prev_li).find(editor.html.blockTagsQuery()).get(-1) || prev_li\n\n      // Add markers.\n      $(marker).replaceWith(FE.MARKERS)\n\n      // Remove possible BR at the end of the previous list.\n      let contents = editor.node.contents(prev_li)\n\n      if (contents.length && contents[contents.length - 1].tagName === 'BR') {\n        $(contents[contents.length - 1]).remove()\n      }\n\n      // Remove any nodes that might be wrapped.\n      $(li).find(editor.html.blockTagsQuery()).not('ol, ul, table').each(function () {\n        if (this.parentNode === li) {\n          $(this).replaceWith($(this).html() + (editor.node.isEmpty(this) ? '' : '<br>'))\n        }\n      })\n\n      // Append the current list item content to the previous one.\n      let node = editor.node.contents(li)[0]\n      let tmp\n\n      while (node && !editor.node.isList(node)) {\n        tmp = node.nextSibling\n        $(prev_li).append(node)\n        node = tmp\n      }\n\n      prev_li = li.previousSibling\n\n      while (node) {\n        tmp = node.nextSibling\n        $(prev_li).append(node)\n        node = tmp\n      }\n\n      // Remove ending BR.\n      contents = editor.node.contents(prev_li)\n      if (contents.length > 1 && contents[contents.length - 1].tagName === 'BR') {\n        $(contents[contents.length - 1]).remove()\n      }\n\n      // Remove the current LI.\n      $(li).remove()\n    }\n\n    // No previous li.\n    else {\n      const ul = _firstParentList(li)\n\n      // Add markers.\n      $(marker).replaceWith(FE.MARKERS)\n\n      // Nested lists.\n      if (ul.parentNode && ul.parentNode.tagName === 'LI') {\n        const prev_node = ul.previousSibling\n\n        // Previous node is block.\n        if (editor.node.isBlock(prev_node)) {\n\n          // Remove any nodes that might be wrapped.\n          $(li).find(editor.html.blockTagsQuery()).not('ol, ul, table').each(function () {\n            if (this.parentNode === li) {\n              $(this).replaceWith($(this).html() + (editor.node.isEmpty(this) ? '' : '<br>'))\n            }\n          })\n\n          $(prev_node).append($(li).html())\n        }\n\n        // Text right in li.\n        else {\n          $(ul).before($(li).html())\n        }\n      }\n\n      // Normal lists. Add an empty li instead.\n      else {\n        const default_tag = editor.html.defaultTag()\n\n        if (default_tag && $(li).find(editor.html.blockTagsQuery()).length === 0) {\n          $(ul).before(`<${default_tag}>${$(li).html()}</${default_tag}>`)\n        }\n        else {\n          $(ul).before($(li).html())\n        }\n      }\n\n      // Remove the current li.\n      $(li).remove()\n      editor.html.wrap()\n\n      // Remove the ul if it is empty.\n      if ($(ul).find('li').length === 0) {\n        $(ul).remove()\n      }\n    }\n  }\n\n  /**\n   * Delete at the end of list item.\n   */\n  function _del(marker) {\n    const li = _firstParentLI(marker)\n    const next_li = li.nextSibling\n    let contents\n\n    // There is a next li.\n    if (next_li) {\n\n      // Remove possible BR at the beginning of the next LI.\n      contents = editor.node.contents(next_li)\n\n      if (contents.length && contents[0].tagName === 'BR') {\n        $(contents[0]).remove()\n      }\n\n      // Unwrap content from the next node.\n      $(next_li).find(editor.html.blockTagsQuery()).not('ol, ul, table').each(function () {\n        if (this.parentNode === next_li) {\n          $(this).replaceWith($(this).html() + (editor.node.isEmpty(this) ? '' : '<br>'))\n        }\n      })\n\n      // Append the next LI to the current LI.\n      let last_node = marker\n      let node = editor.node.contents(next_li)[0]\n      let tmp\n\n      while (node && !editor.node.isList(node)) {\n        tmp = node.nextSibling\n        $(last_node).after(node)\n        last_node = node\n        node = tmp\n      }\n\n      // Append nested lists.\n      while (node) {\n        tmp = node.nextSibling\n        $(li).append(node)\n        node = tmp\n      }\n\n      // Replace marker with markers.\n      $(marker).replaceWith(FE.MARKERS)\n\n      // Remove next li.\n      $(next_li).remove()\n    }\n\n    // No next li.\n    else {\n\n      // Search the next sibling in parents.\n      let next_node = li\n\n      while (!next_node.nextSibling && next_node !== editor.el) {\n        next_node = next_node.parentNode\n      }\n\n      // We're right at the end.\n      if (next_node === editor.el) {\n        return false\n      }\n\n      // Get the next sibling.\n      next_node = next_node.nextSibling\n\n      // Next sibling is a block tag.\n      if (editor.node.isBlock(next_node)) {\n\n        // Check if we can do delete in it.\n        if (FE.NO_DELETE_TAGS.indexOf(next_node.tagName) < 0) {\n\n          // Add markers.\n          $(marker).replaceWith(FE.MARKERS)\n\n          // Remove any possible BR at the end of the LI.\n          contents = editor.node.contents(li)\n\n          if (contents.length && contents[contents.length - 1].tagName === 'BR') {\n            $(contents[contents.length - 1]).remove()\n          }\n\n          // Append next node.\n          $(li).append($(next_node).html())\n\n          // Remove the next node.\n          $(next_node).remove()\n        }\n      }\n\n      // Append everything till the next block tag or BR.\n      else {\n\n        // Remove any possible BR at the end of the LI.\n        contents = editor.node.contents(li)\n\n        if (contents.length && contents[contents.length - 1].tagName === 'BR') {\n          $(contents[contents.length - 1]).remove()\n        }\n\n        // var next_node = next_li;\n        $(marker).replaceWith(FE.MARKERS)\n\n        while (next_node && !editor.node.isBlock(next_node) && next_node.tagName !== 'BR') {\n          $(li).append($(next_node))\n          next_node = next_node.nextSibling\n        }\n      }\n    }\n  }\n\n  return {\n    _startEnter,\n    _middleEnter,\n    _endEnter,\n    _backspace,\n    _del\n  }\n}\n\n","import $ from 'jquery'\nimport FE from 'froala_editor'\n\n// Do not merge with the previous one.\nFE.NO_DELETE_TAGS = ['TH', 'TD', 'TR', 'TABLE', 'FORM']\n\n// Do simple enter.\nFE.SIMPLE_ENTER_TAGS = ['TH', 'TD', 'LI', 'DL', 'DT', 'FORM']\n\nFE.MODULES.cursor = function (editor) {\n  /**\n   * Check if node is at the end of a block tag.\n   */\n  function _atEnd(node) {\n    if (!node) {\n      return false\n    }\n\n    if (editor.node.isBlock(node)) {\n      return true\n    }\n\n    if (node.nextSibling && node.nextSibling.nodeType === Node.TEXT_NODE && node.nextSibling.textContent.replace(/\\u200b/g, '').length === 0) {\n      return _atEnd(node.nextSibling)\n    }\n\n    if (node.nextSibling && !(node.previousSibling && node.nextSibling.tagName === 'BR' && !node.nextSibling.nextSibling)) {\n      return false\n    }\n\n    return _atEnd(node.parentNode)\n  }\n\n  /**\n   * Check if node is at the start of a block tag.\n   */\n  function _atStart(node) {\n    if (!node) {\n      return false\n    }\n\n    if (editor.node.isBlock(node)) {\n      return true\n    }\n\n    if (node.previousSibling && node.previousSibling.nodeType === Node.TEXT_NODE && node.previousSibling.textContent.replace(/\\u200b/g, '').length === 0) {\n      return _atStart(node.previousSibling)\n    }\n\n    if (node.previousSibling) {\n      return false\n    }\n\n    if (!node.previousSibling && editor.node.hasClass(node.parentNode, 'fr-inner')) {\n      return true\n    }\n\n    return _atStart(node.parentNode)\n  }\n\n  /**\n   * Check if node is a the start of the container.\n   */\n  function _isAtStart(node, container) {\n    if (!node) {\n      return false\n    }\n\n    if (node === editor.$wp.get(0)) {\n      return false\n    }\n\n    if (node.previousSibling && node.previousSibling.nodeType === Node.TEXT_NODE && node.previousSibling.textContent.replace(/\\u200b/g, '').length === 0) {\n      return _isAtStart(node.previousSibling, container)\n    }\n\n    if (node.previousSibling) {\n      return false\n    }\n\n    if (node.parentNode === container) {\n      return true\n    }\n\n    return _isAtStart(node.parentNode, container)\n  }\n\n  /**\n   * Check if node is a the start of the container.\n   */\n  function _isAtEnd(node, container) {\n    if (!node) {\n      return false\n    }\n\n    if (node === editor.$wp.get(0)) {\n      return false\n    }\n\n    if (node.nextSibling && node.nextSibling.nodeType === Node.TEXT_NODE && node.nextSibling.textContent.replace(/\\u200b/g, '').length === 0) {\n\n      return _isAtEnd(node.nextSibling, container)\n    }\n\n    if (node.nextSibling && !(node.previousSibling && node.nextSibling.tagName === 'BR' && !node.nextSibling.nextSibling)) {\n      return false\n    }\n\n    if (node.parentNode === container) {\n      return true\n    }\n\n    return _isAtEnd(node.parentNode, container)\n  }\n\n  /**\n   * Check if the node is inside a LI.\n   */\n  function _inLi(node) {\n    return $(node).parentsUntil(editor.$el, 'LI').length > 0 && $(node).parentsUntil('LI', 'TABLE').length === 0\n  }\n\n  /**\n   * Get the length of the first or last character from text. Note: A special character can contain 1, 2 or 4 javascript 16bits characters.\n   */\n  function _getExtremityCharacterLength(text, first) {\n\n    const special_chars_regex = new RegExp(`${first ? '^' : ''}(([\\\\uD83C-\\\\uDBFF\\\\uDC00-\\\\uDFFF]+\\\\u200D)*[\\\\uD83C-\\\\uDBFF\\\\uDC00-\\\\uDFFF]{2})${first ? '' : '$'}`, 'i')\n    const matches = text.match(special_chars_regex)\n\n    // No matches means there is a normal character.\n    if (!matches) {\n      return 1\n    }\n\n    // Special character match. Can be 1, 2 or 4 characters.\n\n\n    return matches[0].length\n\n  }\n\n  /**\n   * Do backspace at the start of a block tag.\n   */\n  function _startBackspace(marker) {\n    const quote = $(marker).parentsUntil(editor.$el, 'BLOCKQUOTE').length > 0\n    let deep_parent = editor.node.deepestParent(marker, [], !quote)\n    let current_block = deep_parent\n\n    // Check for nested block tags if no previous element.\n    while (deep_parent && !deep_parent.previousSibling && deep_parent.tagName !== 'BLOCKQUOTE' && deep_parent.parentElement !== editor.el && !editor.node.hasClass(deep_parent.parentElement, 'fr-inner') && FE.SIMPLE_ENTER_TAGS.indexOf(deep_parent.parentElement.tagName) < 0) {\n      deep_parent = deep_parent.parentElement\n    }\n\n\n    if (deep_parent && deep_parent.tagName === 'BLOCKQUOTE') {\n      const m_parent = editor.node.deepestParent(marker, [$(marker).parentsUntil(editor.$el, 'BLOCKQUOTE').get(0)])\n\n      if (m_parent && m_parent.previousSibling) {\n        deep_parent = m_parent\n        current_block = m_parent\n      }\n    }\n\n    // Deepest parent is not the main element.\n    if (deep_parent !== null) {\n      let prev_node = deep_parent.previousSibling\n      let contents\n\n      // We are inside a block tag.\n      if (editor.node.isBlock(deep_parent) && editor.node.isEditable(deep_parent)) {\n\n        // There is a previous node.\n        if (prev_node && FE.NO_DELETE_TAGS.indexOf(prev_node.tagName) < 0) {\n          if (editor.node.isDeletable(prev_node)) {\n            $(prev_node).remove()\n            $(marker).replaceWith(FE.MARKERS)\n          }\n          else {\n            // Previous node is a block tag.\n            if (editor.node.isEditable(prev_node)) {\n              if (editor.node.isBlock(prev_node)) {\n                if (editor.node.isEmpty(prev_node) && !editor.node.isList(prev_node)) {\n                  $(prev_node).remove()\n\n                  // https://github.com/froala/wysiwyg-editor/issues/1877.\n                  $(marker).after(editor.opts.keepFormatOnDelete ? FE.INVISIBLE_SPACE : '')\n                }\n                else {\n                  if (editor.node.isList(prev_node)) {\n                    prev_node = $(prev_node).find('li').last().get(0)\n                  }\n\n                  // Remove last BR.\n                  contents = editor.node.contents(prev_node)\n\n                  if (contents.length && contents[contents.length - 1].tagName === 'BR') {\n                    $(contents[contents.length - 1]).remove()\n                  }\n\n                  // Prev node is blockquote but the current one isn't.\n                  if (prev_node.tagName === 'BLOCKQUOTE' && deep_parent.tagName !== 'BLOCKQUOTE') {\n                    contents = editor.node.contents(prev_node)\n\n                    while (contents.length && editor.node.isBlock(contents[contents.length - 1])) {\n                      prev_node = contents[contents.length - 1]\n                      contents = editor.node.contents(prev_node)\n                    }\n                  }\n\n                  // Prev node is not blockquote, but the current one is.\n                  else if (prev_node.tagName !== 'BLOCKQUOTE' && current_block.tagName === 'BLOCKQUOTE') {\n                    contents = editor.node.contents(current_block)\n\n                    while (contents.length && editor.node.isBlock(contents[0])) {\n                      current_block = contents[0]\n                      contents = editor.node.contents(current_block)\n                    }\n                  }\n\n                  // When current node is empty place the cursor at the end of the prev node.\n                  if (editor.node.isEmpty(deep_parent)) {\n                    $(marker).remove()\n                    editor.selection.setAtEnd(prev_node, true)\n                  }\n\n                  // Replace marker with markers.\n                  else {\n                    $(marker).replaceWith(FE.MARKERS)\n\n                    // Previous node may have only block children.\n                    const prev_children = prev_node.childNodes\n\n                    // Append to prev node current HTML\n                    if (!editor.node.isBlock(prev_children[prev_children.length - 1])) {\n                      $(prev_node).append(current_block.innerHTML)\n                    }\n                    else {\n                      // Append the HTML to the last child of the previous node.\n                      $(prev_children[prev_children.length - 1]).append(current_block.innerHTML)\n                    }\n                  }\n\n                  // Remove current block.\n                  $(current_block).remove()\n\n                  // Remove current deep parent if empty.\n                  if (editor.node.isEmpty(deep_parent)) {\n                    $(deep_parent).remove()\n                  }\n                }\n              }\n              else {\n                $(marker).replaceWith(FE.MARKERS)\n\n                if (deep_parent.tagName === 'BLOCKQUOTE' && prev_node.nodeType === Node.ELEMENT_NODE) {\n                  $(prev_node).remove()\n                }\n                else {\n                  $(prev_node).after(editor.node.isEmpty(deep_parent) ? '' : $(deep_parent).html())\n                  $(deep_parent).remove()\n\n                  if (prev_node.tagName === 'BR') {\n                    $(prev_node).remove()\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n\n      // No block tag.\n      /* jshint ignore:start */\n      /* jscs:disable */\n      else {\n        // This should never happen.\n      }\n      /* jshint ignore:end */\n      /* jscs:enable */\n    }\n  }\n\n  /**\n   * Do backspace at the middle of a block tag.\n   */\n  function _middleBackspace(marker) {\n    let prev_node = marker\n\n    // Get the parent node that has a prev sibling.\n    while (!prev_node.previousSibling) {\n      prev_node = prev_node.parentNode\n\n      if (editor.node.isElement(prev_node)) {\n        return false\n      }\n    }\n    prev_node = prev_node.previousSibling\n\n    // Not block tag.\n    let contents\n\n    if (!editor.node.isBlock(prev_node) && editor.node.isEditable(prev_node)) {\n      contents = editor.node.contents(prev_node)\n\n      // Previous node is text.\n      while (prev_node.nodeType !== Node.TEXT_NODE && !editor.node.isDeletable(prev_node) && contents.length && editor.node.isEditable(prev_node)) {\n        prev_node = contents[contents.length - 1]\n        contents = editor.node.contents(prev_node)\n      }\n\n      if (prev_node.nodeType === Node.TEXT_NODE) {\n        const txt = prev_node.textContent\n        let len = txt.length\n\n        // We have a \\n character.\n        if (txt.length && txt[txt.length - 1] === '\\n') {\n          prev_node.textContent = txt.substring(0, len - 2)\n\n          if (prev_node.textContent.length === 0) {\n            prev_node.parentNode.removeChild(prev_node)\n          }\n\n          return _middleBackspace(marker)\n        }\n\n        // Tab UNDO.\n        if (editor.opts.tabSpaces && txt.length >= editor.opts.tabSpaces) {\n          const tab_str = txt.substr(txt.length - editor.opts.tabSpaces, txt.length - 1)\n\n          if (tab_str.replace(/ /g, '').replace(new RegExp(FE.UNICODE_NBSP, 'g'), '').length === 0) {\n            len = txt.length - editor.opts.tabSpaces + 1\n          }\n        }\n\n        prev_node.textContent = txt.substring(0, len - _getExtremityCharacterLength(txt))\n\n        const deleted = txt.length !== prev_node.textContent.length\n\n        // Remove node if empty.\n        if (prev_node.textContent.length === 0) {\n\n          // Here we check to see if we should keep the current formatting.\n          if (deleted && editor.opts.keepFormatOnDelete) {\n            $(prev_node).after(FE.INVISIBLE_SPACE + FE.MARKERS)\n          }\n          else {\n            // Condition prev_node.parentNode.childNodes.length === 1 is from https://github.com/froala/wysiwyg-editor/issues/1855 .\n            if ((prev_node.parentNode.childNodes.length === 2 && prev_node.parentNode === marker.parentNode || prev_node.parentNode.childNodes.length === 1) && !editor.node.isBlock(prev_node.parentNode) && !editor.node.isElement(prev_node.parentNode) && editor.node.isDeletable(prev_node.parentNode)) {\n              $(prev_node.parentNode).after(FE.MARKERS)\n              $(prev_node.parentNode).remove()\n            }\n            else {\n              // https://github.com/froala/wysiwyg-editor/issues/2626.\n              while (!editor.node.isElement(prev_node.parentNode) && editor.node.isEmpty(prev_node.parentNode) && editor.node.isDeletable(prev_node.parentNode)) {\n                const t_node = prev_node\n                prev_node = prev_node.parentNode\n                t_node.parentNode.removeChild(t_node)\n              }\n\n              $(prev_node).after(FE.MARKERS)\n\n              // https://github.com/froala/wysiwyg-editor/issues/1379.\n              if (editor.node.isElement(prev_node.parentNode) && !marker.nextSibling && prev_node.previousSibling && prev_node.previousSibling.tagName === 'BR') {\n                $(marker).after('<br>')\n              }\n\n              prev_node.parentNode.removeChild(prev_node)\n            }\n          }\n        }\n        else {\n          $(prev_node).after(FE.MARKERS)\n        }\n      }\n      else if (editor.node.isDeletable(prev_node)) {\n        $(prev_node).after(FE.MARKERS)\n        $(prev_node).remove()\n      }\n      else if (marker.nextSibling && marker.nextSibling.tagName === 'BR' && editor.node.isVoid(prev_node) && prev_node.tagName !== 'BR') {\n        $(marker.nextSibling).remove()\n        $(marker).replaceWith(FE.MARKERS)\n      }\n      else if (editor.events.trigger('node.remove', [$(prev_node)]) !== false) {\n        $(prev_node).after(FE.MARKERS)\n        $(prev_node).remove()\n      }\n    }\n\n    // Block tag but we are allowed to delete it.\n    else if (FE.NO_DELETE_TAGS.indexOf(prev_node.tagName) < 0 && (editor.node.isEditable(prev_node) || editor.node.isDeletable(prev_node))) {\n      if (editor.node.isDeletable(prev_node)) {\n        $(marker).replaceWith(FE.MARKERS)\n        $(prev_node).remove()\n      }\n      else if (editor.node.isEmpty(prev_node) && !editor.node.isList(prev_node)) {\n        $(prev_node).remove()\n        $(marker).replaceWith(FE.MARKERS)\n      }\n      else {\n\n        // List correction.\n        if (editor.node.isList(prev_node)) {\n          prev_node = $(prev_node).find('li').last().get(0)\n        }\n\n        contents = editor.node.contents(prev_node)\n\n        if (contents && contents[contents.length - 1].tagName === 'BR') {\n          $(contents[contents.length - 1]).remove()\n        }\n\n        contents = editor.node.contents(prev_node)\n\n        while (contents && editor.node.isBlock(contents[contents.length - 1])) {\n          prev_node = contents[contents.length - 1]\n          contents = editor.node.contents(prev_node)\n        }\n\n        $(prev_node).append(FE.MARKERS)\n\n        let next_node = marker\n\n        while (!next_node.previousSibling) {\n          next_node = next_node.parentNode\n        }\n\n        while (next_node && next_node.tagName !== 'BR' && !editor.node.isBlock(next_node)) {\n          const copy_node = next_node\n          next_node = next_node.nextSibling\n          $(prev_node).append(copy_node)\n        }\n\n        // Remove BR.\n        if (next_node && next_node.tagName === 'BR') {\n          $(next_node).remove()\n        }\n\n        $(marker).remove()\n      }\n    }\n    else if (marker.nextSibling && marker.nextSibling.tagName === 'BR') {\n      $(marker.nextSibling).remove()\n    }\n  }\n\n  /**\n   * Do backspace.\n   */\n  function backspace() {\n    let do_default = false\n\n    // Add a marker in HTML.\n    const marker = editor.markers.insert()\n\n    if (!marker) {\n      return true\n    }\n\n    // Do not allow edit inside contenteditable=\"false\".\n    let p_node = marker.parentNode\n\n    while (p_node && !editor.node.isElement(p_node)) {\n      if (p_node.getAttribute('contenteditable') === 'false') {\n        $(marker).replaceWith(FE.MARKERS)\n        editor.selection.restore()\n\n        return false\n      }\n      else if (p_node.getAttribute('contenteditable') === 'true') {\n        break\n      }\n\n      p_node = p_node.parentNode\n    }\n\n    editor.el.normalize()\n\n    // We should remove invisible space first of all.\n    const prev_node = marker.previousSibling\n\n    if (prev_node) {\n      const txt = prev_node.textContent\n\n      // Check if we have an invisible space before the marker.\n      if (txt && txt.length && txt.charCodeAt(txt.length - 1) === 8203) {\n        if (txt.length === 1) {\n          $(prev_node).remove()\n        }\n        else {\n          prev_node.textContent = prev_node.textContent.substr(0, txt.length - _getExtremityCharacterLength(txt))\n        }\n      }\n    }\n\n    // Delete at end.\n    if (_atEnd(marker)) {\n      do_default = _middleBackspace(marker)\n    }\n\n    // Delete at start.\n    else if (_atStart(marker)) {\n      if (_inLi(marker) && _isAtStart(marker, $(marker).parents('li').get(0))) {\n        editor.cursorLists._backspace(marker)\n      }\n      else {\n        _startBackspace(marker)\n      }\n    }\n\n    // Delete at middle.\n    else {\n      do_default = _middleBackspace(marker)\n    }\n\n    $(marker).remove()\n\n    _cleanEmptyBlockquotes()\n    editor.html.fillEmptyBlocks(true)\n\n    if (!editor.opts.htmlUntouched) {\n      editor.html.cleanEmptyTags()\n      editor.clean.lists()\n      editor.spaces.normalizeAroundCursor()\n    }\n\n    editor.selection.restore()\n\n    return do_default\n  }\n\n  /**\n   * Delete at the end of a block tag.\n   */\n  function _endDel(marker) {\n    const quote = $(marker).parentsUntil(editor.$el, 'BLOCKQUOTE').length > 0\n    let deep_parent = editor.node.deepestParent(marker, [], !quote)\n\n    if (deep_parent && deep_parent.tagName === 'BLOCKQUOTE') {\n      const m_parent = editor.node.deepestParent(marker, [$(marker).parentsUntil(editor.$el, 'BLOCKQUOTE').get(0)])\n\n      if (m_parent && m_parent.nextSibling) {\n        deep_parent = m_parent\n      }\n    }\n\n    // Deepest parent is not the main element.\n    if (deep_parent !== null) {\n      let next_node = deep_parent.nextSibling\n      let contents\n\n      // We are inside a block tag.\n      if (editor.node.isBlock(deep_parent) && (editor.node.isEditable(deep_parent) || editor.node.isDeletable(deep_parent))) {\n\n        // There is a next node.\n        if (next_node && FE.NO_DELETE_TAGS.indexOf(next_node.tagName) < 0) {\n          if (editor.node.isDeletable(next_node)) {\n            $(next_node).remove()\n            $(marker).replaceWith(FE.MARKERS)\n          }\n          else {\n\n            // Next node is a block tag.\n            if (editor.node.isBlock(next_node) && editor.node.isEditable(next_node)) {\n\n              // Next node is a list.\n              if (editor.node.isList(next_node)) {\n\n                // Current block tag is empty.\n                if (editor.node.isEmpty(deep_parent, true)) {\n                  $(deep_parent).remove()\n\n                  $(next_node).find('li').first().prepend(FE.MARKERS)\n                }\n                else {\n                  const $li = $(next_node).find('li').first()\n\n                  if (deep_parent.tagName === 'BLOCKQUOTE') {\n                    contents = editor.node.contents(deep_parent)\n\n                    if (contents.length && editor.node.isBlock(contents[contents.length - 1])) {\n                      deep_parent = contents[contents.length - 1]\n                    }\n                  }\n\n                  // There are no nested lists.\n                  if ($li.find('ul, ol').length === 0) {\n                    $(marker).replaceWith(FE.MARKERS)\n\n                    // Remove any nodes that might be wrapped.\n                    $li.find(editor.html.blockTagsQuery()).not('ol, ul, table').each(function () {\n                      if (this.parentNode === $li.get(0)) {\n                        $(this).replaceWith($(this).html() + (editor.node.isEmpty(this) ? '' : '<br>'))\n                      }\n                    })\n\n                    $(deep_parent).append(editor.node.contents($li.get(0)))\n                    $li.remove()\n\n                    if ($(next_node).find('li').length === 0) {\n                      $(next_node).remove()\n                    }\n                  }\n                }\n              }\n              else {\n\n                // Remove last BR.\n                contents = editor.node.contents(next_node)\n\n                if (contents.length && contents[0].tagName === 'BR') {\n                  $(contents[0]).remove()\n                }\n\n                if (next_node.tagName !== 'BLOCKQUOTE' && deep_parent.tagName === 'BLOCKQUOTE') {\n                  contents = editor.node.contents(deep_parent)\n\n                  while (contents.length && editor.node.isBlock(contents[contents.length - 1])) {\n                    deep_parent = contents[contents.length - 1]\n                    contents = editor.node.contents(deep_parent)\n                  }\n                }\n                else if (next_node.tagName === 'BLOCKQUOTE' && deep_parent.tagName !== 'BLOCKQUOTE') {\n                  contents = editor.node.contents(next_node)\n\n                  while (contents.length && editor.node.isBlock(contents[0])) {\n                    next_node = contents[0]\n                    contents = editor.node.contents(next_node)\n                  }\n                }\n\n                $(marker).replaceWith(FE.MARKERS)\n                $(deep_parent).append(next_node.innerHTML)\n                $(next_node).remove()\n              }\n            }\n            else {\n              $(marker).replaceWith(FE.MARKERS)\n\n              // var next_node = next_node.nextSibling;\n              while (next_node && next_node.tagName !== 'BR' && !editor.node.isBlock(next_node) && editor.node.isEditable(next_node)) {\n                const copy_node = next_node\n                next_node = next_node.nextSibling\n                $(deep_parent).append(copy_node)\n              }\n\n              if (next_node && next_node.tagName === 'BR' && editor.node.isEditable(next_node)) {\n                $(next_node).remove()\n              }\n            }\n          }\n        }\n      }\n\n      // No block tag.\n      /* jshint ignore:start */\n      /* jscs:disable */\n      else {\n        // This should never happen.\n      }\n      /* jshint ignore:end */\n      /* jscs:enable */\n    }\n  }\n\n  /**\n   * Delete at the middle of a block tag.\n   */\n  function _middleDel(marker) {\n    let next_node = marker\n\n    // Get the parent node that has a next sibling.\n    while (!next_node.nextSibling) {\n      next_node = next_node.parentNode\n\n      if (editor.node.isElement(next_node)) {\n        return false\n      }\n    }\n    next_node = next_node.nextSibling\n\n    // Handle the case when the next node is a BR.\n    if (next_node.tagName === 'BR' && editor.node.isEditable(next_node)) {\n\n      // There is a next sibling.\n      if (next_node.nextSibling) {\n        if (editor.node.isBlock(next_node.nextSibling) && editor.node.isEditable(next_node.nextSibling)) {\n          if (FE.NO_DELETE_TAGS.indexOf(next_node.nextSibling.tagName) < 0) {\n            next_node = next_node.nextSibling\n            $(next_node.previousSibling).remove()\n          }\n          else {\n            $(next_node).remove()\n\n            return\n          }\n        }\n      }\n\n      // No next sibling. We should check if BR is at the end.\n      else if (_atEnd(next_node)) {\n        if (_inLi(marker)) {\n          editor.cursorLists._del(marker)\n        }\n        else {\n          const deep_parent = editor.node.deepestParent(next_node)\n\n          if (deep_parent) {\n            if (!editor.node.isEmpty(editor.node.blockParent(next_node)) || (editor.node.blockParent(next_node).nextSibling && FE.NO_DELETE_TAGS.indexOf(editor.node.blockParent(next_node).nextSibling.tagName)) < 0) {\n              $(next_node).remove()\n            }\n\n            _endDel(marker)\n          }\n        }\n\n        return\n      }\n    }\n\n    // Not block tag.\n    let contents\n\n    if (!editor.node.isBlock(next_node) && editor.node.isEditable(next_node)) {\n      contents = editor.node.contents(next_node)\n\n      // Next node is text.\n      while (next_node.nodeType !== Node.TEXT_NODE && contents.length && !editor.node.isDeletable(next_node) && editor.node.isEditable(next_node)) {\n        next_node = contents[0]\n        contents = editor.node.contents(next_node)\n      }\n\n      if (next_node.nodeType === Node.TEXT_NODE) {\n        $(next_node).before(FE.MARKERS)\n\n        if (next_node.textContent.length) {\n          next_node.textContent = next_node.textContent.substring(_getExtremityCharacterLength(next_node.textContent, true), next_node.textContent.length)\n        }\n      }\n      else if (editor.node.isDeletable(next_node)) {\n        $(next_node).before(FE.MARKERS)\n        $(next_node).remove()\n      }\n      else if (editor.events.trigger('node.remove', [$(next_node)]) !== false) {\n        $(next_node).before(FE.MARKERS)\n        $(next_node).remove()\n      }\n\n      $(marker).remove()\n    }\n\n    // Block tag.\n    else if (FE.NO_DELETE_TAGS.indexOf(next_node.tagName) < 0 && (editor.node.isEditable(next_node) || editor.node.isDeletable(next_node))) {\n      if (editor.node.isDeletable(next_node)) {\n        $(marker).replaceWith(FE.MARKERS)\n        $(next_node).remove()\n      }\n      else if (editor.node.isList(next_node)) {\n\n          // There is a previous sibling.\n        if (marker.previousSibling) {\n          $(next_node).find('li').first().prepend(marker)\n          editor.cursorLists._backspace(marker)\n        }\n\n          // No previous sibling.\n        else {\n          $(next_node).find('li').first().prepend(FE.MARKERS)\n          $(marker).remove()\n        }\n      }\n      else {\n        contents = editor.node.contents(next_node)\n\n        if (contents && contents[0].tagName === 'BR') {\n          $(contents[0]).remove()\n        }\n\n          // Deal with blockquote.\n        if (contents && next_node.tagName === 'BLOCKQUOTE') {\n          let node = contents[0]\n          $(marker).before(FE.MARKERS)\n\n          while (node && node.tagName !== 'BR') {\n            const tmp = node\n            node = node.nextSibling\n            $(marker).before(tmp)\n          }\n\n          if (node && node.tagName === 'BR') {\n            $(node).remove()\n          }\n        }\n        else {\n          $(marker)\n              .after($(next_node).html())\n              .after(FE.MARKERS)\n\n          $(next_node).remove()\n        }\n      }\n    }\n  }\n\n  /**\n   * Delete.\n   */\n  function del() {\n    const marker = editor.markers.insert()\n\n    if (!marker) {\n      return false\n    }\n\n    editor.el.normalize()\n\n    // Delete at end.\n    if (_atEnd(marker)) {\n      if (_inLi(marker)) {\n        if ($(marker).parents('li').first().find('ul, ol').length === 0) {\n          editor.cursorLists._del(marker)\n        }\n        else {\n          let $li = $(marker).parents('li').first()\n                      .find('ul, ol')\n                      .first()\n                      .find('li')\n                      .first()\n          $li = $li.find(editor.html.blockTagsQuery()).get(-1) || $li\n\n          $li.prepend(marker)\n          editor.cursorLists._backspace(marker)\n        }\n      }\n      else {\n        _endDel(marker)\n      }\n    }\n\n    // Delete at start.\n    else if (_atStart(marker)) {\n      _middleDel(marker)\n    }\n\n    // Delete at middle.\n    else {\n      _middleDel(marker)\n    }\n\n    $(marker).remove()\n    _cleanEmptyBlockquotes()\n    editor.html.fillEmptyBlocks(true)\n\n    if (!editor.opts.htmlUntouched) {\n      editor.html.cleanEmptyTags()\n      editor.clean.lists()\n    }\n\n    editor.spaces.normalizeAroundCursor()\n    editor.selection.restore()\n  }\n\n  function _cleanEmptyBlockquotes() {\n    const blks = editor.el.querySelectorAll('blockquote:empty')\n\n    for (let i = 0; i < blks.length; i++) {\n      blks[i].parentNode.removeChild(blks[i])\n    }\n  }\n\n  function _cleanNodesToRemove() {\n    editor.$el.find('.fr-to-remove').each(function () {\n      const contents = editor.node.contents(this)\n\n      for (let i = 0; i < contents.length; i++) {\n        if (contents[i].nodeType === Node.TEXT_NODE) {\n          contents[i].textContent = contents[i].textContent.replace(/\\u200B/g, '')\n        }\n      }\n\n      $(this).replaceWith(this.innerHTML)\n    })\n  }\n\n  /**\n   * Enter at the end of a block tag.\n   */\n  function _endEnter(marker, shift, quote) {\n    const deep_parent = editor.node.deepestParent(marker, [], !quote)\n    let default_tag\n\n    if (deep_parent && deep_parent.tagName === 'BLOCKQUOTE') {\n      if (_isAtEnd(marker, deep_parent)) {\n        default_tag = editor.html.defaultTag()\n\n        if (default_tag) {\n          $(deep_parent).after(`<${default_tag}>${FE.MARKERS}<br></${default_tag}>`)\n        }\n        else {\n          $(deep_parent).after(`${FE.MARKERS}<br>`)\n        }\n\n        $(marker).remove()\n\n        return false\n      }\n\n      _middleEnter(marker, shift, quote)\n\n      return false\n\n    }\n\n    // We are right in the main element.\n    if (deep_parent === null) {\n      default_tag = editor.html.defaultTag()\n\n      if (!default_tag || !editor.node.isElement(marker.parentNode)) {\n        if (marker.previousSibling && !$(marker.previousSibling).is('br') && !marker.nextSibling) {\n          $(marker).replaceWith(`<br>${FE.MARKERS}<br>`)\n        }\n        else {\n          $(marker).replaceWith(`<br>${FE.MARKERS}`)\n        }\n      }\n      else {\n        $(marker).replaceWith(`<${default_tag}>${FE.MARKERS}<br></${default_tag}>`)\n      }\n    }\n\n    // There is a parent.\n    else {\n\n      // Block tag parent.\n      let c_node = marker\n      let str = ''\n\n      if (!editor.node.isBlock(deep_parent) || shift) {\n        str = '<br/>'\n      }\n\n      let c_str = ''\n      let o_str = ''\n\n      default_tag = editor.html.defaultTag()\n      let open_default_tag = ''\n      let close_default_tag = ''\n\n      if (default_tag && editor.node.isBlock(deep_parent)) {\n        open_default_tag = `<${default_tag}>`\n        close_default_tag = `</${default_tag}>`\n\n        if (deep_parent.tagName === default_tag.toUpperCase()) {\n          open_default_tag = editor.node.openTagString($(deep_parent).clone().removeAttr('id').get(0))\n        }\n      }\n\n      do {\n        c_node = c_node.parentNode\n\n        // Shift condition.\n        if (!shift || c_node !== deep_parent || shift && !editor.node.isBlock(deep_parent)) {\n          c_str += editor.node.closeTagString(c_node)\n\n          // Open str when there is a block parent.\n          if (c_node === deep_parent && editor.node.isBlock(deep_parent)) {\n            o_str = open_default_tag + o_str\n          }\n          else {\n            const cls = c_node.tagName === 'A' && _isAtEnd(marker, c_node) ? 'fr-to-remove' : ''\n            o_str = editor.node.openTagString($(c_node).clone().addClass(cls).get(0)) + o_str\n          }\n        }\n      } while (c_node !== deep_parent)\n\n      // Add BR if deep parent is block tag.\n      str = c_str + str + o_str + (marker.parentNode === deep_parent && editor.node.isBlock(deep_parent) ? '' : FE.INVISIBLE_SPACE) + FE.MARKERS\n\n      if (editor.node.isBlock(deep_parent) && !$(deep_parent).find('*').last().is('br')) {\n        $(deep_parent).append('<br/>')\n      }\n\n      $(marker).after('<span id=\"fr-break\"></span>')\n      $(marker).remove()\n\n      // Add a BR after to make sure we display the last line.\n      if ((!deep_parent.nextSibling || editor.node.isBlock(deep_parent.nextSibling)) && !editor.node.isBlock(deep_parent)) {\n        $(deep_parent).after('<br>')\n      }\n\n      let html\n\n      // No shift.\n      if (!shift && editor.node.isBlock(deep_parent)) {\n        html = editor.node.openTagString(deep_parent) + $(deep_parent).html() + close_default_tag\n      }\n      else {\n        html = editor.node.openTagString(deep_parent) + $(deep_parent).html() + editor.node.closeTagString(deep_parent)\n      }\n\n      html = html.replace(/<span id=\"fr-break\"><\\/span>/g, str)\n\n      $(deep_parent).replaceWith(html)\n    }\n  }\n\n  /**\n   * Start at the beginning of a block tag.\n   */\n  function _startEnter(marker, shift, quote) {\n    const deep_parent = editor.node.deepestParent(marker, [], !quote)\n    let default_tag\n\n    // https://github.com/froala-labs/froala-editor-js-2/issues/320\n    if (deep_parent && deep_parent.tagName === 'TABLE') {\n      $(deep_parent).find('td, th').first().prepend(marker)\n\n      return _startEnter(marker, shift, quote)\n    }\n\n    if (deep_parent && deep_parent.tagName === 'BLOCKQUOTE') {\n      if (_isAtStart(marker, deep_parent)) {\n        default_tag = editor.html.defaultTag()\n\n        if (default_tag) {\n          $(deep_parent).before(`<${default_tag}>${FE.MARKERS}<br></${default_tag}>`)\n        }\n        else {\n          $(deep_parent).before(`${FE.MARKERS}<br>`)\n        }\n\n        $(marker).remove()\n\n        return false\n      }\n      else if (_isAtEnd(marker, deep_parent)) {\n        _endEnter(marker, shift, true)\n      }\n      else {\n        _middleEnter(marker, shift, true)\n      }\n    }\n\n    // We are right in the main element.\n    if (deep_parent === null) {\n      default_tag = editor.html.defaultTag()\n\n      if (!default_tag || !editor.node.isElement(marker.parentNode)) {\n        $(marker).replaceWith(`<br>${FE.MARKERS}`)\n      }\n      else {\n        $(marker).replaceWith(`<${default_tag}>${FE.MARKERS}<br></${default_tag}>`)\n      }\n    }\n    else {\n      if (editor.node.isBlock(deep_parent)) {\n        if (deep_parent.tagName === 'PRE') {\n          shift = true\n        }\n\n        if (shift) {\n          $(marker).remove()\n          $(deep_parent).prepend(`<br>${FE.MARKERS}`)\n        }\n        else if (editor.node.isEmpty(deep_parent, true)) {\n\n          return _endEnter(marker, shift, quote)\n        }\n        else if (!editor.opts.keepFormatOnDelete) {\n          $(deep_parent).before(`${editor.node.openTagString($(deep_parent).clone().removeAttr('id').get(0))}<br>${editor.node.closeTagString(deep_parent)}`)\n        }\n        else {\n          let tmp = marker\n          let str = FE.INVISIBLE_SPACE\n\n            // Look up to all parents.\n          while (tmp !== deep_parent && !editor.node.isElement(tmp)) {\n            tmp = tmp.parentNode\n            str = editor.node.openTagString(tmp) + str + editor.node.closeTagString(tmp)\n          }\n\n          $(deep_parent).before(str)\n        }\n      }\n      else {\n        $(deep_parent).before('<br>')\n      }\n\n      $(marker).remove()\n    }\n  }\n\n  /**\n   * Enter at the middle of a block tag.\n   */\n  function _middleEnter(marker, shift, quote) {\n    const deep_parent = editor.node.deepestParent(marker, [], !quote)\n\n    // We are right in the main element.\n    if (deep_parent === null) {\n\n      // Default tag is not enter.\n      if (editor.html.defaultTag() && marker.parentNode === editor.el) {\n        $(marker).replaceWith(`<${editor.html.defaultTag()}>${FE.MARKERS}<br></${editor.html.defaultTag()}>`)\n      }\n      else {\n\n        // Add a BR after to make sure we display the last line.\n        if (!marker.nextSibling || editor.node.isBlock(marker.nextSibling)) {\n          $(marker).after('<br>')\n        }\n\n        $(marker).replaceWith(`<br>${FE.MARKERS}`)\n      }\n    }\n\n    // There is a parent.\n    else {\n\n      // Block tag parent.\n      let c_node = marker\n      let str = ''\n\n      if (deep_parent.tagName === 'PRE') {\n        shift = true\n      }\n\n      if (!editor.node.isBlock(deep_parent) || shift) {\n        str = '<br>'\n      }\n\n      let c_str = ''\n      let o_str = ''\n\n      do {\n        const tmp = c_node\n        c_node = c_node.parentNode\n\n        // Move marker after node it if is empty and we are in quote.\n        if (deep_parent.tagName === 'BLOCKQUOTE' && editor.node.isEmpty(tmp) && !editor.node.hasClass(tmp, 'fr-marker')) {\n          if ($(tmp).find(marker).length > 0) {\n            $(tmp).after(marker)\n          }\n        }\n\n        // If not at end or start of element in quote.\n        if (!(deep_parent.tagName === 'BLOCKQUOTE' && (_isAtEnd(marker, c_node) || _isAtStart(marker, c_node)))) {\n\n          // 1. No shift.\n          // 2. c_node is not deep parent.\n          // 3. Shift and deep parent is not block tag.\n          if (!shift || c_node !== deep_parent || shift && !editor.node.isBlock(deep_parent)) {\n            c_str += editor.node.closeTagString(c_node)\n\n            const cls = c_node.tagName === 'A' && _isAtEnd(marker, c_node) ? 'fr-to-remove' : ''\n            o_str = editor.node.openTagString($(c_node).clone().addClass(cls).removeAttr('id').get(0)) + o_str\n          }\n        }\n      } while (c_node !== deep_parent)\n\n      // We should add an invisible space if:\n      // 1. parent node is not deep parent and block tag.\n      // 2. marker has no next sibling.\n      const add =\n        deep_parent === marker.parentNode && editor.node.isBlock(deep_parent) ||\n        marker.nextSibling\n\n\n      if (deep_parent.tagName === 'BLOCKQUOTE') {\n        if (marker.previousSibling && editor.node.isBlock(marker.previousSibling) && marker.nextSibling && marker.nextSibling.tagName === 'BR') {\n          $(marker.nextSibling).after(marker)\n\n          if (marker.nextSibling && marker.nextSibling.tagName === 'BR') {\n            $(marker.nextSibling).remove()\n          }\n        }\n\n        const default_tag = editor.html.defaultTag()\n        str = `${c_str + str + (default_tag ? `<${default_tag}>` : '') + FE.MARKERS}<br>${default_tag ? `</${default_tag}>` : ''}${o_str}`\n      }\n      else {\n        str = c_str + str + o_str + (add ? '' : FE.INVISIBLE_SPACE) + FE.MARKERS\n      }\n\n      $(marker).replaceWith('<span id=\"fr-break\"></span>')\n      let html = editor.node.openTagString(deep_parent) + $(deep_parent).html() + editor.node.closeTagString(deep_parent)\n      html = html.replace(/<span id=\"fr-break\"><\\/span>/g, str)\n\n      $(deep_parent).replaceWith(html)\n    }\n  }\n\n  /**\n   * Do enter.\n   */\n  function enter(shift) {\n    // Add a marker in HTML.\n    const marker = editor.markers.insert()\n\n    if (!marker) {\n      return true\n    }\n\n    editor.el.normalize()\n\n    let quote = false\n\n    if ($(marker).parentsUntil(editor.$el, 'BLOCKQUOTE').length > 0) {\n      shift = false\n      quote = true\n    }\n\n    if ($(marker).parentsUntil(editor.$el, 'TD, TH').length) {\n      quote = false\n    }\n\n    // At the end.\n    if (_atEnd(marker)) {\n\n      // Enter in list.\n      if (_inLi(marker) && !shift && !quote) {\n        editor.cursorLists._endEnter(marker)\n      }\n      else {\n        _endEnter(marker, shift, quote)\n      }\n    }\n\n    // At start.\n    else if (_atStart(marker)) {\n\n      // Enter in list.\n      if (_inLi(marker) && !shift && !quote) {\n        editor.cursorLists._startEnter(marker)\n      }\n      else {\n        _startEnter(marker, shift, quote)\n      }\n    }\n\n    // At middle.\n    else {\n\n      // Enter in list.\n      if (_inLi(marker) && !shift && !quote) {\n        editor.cursorLists._middleEnter(marker)\n      }\n      else {\n        _middleEnter(marker, shift, quote)\n      }\n    }\n\n    _cleanNodesToRemove()\n    editor.html.fillEmptyBlocks(true)\n\n    if (!editor.opts.htmlUntouched) {\n      editor.html.cleanEmptyTags()\n      editor.clean.lists()\n    }\n\n    editor.spaces.normalizeAroundCursor()\n    editor.selection.restore()\n  }\n\n  return {\n    enter,\n    backspace,\n    del,\n    isAtEnd: _isAtEnd,\n    isAtStart: _isAtStart\n  }\n}\n","!function(t){\"use strict\";(t=t&&t.hasOwnProperty(\"default\")?t.default:t).MODULES.data=function(c){var E=\"OB1F1A4D3I1A15A11D3E6B5==\",l=\"NCKB1zwtPA9tqzajXC2c2A7B-16VD3spzJ1C9C3D5oOF2OB1NB1LD7VA5QF4TE3gytXB2A4C-8VA2AC4E1D3GB2EB2KC3KD1MF1juuSB1A8C6yfbmd1B2a1A5qdsdB2tivbC3CB1KC1CH1eLA2sTF1B4I4H-7B-21UB6b1F5bzzzyAB4JC3MG2hjdKC1JE6C1E1cj1pD-16pUE5B4prra2B5ZB3D3C3pxj1EA6A3rnJA2C-7I-7JD9D1E1wYH1F3sTB5TA2G4H4ZA22qZA5BB3mjcvcCC3JB1xillavC-21VE6PC5SI4YC5C8mb1A3WC3BD2B5aoDA2qqAE3A5D-17fOD1D5RD4WC10tE6OAZC3nF-7b1C4A4D3qCF2fgmapcromlHA2QA6a1E1D3e1A6C2bie2F4iddnIA7B2mvnwcIB5OA1DB2OLQA3PB10WC7WC5d1E3uI-7b1D5D6b1E4D2arlAA4EA1F-11srxI-7MB1D7PF1E5B4adB-21YD5vrZH3D3xAC4E1A2GF2CF2J-7yNC2JE1MI2hH-7QB1C6B5B-9bA-7XB13a1B5VievwpKB4LA3NF-10H-9I-8hhaC-16nqPG4wsleTD5zqYF3h1G2B7B4yvGE2Pi1H-7C-21OE6B1uLD1kI4WC1E7C5g1D-8fue1C8C6c1D4D3Hpi1CC4kvGC2E1legallyXB4axVA11rsA4A-9nkdtlmzBA2GD3A13A6CB1dabE1lezrUE6RD5TB4A-7f1C8c1B5d1D4D3tyfCD5C2D2==\",u=function(){for(var t=0,n=document.domain,e=n.split(\".\"),C=\"_gd\"+(new Date).getTime();t<e.length-1&&-1===document.cookie.indexOf(C+\"=\"+C);)n=e.slice(-1-++t).join(\".\"),document.cookie=C+\"=\"+C+\";domain=\"+n+\";\";return document.cookie=C+\"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;domain=\"+n+\";\",(n||\"\").replace(/(^\\.*)|(\\.*$)/g,\"\")}();function d(t){return t}var f=d(function(t){if(!t)return t;for(var n=\"\",e=d(\"charCodeAt\"),C=d(\"fromCharCode\"),A=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\".indexOf(t[0]),B=1;B<t.length-2;B++){for(var r=o(++A),D=t[e](B),i=\"\";/[0-9-]/.test(t[B+1]);)i+=t[++B];D=a(D,r,i=parseInt(i,10)||0),D^=A-1&31,n+=String[C](D)}return n});function o(t){for(var n=t.toString(),e=0,C=0;C<n.length;C++)e+=parseInt(n.charAt(C),10);return 10<e?e%9+1:e}function a(t,n,e){for(var C=Math.abs(e);0<C--;)t-=n;return e<0&&(t+=123),t}function s(t){return!(!t||\"block\"===t.css(\"display\"))&&(t.remove(),!0)}function g(t){return t&&c.$box.contains(t)}var p=void 0,h=void 0,t=0;function v(){if(10<t&&(c[d(f(\"0ppecjvc==\"))](),setTimeout(function(){$.FE=null},10)),!c.$box)return!1;c.$wp.prepend(f(d(f(l)))),p=c.$wp.find(\"> div\").first(),h=p.find(\"> a\"),\"rtl\"===c.opts.direction&&p.css(\"left\",\"auto\").css(\"right\",0).attr(\"direction\",\"rtl\"),t++}function F(t){for(var n=[f(\"9qqG-7amjlwq==\"),f(\"KA3B3C2A6D1D5H5H1A3==\"),f(\"3B9B3B5F3C4G3E3==\"),f(\"QzbzvxyB2yA-9m==\"),f(\"ji1kacwmgG5bc==\"),f(\"nmA-13aogi1A3c1jd==\")],e=0;e<n.length;e++)if(String.prototype.endsWith||(String.prototype.endsWith=function(t,n){return(void 0===n||n>this.length)&&(n=this.length),this.substring(n-t.length,n)===t}),t.endsWith(n[e]))return!0;return!1}return{_init:function(){var t=c.o_win.FEK;try{t=t||localStorage&&localStorage.FEK}catch(t){}t=c.opts.key||t||[\"\"];var n=f(d(\"ziRA1E3B9pA5B-11D-11xg1A3ZB5D1D4B-11ED2EG2pdeoC1clIH4wB-22yQD5uF4YE3E3A9==\"));\"string\"==typeof t&&(t=[t]);for(var e,C,A,B=!(c.ul=!0),r=0,D=0;D<t.length;D++){var i=(C=t[D],3===(A=(f(C)||\"\").split(\"|\")).length?A:[null,null,f(C)||\"\"]),o=i[2];if(o===f(d(f(\"mcVRDoB1BGILD7YFe1BTXBA7B6==\")))||0<=o.indexOf(u,o.length-u.length)||F(u)){if(!((null===(e=i[1])||new Date(e)<new Date(f(E)))&&0<(u||\"\").length)||F(u)){c.ul=!1;break}B=!0,l=\"RCZB17botVG4A-8yzia1C4A5DG3CD2cFB4qflmCE4I2FB1SC7F6PE4WE3RD6e2A4c1D3d1E2E3ehxdGE3CE2IB2LC1HG2LE1QA3QC7B-13cC-9epmkjc1B4e1C4pgjgvkOC5E1eNE1HB2LD2B-13WD5tvabUA5a1A4f1A2G3C2A-21cihKE3FE2DB2cccJE1iC-7G-7tD-17tVD6A-9qC-7QC7a1E4B4je1E3E2G2ecmsAA1xH-8HB11C1D1lgzQA3dTB8od1D4XE3ohb1B4E4D3mbLA10NA7C-21d1genodKC11PD9PE5tA-8UI3ZC5XB5B-11qXF2F-7wtwjAG3NA1IB1OD1HC1RD4QJ4evUF2D5XG2G4XA8pqocH1F3G2J2hcpHC4D1MD4C1MB8PD5klcQD1A8A6e2A3ed1E2A24A7HC5C3qA-9tiA-61dcC3MD1LE1D4SA3A9ZZXSE4g1C3Pa2C5ufbcGI3I2B4skLF2CA1vxB-22wgUC4kdH-8cVB5iwe1A2D3H3G-7DD5JC2ED2OH2JB10D3C2xHE1KA29PB11wdC-11C4cixb2C7a1C4YYE3B2A15uB-21wpCA1MF1NuC-21dyzD6pPG4I-7pmjc1A4yte1F3B-22yvCC3VbC-7qC-22qNE2hC1vH-8zad1RF6WF3DpI-7C8A-16hpf1F3D2ylalB-13BB2lpA-63IB3uOF6D5G4gabC-21UD2A3PH4ZA20B11b2C6ED4A2H3I1A15DB4KD2laC-8LA5B8B7==\",r=i[0]||-1}}var a=new Image;!0===c.ul&&(v(),a.src=B?d(f(n))+\"e=\"+r:d(f(n))+\"u\"),!0===c.ul&&c.events.on(\"contentChanged\",function(){(s(p)||s(h)||g(p)||g(h))&&v()}),c.events.on(\"destroy\",function(){p&&p.length&&p.remove()},!0)}}}}($.FroalaEditor);\n//# sourceMappingURL=data.min.js.map\n","import $ from 'jquery'\nimport FE from 'froala_editor'\n\nFE.MODULES.format = function (editor) {\n  /**\n   * Create open tag string.\n   */\n  function _openTag(tag, attrs) {\n    let str = `<${tag}`\n\n    for (const key in attrs) {\n      if (Object.prototype.hasOwnProperty.call(attrs, key)) {\n        str += ` ${key}=\"${attrs[key]}\"`\n      }\n    }\n\n    str += '>'\n\n    return str\n  }\n\n  /**\n   * Create close tag string.\n   */\n  function _closeTag(tag) {\n    return `</${tag}>`\n  }\n\n  /**\n   * Create query for the current format.\n   */\n  function _query(tag, attrs) {\n    let selector = tag\n\n    for (const key in attrs) {\n      if (Object.prototype.hasOwnProperty.call(attrs, key)) {\n        if (key === 'id') {\n          selector += `#${attrs[key]}`\n        }\n        else if (key === 'class') {\n          selector += `.${attrs[key]}`\n        }\n        else {\n          selector += `[${key}=\"${attrs[key]}\"]`\n        }\n      }\n    }\n\n    return selector\n  }\n\n  /**\n   * Test matching element.\n   */\n  function _matches(el, selector) {\n    if (!el || el.nodeType !== Node.ELEMENT_NODE) {\n      return false\n    }\n\n    return (el.matches || el.matchesSelector || el.msMatchesSelector || el.mozMatchesSelector || el.webkitMatchesSelector || el.oMatchesSelector).call(el, selector)\n  }\n\n  /**\n   * Apply format to the current node till we find a marker.\n   */\n  function _processNodeFormat(start_node, tag, attrs) {\n\n    // No start node.\n    if (!start_node) {\n      return\n    }\n\n    // Skip comments.\n    while (start_node.nodeType === Node.COMMENT_NODE) {\n      start_node = start_node.nextSibling\n    }\n\n    // No start node.\n    if (!start_node) {\n      return\n    }\n\n    // If we are in a block process starting with the first child.\n    if (editor.node.isBlock(start_node) && start_node.tagName !== 'HR') {\n      _processNodeFormat(start_node.firstChild, tag, attrs)\n\n      return false\n    }\n\n    // Create new element.\n    const $span = $(editor.doc.createElement(tag))\n    $span.attr(attrs)\n\n    $span.insertBefore(start_node)\n\n    // Start with the next sibling of the current node.\n    let node = start_node\n\n    // Search while there is a next node.\n    // Next node is not marker.\n    // Next node does not contain marker.\n    // Next node is not an inner list.\n    while (node && !$(node).is('.fr-marker') && $(node).find('.fr-marker').length === 0 && node.tagName !== 'UL' && node.tagName !== 'OL') {\n      const tmp = node\n      node = node.nextSibling\n      $span.append(tmp)\n    }\n\n    // If there is no node left at the right look at parent siblings.\n    if (!node) {\n      let p_node = $span.get(0).parentNode\n\n      while (p_node && !p_node.nextSibling && !editor.node.isElement(p_node)) {\n        p_node = p_node.parentNode\n      }\n\n      if (p_node) {\n        const sibling = p_node.nextSibling\n\n        if (sibling) {\n\n          // Parent sibling is block then look next.\n          if (!editor.node.isBlock(sibling)) {\n            _processNodeFormat(sibling, tag, attrs)\n          }\n          else if (sibling.tagName === 'HR') {\n            _processNodeFormat(sibling.nextSibling, tag, attrs)\n          }\n          else {\n            _processNodeFormat(sibling.firstChild, tag, attrs)\n          }\n        }\n      }\n    }\n\n    // Start processing child nodes if there is a marker or an inner list.\n    else if ($(node).find('.fr-marker').length || node.tagName === 'UL' || node.tagName === 'OL') {\n      _processNodeFormat(node.firstChild, tag, attrs)\n    }\n\n    if ($span.is(':empty')) {\n      $span.remove()\n    }\n  }\n\n  /**\n   * Apply tag format.\n   */\n  function apply(tag, attrs) {\n    let i\n\n    if (typeof attrs === 'undefined') {\n      attrs = {}\n    }\n\n    if (attrs.style) {\n      delete attrs.style\n    }\n\n    // Selection is collapsed.\n    if (editor.selection.isCollapsed()) {\n      editor.markers.insert()\n      const $marker = editor.$el.find('.fr-marker')\n      $marker.replaceWith(_openTag(tag, attrs) + FE.INVISIBLE_SPACE + FE.MARKERS + _closeTag(tag))\n      editor.selection.restore()\n    }\n\n    // Selection is not collapsed.\n    else {\n      editor.selection.save()\n\n      // Check if selection can be deleted.\n      const start_marker = editor.$el.find('.fr-marker[data-type=\"true\"]').get(0).nextSibling\n\n      _processNodeFormat(start_marker, tag, attrs)\n\n      // Clean inner spans.\n      let inner_spans\n\n      do {\n        inner_spans = editor.$el.find(`${_query(tag, attrs)} > ${_query(tag, attrs)}`)\n\n        for (i = 0; i < inner_spans.length; i++) {\n          inner_spans[i].outerHTML = inner_spans[i].innerHTML\n        }\n      } while (inner_spans.length)\n\n      editor.el.normalize()\n\n      // Have markers inside the new tag.\n      const markers = editor.el.querySelectorAll('.fr-marker')\n\n      for (i = 0; i < markers.length; i++) {\n        const $mk = $(markers[i])\n\n        if ($mk.data('type') === true) {\n          if (_matches($mk.get(0).nextSibling, _query(tag, attrs))) {\n            $mk.next().prepend($mk)\n          }\n        }\n        else if (_matches($mk.get(0).previousSibling, _query(tag, attrs))) {\n          $mk.prev().append($mk)\n        }\n      }\n\n      editor.selection.restore()\n    }\n  }\n\n  /**\n   * Split at current node the parents with tag.\n   */\n  function _split($node, tag, attrs, collapsed) {\n    if (!collapsed) {\n      let changed = false\n\n      if ($node.data('type') === true) {\n        while (editor.node.isFirstSibling($node.get(0)) && !$node.parent().is(editor.$el) && !$node.parent().is('ol') && !$node.parent().is('ul')) {\n          $node.parent().before($node)\n          changed = true\n        }\n      }\n      else if ($node.data('type') === false) {\n        while (editor.node.isLastSibling($node.get(0)) && !$node.parent().is(editor.$el) && !$node.parent().is('ol') && !$node.parent().is('ul')) {\n          $node.parent().after($node)\n          changed = true\n        }\n      }\n\n      if (changed) {\n        return true\n      }\n    }\n\n    // Check if current node has parents which match our tag.\n    if ($node.parents(tag).length || typeof tag === 'undefined') {\n\n      let close_str = ''\n      let open_str = ''\n      let $p_node = $node.parent()\n\n      // Do not split when parent is block.\n      if ($p_node.is(editor.$el) || editor.node.isBlock($p_node.get(0))) {\n        return false\n      }\n\n      // Check undefined so that we.\n      while (!editor.node.isBlock($p_node.parent().get(0)) && (typeof tag === 'undefined' || !_matches($p_node.get(0), _query(tag, attrs)))) {\n        close_str += editor.node.closeTagString($p_node.get(0))\n        open_str = editor.node.openTagString($p_node.get(0)) + open_str\n        $p_node = $p_node.parent()\n      }\n\n      // Node STR.\n      const node_str = $node.get(0).outerHTML\n\n      // Replace node with marker.\n      $node.replaceWith('<span id=\"mark\"></span>')\n\n      // Rebuild the HTML for the node.\n      const p_html = $p_node.html().replace(/<span id=\"mark\"><\\/span>/, close_str + editor.node.closeTagString($p_node.get(0)) + open_str + node_str + close_str + editor.node.openTagString($p_node.get(0)) + open_str)\n      $p_node.replaceWith(editor.node.openTagString($p_node.get(0)) + p_html + editor.node.closeTagString($p_node.get(0)))\n\n      return true\n    }\n\n    return false\n  }\n\n  /**\n   * Process node remove.\n   */\n  function _processNodeRemove($node, should_remove, tag, attrs) {\n\n    // Get contents.\n    const contents = editor.node.contents($node.get(0))\n\n    // Loop contents.\n    for (let i = 0; i < contents.length; i++) {\n      const node = contents[i]\n\n      // We found a marker => change should_remove flag.\n      if (editor.node.hasClass(node, 'fr-marker')) {\n        should_remove = (should_remove + 1) % 2\n      }\n\n      // We should remove.\n      else if (should_remove) {\n\n        // Check if we have a marker inside it.\n        if ($(node).find('.fr-marker').length > 0) {\n          should_remove = _processNodeRemove($(node), should_remove, tag, attrs)\n        }\n\n        // Remove everything starting with the most inner nodes which match the current selector.\n        else {\n\n          const nodes = $(node).find(tag || '*:not(a):not(br)')\n\n          for (let j = nodes.length - 1; j >= 0; j--) {\n            const nd = nodes[j]\n\n            if (!editor.node.isBlock(nd) && !editor.node.isVoid(nd) && (typeof tag === 'undefined' || _matches(nd, _query(tag, attrs)))) {\n              if (!editor.node.hasClass(nd, 'fr-clone')) {\n                nd.outerHTML = nd.innerHTML\n              }\n            }\n            else if (editor.node.isBlock(nd) && typeof tag === 'undefined' && node.tagName !== 'TABLE') {\n              editor.node.clearAttributes(nd)\n            }\n          }\n\n          // Check inner nodes.\n          if (typeof tag === 'undefined' && node.nodeType === Node.ELEMENT_NODE && !editor.node.isVoid(node) || _matches(node, _query(tag, attrs))) {\n            if (!editor.node.isBlock(node)) {\n              $(node).replaceWith(node.innerHTML)\n            }\n          }\n\n          // Remove formatting from block nodes.\n          else if (typeof tag === 'undefined' && node.nodeType === Node.ELEMENT_NODE && editor.node.isBlock(node) && node.tagName !== 'TABLE') {\n            editor.node.clearAttributes(node)\n          }\n        }\n      }\n      else {\n\n        // There is a marker.\n        if ($(node).find('.fr-marker').length > 0) {\n          should_remove = _processNodeRemove($(node), should_remove, tag, attrs)\n        }\n      }\n    }\n\n    return should_remove\n  }\n\n  /**\n   * Remove tag.\n   */\n  function remove(tag, attrs) {\n    if (typeof attrs === 'undefined') {\n      attrs = {}\n    }\n\n    if (attrs.style) {\n      delete attrs.style\n    }\n\n    const collapsed = editor.selection.isCollapsed()\n    editor.selection.save()\n\n    // Split at start and end marker.\n    let reassess = true\n\n    while (reassess) {\n      reassess = false\n      const markers = editor.$el.find('.fr-marker')\n\n      for (let i = 0; i < markers.length; i++) {\n        const $marker = $(markers[i])\n        let $clone = null\n\n        if (!$marker.attr('data-cloned') && !collapsed) {\n          $clone = $marker.clone().removeClass('fr-marker').addClass('fr-clone')\n\n          if ($marker.data('type') === true) {\n            $marker.attr('data-cloned', true).after($clone)\n          }\n          else {\n            $marker.attr('data-cloned', true).before($clone)\n          }\n        }\n\n        if (_split($marker, tag, attrs, collapsed)) {\n          reassess = true\n          break\n        }\n      }\n    }\n\n    // Remove format between markers.\n    _processNodeRemove(editor.$el, 0, tag, attrs)\n\n    // Replace markers with their clones.\n    if (!collapsed) {\n      editor.$el.find('.fr-marker').remove()\n      editor.$el.find('.fr-clone').removeClass('fr-clone').addClass('fr-marker')\n    }\n\n    // Selection is collapsed => add invisible spaces.\n    if (collapsed) {\n      editor.$el.find('.fr-marker').before(FE.INVISIBLE_SPACE).after(FE.INVISIBLE_SPACE)\n    }\n\n    editor.html.cleanEmptyTags()\n\n    editor.el.normalize()\n    editor.selection.restore()\n  }\n\n  /**\n   * Toggle format.\n   */\n  function toggle(tag, attrs) {\n    if (is(tag, attrs)) {\n      remove(tag, attrs)\n    }\n    else {\n      apply(tag, attrs)\n    }\n  }\n\n  /**\n   * Clean format.\n   */\n  function _cleanFormat(elem, prop) {\n    const $elem = $(elem)\n    $elem.css(prop, '')\n\n    if ($elem.attr('style') === '') {\n      $elem.replaceWith($elem.html())\n    }\n  }\n\n  /**\n   * Filter spans with specific property.\n   */\n  function _filterSpans(elem, prop) {\n    return $(elem).attr('style').indexOf(`${prop}:`) === 0 || $(elem).attr('style').indexOf(`;${prop}:`) >= 0 || $(elem).attr('style').indexOf(`; ${prop}:`) >= 0\n  }\n\n  /**\n   * Apply inline style.\n   */\n  function applyStyle(prop, val) {\n\n    let i\n    let $marker\n    let $span = null\n\n    // Selection is collapsed.\n    if (editor.selection.isCollapsed()) {\n      editor.markers.insert()\n      $marker = editor.$el.find('.fr-marker')\n      const $parent = $marker.parent()\n\n      // https://github.com/froala/wysiwyg-editor/issues/1084\n      if (editor.node.openTagString($parent.get(0)) === `<span style=\"${prop}: ${$parent.css(prop)};\">`) {\n        if (editor.node.isEmpty($parent.get(0))) {\n          $span = $(editor.doc.createElement('span')).attr('style', `${prop}: ${val};`).html(`${FE.INVISIBLE_SPACE}${FE.MARKERS}`)\n          $parent.replaceWith($span)\n        }\n\n        // We should get out of the current span with the same props.\n        else {\n          const x = {}\n          x['style*'] = `${prop}:`\n          _split($marker, 'span', x, true)\n          $marker = editor.$el.find('.fr-marker')\n\n          if (val) {\n            $span = $(editor.doc.createElement('span')).attr('style', `${prop}: ${val};`).html(`${FE.INVISIBLE_SPACE}${FE.MARKERS}`)\n            $marker.replaceWith($span)\n          }\n          else {\n            $marker.replaceWith(FE.INVISIBLE_SPACE + FE.MARKERS)\n          }\n        }\n\n        editor.html.cleanEmptyTags()\n      }\n      else if (editor.node.isEmpty($parent.get(0)) && $parent.is('span')) {\n        $marker.replaceWith(FE.MARKERS)\n        $parent.css(prop, val)\n      }\n      else {\n        $span = $(`<span style=\"${prop}: ${val};\">${FE.INVISIBLE_SPACE}${FE.MARKERS}</span>`)\n        $marker.replaceWith($span)\n      }\n\n      // If we have a span, then split the parent nodes.\n      if ($span) {\n        _splitParents($span, prop, val)\n      }\n    }\n    else {\n      editor.selection.save()\n\n      // When removing selection we should make sure we have selection outside of the first/last parent node.\n      // We also need to do this for U tags.\n      if (val === null || prop === 'color' && editor.$el.find('.fr-marker').parents('u, a').length > 0) {\n        const markers = editor.$el.find('.fr-marker')\n\n        for (i = 0; i < markers.length; i++) {\n          $marker = $(markers[i])\n\n          if ($marker.data('type') === true) {\n            while (editor.node.isFirstSibling($marker.get(0)) && !$marker.parent().is(editor.$el) && !editor.node.isElement($marker.parent().get(0)) && !editor.node.isBlock($marker.parent().get(0))) {\n              $marker.parent().before($marker)\n            }\n          }\n          else {\n            while (editor.node.isLastSibling($marker.get(0)) && !$marker.parent().is(editor.$el) && !editor.node.isElement($marker.parent().get(0)) && !editor.node.isBlock($marker.parent().get(0))) {\n              $marker.parent().after($marker)\n            }\n          }\n        }\n      }\n\n      // Check if selection can be deleted.\n      const start_marker = editor.$el.find('.fr-marker[data-type=\"true\"]').get(0).nextSibling\n\n      const attrs = {\n        class: 'fr-unprocessed'\n      }\n\n      if (val) {\n        attrs.style = `${prop}: ${val};`\n      }\n      _processNodeFormat(start_marker, 'span', attrs)\n\n      editor.$el.find('.fr-marker + .fr-unprocessed').each(function () {\n        $(this).prepend($(this).prev())\n      })\n\n      editor.$el.find('.fr-unprocessed + .fr-marker').each(function () {\n        $(this).prev().append(this)\n      })\n\n      // When em are being used keep them as the most inner props.\n      if ((val || '').match(/\\dem$/)) {\n        editor.$el.find('span.fr-unprocessed').removeClass('fr-unprocessed')\n      }\n\n      while (editor.$el.find('span.fr-unprocessed').length > 0) {\n        $span = editor.$el.find('span.fr-unprocessed').first().removeClass('fr-unprocessed')\n\n        // Look at parent node to see if we can merge with it.\n        $span.parent().get(0).normalize()\n\n        if ($span.parent().is('span') && $span.parent().get(0).childNodes.length === 1) {\n          $span.parent().css(prop, val)\n          const $child = $span\n          $span = $span.parent()\n          $child.replaceWith($child.html())\n        }\n\n        // Replace in reverse order to take care of the inner spans first.\n        const inner_spans = $span.find('span')\n\n        for (i = inner_spans.length - 1; i >= 0; i--) {\n          _cleanFormat(inner_spans[i], prop)\n        }\n\n        // Split parent nodes.\n        _splitParents($span, prop, val)\n      }\n    }\n\n    _normalize()\n  }\n\n  function _splitParents($span, prop, val) {\n    let i\n\n    // Look at parents with the same property.\n    let $outer_span = $span.parentsUntil(editor.$el, 'span[style]')\n    const to_remove = []\n\n    for (i = $outer_span.length - 1; i >= 0; i--) {\n      if (!_filterSpans($outer_span[i], prop)) {\n        to_remove.push($outer_span[i])\n      }\n    }\n\n    $outer_span = $outer_span.not(to_remove)\n\n    if ($outer_span.length) {\n      let c_str = ''\n      let o_str = ''\n      let ic_str = ''\n      let io_str = ''\n      let c_node = $span.get(0)\n\n      do {\n        c_node = c_node.parentNode\n\n        $(c_node).addClass('fr-split')\n\n        c_str += editor.node.closeTagString(c_node)\n        o_str = editor.node.openTagString($(c_node).clone().addClass('fr-split').get(0)) + o_str\n\n        // Inner close and open.\n        if ($outer_span.get(0) !== c_node) {\n          ic_str += editor.node.closeTagString(c_node)\n          io_str = editor.node.openTagString($(c_node).clone().addClass('fr-split').get(0)) + io_str\n        }\n      } while ($outer_span.get(0) !== c_node)\n\n      // Build breaking string.\n      const str = `${c_str + editor.node.openTagString($($outer_span.get(0)).clone().css(prop, val || '').get(0)) + io_str + $span.css(prop, '').get(0).outerHTML + ic_str}</span>${o_str}`\n      $span.replaceWith('<span id=\"fr-break\"></span>')\n      const html = $outer_span.get(0).outerHTML\n\n      // Replace the outer node.\n      $($outer_span.get(0)).replaceWith(html.replace(/<span id=\"fr-break\"><\\/span>/g, str))\n    }\n  }\n\n  function _normalize() {\n    let i\n\n    while (editor.$el.find('.fr-split:empty').length > 0) {\n      editor.$el.find('.fr-split:empty').remove()\n    }\n\n    editor.$el.find('.fr-split').removeClass('fr-split')\n\n    editor.$el.find('[style=\"\"]').removeAttr('style')\n    editor.$el.find('[class=\"\"]').removeAttr('class')\n\n    editor.html.cleanEmptyTags()\n\n    const $spans = editor.$el.find('span')\n    for (let k = $spans.length - 1; k >= 0; k--) {\n      const msp = $spans[k]\n\n      if (!msp.attributes || msp.attributes.length === 0) {\n        $(msp).replaceWith(msp.innerHTML)\n      }\n    }\n\n    editor.el.normalize()\n\n    // Join current spans together if they are one next to each other.\n    const just_spans = editor.$el.find('span[style] + span[style]')\n\n    for (i = 0; i < just_spans.length; i++) {\n      const $x = $(just_spans[i])\n      const $p = $(just_spans[i]).prev()\n\n      if ($x.get(0).previousSibling === $p.get(0) && editor.node.openTagString($x.get(0)) === editor.node.openTagString($p.get(0))) {\n        $x.prepend($p.html())\n        $p.remove()\n      }\n    }\n\n    // Check if we have span(font-size) inside span(background-color).\n    // Then, make a split.\n    editor.$el.find('span[style] span[style]').each(function () {\n      if ($(this).attr('style').indexOf('font-size') >= 0) {\n        const $parent = $(this).parents('span[style]')\n\n        if ($parent.attr('style').indexOf('background-color') >= 0) {\n          $(this).attr('style', `${$(this).attr('style')};${$parent.attr('style')}`)\n          _split($(this), 'span[style]', {}, false)\n        }\n      }\n    })\n\n    editor.el.normalize()\n    editor.selection.restore()\n  }\n\n  /**\n   * Remove inline style.\n   */\n  function removeStyle(prop) {\n    applyStyle(prop, null)\n  }\n\n  /**\n   * Get the current state.\n   */\n  function is(tag, attrs) {\n    if (typeof attrs === 'undefined') {\n      attrs = {}\n    }\n\n    if (attrs.style) {\n      delete attrs.style\n    }\n\n    const range = editor.selection.ranges(0)\n    let el = range.startContainer\n\n    if (el.nodeType === Node.ELEMENT_NODE) {\n\n      // Search for node deeper.\n      if (el.childNodes.length > 0 && el.childNodes[range.startOffset]) {\n        el = el.childNodes[range.startOffset]\n      }\n    }\n\n    // If we are at the end of text node, then check next elements.\n    if (!range.collapsed && el.nodeType === Node.TEXT_NODE && range.startOffset === (el.textContent || '').length) {\n      while (!editor.node.isBlock(el.parentNode) && !el.nextSibling) {\n        el = el.parentNode\n      }\n\n      if (el.nextSibling) {\n        el = el.nextSibling\n      }\n    }\n\n\n    // Check first childs.\n    let f_child = el\n\n    while (f_child && f_child.nodeType === Node.ELEMENT_NODE && !_matches(f_child, _query(tag, attrs))) {\n      f_child = f_child.firstChild\n    }\n\n    if (f_child && f_child.nodeType === Node.ELEMENT_NODE && _matches(f_child, _query(tag, attrs))) {\n      return true\n    }\n\n\n    // Check parents.\n    let p_node = el\n\n    if (p_node && p_node.nodeType !== Node.ELEMENT_NODE) {\n      p_node = p_node.parentNode\n    }\n\n    while (p_node && p_node.nodeType === Node.ELEMENT_NODE && p_node !== editor.el && !_matches(p_node, _query(tag, attrs))) {\n      p_node = p_node.parentNode\n    }\n\n    if (p_node && p_node.nodeType === Node.ELEMENT_NODE && p_node !== editor.el && _matches(p_node, _query(tag, attrs))) {\n      return true\n    }\n\n    return false\n  }\n\n  return {\n    is,\n    toggle,\n    apply,\n    remove,\n    applyStyle,\n    removeStyle\n  }\n}\n","import $ from 'jquery'\nimport FE from 'froala_editor'\n\n// Enter possible actions.\nFE.ENTER_P = 0\nFE.ENTER_DIV = 1\nFE.ENTER_BR = 2\n\nFE.KEYCODE = {\n  BACKSPACE: 8,\n  TAB: 9,\n  ENTER: 13,\n  SHIFT: 16,\n  CTRL: 17,\n  ALT: 18,\n  ESC: 27,\n  SPACE: 32,\n  ARROW_LEFT: 37,\n  ARROW_UP: 38,\n  ARROW_RIGHT: 39,\n  ARROW_DOWN: 40,\n  DELETE: 46,\n  ZERO: 48,\n  ONE: 49,\n  TWO: 50,\n  THREE: 51,\n  FOUR: 52,\n  FIVE: 53,\n  SIX: 54,\n  SEVEN: 55,\n  EIGHT: 56,\n  NINE: 57,\n  FF_SEMICOLON: 59, // Firefox (Gecko) fires this for semicolon instead of 186\n  FF_EQUALS: 61, // Firefox (Gecko) fires this for equals instead of 187\n  QUESTION_MARK: 63, // needs localization\n  A: 65,\n  B: 66,\n  C: 67,\n  D: 68,\n  E: 69,\n  F: 70,\n  G: 71,\n  H: 72,\n  I: 73,\n  J: 74,\n  K: 75,\n  L: 76,\n  M: 77,\n  N: 78,\n  O: 79,\n  P: 80,\n  Q: 81,\n  R: 82,\n  S: 83,\n  T: 84,\n  U: 85,\n  V: 86,\n  W: 87,\n  X: 88,\n  Y: 89,\n  Z: 90,\n  META: 91,\n  NUM_ZERO: 96,\n  NUM_ONE: 97,\n  NUM_TWO: 98,\n  NUM_THREE: 99,\n  NUM_FOUR: 100,\n  NUM_FIVE: 101,\n  NUM_SIX: 102,\n  NUM_SEVEN: 103,\n  NUM_EIGHT: 104,\n  NUM_NINE: 105,\n  NUM_MULTIPLY: 106,\n  NUM_PLUS: 107,\n  NUM_MINUS: 109,\n  NUM_PERIOD: 110,\n  NUM_DIVISION: 111,\n\n  F1: 112,\n  F2: 113,\n  F3: 114,\n  F4: 115,\n  F5: 116,\n  F6: 117,\n  F7: 118,\n  F8: 119,\n  F9: 120,\n  F10: 121,\n  F11: 122,\n  F12: 123,\n\n  FF_HYPHEN: 173, // Firefox (Gecko) fires this for hyphen instead of 189s\n  SEMICOLON: 186, // needs localization\n  DASH: 189, // needs localization\n  EQUALS: 187, // needs localization\n  COMMA: 188, // needs localization\n  HYPHEN: 189, // needs localization\n  PERIOD: 190, // needs localization\n  SLASH: 191, // needs localization\n  APOSTROPHE: 192, // needs localization\n  TILDE: 192, // needs localization\n  SINGLE_QUOTE: 222, // needs localization\n  OPEN_SQUARE_BRACKET: 219, // needs localization\n  BACKSLASH: 220, // needs localization\n  CLOSE_SQUARE_BRACKET: 221, // needs localization\n\n  IME: 229\n}\n\n// Extend defaults.\nObject.assign(FE.DEFAULTS, {\n  enter: FE.ENTER_P,\n  multiLine: true,\n  tabSpaces: 0\n})\n\nFE.MODULES.keys = function (editor) {\n  let IME = false\n\n  /**\n   * ENTER.\n   */\n  function _enter(e) {\n    if (!editor.opts.multiLine) {\n      e.preventDefault()\n      e.stopPropagation()\n    }\n\n    // Not iOS.\n    else {\n\n      // Do not prevent default on IOS.\n      if (!editor.helpers.isIOS()) {\n        e.preventDefault()\n        e.stopPropagation()\n      }\n\n      if (!editor.selection.isCollapsed()) {\n        editor.selection.remove()\n      }\n\n      editor.cursor.enter()\n    }\n  }\n\n  /**\n   * SHIFT ENTER.\n   */\n  function _shiftEnter(e) {\n    e.preventDefault()\n    e.stopPropagation()\n\n    if (editor.opts.multiLine) {\n      if (!editor.selection.isCollapsed()) {\n        editor.selection.remove()\n      }\n\n      editor.cursor.enter(true)\n    }\n  }\n  /**\n   * Control/Command Backspace.\n   */\n  function _ctlBackspace() {\n\n    setTimeout(() => {\n      editor.events.disableBlur()\n      editor.events.focus()\n    }, 0)\n  }\n\n  /**\n   * BACKSPACE.\n   */\n  function _backspace(e) {\n    // There is no selection.\n    if (editor.selection.isCollapsed()) {\n      editor.cursor.backspace()\n\n      if (editor.helpers.isIOS()) {\n        const range = editor.selection.ranges(0)\n        range.deleteContents()\n        range.insertNode(document.createTextNode('\\u200B'))\n\n        const sel = editor.selection.get()\n        sel.modify('move', 'forward', 'character')\n      }\n      else {\n        e.preventDefault()\n        e.stopPropagation()\n      }\n    }\n\n    // We have text selected.\n    else {\n      e.preventDefault()\n      e.stopPropagation()\n\n      editor.selection.remove()\n    }\n\n    editor.placeholder.refresh()\n  }\n\n  /**\n   * DELETE\n   */\n  function _del(e) {\n    e.preventDefault()\n    e.stopPropagation()\n\n    // There is no selection.\n    if (editor.selection.text() === '') {\n      editor.cursor.del()\n    }\n\n    // We have text selected.\n    else {\n      editor.selection.remove()\n    }\n\n    editor.placeholder.refresh()\n  }\n\n  /**\n   * SPACE\n   */\n  function _space(e) {\n    const el = editor.selection.element()\n\n    // Do nothing on mobile.\n    // Browser is Mozilla or we're inside a link tag.\n    if (!editor.helpers.isMobile() && (el && el.tagName === 'A')) {\n      e.preventDefault()\n      e.stopPropagation()\n\n      if (!editor.selection.isCollapsed()) {\n        editor.selection.remove()\n      }\n      const marker = editor.markers.insert()\n\n      if (marker) {\n        const prev_node = marker.previousSibling\n        const next_node = marker.nextSibling\n\n        if (!next_node && marker.parentNode && marker.parentNode.tagName === 'A') {\n          marker.parentNode.insertAdjacentHTML('afterend', `&nbsp;${FE.MARKERS}`)\n          marker.parentNode.removeChild(marker)\n        }\n        else {\n          if (prev_node && prev_node.nodeType === Node.TEXT_NODE && prev_node.textContent.length === 1 && prev_node.textContent.charCodeAt(0) === 160) {\n            prev_node.textContent += ' '\n          }\n          else {\n            marker.insertAdjacentHTML('beforebegin', '&nbsp;')\n          }\n\n          marker.outerHTML = FE.MARKERS\n        }\n\n        editor.selection.restore()\n      }\n    }\n  }\n\n  /**\n   * Handle typing in Korean for FF.\n   */\n  function _input() {\n\n    // Select is collapsed and we're not using IME.\n    if (editor.browser.mozilla && editor.selection.isCollapsed() && !IME) {\n      const range = editor.selection.ranges(0)\n      const start_container = range.startContainer\n      const start_offset = range.startOffset\n\n      // Start container is text and last char before cursor is space.\n      if (start_container && start_container.nodeType === Node.TEXT_NODE && start_offset <= start_container.textContent.length && start_offset > 0 && start_container.textContent.charCodeAt(start_offset - 1) === 32) {\n        editor.selection.save()\n        editor.spaces.normalize()\n        editor.selection.restore()\n      }\n    }\n  }\n\n  /**\n   * Cut.\n   */\n  function _cut() {\n    if (editor.selection.isFull()) {\n      setTimeout(() => {\n        const default_tag = editor.html.defaultTag()\n\n        if (default_tag) {\n          editor.$el.html(`<${default_tag}>${FE.MARKERS}<br/></${default_tag}>`)\n        }\n        else {\n          editor.$el.html(`${FE.MARKERS}<br/>`)\n        }\n        editor.selection.restore()\n\n        editor.placeholder.refresh()\n        editor.button.bulkRefresh()\n        editor.undo.saveStep()\n      }, 0)\n    }\n  }\n\n  /**\n   * Tab.\n   */\n  function _tab(e) {\n    if (editor.opts.tabSpaces > 0) {\n      if (editor.selection.isCollapsed()) {\n        editor.undo.saveStep()\n\n        e.preventDefault()\n        e.stopPropagation()\n\n        let str = ''\n\n        for (let i = 0; i < editor.opts.tabSpaces; i++) {\n          str += '&nbsp;'\n        }\n        editor.html.insert(str)\n        editor.placeholder.refresh()\n\n        editor.undo.saveStep()\n      }\n      else {\n        e.preventDefault()\n        e.stopPropagation()\n\n        if (!e.shiftKey) {\n          editor.commands.indent()\n        }\n        else {\n          editor.commands.outdent()\n        }\n      }\n    }\n  }\n\n  /**\n   * Map keyPress actions.\n   */\n  function _mapKeyPress() {\n    IME = false\n  }\n\n  function _clearIME() {\n    IME = false\n  }\n\n  /**\n   * If is IME.\n   */\n  function isIME() {\n    return IME\n  }\n\n  let key_down_code\n\n  function _empty() {\n    const default_tag = editor.html.defaultTag()\n\n    if (default_tag) {\n      editor.$el.html(`<${default_tag}>${FE.MARKERS}<br/></${default_tag}>`)\n    }\n    else {\n      editor.$el.html(`${FE.MARKERS}<br/>`)\n    }\n\n    editor.selection.restore()\n  }\n\n  /**\n   * Map keyDown actions.\n   */\n  function _mapKeyDown(e) {\n    const sel_el = editor.selection.element()\n\n    if (sel_el && ['INPUT', 'TEXTAREA'].indexOf(sel_el.tagName) >= 0) {\n      return true\n    }\n\n    if (e && isArrow(e.which)) {\n      return true\n    }\n\n    editor.events.disableBlur()\n\n    const key_code = e.which\n\n    if (key_code === 16) {\n      return true\n    }\n\n    key_down_code = key_code\n\n    // Handle Japanese typing.\n    if (key_code === FE.KEYCODE.IME) {\n      IME = true\n\n      return true\n    }\n\n    IME = false\n\n\n    const char_key = isCharacter(key_code) && !ctrlKey(e) && !e.altKey\n    const del_key = key_code === FE.KEYCODE.BACKSPACE || key_code === FE.KEYCODE.DELETE\n\n    // 1. Selection is full.\n    // 2. Del key is hit, editor is empty and there is keepFormatOnDelete.\n    if (editor.selection.isFull() && !editor.opts.keepFormatOnDelete && !editor.placeholder.isVisible() || del_key && editor.placeholder.isVisible() && editor.opts.keepFormatOnDelete) {\n      if (char_key || del_key) {\n        _empty()\n\n        if (!isCharacter(key_code)) {\n          e.preventDefault()\n\n          return true\n        }\n      }\n    }\n\n    // ENTER.\n    if (key_code === FE.KEYCODE.ENTER) {\n      if (e.shiftKey) {\n        _shiftEnter(e)\n      }\n      else {\n        _enter(e)\n      }\n    }\n\n    // Ctrl/Command Backspace.\n    else if (key_code === FE.KEYCODE.BACKSPACE && (e.metaKey || e.ctrlKey)) {\n      _ctlBackspace()\n    }\n\n    // Backspace.\n    else if (key_code === FE.KEYCODE.BACKSPACE && !ctrlKey(e) && !e.altKey) {\n      if (!editor.placeholder.isVisible()) {\n        _backspace(e)\n      }\n      else {\n        if (!editor.opts.keepFormatOnDelete) {\n          _empty()\n        }\n\n        e.preventDefault()\n        e.stopPropagation()\n      }\n    }\n\n    // Delete.\n    else if (key_code === FE.KEYCODE.DELETE && !ctrlKey(e) && !e.altKey && !e.shiftKey) {\n      if (!editor.placeholder.isVisible()) {\n        _del(e)\n      }\n      else {\n        if (!editor.opts.keepFormatOnDelete) {\n          _empty()\n        }\n\n        e.preventDefault()\n        e.stopPropagation()\n      }\n    }\n\n    // Space.\n    else if (key_code === FE.KEYCODE.SPACE) {\n      _space(e)\n    }\n\n    // Tab.\n    else if (key_code === FE.KEYCODE.TAB) {\n      _tab(e)\n    }\n\n    // Char key.\n    else if (!ctrlKey(e) && isCharacter(e.which) && !editor.selection.isCollapsed() && !e.ctrlKey) {\n      editor.selection.remove()\n    }\n\n    editor.events.enableBlur()\n  }\n\n  /**\n   * Remove U200B.\n   */\n  function _replaceU200B(el) {\n    const walker = editor.doc.createTreeWalker(el, NodeFilter.SHOW_TEXT, editor.node.filter((node) => /\\u200B/gi.test(node.textContent)), false)\n\n    while (walker.nextNode()) {\n      const node = walker.currentNode\n\n      node.textContent = node.textContent.replace(/\\u200B/gi, '')\n    }\n  }\n\n  function positionCaret() {\n    if (!editor.$wp) {\n      return true\n    }\n\n    let info\n\n    if (!editor.opts.height && !editor.opts.heightMax) {\n\n      // Make sure we scroll bottom.\n      info = editor.position.getBoundingRect()\n        .top\n\n      // https://github.com/froala/wysiwyg-editor/issues/834.\n      if (editor.opts.toolbarBottom) {\n        info += editor.opts.toolbarStickyOffset\n      }\n\n      if (editor.helpers.isIOS() || editor.helpers.isAndroid()) {\n        info -= editor.helpers.scrollTop()\n      }\n\n      if (editor.opts.iframe) {\n        info += editor.$iframe.offset()\n          .top\n\n        // https://github.com/froala-labs/froala-editor-js-2/issues/432 . getBoundingRect will return different results in iframe because the viewport.\n        info -= editor.helpers.scrollTop()\n      }\n\n      info += editor.opts.toolbarStickyOffset\n\n      if (info > editor.o_win.innerHeight - 20) {\n        $(editor.o_win)\n          .scrollTop(info + editor.helpers.scrollTop() - editor.o_win.innerHeight + 20)\n      }\n\n      // Make sure we scroll top.\n      info = editor.position.getBoundingRect()\n        .top\n\n      // https://github.com/froala/wysiwyg-editor/issues/834.\n      if (!editor.opts.toolbarBottom) {\n        info -= editor.opts.toolbarStickyOffset\n      }\n\n      if (editor.helpers.isIOS() || editor.helpers.isAndroid()) {\n        info -= editor.helpers.scrollTop()\n      }\n\n      if (editor.opts.iframe) {\n        info += editor.$iframe.offset()\n          .top\n\n        // https://github.com/froala-labs/froala-editor-js-2/issues/432 . getBoundingRect will return different results in iframe because the viewport.\n        info -= editor.helpers.scrollTop()\n      }\n\n      if (info < editor.$tb.height() + 20) {\n        $(editor.o_win)\n          .scrollTop(info + editor.helpers.scrollTop() - editor.$tb.height() - 20)\n      }\n    }\n    else {\n\n      // Make sure we scroll bottom.\n      info = editor.position.getBoundingRect()\n        .top\n\n      if (editor.helpers.isIOS() || editor.helpers.isAndroid()) {\n        info -= editor.helpers.scrollTop()\n      }\n\n      if (editor.opts.iframe) {\n        info += editor.$iframe.offset()\n          .top\n      }\n\n      if (info > editor.$wp.offset()\n        .top - editor.helpers.scrollTop() + editor.$wp.height() - 20) {\n        editor.$wp.scrollTop(info + editor.$wp.scrollTop() - (editor.$wp.height() + editor.$wp.offset()\n          .top) + editor.helpers.scrollTop() + 20)\n      }\n    }\n  }\n\n  /**\n   * Map keyUp actions.\n   */\n  function _mapKeyUp(e) {\n    const sel_el = editor.selection.element()\n\n    if (sel_el && ['INPUT', 'TEXTAREA'].indexOf(sel_el.tagName) >= 0) {\n      return true\n    }\n\n    // When using iOS soft keyboard, in keyup we get 0 for keycode,\n    // therefore, we are using the one we got on keydown.\n    if (e && e.which === 0 && key_down_code) {\n      e.which = key_down_code\n    }\n\n    if (editor.helpers.isAndroid() && editor.browser.mozilla) {\n\n      return true\n    }\n\n    // IME IE.\n    if (IME) {\n      return false\n    }\n\n    // Revert ios default ENTER.\n    if (e && editor.helpers.isIOS() && e.which === FE.KEYCODE.ENTER) {\n      editor.doc.execCommand('delete')\n    }\n\n    if (!editor.selection.isCollapsed()) {\n      return true\n    }\n\n    if (e && (e.which === FE.KEYCODE.META || e.which === FE.KEYCODE.CTRL)) {\n      return true\n    }\n\n    if (e && isArrow(e.which)) {\n      return true\n    }\n\n    if (e && !editor.helpers.isIOS() && (e.which === FE.KEYCODE.ENTER || e.which === FE.KEYCODE.BACKSPACE || e.which >= 37 && e.which <= 40 && !editor.browser.msie)) {\n      positionCaret()\n    }\n\n    // Remove invisible space where possible.\n    function has_invisible(node) {\n      if (!node) {\n        return false\n      }\n\n      let text = node.innerHTML\n      text = text.replace(/<span[^>]*? class\\s*=\\s*[\"']?fr-marker[\"']?[^>]+>\\u200b<\\/span>/gi, '')\n\n      if (text && /\\u200B/.test(text) && text.replace(/\\u200B/gi, '')\n        .length > 0) {\n        return true\n      }\n\n      return false\n    }\n\n    function ios_CJK(el) {\n      const CJKRegEx = /[\\u3041-\\u3096\\u30A0-\\u30FF\\u4E00-\\u9FFF\\u3130-\\u318F\\uAC00-\\uD7AF]/gi\n\n      return !editor.helpers.isIOS() || ((el.textContent || '')\n          .match(CJKRegEx) || [])\n        .length === 0\n    }\n\n    // Get the selection element.\n    const el = editor.selection.element()\n\n    if (has_invisible(el) && !editor.node.hasClass(el, 'fr-marker') && el.tagName !== 'IFRAME' && ios_CJK(el)) {\n      editor.selection.save()\n      _replaceU200B(el)\n      editor.selection.restore()\n    }\n  }\n\n  // Check if we should consider that CTRL key is pressed.\n  function ctrlKey(e) {\n    if (navigator.userAgent.indexOf('Mac OS X') !== -1) {\n      if (e.metaKey && !e.altKey) {\n        return true\n      }\n    }\n    else if (e.ctrlKey && !e.altKey) {\n      return true\n    }\n\n    return false\n  }\n\n  function isArrow(key_code) {\n    if (key_code >= FE.KEYCODE.ARROW_LEFT && key_code <= FE.KEYCODE.ARROW_DOWN) {\n\n      return true\n    }\n  }\n\n  function isCharacter(key_code) {\n    if (key_code >= FE.KEYCODE.ZERO &&\n      key_code <= FE.KEYCODE.NINE) {\n\n      return true\n    }\n\n    if (key_code >= FE.KEYCODE.NUM_ZERO &&\n      key_code <= FE.KEYCODE.NUM_MULTIPLY) {\n\n      return true\n    }\n\n    if (key_code >= FE.KEYCODE.A &&\n      key_code <= FE.KEYCODE.Z) {\n\n      return true\n    }\n\n    // Safari sends zero key code for non-latin characters.\n    if (editor.browser.webkit && key_code === 0) {\n\n      return true\n    }\n\n    switch (key_code) {\n      case FE.KEYCODE.SPACE:\n      case FE.KEYCODE.QUESTION_MARK:\n      case FE.KEYCODE.NUM_PLUS:\n      case FE.KEYCODE.NUM_MINUS:\n      case FE.KEYCODE.NUM_PERIOD:\n      case FE.KEYCODE.NUM_DIVISION:\n      case FE.KEYCODE.SEMICOLON:\n      case FE.KEYCODE.FF_SEMICOLON:\n      case FE.KEYCODE.DASH:\n      case FE.KEYCODE.EQUALS:\n      case FE.KEYCODE.FF_EQUALS:\n      case FE.KEYCODE.COMMA:\n      case FE.KEYCODE.PERIOD:\n      case FE.KEYCODE.SLASH:\n      case FE.KEYCODE.APOSTROPHE:\n      case FE.KEYCODE.SINGLE_QUOTE:\n      case FE.KEYCODE.OPEN_SQUARE_BRACKET:\n      case FE.KEYCODE.BACKSLASH:\n      case FE.KEYCODE.CLOSE_SQUARE_BRACKET:\n\n        return true\n      default:\n\n        return false\n    }\n\n  }\n\n  let _typing_timeout\n  let _temp_snapshot\n\n  function _typingKeyDown(e) {\n    const keycode = e.which\n\n    if (ctrlKey(e) || keycode >= 37 && keycode <= 40 || !isCharacter(keycode) && keycode !== FE.KEYCODE.DELETE && keycode !== FE.KEYCODE.BACKSPACE && keycode !== FE.KEYCODE.ENTER && keycode !== FE.KEYCODE.IME) {\n      return true\n    }\n\n    if (!_typing_timeout) {\n      _temp_snapshot = editor.snapshot.get()\n\n      if (!editor.undo.canDo()) {\n        editor.undo.saveStep()\n      }\n    }\n\n    clearTimeout(_typing_timeout)\n    _typing_timeout = setTimeout(() => {\n      _typing_timeout = null\n      editor.undo.saveStep()\n    }, Math.max(250, editor.opts.typingTimer))\n  }\n\n  function _typingKeyUp(e) {\n    const keycode = e.which\n\n    if (ctrlKey(e) || keycode >= 37 && keycode <= 40) {\n      return true\n    }\n\n    if (_temp_snapshot && _typing_timeout) {\n      editor.undo.saveStep(_temp_snapshot)\n      _temp_snapshot = null\n    }\n\n    // iOS choosing suggestion.\n    else if ((typeof keycode === 'undefined' || keycode === 0) && !_temp_snapshot && !_typing_timeout) {\n      editor.undo.saveStep()\n    }\n  }\n\n  function forceUndo() {\n    if (_typing_timeout) {\n      clearTimeout(_typing_timeout)\n      editor.undo.saveStep()\n      _temp_snapshot = null\n    }\n  }\n\n  /**\n   * Check if key event is part of browser accessibility.\n   */\n  function isBrowserAction(e) {\n    const keycode = e.which\n\n    return ctrlKey(e) || keycode === FE.KEYCODE.F5\n  }\n\n  // Node doesn't have a BR or text inside it.\n  function _isEmpty(node) {\n    if (node && node.tagName === 'BR') {\n      return false\n    }\n\n    // No text and no BR.\n    // Special case for image caption / video.\n    try {\n      return (node.textContent || '').length === 0 && node.querySelector && !node.querySelector(':scope > br') ||\n        node.childNodes && node.childNodes.length === 1 && node.childNodes[0].getAttribute && (node.childNodes[0].getAttribute('contenteditable') === 'false' || editor.node.hasClass(node.childNodes[0], 'fr-img-caption'))\n    }\n    catch (ex) {\n      return false\n    }\n  }\n\n  /**\n   * Allow typing after/before last element.\n   */\n  function _allowTypingOnEdges(e) {\n    const childs = editor.el.childNodes\n    const dt = editor.html.defaultTag()\n\n    if (e.target && e.target !== editor.el) {\n      return true\n    }\n\n    // No childs.\n    if (childs.length === 0) {\n      return true\n    }\n\n    // At the bottom.\n    if (editor.$el.outerHeight() - e.offsetY <= 10) {\n      if (_isEmpty(childs[childs.length - 1])) {\n        if (dt) {\n          editor.$el.append(`<${dt}>${FE.MARKERS}<br></${dt}>`)\n        }\n        else {\n          editor.$el.append(`${FE.MARKERS}<br>`)\n        }\n\n        // Restore selection and scroll.\n        editor.selection.restore()\n        positionCaret()\n      }\n    }\n\n    // At the top\n    else if (e.offsetY <= 10) {\n      if (_isEmpty(childs[0])) {\n        if (dt) {\n          editor.$el.prepend(`<${dt}>${FE.MARKERS}<br></${dt}>`)\n        }\n        else {\n          editor.$el.prepend(`${FE.MARKERS}<br>`)\n        }\n\n        // Restore selection and scroll.\n        editor.selection.restore()\n        positionCaret()\n      }\n    }\n  }\n\n  function _clearTypingTimer() {\n    if (_typing_timeout) {\n      clearTimeout(_typing_timeout)\n    }\n  }\n\n  /**\n   * Tear up.\n   */\n  function _init() {\n    editor.events.on('keydown', _typingKeyDown)\n    editor.events.on('input', _input)\n    editor.events.on('mousedown', _clearIME)\n    editor.events.on('keyup input', _typingKeyUp)\n\n    // Register for handling.\n    editor.events.on('keypress', _mapKeyPress)\n    editor.events.on('keydown', _mapKeyDown)\n    editor.events.on('keyup', _mapKeyUp)\n    editor.events.on('destroy', _clearTypingTimer)\n\n    editor.events.on('html.inserted', _mapKeyUp)\n\n    // Handle cut.\n    editor.events.on('cut', _cut)\n\n    // Click in editor at beginning / end.\n    editor.events.on('click', _allowTypingOnEdges)\n  }\n\n  return {\n    _init,\n    ctrlKey,\n    isCharacter,\n    isArrow,\n    forceUndo,\n    isIME,\n    isBrowserAction,\n    positionCaret\n  }\n}\n","import $ from 'jquery'\nimport FE from 'froala_editor'\n\nObject.assign(FE.DEFAULTS, {\n  pastePlain: false,\n  pasteDeniedTags: ['colgroup', 'col', 'meta'],\n  pasteDeniedAttrs: ['class', 'id', 'style'],\n  pasteAllowedStyleProps: ['.*'],\n  pasteAllowLocalImages: false\n})\n\nFE.MODULES.paste = function (editor) {\n  let clipboard_html\n  let clipboard_rtf\n  let $paste_div\n  let snapshot\n\n  function saveCopiedText(html, plain) {\n    try {\n      editor.win.localStorage.setItem('fr-copied-html', html)\n      editor.win.localStorage.setItem('fr-copied-text', plain)\n    }\n    catch (ex) {\n      // do no matter what\n    }\n  }\n\n  /**\n   * Handle copy and cut.\n   */\n  function _handleCopy(e) {\n    const copied_html = editor.html.getSelected()\n    saveCopiedText(copied_html, $(editor.doc.createElement('div')).html(copied_html).text())\n\n    if (e.type === 'cut') {\n      editor.undo.saveStep()\n\n      setTimeout(() => {\n        editor.selection.save()\n        editor.html.wrap()\n        editor.selection.restore()\n        editor.events.focus()\n        editor.undo.saveStep()\n      }, 0)\n    }\n  }\n\n  /**\n   * Handle pasting.\n   */\n  let stop_paste = false\n\n  function _handlePaste(e) {\n    if (stop_paste) {\n\n      return false\n    }\n\n    if (e.originalEvent) {\n      e = e.originalEvent\n    }\n\n    if (editor.events.trigger('paste.before', [e]) === false) {\n      e.preventDefault()\n\n      return false\n    }\n\n    // Read data from clipboard.\n    if (e && e.clipboardData && e.clipboardData.getData) {\n      let types = ''\n      const clipboard_types = e.clipboardData.types\n\n      if (editor.helpers.isArray(clipboard_types)) {\n        for (let i = 0; i < clipboard_types.length; i++) {\n          types += `${clipboard_types[i]};`\n        }\n      }\n      else {\n        types = clipboard_types\n      }\n\n      clipboard_html = ''\n\n      // Get rtf clipboard.\n      if (/text\\/rtf/.test(types)) {\n        clipboard_rtf = e.clipboardData.getData('text/rtf')\n      }\n\n      // HTML.\n      if (/text\\/html/.test(types) && !editor.browser.safari) {\n        clipboard_html = e.clipboardData.getData('text/html')\n      }\n\n      // Safari HTML.\n      else if (/text\\/rtf/.test(types) && editor.browser.safari) {\n        clipboard_html = clipboard_rtf\n      }\n\n      // Safari HTML for iOS.\n      else if (/public.rtf/.test(types) && editor.browser.safari) {\n        clipboard_html = e.clipboardData.getData('text/rtf')\n      }\n\n      if (clipboard_html !== '') {\n        _processPaste()\n\n        if (e.preventDefault) {\n          e.stopPropagation()\n          e.preventDefault()\n        }\n\n        return false\n      }\n\n      clipboard_html = null\n\n    }\n\n    // Normal paste.\n    _beforePaste()\n\n    return false\n  }\n\n  /**\n   * Handle dropping content in the editor.\n   */\n  function _dropPaste(e) {\n    if (e.originalEvent) {\n      e = e.originalEvent\n    }\n\n    // Read data from clipboard.\n    if (e && e.dataTransfer && e.dataTransfer.getData) {\n      let types = ''\n      const clipboard_types = e.dataTransfer.types\n\n      if (editor.helpers.isArray(clipboard_types)) {\n        for (let i = 0; i < clipboard_types.length; i++) {\n          types += `${clipboard_types[i]};`\n        }\n      }\n      else {\n        types = clipboard_types\n      }\n\n      clipboard_html = ''\n\n      // Get rtf clipboard.\n      if (/text\\/rtf/.test(types)) {\n        clipboard_rtf = e.dataTransfer.getData('text/rtf')\n      }\n\n      // HTML.\n      if (/text\\/html/.test(types)) {\n        clipboard_html = e.dataTransfer.getData('text/html')\n      }\n\n      // Safari HTML.\n      else if (/text\\/rtf/.test(types) && editor.browser.safari) {\n        clipboard_html = clipboard_rtf\n      }\n      else if (/text\\/plain/.test(types) && !this.browser.mozilla) {\n        clipboard_html = editor.html.escapeEntities(e.dataTransfer.getData('text/plain')).replace(/\\n/g, '<br>')\n      }\n\n      if (clipboard_html !== '') {\n        editor.keys.forceUndo()\n        snapshot = editor.snapshot.get()\n\n        // Save selection, but change markers class so that we can restore it later.\n        editor.selection.save()\n        editor.$el.find('.fr-marker').removeClass('fr-marker').addClass('fr-marker-helper')\n\n        // Insert marker point helper and change class to restore it later.\n        const ok = editor.markers.insertAtPoint(e)\n        editor.$el.find('.fr-marker').removeClass('fr-marker').addClass('fr-marker-placeholder')\n\n        // Restore selection and remove it.\n        editor.$el.find('.fr-marker-helper').addClass('fr-marker').removeClass('fr-marker-helper')\n        editor.selection.restore()\n        editor.selection.remove()\n\n        // Restore marker point helper.\n        editor.$el.find('.fr-marker-placeholder').addClass('fr-marker').removeClass('fr-marker-placeholder')\n\n        if (ok !== false) {\n          // Insert markers.\n          const marker = editor.el.querySelector('.fr-marker')\n\n          $(marker).replaceWith(FE.MARKERS)\n          editor.selection.restore()\n\n          _processPaste()\n\n          if (e.preventDefault) {\n            e.stopPropagation()\n            e.preventDefault()\n          }\n\n          return false\n        }\n      }\n      else {\n        clipboard_html = null\n      }\n    }\n  }\n\n  /**\n   * Before starting to paste.\n   */\n  function _beforePaste() {\n\n    // Save selection\n    editor.selection.save()\n    editor.events.disableBlur()\n\n    // Set clipboard HTML.\n    clipboard_html = null\n\n    // Remove and store the editable content\n    if (!$paste_div) {\n      $paste_div = $('<div contenteditable=\"true\" style=\"position: fixed; top: 0; left: -9999px; height: 100%; width: 0; word-break: break-all; overflow:hidden; z-index: 2147483647; line-height: 140%; -moz-user-select: text; -webkit-user-select: text; -ms-user-select: text; user-select: text;\" tabIndex=\"-1\"></div>')\n\n      // Sketch app fix. https://github.com/froala/wysiwyg-editor/issues/2042\n      // Also: when using iframe Safari needs to have focus in the same window.\n      if (editor.browser.safari) {\n        $paste_div.css('top', editor.$sc.scrollTop())\n        editor.$el.after($paste_div)\n      }\n      else if (editor.browser.edge && editor.opts.iframe) {\n        editor.$el.append($paste_div)\n      }\n      else {\n        editor.$box.after($paste_div)\n      }\n\n      editor.events.on('destroy', () => {\n        $paste_div.remove()\n      })\n    }\n    else {\n      $paste_div.html('')\n\n      if (editor.browser.edge && editor.opts.iframe) {\n        editor.$el.append($paste_div)\n      }\n    }\n\n    // Focus on the pasted div.\n    $paste_div.focus()\n\n    // Process paste soon.\n    editor.win.setTimeout(_processPaste, 1)\n  }\n\n  /**\n   * Clean HTML that was pasted from Word.\n   */\n  function _wordClean(html) {\n\n    let i\n\n    // Single item list.\n    html = html.replace(\n      /<p(.*?)class=\"?'?MsoListParagraph\"?'? ([\\s\\S]*?)>([\\s\\S]*?)<\\/p>/gi,\n      '<ul><li>$3</li></ul>'\n    )\n    html = html.replace(\n      /<p(.*?)class=\"?'?NumberedText\"?'? ([\\s\\S]*?)>([\\s\\S]*?)<\\/p>/gi,\n      '<ol><li>$3</li></ol>'\n    )\n\n    // List start.\n    html = html.replace(\n      /<p(.*?)class=\"?'?MsoListParagraphCxSpFirst\"?'?([\\s\\S]*?)(level\\d)?([\\s\\S]*?)>([\\s\\S]*?)<\\/p>/gi,\n      '<ul><li$3>$5</li>'\n    )\n    html = html.replace(\n      /<p(.*?)class=\"?'?NumberedTextCxSpFirst\"?'?([\\s\\S]*?)(level\\d)?([\\s\\S]*?)>([\\s\\S]*?)<\\/p>/gi,\n      '<ol><li$3>$5</li>'\n    )\n\n    // List middle.\n    html = html.replace(\n      /<p(.*?)class=\"?'?MsoListParagraphCxSpMiddle\"?'?([\\s\\S]*?)(level\\d)?([\\s\\S]*?)>([\\s\\S]*?)<\\/p>/gi,\n      '<li$3>$5</li>'\n    )\n    html = html.replace(\n      /<p(.*?)class=\"?'?NumberedTextCxSpMiddle\"?'?([\\s\\S]*?)(level\\d)?([\\s\\S]*?)>([\\s\\S]*?)<\\/p>/gi,\n      '<li$3>$5</li>'\n    )\n    html = html.replace(\n      /<p(.*?)class=\"?'?MsoListBullet\"?'?([\\s\\S]*?)(level\\d)?([\\s\\S]*?)>([\\s\\S]*?)<\\/p>/gi,\n      '<li$3>$5</li>'\n    )\n\n    // List end.\n    html = html.replace(\n      /<p(.*?)class=\"?'?MsoListParagraphCxSpLast\"?'?([\\s\\S]*?)(level\\d)?([\\s\\S]*?)>([\\s\\S]*?)<\\/p>/gi,\n      '<li$3>$5</li></ul>'\n    )\n    html = html.replace(\n      /<p(.*?)class=\"?'?NumberedTextCxSpLast\"?'?([\\s\\S]*?)(level\\d)?([\\s\\S]*?)>([\\s\\S]*?)<\\/p>/gi,\n      '<li$3>$5</li></ol>'\n    )\n\n    // Clean list bullets.\n    html = html.replace(/<span([^<]*?)style=\"?'?mso-list:Ignore\"?'?([\\s\\S]*?)>([\\s\\S]*?)<span/gi, '<span><span')\n\n    // Webkit clean list bullets.\n    html = html.replace(/<!--\\[if !supportLists\\]-->([\\s\\S]*?)<!--\\[endif\\]-->/gi, '')\n    html = html.replace(/<!\\[if !supportLists\\]>([\\s\\S]*?)<!\\[endif\\]>/gi, '')\n\n    // Remove mso classes.\n    html = html.replace(/(\\n|\\r| class=(\")?Mso[a-zA-Z0-9]+(\")?)/gi, ' ')\n\n    // Remove comments.\n    html = html.replace(/<!--[\\s\\S]*?-->/gi, '')\n\n    // Remove tags but keep content.\n    html = html.replace(/<(\\/)*(meta|link|span|\\\\?xml:|st1:|o:|font)(.*?)>/gi, '')\n\n    // Remove no needed tags.\n    const word_tags = ['style', 'script', 'applet', 'embed', 'noframes', 'noscript']\n\n    for (i = 0; i < word_tags.length; i++) {\n      const regex = new RegExp(`<${word_tags[i]}.*?${word_tags[i]}(.*?)>`, 'gi')\n      html = html.replace(regex, '')\n    }\n\n    // Remove spaces.\n    html = html.replace(/&nbsp;/gi, ' ')\n\n    // Keep empty TH and TD.\n    html = html.replace(/<td([^>]*)><\\/td>/g, '<td$1><br></td>')\n    html = html.replace(/<th([^>]*)><\\/th>/g, '<th$1><br></th>')\n\n    // Remove empty tags.\n    let oldHTML\n\n    do {\n      oldHTML = html\n      html = html.replace(/<[^/>][^>]*><\\/[^>]+>/gi, '')\n    } while (html !== oldHTML)\n\n    // Process list indentation.\n    html = html.replace(/<lilevel([^1])([^>]*)>/gi, '<li data-indent=\"true\"$2>')\n    html = html.replace(/<lilevel1([^>]*)>/gi, '<li$1>')\n\n    // Clean HTML.\n    html = editor.clean.html(html, editor.opts.pasteDeniedTags, editor.opts.pasteDeniedAttrs)\n\n    // Clean empty links.\n    html = html.replace(/<a>(.[^<]+)<\\/a>/gi, '$1')\n\n    // https://github.com/froala/wysiwyg-editor/issues/1364.\n    html = html.replace(/<br> */g, '<br>')\n\n    // Process list indent.\n    const div = editor.o_doc.createElement('div')\n    div.innerHTML = html\n\n    const lis = div.querySelectorAll('li[data-indent]')\n\n    for (i = 0; i < lis.length; i++) {\n      const li = lis[i]\n\n      const p_li = li.previousElementSibling\n\n      if (p_li && p_li.tagName === 'LI') {\n        let list = p_li.querySelector(':scope > ul, :scope > ol')\n\n        if (!list) {\n          list = document.createElement('ul')\n          p_li.appendChild(list)\n        }\n\n        list.appendChild(li)\n      }\n      else {\n        li.removeAttribute('data-indent')\n      }\n    }\n\n    editor.html.cleanBlankSpaces(div)\n\n    html = div.innerHTML\n\n    return html\n  }\n\n  /**\n   * Plain clean.\n   */\n  function _plainPasteClean(html) {\n\n    let el = null\n    let i\n    const div = editor.doc.createElement('div')\n    div.innerHTML = html\n\n    let els = div.querySelectorAll('p, div, h1, h2, h3, h4, h5, h6, pre, blockquote')\n\n    for (i = 0; i < els.length; i++) {\n      el = els[i]\n      el.outerHTML = `<${editor.html.defaultTag() || 'DIV'}>${el.innerHTML}</${editor.html.defaultTag() || 'DIV'}>`\n    }\n\n    els = div.querySelectorAll(`*:not(${'p, div, h1, h2, h3, h4, h5, h6, pre, blockquote, ul, ol, li, table, tbody, thead, tr, td, br, img'.split(',').join('):not(')})`)\n\n    for (i = els.length - 1; i >= 0; i--) {\n      el = els[i]\n      el.outerHTML = el.innerHTML\n    }\n\n    // Remove comments.\n    function cleanComments(node) {\n      const contents = editor.node.contents(node)\n\n      for (let i = 0; i < contents.length; i++) {\n        if (contents[i].nodeType !== Node.TEXT_NODE && contents[i].nodeType !== Node.ELEMENT_NODE) {\n          contents[i].parentNode.removeChild(contents[i])\n        }\n        else {\n          cleanComments(contents[i])\n        }\n      }\n    }\n\n    cleanComments(div)\n\n    return div.innerHTML\n  }\n\n  /**\n   * Process the pasted HTML.\n   */\n  function _processPaste() {\n\n    if (editor.browser.edge && editor.opts.iframe) {\n      editor.$box.after($paste_div)\n    }\n\n    // Save undo snapshot.\n    if (!snapshot) {\n      editor.keys.forceUndo()\n      snapshot = editor.snapshot.get()\n    }\n\n    // Cannot read from clipboard.\n    if (!clipboard_html) {\n      clipboard_html = $paste_div.get(0).innerHTML\n\n      editor.selection.restore()\n      editor.events.enableBlur()\n    }\n\n    const is_word = clipboard_html.match(/(class=\"?Mso|class='?Mso|class=\"?Xl|class='?Xl|class=Xl|style=\"[^\"]*\\bmso-|style='[^']*\\bmso-|w:WordDocument)/gi)\n\n    // Trigger chain cleanp.\n    const response = editor.events.chainTrigger('paste.beforeCleanup', clipboard_html)\n\n    if (response && typeof response === 'string') {\n      clipboard_html = response\n    }\n\n    // Clean non-word or word if no plugin processed the paste.\n    if (!is_word || is_word && editor.events.trigger('paste.wordPaste', [clipboard_html]) !== false) {\n      clean(clipboard_html, is_word)\n    }\n  }\n\n  /**\n   * Check if pasted content comes from the editor.\n   */\n  function _isFromEditor(clipboard_html) {\n    let possible_text = null\n\n    try {\n      possible_text = editor.win.localStorage.getItem('fr-copied-text')\n    }\n    catch (ex) {\n      // continue no matter what.a\n    }\n\n    if (possible_text && $('<div>').html(clipboard_html).text().replace(/\\u00A0/gi, ' ').replace(/\\r|\\n/gi, '') === possible_text.replace(/\\u00A0/gi, ' ').replace(/\\r|\\n/gi, '')) {\n      return true\n    }\n\n    return false\n  }\n\n  function _buildTabs(len) {\n    let tabs = ''\n    let i = 0\n\n    while (i++ < len) {\n      tabs += '&nbsp;'\n    }\n\n    return tabs\n  }\n\n  /**\n   * Clean clipboard html.\n   */\n  function clean(clipboard_html, is_word, keep_formatting) {\n    let els = null\n    let el = null\n    let i\n\n    // Keep only body if there is.\n    if (clipboard_html.toLowerCase().indexOf('<body') >= 0) {\n      let style = ''\n\n      if (clipboard_html.indexOf('<style') >= 0) {\n        style = clipboard_html.replace(/[.\\s\\S\\w\\W<>]*(<style[^>]*>[\\s]*[.\\s\\S\\w\\W<>]*[\\s]*<\\/style>)[.\\s\\S\\w\\W<>]*/gi, '$1')\n      }\n\n      clipboard_html = style + clipboard_html.replace(/[.\\s\\S\\w\\W<>]*<body[^>]*>[\\s]*([.\\s\\S\\w\\W<>]*)[\\s]*<\\/body>[.\\s\\S\\w\\W<>]*/gi, '$1')\n      clipboard_html = clipboard_html.replace(/ \\n/g, ' ').replace(/\\n /g, ' ').replace(/([^>])\\n([^<])/g, '$1 $2')\n    }\n\n    // Google Docs paste.\n    let is_gdocs = false\n\n    if (clipboard_html.indexOf('id=\"docs-internal-guid') >= 0) {\n      clipboard_html = clipboard_html.replace(/^[\\w\\W\\s\\S]* id=\"docs-internal-guid[^>]*>([\\w\\W\\s\\S]*)<\\/b>[\\w\\W\\s\\S]*$/g, '$1')\n      is_gdocs = true\n    }\n\n    // Not word paste.\n    let is_editor_content = false\n\n    if (!is_word) {\n      is_editor_content = _isFromEditor(clipboard_html)\n\n      // Remove pasting token.\n      if (is_editor_content) {\n        clipboard_html = editor.win.localStorage.getItem('fr-copied-html')\n      }\n\n      if (!is_editor_content) {\n        // Remove comments.\n        const htmlAllowedStylePropsCopy = editor.opts.htmlAllowedStyleProps\n        editor.opts.htmlAllowedStyleProps = editor.opts.pasteAllowedStyleProps\n        editor.opts.htmlAllowComments = false\n\n        // Pasting from Apple Notes.\n        clipboard_html = clipboard_html.replace(/<span class=\"Apple-tab-span\">\\s*<\\/span>/g, _buildTabs(editor.opts.tabSpaces || 4))\n        clipboard_html = clipboard_html.replace(/<span class=\"Apple-tab-span\" style=\"white-space:pre\">(\\t*)<\\/span>/g, (str, x) => _buildTabs(x.length * (editor.opts.tabSpaces || 4)))\n\n        // Pasting from other sources with tabs.\n        clipboard_html = clipboard_html.replace(/\\t/g, _buildTabs(editor.opts.tabSpaces || 4))\n\n        clipboard_html = editor.clean.html(clipboard_html, editor.opts.pasteDeniedTags, editor.opts.pasteDeniedAttrs)\n\n        editor.opts.htmlAllowedStyleProps = htmlAllowedStylePropsCopy\n        editor.opts.htmlAllowComments = true\n\n        // Remove empty tags.\n        clipboard_html = cleanEmptyTagsAndDivs(clipboard_html)\n\n        // Do not keep entities that are not HTML compatible.\n        clipboard_html = clipboard_html.replace(/\\r/g, '')\n\n        // Trail ending and starting spaces.\n        clipboard_html = clipboard_html.replace(/^ */g, '').replace(/ *$/g, '')\n      }\n    }\n\n    // Word paste cleanup when word plugin is not used.\n    if (is_word && (!editor.wordPaste || !keep_formatting)) {\n\n      // Strip spaces at the beginning.\n      clipboard_html = clipboard_html.replace(/^\\n*/g, '').replace(/^ /g, '')\n\n      // Firefox paste.\n      if (clipboard_html.indexOf('<colgroup>') === 0) {\n        clipboard_html = `<table>${clipboard_html}</table>`\n      }\n\n      clipboard_html = _wordClean(clipboard_html)\n\n      clipboard_html = cleanEmptyTagsAndDivs(clipboard_html)\n    }\n\n    // Do plain paste cleanup.\n    if (editor.opts.pastePlain && !is_editor_content) {\n      clipboard_html = _plainPasteClean(clipboard_html)\n    }\n\n    // After paste cleanup event.\n    const response = editor.events.chainTrigger('paste.afterCleanup', clipboard_html)\n\n    if (typeof response === 'string') {\n      clipboard_html = response\n    }\n\n    // Check if there is anything to clean.\n    if (clipboard_html !== '') {\n      // Normalize spaces.\n      const tmp = editor.o_doc.createElement('div')\n      tmp.innerHTML = clipboard_html\n\n      // https://github.com/froala/wysiwyg-editor/issues/2632.\n      if (clipboard_html.indexOf('<body>') >= 0) {\n        editor.html.cleanBlankSpaces(tmp)\n        editor.spaces.normalize(tmp, true)\n      }\n      else {\n        editor.spaces.normalize(tmp)\n      }\n\n      // Remove all spans.\n      const spans = tmp.getElementsByTagName('span')\n\n      for (i = spans.length - 1; i >= 0; i--) {\n        const span = spans[i]\n\n        if (span.attributes.length === 0) {\n          span.outerHTML = span.innerHTML\n        }\n      }\n\n      // Check if we're inside a list.\n      const selection_el = editor.selection.element()\n      let in_list = false\n\n      if (selection_el && $(selection_el).parentsUntil(editor.el, 'ul, ol').length) {\n        in_list = true\n      }\n\n      // Unwrap lists if they are the only thing in the pasted HTML.\n      if (in_list) {\n        const list = tmp.children\n\n        if (list.length === 1 && ['OL', 'UL'].indexOf(list[0].tagName) >= 0) {\n          list[0].outerHTML = list[0].innerHTML\n        }\n      }\n\n      // Remove unecessary new_lines.\n      if (!is_gdocs) {\n        const brs = tmp.getElementsByTagName('br')\n\n        for (i = brs.length - 1; i >= 0; i--) {\n          const br = brs[i]\n\n          if (editor.node.isBlock(br.previousSibling)) {\n            br.parentNode.removeChild(br)\n          }\n        }\n      }\n\n      // https://github.com/froala/wysiwyg-editor/issues/1493\n      if (editor.opts.enter === FE.ENTER_BR) {\n        els = tmp.querySelectorAll('p, div')\n\n        for (i = els.length - 1; i >= 0; i--) {\n          el = els[i]\n\n          // Fixes https://github.com/froala/wysiwyg-editor/issues/1895.\n          if (el.attributes.length === 0) {\n            el.outerHTML = el.innerHTML + (el.nextSibling && !editor.node.isEmpty(el) ? '<br>' : '')\n          }\n        }\n      }\n      else if (editor.opts.enter === FE.ENTER_DIV) {\n\n        els = tmp.getElementsByTagName('p')\n\n        for (i = els.length - 1; i >= 0; i--) {\n          el = els[i]\n\n          if (el.attributes.length === 0) {\n            el.outerHTML = `<div>${el.innerHTML}</div>`\n          }\n        }\n      }\n      else if (editor.opts.enter === FE.ENTER_P) {\n        if (tmp.childNodes.length === 1 && tmp.childNodes[0].tagName === 'P' && tmp.childNodes[0].attributes.length === 0) {\n          tmp.childNodes[0].outerHTML = tmp.childNodes[0].innerHTML\n        }\n      }\n\n      clipboard_html = tmp.innerHTML\n\n      if (is_editor_content) {\n        clipboard_html = removeEmptyTags(clipboard_html)\n      }\n\n      // Insert HTML.\n      editor.html.insert(clipboard_html, true)\n    }\n\n    _afterPaste()\n\n    editor.undo.saveStep(snapshot)\n    snapshot = null\n    editor.undo.saveStep()\n  }\n\n  /**\n   * After pasting.\n   */\n  function _afterPaste() {\n    editor.events.trigger('paste.after')\n  }\n\n  /*\n   * Get clipboard in RTF format.\n   */\n  function getRtfClipboard() {\n\n    return clipboard_rtf\n  }\n\n  /*\n   * Remove those nodes with attrs.\n   */\n  function _filterNoAttrs(arry) {\n    for (let t = arry.length - 1; t >= 0; t--) {\n      if (arry[t].attributes && arry[t].attributes.length) {\n        arry.splice(t, 1)\n      }\n    }\n\n    return arry\n  }\n\n  function cleanEmptyTagsAndDivs(html) {\n    let i\n    const div = editor.o_doc.createElement('div')\n    div.innerHTML = html\n\n    // Workaround for Nodepad paste.\n    let divs = _filterNoAttrs(Array.prototype.slice.call(div.querySelectorAll(':scope > div:not([style]), td > div:not([style]), th > div:not([style]), li > div:not([style])')))\n\n    while (divs.length) {\n      const dv = divs[divs.length - 1]\n\n      if (editor.html.defaultTag() && editor.html.defaultTag() !== 'div') {\n\n        // If we have nested block tags unwrap them.\n        if (dv.querySelector(editor.html.blockTagsQuery())) {\n          dv.outerHTML = dv.innerHTML\n        }\n        else {\n          dv.outerHTML = `<${editor.html.defaultTag()}>${dv.innerHTML}</${editor.html.defaultTag()}>`\n        }\n      }\n      else {\n        const els = dv.querySelectorAll('*')\n\n        if (!els.length || els[els.length - 1].tagName !== 'BR' && dv.innerText.length === 0) {\n          dv.outerHTML = `${dv.innerHTML}<br>`\n        }\n        else {\n          dv.outerHTML = dv.innerHTML\n        }\n      }\n\n      divs = _filterNoAttrs(Array.prototype.slice.call(div.querySelectorAll(':scope > div:not([style]), td > div:not([style]), th > div:not([style]), li > div:not([style])')))\n    }\n\n    // Remove divs.\n    divs = _filterNoAttrs(Array.prototype.slice.call(div.querySelectorAll('div:not([style])')))\n\n    while (divs.length) {\n      for (i = 0; i < divs.length; i++) {\n        const el = divs[i]\n        const text = el.innerHTML.replace(/\\u0009/gi, '').trim()\n\n        el.outerHTML = text\n      }\n\n      divs = _filterNoAttrs(Array.prototype.slice.call(div.querySelectorAll('div:not([style])')))\n    }\n\n    return div.innerHTML\n  }\n\n  /**\n   * Remove possible empty tags in pasted HTML.\n   */\n  function removeEmptyTags(html) {\n\n    let i\n    const div = editor.o_doc.createElement('div')\n    div.innerHTML = html\n\n    // Clean empty tags.\n    let empty_tags = div.querySelectorAll(`*:empty:not(td):not(th):not(tr):not(iframe):not(svg):not(${FE.VOID_ELEMENTS.join('):not(')}):not(${editor.opts.htmlAllowedEmptyTags.join('):not(')})`)\n\n    while (empty_tags.length) {\n      for (i = 0; i < empty_tags.length; i++) {\n        empty_tags[i].parentNode.removeChild(empty_tags[i])\n      }\n\n      empty_tags = div.querySelectorAll(`*:empty:not(td):not(th):not(tr):not(iframe):not(svg):not(${FE.VOID_ELEMENTS.join('):not(')}):not(${editor.opts.htmlAllowedEmptyTags.join('):not(')})`)\n    }\n\n    return div.innerHTML\n  }\n\n  /**\n   * Initialize.\n   */\n  function _init() {\n    editor.el.addEventListener('copy', _handleCopy)\n    editor.el.addEventListener('cut', _handleCopy)\n    editor.el.addEventListener('paste', _handlePaste, {\n      capture: true\n    })\n\n    editor.events.on('drop', _dropPaste)\n\n    if (editor.browser.msie && editor.browser.version < 11) {\n      editor.events.on('mouseup', (e) => {\n        if (e.button === 2) {\n          setTimeout(() => {\n            stop_paste = false\n          }, 50)\n          stop_paste = true\n        }\n      }, true)\n\n      editor.events.on('beforepaste', _handlePaste)\n    }\n\n    editor.events.on('destroy', _destroy)\n  }\n\n  function _destroy() {\n    editor.el.removeEventListener('copy', _handleCopy)\n    editor.el.removeEventListener('cut', _handleCopy)\n    editor.el.removeEventListener('paste', _handlePaste)\n  }\n\n  return {\n    _init,\n    cleanEmptyTagsAndDivs,\n    getRtfClipboard,\n    saveCopiedText,\n    clean\n  }\n}\n","import FE from 'froala_editor'\n\nObject.assign(FE.DEFAULTS, {\n  shortcutsEnabled: [],\n  shortcutsHint: true\n})\n\nFE.SHORTCUTS_MAP = {}\n\nFE.RegisterShortcut = function (key, cmd, val, letter, shift, option) {\n  FE.SHORTCUTS_MAP[(shift ? '^' : '') + (option ? '@' : '') + key] = {\n    cmd,\n    val,\n    letter,\n    shift,\n    option\n  }\n\n  FE.DEFAULTS.shortcutsEnabled.push(cmd)\n}\n\nFE.RegisterShortcut(FE.KEYCODE.E, 'show', null, 'E', false, false)\nFE.RegisterShortcut(FE.KEYCODE.B, 'bold', null, 'B', false, false)\nFE.RegisterShortcut(FE.KEYCODE.I, 'italic', null, 'I', false, false)\nFE.RegisterShortcut(FE.KEYCODE.U, 'underline', null, 'U', false, false)\nFE.RegisterShortcut(FE.KEYCODE.S, 'strikeThrough', null, 'S', false, false)\nFE.RegisterShortcut(FE.KEYCODE.CLOSE_SQUARE_BRACKET, 'indent', null, ']', false, false)\nFE.RegisterShortcut(FE.KEYCODE.OPEN_SQUARE_BRACKET, 'outdent', null, '[', false, false)\nFE.RegisterShortcut(FE.KEYCODE.Z, 'undo', null, 'Z', false, false)\nFE.RegisterShortcut(FE.KEYCODE.Z, 'redo', null, 'Z', true, false)\nFE.RegisterShortcut(FE.KEYCODE.Y, 'redo', null, 'Y', false, false)\n\nFE.MODULES.shortcuts = function (editor) {\n  let inverse_map = null\n\n  function get(cmd) {\n    if (!editor.opts.shortcutsHint) {\n      return null\n    }\n\n    if (!inverse_map) {\n      inverse_map = {}\n\n      for (const key in FE.SHORTCUTS_MAP) {\n        if (Object.prototype.hasOwnProperty.call(FE.SHORTCUTS_MAP, key) && editor.opts.shortcutsEnabled.indexOf(FE.SHORTCUTS_MAP[key].cmd) >= 0) {\n          inverse_map[`${FE.SHORTCUTS_MAP[key].cmd}.${FE.SHORTCUTS_MAP[key].val || ''}`] = {\n            shift: FE.SHORTCUTS_MAP[key].shift,\n            option: FE.SHORTCUTS_MAP[key].option,\n            letter: FE.SHORTCUTS_MAP[key].letter\n          }\n        }\n      }\n    }\n\n    const srct = inverse_map[cmd]\n\n    if (!srct) {\n      return null\n    }\n\n    return (editor.helpers.isMac() ? String.fromCharCode(8984) : 'Ctrl+') +\n            (srct.shift ? editor.helpers.isMac() ? String.fromCharCode(8679) : 'Shift+' : '') +\n            (srct.option ? editor.helpers.isMac() ? String.fromCharCode(8997) : 'Alt+' : '') +\n            srct.letter\n  }\n\n  let active = false\n\n  /**\n   * Execute shortcut.\n   */\n  function exec(e) {\n    if (!editor.core.hasFocus()) {\n      return true\n    }\n\n    const keycode = e.which\n\n    const ctrlKey = navigator.userAgent.indexOf('Mac OS X') !== -1 ? e.metaKey : e.ctrlKey\n\n    if (e.type === 'keyup' && active) {\n      if (keycode !== FE.KEYCODE.META) {\n        active = false\n\n        return false\n      }\n    }\n\n    if (e.type === 'keydown') {\n      active = false\n    }\n\n    // Build shortcuts map.\n    const map_key = (e.shiftKey ? '^' : '') + (e.altKey ? '@' : '') + keycode\n\n    if (ctrlKey && FE.SHORTCUTS_MAP[map_key]) {\n      const cmd = FE.SHORTCUTS_MAP[map_key].cmd\n\n      // Check if shortcut is enabled.\n      if (cmd && editor.opts.shortcutsEnabled.indexOf(cmd) >= 0) {\n        const val = FE.SHORTCUTS_MAP[map_key].val\n\n        // Search for button.\n        let $btn\n\n        if (cmd && !val) {\n          $btn = editor.$tb.find(`.fr-command[data-cmd=\"${cmd}\"]`)\n        }\n        else if (cmd && val) {\n          $btn = editor.$tb.find(`.fr-command[data-cmd=\"${cmd}\"][data-param1=\"${val}\"]`)\n        }\n\n        // Button found.\n        if ($btn.length) {\n          e.preventDefault()\n          e.stopPropagation()\n\n          $btn.parents('.fr-toolbar').data('instance', editor)\n\n          if (e.type === 'keydown') {\n            editor.button.exec($btn)\n            active = true\n          }\n\n          return false\n        }\n\n        // Search for command.\n        else if (cmd && (editor.commands[cmd] || FE.COMMANDS[cmd] && FE.COMMANDS[cmd].callback)) {\n          e.preventDefault()\n          e.stopPropagation()\n\n          if (e.type === 'keydown') {\n            (editor.commands[cmd] || FE.COMMANDS[cmd].callback)()\n            active = true\n          }\n\n          return false\n        }\n      }\n    }\n  }\n\n  /**\n   * Initialize.\n   */\n  function _init() {\n    editor.events.on('keydown', exec, true)\n    editor.events.on('keyup', exec, true)\n  }\n\n  return {\n    _init,\n    get\n  }\n}\n","import FE from 'froala_editor'\n\nFE.MODULES.snapshot = function (editor) {\n  /**\n   * Get the index of a node inside it's parent.\n   */\n  function _getNodeIndex(node) {\n    const childNodes = node.parentNode.childNodes\n    let idx = 0\n    let prevNode = null\n\n    for (let i = 0; i < childNodes.length; i++) {\n      if (prevNode) {\n\n        // Current node is text and it is empty.\n        const isEmptyText = childNodes[i].nodeType === Node.TEXT_NODE && childNodes[i].textContent === ''\n\n        // Previous node is text, current node is text.\n        const twoTexts = prevNode.nodeType === Node.TEXT_NODE && childNodes[i].nodeType === Node.TEXT_NODE\n\n        if (!isEmptyText && !twoTexts) {\n          idx++\n        }\n      }\n\n      if (childNodes[i] === node) {\n        return idx\n      }\n\n      prevNode = childNodes[i]\n    }\n  }\n\n  /**\n   * Determine the location of the node inside the element.\n   */\n  function _getNodeLocation(node) {\n    const loc = []\n\n    if (!node.parentNode) {\n      return []\n    }\n\n    while (!editor.node.isElement(node)) {\n      loc.push(_getNodeIndex(node))\n      node = node.parentNode\n    }\n\n    return loc.reverse()\n  }\n\n  /**\n   * Get the range offset inside the node.\n   */\n  function _getRealNodeOffset(node, offset) {\n    while (node && node.nodeType === Node.TEXT_NODE) {\n      const prevNode = node.previousSibling\n\n      if (prevNode && prevNode.nodeType === Node.TEXT_NODE) {\n        offset += prevNode.textContent.length\n      }\n      node = prevNode\n    }\n\n    return offset\n  }\n\n  /**\n   * Codify each range.\n   */\n  function _getRange(range) {\n    return {\n      scLoc: _getNodeLocation(range.startContainer),\n      scOffset: _getRealNodeOffset(range.startContainer, range.startOffset),\n      ecLoc: _getNodeLocation(range.endContainer),\n      ecOffset: _getRealNodeOffset(range.endContainer, range.endOffset)\n    }\n  }\n\n  /**\n   * Get the current snapshot.\n   */\n  function get() {\n    const snapshot = {}\n\n    editor.events.trigger('snapshot.before')\n\n    snapshot.html = (editor.$wp ? editor.$el.html() : editor.$oel.get(0).outerHTML).replace(/ style=\"\"/g, '')\n\n    snapshot.ranges = []\n\n    if (editor.$wp && editor.selection.inEditor() && editor.core.hasFocus()) {\n      const ranges = editor.selection.ranges()\n\n      for (let i = 0; i < ranges.length; i++) {\n        snapshot.ranges.push(_getRange(ranges[i]))\n      }\n    }\n\n    editor.events.trigger('snapshot.after', [snapshot])\n\n    return snapshot\n  }\n\n  /**\n   * Determine node by its location in the main element.\n   */\n  function _getNodeByLocation(loc) {\n    let node = editor.el\n\n    for (let i = 0; i < loc.length; i++) {\n      node = node.childNodes[loc[i]]\n    }\n\n    return node\n  }\n\n  /**\n   * Restore range from snapshot.\n   */\n  function _restoreRange(sel, range_snapshot) {\n    try {\n\n      // Get range info.\n      const startNode = _getNodeByLocation(range_snapshot.scLoc)\n      const startOffset = range_snapshot.scOffset\n      const endNode = _getNodeByLocation(range_snapshot.ecLoc)\n      const endOffset = range_snapshot.ecOffset\n\n      // Restore range.\n      const range = editor.doc.createRange()\n      range.setStart(startNode, startOffset)\n      range.setEnd(endNode, endOffset)\n\n      sel.addRange(range)\n    }\n    catch (ex) {\n      // continue regardless of error\n    }\n  }\n\n  /**\n   * Restore snapshot.\n   */\n  function restore(snapshot) {\n\n    // Restore HTML.\n    if (editor.$el.html() !== snapshot.html) {\n      if (editor.opts.htmlExecuteScripts) {\n        editor.$el.html(snapshot.html)\n      }\n      else {\n        editor.el.innerHTML = snapshot.html\n      }\n    }\n\n    // Get selection.\n    const sel = editor.selection.get()\n\n    // Make sure to clear current selection.\n    editor.selection.clear()\n\n    // Focus.\n    editor.events.focus(true)\n\n    // Restore Ranges.\n    for (let i = 0; i < snapshot.ranges.length; i++) {\n      _restoreRange(sel, snapshot.ranges[i])\n    }\n  }\n\n  /**\n   * Compare two snapshots.\n   */\n  function equal(s1, s2) {\n    if (s1.html !== s2.html) {\n      return false\n    }\n\n    if (editor.core.hasFocus() && JSON.stringify(s1.ranges) !== JSON.stringify(s2.ranges)) {\n      return false\n    }\n\n    return true\n  }\n\n  return {\n    get,\n    restore,\n    equal\n  }\n}\n","import FE from 'froala_editor'\n\nFE.MODULES.undo = function (editor) {\n  /**\n   * Disable the default browser undo.\n   */\n  function _disableBrowserUndo(e) {\n    const keyCode = e.which\n    const ctrlKey = editor.keys.ctrlKey(e)\n\n    // Ctrl Key.\n    if (ctrlKey) {\n      if (keyCode === FE.KEYCODE.Z && e.shiftKey) {\n        e.preventDefault()\n      }\n\n      if (keyCode === FE.KEYCODE.Z) {\n        e.preventDefault()\n      }\n    }\n  }\n\n  function canDo() {\n    if (editor.undo_stack.length === 0 || editor.undo_index <= 1) {\n      return false\n    }\n\n    return true\n  }\n\n  function canRedo() {\n    if (editor.undo_index === editor.undo_stack.length) {\n      return false\n    }\n\n    return true\n  }\n\n  let last_html = null\n\n  function saveStep(snapshot) {\n    if (!editor.undo_stack || editor.undoing || editor.el.querySelector('.fr-marker')) {\n      return\n    }\n\n    if (typeof snapshot === 'undefined') {\n      snapshot = editor.snapshot.get()\n\n      if (!editor.undo_stack[editor.undo_index - 1] || !editor.snapshot.equal(editor.undo_stack[editor.undo_index - 1], snapshot)) {\n        dropRedo()\n        editor.undo_stack.push(snapshot)\n        editor.undo_index++\n\n        if (snapshot.html !== last_html) {\n          editor.events.trigger('contentChanged')\n          last_html = snapshot.html\n        }\n      }\n    }\n    else {\n      dropRedo()\n\n      if (editor.undo_index > 0) {\n        editor.undo_stack[editor.undo_index - 1] = snapshot\n      }\n      else {\n        editor.undo_stack.push(snapshot)\n        editor.undo_index++\n      }\n    }\n  }\n\n  function dropRedo() {\n    if (!editor.undo_stack || editor.undoing) {\n      return\n    }\n\n    while (editor.undo_stack.length > editor.undo_index) {\n      editor.undo_stack.pop()\n    }\n  }\n\n  function _do() {\n    if (editor.undo_index > 1) {\n      editor.undoing = true\n\n      // Get snapshot.\n      const snapshot = editor.undo_stack[--editor.undo_index - 1]\n\n      // Clear any existing content changed timers.\n      clearTimeout(editor._content_changed_timer)\n\n      // Restore snapshot.\n      editor.snapshot.restore(snapshot)\n      last_html = snapshot.html\n\n      // Hide popups.\n      editor.popups.hideAll()\n\n      // Enable toolbar.\n      editor.toolbar.enable()\n\n      // Call content changed.\n      editor.events.trigger('contentChanged')\n\n      editor.events.trigger('commands.undo')\n\n      editor.undoing = false\n    }\n  }\n\n  function _redo() {\n    if (editor.undo_index < editor.undo_stack.length) {\n      editor.undoing = true\n\n      // Get snapshot.\n      const snapshot = editor.undo_stack[editor.undo_index++]\n\n      // Clear any existing content changed timers.\n      clearTimeout(editor._content_changed_timer)\n\n      // Restore snapshot.\n      editor.snapshot.restore(snapshot)\n      last_html = snapshot.html\n\n      // Hide popups.\n      editor.popups.hideAll()\n\n      // Enable toolbar.\n      editor.toolbar.enable()\n\n      // Call content changed.\n      editor.events.trigger('contentChanged')\n\n      editor.events.trigger('commands.redo')\n\n      editor.undoing = false\n    }\n  }\n\n  function reset() {\n    editor.undo_index = 0\n    editor.undo_stack = []\n  }\n\n  function _destroy() {\n    editor.undo_stack = []\n  }\n\n  /**\n   * Initialize\n   */\n  function _init() {\n    reset()\n    editor.events.on('initialized', () => {\n      last_html = (editor.$wp ? editor.$el.html() : editor.$oel.get(0).outerHTML).replace(/ style=\"\"/g, '')\n    })\n\n    editor.events.on('blur', () => {\n      if (!editor.el.querySelector('.fr-dragging')) {\n        editor.undo.saveStep()\n      }\n    })\n\n    editor.events.on('keydown', _disableBrowserUndo)\n\n    editor.events.on('destroy', _destroy)\n  }\n\n  return {\n    _init,\n    run: _do,\n    redo: _redo,\n    canDo,\n    canRedo,\n    dropRedo,\n    reset,\n    saveStep\n  }\n}\n","import FE from 'froala_editor'\n\n// Extend defaults.\nObject.assign(FE.DEFAULTS, {\n  height: null,\n  heightMax: null,\n  heightMin: null,\n  width: null\n})\n\nFE.MODULES.size = function (editor) {\n  function syncIframe() {\n    refresh()\n\n    if (editor.opts.height) {\n      editor.$el.css('minHeight', editor.opts.height - editor.helpers.getPX(editor.$el.css('padding-top')) - editor.helpers.getPX(editor.$el.css('padding-bottom')))\n    }\n\n    editor.$iframe.height(editor.$el.outerHeight(true))\n  }\n\n  function refresh() {\n    if (editor.opts.heightMin) {\n      editor.$el.css('minHeight', editor.opts.heightMin)\n    }\n    else {\n      editor.$el.css('minHeight', '')\n    }\n\n    if (editor.opts.heightMax) {\n      editor.$wp.css('maxHeight', editor.opts.heightMax)\n      editor.$wp.css('overflow', 'auto')\n    }\n    else {\n      editor.$wp.css('maxHeight', '')\n      editor.$wp.css('overflow', '')\n    }\n\n    // Set height.\n    if (editor.opts.height) {\n      editor.$wp.height(editor.opts.height)\n      editor.$wp.css('overflow', 'auto')\n      editor.$el.css('minHeight', editor.opts.height - editor.helpers.getPX(editor.$el.css('padding-top')) - editor.helpers.getPX(editor.$el.css('padding-bottom')))\n    }\n    else {\n      editor.$wp.css('height', '')\n\n      if (!editor.opts.heightMin) {\n        editor.$el.css('minHeight', '')\n      }\n\n      if (!editor.opts.heightMax) {\n        editor.$wp.css('overflow', '')\n      }\n    }\n\n    if (editor.opts.width) {\n      editor.$box.width(editor.opts.width)\n    }\n  }\n\n  function _init() {\n    if (!editor.$wp) {\n      return false\n    }\n\n    refresh()\n\n    // Sync iframe height.\n    if (editor.$iframe) {\n      editor.events.on('keyup keydown', () => {\n        setTimeout(syncIframe, 0)\n      }, true)\n\n      editor.events.on('commands.after html.set init initialized paste.after', syncIframe)\n    }\n  }\n\n  return {\n    _init,\n    syncIframe,\n    refresh\n  }\n}\n","import $ from 'jquery'\nimport FE from 'froala_editor'\n\n// Extend defaults.\nObject.assign(FE.DEFAULTS, {\n  tooltips: true\n})\n\nFE.MODULES.tooltip = function (editor) {\n  function hide() {\n    if (editor.helpers.isMobile()) {\n      return\n    }\n\n    // Position fixed for: https://github.com/froala/wysiwyg-editor/issues/1247.\n    if (editor.$tooltip) {\n      editor.$tooltip.removeClass('fr-visible').css('left', '-3000px').css('position', 'fixed')\n    }\n  }\n\n  function to($el, above) {\n    if (editor.helpers.isMobile()) {\n      return\n    }\n\n    if (!$el.data('title')) {\n      $el.data('title', $el.attr('title'))\n    }\n\n    if (!$el.data('title')) {\n      return\n    }\n\n    if (!editor.$tooltip) {\n      _init()\n    }\n\n    $el.removeAttr('title')\n    editor.$tooltip.text(editor.language.translate($el.data('title')))\n    editor.$tooltip.addClass('fr-visible')\n\n    let left = $el.offset().left + ($el.outerWidth() - editor.$tooltip.outerWidth()) / 2\n\n    // Normalize screen position.\n    if (left < 0) {\n      left = 0\n    }\n\n    if (left + editor.$tooltip.outerWidth() > $(editor.o_win).width()) {\n      left = $(editor.o_win).width() - editor.$tooltip.outerWidth()\n    }\n\n    if (typeof above === 'undefined') {\n      above = editor.opts.toolbarBottom\n    }\n    const top = !above ? $el.offset().top + $el.outerHeight() : $el.offset().top - editor.$tooltip.height()\n\n    editor.$tooltip.css('position', '')\n    editor.$tooltip.css('left', left)\n    editor.$tooltip.css('top', Math.ceil(top))\n\n    if ($(editor.o_doc).find('body').first().css('position') !== 'static') {\n      editor.$tooltip.css('margin-left', -$(editor.o_doc).find('body').first().offset().left)\n      editor.$tooltip.css('margin-top', -$(editor.o_doc).find('body').first().offset().top)\n    }\n    else {\n      editor.$tooltip.css('margin-left', '')\n      editor.$tooltip.css('margin-top', '')\n    }\n  }\n\n  function bind($el, selector, above) {\n    if (editor.opts.tooltips && !editor.helpers.isMobile()) {\n      editor.events.$on($el, 'mouseover', selector, (e) => {\n        if (!editor.node.hasClass(e.currentTarget, 'fr-disabled') && !editor.edit.isDisabled()) {\n          to($(e.currentTarget), above)\n        }\n      }, true)\n\n      editor.events.$on($el, `mouseout ${editor._mousedown} ${editor._mouseup}`, selector, () => {\n        hide()\n      }, true)\n    }\n  }\n\n  function _init() {\n    if (editor.opts.tooltips && !editor.helpers.isMobile()) {\n      if (!editor.shared.$tooltip) {\n        editor.shared.$tooltip = $(editor.doc.createElement('DIV')).addClass('fr-tooltip')\n\n        editor.$tooltip = editor.shared.$tooltip\n\n        if (editor.opts.theme) {\n          editor.$tooltip.addClass(`${editor.opts.theme}-theme`)\n        }\n\n        $(editor.o_doc).find('body').first().append(editor.$tooltip)\n      }\n      else {\n        editor.$tooltip = editor.shared.$tooltip\n      }\n\n      editor.events.on('shared.destroy', () => {\n        editor.$tooltip.html('').removeData().remove()\n        editor.$tooltip = null\n      }, true)\n    }\n  }\n\n  return {\n    hide,\n    to,\n    bind\n  }\n}\n","import '../events.js'\nimport '../ui/tooltip.js'\n\nimport $ from 'jquery'\nimport FE from 'froala_editor'\n\nFE.MODULES.button = function (editor) {\n  let buttons = []\n\n  if (editor.opts.toolbarInline || editor.opts.toolbarContainer) {\n    if (!editor.shared.buttons) {\n      editor.shared.buttons = []\n    }\n    buttons = editor.shared.buttons\n  }\n\n  let popup_buttons = []\n\n  if (!editor.shared.popup_buttons) {\n    editor.shared.popup_buttons = []\n  }\n  popup_buttons = editor.shared.popup_buttons\n\n  /*\n   * Filter buttons based on a specified selector.\n   */\n  function _filterButtons(butons_list, selector, search_dropdowns) {\n\n    let $filtered_buttons = $()\n\n    for (let i = 0; i < butons_list.length; i++) {\n      const $button = $(butons_list[i])\n\n      if ($button.is(selector)) {\n        $filtered_buttons = $filtered_buttons.add($button)\n      }\n\n      // Search for dropdowns menuitems\n      if (search_dropdowns && $button.is('.fr-dropdown')) {\n        const $dropdown_menu_items = $button.next().find(selector)\n        $filtered_buttons = $filtered_buttons.add($dropdown_menu_items)\n      }\n    }\n\n    return $filtered_buttons\n  }\n\n  /*\n   * Get all buttons from page based on a specified selector.\n   */\n  function getButtons(selector, search_dropdowns) {\n\n    let $buttons = $()\n    let id\n\n    if (!selector) {\n\n      return $buttons\n    }\n\n    // Search all toolbar buttons.\n    $buttons = $buttons.add(_filterButtons(buttons, selector, search_dropdowns))\n\n    // Search all popups buttons.\n    $buttons = $buttons.add(_filterButtons(popup_buttons, selector, search_dropdowns))\n\n    // Look in popup's content.\n    for (id in editor.shared.popups) {\n\n      if (Object.prototype.hasOwnProperty.call(editor.shared.popups, id)) {\n        const $popup = editor.shared.popups[id]\n        const $popup_buttons = $popup.children().find(selector)\n        $buttons = $buttons.add($popup_buttons)\n      }\n    }\n\n    // Look in modal's content.\n    for (id in editor.shared.modals) {\n\n      if (Object.prototype.hasOwnProperty.call(editor.shared.modals, id)) {\n        const $modal_hash = editor.shared.modals[id]\n        const $modal_buttons = $modal_hash.$modal.find(selector)\n        $buttons = $buttons.add($modal_buttons)\n      }\n    }\n\n    return $buttons\n  }\n\n  /**\n   * Click was made on a dropdown button.\n   */\n  function _dropdownButtonClick($btn) {\n    const $dropdown = $btn.next()\n\n    const active = editor.node.hasClass($btn.get(0), 'fr-active')\n\n    const $active_dropdowns = getButtons('.fr-dropdown.fr-active').not($btn)\n\n    const inst = $btn.parents('.fr-toolbar, .fr-popup').data('instance') || editor\n\n    // Hide keyboard. We need the entire space.\n    if (inst.helpers.isIOS() && !inst.el.querySelector('.fr-marker')) {\n      inst.selection.save()\n      inst.selection.clear()\n      inst.selection.restore()\n    }\n\n    // Dropdown is not active.\n    if (!active) {\n\n      // Call refresh on show.\n      const cmd = $btn.data('cmd')\n      $dropdown.find('.fr-command').removeClass('fr-active').attr('aria-selected', false)\n\n      if (FE.COMMANDS[cmd] && FE.COMMANDS[cmd].refreshOnShow) {\n        FE.COMMANDS[cmd].refreshOnShow.apply(inst, [$btn, $dropdown])\n      }\n\n      $dropdown.css('left', $btn.offset().left - $btn.parent().offset().left - (editor.opts.direction === 'rtl' ? $dropdown.width() - $btn.outerWidth() : 0))\n\n      // Test height.\n      $dropdown.addClass('test-height')\n      const ht = $dropdown.outerHeight()\n      $dropdown.removeClass('test-height')\n\n      // Reset top and bottom.\n      $dropdown.css('top', '').css('bottom', '')\n\n      // Toolbar top or dropdown is exceeding the window.\n      if (!editor.opts.toolbarBottom && $dropdown.offset().top + $btn.outerHeight() + ht < $(editor.o_doc).height()) {\n        $dropdown.css('top', $btn.position().top + $btn.outerHeight())\n      }\n      else {\n        $dropdown.css('bottom', $btn.parents('.fr-popup, .fr-toolbar').first().height() - $btn.position().top)\n      }\n    }\n\n    // Blink and activate.\n    $btn.addClass('fr-blink').toggleClass('fr-active')\n\n    if ($btn.hasClass('fr-active')) {\n      $dropdown.attr('aria-hidden', false)\n      $btn.attr('aria-expanded', true)\n    }\n    else {\n      $dropdown.attr('aria-hidden', true)\n      $btn.attr('aria-expanded', false)\n    }\n    setTimeout(() => {\n      $btn.removeClass('fr-blink')\n    }, 300)\n\n    // Reset left margin for dropdown.\n    $dropdown.css('margin-left', '')\n\n    // Check if it exceeds window on the right.\n    if ($dropdown.offset().left + $dropdown.outerWidth() > editor.$sc.offset().left + editor.$sc.width()) {\n      $dropdown.css('margin-left', -($dropdown.offset().left + $dropdown.outerWidth() - editor.$sc.offset().left - editor.$sc.width()))\n    }\n\n    // Check if it exceeds window on the left.\n    if ($dropdown.offset().left < editor.$sc.offset().left && editor.opts.direction === 'rtl') {\n      $dropdown.css('margin-left', editor.$sc.offset().left)\n    }\n\n    // Hide dropdowns that might be active.\n    $active_dropdowns.removeClass('fr-active').attr('aria-expanded', false).next().attr('aria-hidden', true)\n    $active_dropdowns.parent('.fr-toolbar:not(.fr-inline)').css('zIndex', '')\n\n    if ($btn.parents('.fr-popup').length === 0 && !editor.opts.toolbarInline) {\n      if (editor.node.hasClass($btn.get(0), 'fr-active')) {\n        editor.$tb.css('zIndex', (editor.opts.zIndex || 1) + 4)\n      }\n      else {\n        editor.$tb.css('zIndex', '')\n      }\n    }\n\n    // Focus the active element or the dropdown button to enable accessibility.\n    const $active_element = $dropdown.find('a.fr-command.fr-active').first()\n\n    // We do not need to focus on mobile.\n    if (!editor.helpers.isMobile()) {\n\n      if ($active_element.length) {\n        editor.accessibility.focusToolbarElement($active_element)\n      }\n      else {\n        editor.accessibility.focusToolbarElement($btn)\n      }\n    }\n  }\n\n  function exec($btn) {\n\n    // Blink.\n    $btn.addClass('fr-blink')\n    setTimeout(() => {\n      $btn.removeClass('fr-blink')\n    }, 500)\n\n    // Get command, value and additional params.\n    const cmd = $btn.data('cmd')\n    const params = []\n\n    while (typeof $btn.data(`param${params.length + 1}`) !== 'undefined') {\n      params.push($btn.data(`param${params.length + 1}`))\n    }\n\n    // Hide dropdowns that might be active including the current one.\n    const $active_dropdowns = getButtons('.fr-dropdown.fr-active')\n\n    if ($active_dropdowns.length) {\n      $active_dropdowns.removeClass('fr-active').attr('aria-expanded', false).next().attr('aria-hidden', true)\n\n      $active_dropdowns.parent('.fr-toolbar:not(.fr-inline)').css('zIndex', '')\n    }\n\n    // Call the command.\n    $btn.parents('.fr-popup, .fr-toolbar').data('instance').commands.exec(cmd, params)\n  }\n\n  /**\n   * Click was made on a command button.\n   */\n  function _commandButtonClick($btn) {\n    exec($btn)\n  }\n\n  function click($btn) {\n    const inst = $btn.parents('.fr-popup, .fr-toolbar').data('instance')\n\n    if ($btn.parents('.fr-popup').length === 0 && !$btn.data('popup')) {\n      inst.popups.hideAll()\n    }\n\n    // Popups are visible, but not in the current instance.\n    if (inst.popups.areVisible() && !inst.popups.areVisible(inst)) {\n\n      // Hide markers in other instances.\n      for (let i = 0; i < FE.INSTANCES.length; i++) {\n        if (FE.INSTANCES[i] !== inst && FE.INSTANCES[i].popups && FE.INSTANCES[i].popups.areVisible()) {\n          FE.INSTANCES[i].$el.find('.fr-marker').remove()\n        }\n      }\n\n      inst.popups.hideAll()\n    }\n\n    // Dropdown button.\n    if (editor.node.hasClass($btn.get(0), 'fr-dropdown')) {\n      _dropdownButtonClick($btn)\n    }\n\n    // Regular button.\n    else {\n      _commandButtonClick($btn)\n\n      if (FE.COMMANDS[$btn.data('cmd')] && FE.COMMANDS[$btn.data('cmd')].refreshAfterCallback !== false) {\n        inst.button.bulkRefresh()\n      }\n    }\n  }\n\n  function _click(e) {\n    const $btn = $(e.currentTarget)\n\n    click($btn)\n  }\n\n  function hideActiveDropdowns($el) {\n    const $active_dropdowns = $el.find('.fr-dropdown.fr-active')\n\n    if ($active_dropdowns.length) {\n      $active_dropdowns.removeClass('fr-active').attr('aria-expanded', false).next().attr('aria-hidden', true)\n\n      $active_dropdowns.parent('.fr-toolbar:not(.fr-inline)').css('zIndex', '')\n    }\n  }\n\n  /**\n   * Click in the dropdown menu.\n   */\n  function _dropdownMenuClick(e) {\n    e.preventDefault()\n    e.stopPropagation()\n  }\n\n  /**\n   * Click on the dropdown wrapper.\n   */\n  function _dropdownWrapperClick(e) {\n    e.stopPropagation()\n\n    // Prevent blurring.\n    if (!editor.helpers.isMobile()) {\n      return false\n    }\n  }\n\n  /**\n   * Bind callbacks for commands.\n   */\n  function bindCommands($el, tooltipAbove) {\n    editor.events.bindClick($el, '.fr-command:not(.fr-disabled)', _click)\n\n    // Click on the dropdown menu.\n    editor.events.$on($el, `${editor._mousedown} ${editor._mouseup} ${editor._move}`, '.fr-dropdown-menu', _dropdownMenuClick, true)\n\n    // Click on the dropdown wrapper.\n    editor.events.$on($el, `${editor._mousedown} ${editor._mouseup} ${editor._move}`, '.fr-dropdown-menu .fr-dropdown-wrapper', _dropdownWrapperClick, true)\n\n    // Hide dropdowns that might be active.\n    const _document = $el.get(0).ownerDocument\n    const _window = 'defaultView' in _document ? _document.defaultView : _document.parentWindow\n\n    function hideDropdowns(e) {\n      if (!e || e.type === editor._mouseup && e.target !== $('html').get(0) || e.type === 'keydown' && (editor.keys.isCharacter(e.which) && !editor.keys.ctrlKey(e) || e.which === FE.KEYCODE.ESC)) {\n        hideActiveDropdowns($el)\n      }\n    }\n    editor.events.$on($(_window), `${editor._mouseup} resize keydown`, hideDropdowns, true)\n\n    if (editor.opts.iframe) {\n      editor.events.$on(editor.$win, editor._mouseup, hideDropdowns, true)\n    }\n\n    // Add refresh.\n    if (editor.node.hasClass($el.get(0), 'fr-popup')) {\n      $.merge(popup_buttons, $el.find('.fr-btn').toArray())\n    }\n    else {\n      $.merge(buttons, $el.find('.fr-btn').toArray())\n    }\n\n    // Assing tooltips to buttons.\n    editor.tooltip.bind($el, '.fr-btn, .fr-title', tooltipAbove)\n  }\n\n  /**\n   * Create the content for dropdown.\n   */\n  function _content(command, info) {\n    let c = ''\n\n    if (info.html) {\n      if (typeof info.html === 'function') {\n        c += info.html.call(editor)\n      }\n      else {\n        c += info.html\n      }\n    }\n    else {\n      let options = info.options\n\n      if (typeof options === 'function') {\n        options = options()\n      }\n\n      c += '<ul class=\"fr-dropdown-list\" role=\"presentation\">'\n\n      for (const val in options) {\n        if (Object.prototype.hasOwnProperty.call(options, val)) {\n          let shortcut = editor.shortcuts.get(`${command}.${val}`)\n\n          if (shortcut) {\n            shortcut = `<span class=\"fr-shortcut\">${shortcut}</span>`\n          }\n          else {\n            shortcut = ''\n          }\n\n          c += `<li role=\"presentation\"><a class=\"fr-command\" tabIndex=\"-1\" role=\"option\" data-cmd=\"${command}\" data-param1=\"${val}\" title=\"${options[val]}\">${editor.language.translate(options[val])}</a></li>`\n        }\n      }\n      c += '</ul>'\n    }\n\n    return c\n  }\n\n  /**\n   * Create button.\n   */\n  function _build(command, info, visible) {\n    if (editor.helpers.isMobile() && info.showOnMobile === false) {\n      return ''\n    }\n\n    let display_selection = info.displaySelection\n\n    if (typeof display_selection === 'function') {\n      display_selection = display_selection(editor)\n    }\n\n    let icon\n\n    if (display_selection) {\n      const default_selection = typeof info.defaultSelection === 'function' ? info.defaultSelection(editor) : info.defaultSelection\n      icon = `<span style=\"width:${info.displaySelectionWidth || 100}px\">${editor.language.translate(default_selection || info.title)}</span>`\n    }\n    else {\n      icon = editor.icon.create(info.icon || command)\n\n      // Used instead of aria-label. The advantage is that it also display text when the css is disabled.\n      icon += `<span class=\"fr-sr-only\">${editor.language.translate(info.title) || ''}</span>`\n    }\n\n    const popup = info.popup ? ' data-popup=\"true\"' : ''\n\n    const modal = info.modal ? ' data-modal=\"true\"' : ''\n\n    let shortcut = editor.shortcuts.get(`${command}.`)\n\n    if (shortcut) {\n      shortcut = ` (${shortcut})`\n    }\n    else {\n      shortcut = ''\n    }\n\n    const button_id = `${command}-${editor.id}`\n\n    const dropdown_id = `dropdown-menu-${button_id}`\n\n    let btn = `<button id=\"${button_id}\"type=\"button\" tabIndex=\"-1\" role=\"button\"${info.toggle ? ' aria-pressed=\"false\"' : ''}${info.type === 'dropdown' ? ` aria-controls=\"${dropdown_id}\" aria-expanded=\"false\" aria-haspopup=\"true\"` : ''}${info.disabled ? ' aria-disabled=\"true\"' : ''} title=\"${editor.language.translate(info.title) || ''}${shortcut}\" class=\"fr-command fr-btn${info.type === 'dropdown' ? ' fr-dropdown' : ''} fr-btn-${editor.icon.getTemplate(info.icon)}${info.displaySelection ? ' fr-selection' : ''}${info.back ? ' fr-back' : ''}${info.disabled ? ' fr-disabled' : ''}${!visible ? ' fr-hidden' : ''}\" data-cmd=\"${command}\"${popup}${modal}>${icon}</button>`\n\n    if (info.type === 'dropdown') {\n\n      // Build dropdown.\n      let dropdown = `<div id=\"${dropdown_id}\" class=\"fr-dropdown-menu\" role=\"listbox\" aria-labelledby=\"${button_id}\" aria-hidden=\"true\"><div class=\"fr-dropdown-wrapper\" role=\"presentation\"><div class=\"fr-dropdown-content\" role=\"presentation\">`\n\n      dropdown += _content(command, info)\n\n      dropdown += '</div></div></div>'\n\n      btn += dropdown\n    }\n\n    return btn\n  }\n\n  function buildList(buttons, visible_buttons) {\n    let str = ''\n\n    for (let i = 0; i < buttons.length; i++) {\n      const cmd_name = buttons[i]\n      const cmd_info = FE.COMMANDS[cmd_name]\n\n      if (cmd_info && typeof cmd_info.plugin !== 'undefined' && editor.opts.pluginsEnabled.indexOf(cmd_info.plugin) < 0) {\n        continue\n      }\n\n      if (cmd_info) {\n        const visible = typeof visible_buttons !== 'undefined' ? visible_buttons.indexOf(cmd_name) >= 0 : true\n        str += _build(cmd_name, cmd_info, visible)\n      }\n      else if (cmd_name === '|') {\n        str += '<div class=\"fr-separator fr-vs\" role=\"separator\" aria-orientation=\"vertical\"></div>'\n      }\n      else if (cmd_name === '-') {\n        str += '<div class=\"fr-separator fr-hs\" role=\"separator\" aria-orientation=\"horizontal\"></div>'\n      }\n    }\n\n    return str\n  }\n\n  function refresh($btn) {\n    const inst = $btn.parents('.fr-popup, .fr-toolbar').data('instance') || editor\n\n    const cmd = $btn.data('cmd')\n\n    let $dropdown\n\n    if (!editor.node.hasClass($btn.get(0), 'fr-dropdown')) {\n      $btn.removeClass('fr-active')\n\n      if ($btn.attr('aria-pressed')) {\n        $btn.attr('aria-pressed', false)\n      }\n    }\n    else {\n      $dropdown = $btn.next()\n    }\n\n    if (FE.COMMANDS[cmd] && FE.COMMANDS[cmd].refresh) {\n      FE.COMMANDS[cmd].refresh.apply(inst, [$btn, $dropdown])\n    }\n    else if (editor.refresh[cmd]) {\n      inst.refresh[cmd]($btn, $dropdown)\n    }\n  }\n\n  function _bulkRefresh(btns) {\n    const inst = editor.$tb ? editor.$tb.data('instance') || editor : editor\n\n    // Check the refresh event.\n    if (editor.events.trigger('buttons.refresh') === false) {\n      return true\n    }\n\n    setTimeout(() => {\n      const focused = inst.selection.inEditor() && inst.core.hasFocus()\n\n      for (let i = 0; i < btns.length; i++) {\n        const $btn = $(btns[i])\n        const cmd = $btn.data('cmd')\n\n        if ($btn.parents('.fr-popup').length === 0) {\n          if (focused || FE.COMMANDS[cmd] && FE.COMMANDS[cmd].forcedRefresh) {\n            inst.button.refresh($btn)\n          }\n          else if (!editor.node.hasClass($btn.get(0), 'fr-dropdown')) {\n            $btn.removeClass('fr-active')\n\n            if ($btn.attr('aria-pressed')) {\n              $btn.attr('aria-pressed', false)\n            }\n          }\n        }\n        else if ($btn.parents('.fr-popup').isVisible()) {\n          inst.button.refresh($btn)\n        }\n      }\n    }, 0)\n  }\n\n  /**\n   * Do buttons refresh.\n   */\n  function bulkRefresh() {\n    _bulkRefresh(buttons)\n    _bulkRefresh(popup_buttons)\n  }\n\n  function _destroy() {\n    buttons = []\n    popup_buttons = []\n  }\n\n  let refresh_timeout = null\n\n  function delayedBulkRefresh() {\n    clearTimeout(refresh_timeout)\n    refresh_timeout = setTimeout(bulkRefresh, 50)\n  }\n\n  /**\n   * Initialize.\n   */\n  function _init() {\n\n    // Assign refresh and do refresh.\n    if (editor.opts.toolbarInline) {\n      editor.events.on('toolbar.show', bulkRefresh)\n    }\n    else {\n      editor.events.on('mouseup', delayedBulkRefresh)\n      editor.events.on('keyup', delayedBulkRefresh)\n      editor.events.on('blur', delayedBulkRefresh)\n      editor.events.on('focus', delayedBulkRefresh)\n      editor.events.on('contentChanged', delayedBulkRefresh)\n\n      if (editor.helpers.isMobile()) {\n        editor.events.$on(editor.$doc, 'selectionchange', bulkRefresh)\n      }\n    }\n\n    editor.events.on('shared.destroy', _destroy)\n  }\n\n  return {\n    _init,\n    buildList,\n    bindCommands,\n    refresh,\n    bulkRefresh,\n    exec,\n    click,\n    hideActiveDropdowns,\n    getButtons\n  }\n}\n","import FE from 'froala_editor'\n\nFE.ICON_TEMPLATES = {\n  font_awesome: '<i class=\"fa fa-[NAME]\" aria-hidden=\"true\"></i>',\n  font_awesome_5: '<i class=\"fas fa-[FA5NAME]\" aria-hidden=\"true\"></i>',\n  font_awesome_5r: '<i class=\"far fa-[FA5NAME]\" aria-hidden=\"true\"></i>',\n  font_awesome_5l: '<i class=\"fal fa-[FA5NAME]\" aria-hidden=\"true\"></i>',\n  text: '<span style=\"text-align: center;\">[NAME]</span>',\n  image: '<img src=[SRC] alt=[ALT] />',\n  svg: '<svg viewBox=\"0 0 32 32\" xmlns=\"http://www.w3.org/2000/svg\">[PATH]</svg>'\n}\n\nFE.ICONS = {\n  bold: {\n    NAME: 'bold'\n  },\n  italic: {\n    NAME: 'italic'\n  },\n  underline: {\n    NAME: 'underline'\n  },\n  strikeThrough: {\n    NAME: 'strikethrough'\n  },\n  subscript: {\n    NAME: 'subscript'\n  },\n  superscript: {\n    NAME: 'superscript'\n  },\n  color: {\n    NAME: 'tint'\n  },\n  outdent: {\n    NAME: 'outdent'\n  },\n  indent: {\n    NAME: 'indent'\n  },\n  undo: {\n    NAME: 'rotate-left',\n    FA5NAME: 'undo'\n  },\n  redo: {\n    NAME: 'rotate-right',\n    FA5NAME: 'redo'\n  },\n  insertHR: {\n    NAME: 'minus'\n  },\n  clearFormatting: {\n    NAME: 'eraser'\n  },\n  selectAll: {\n    NAME: 'mouse-pointer'\n  }\n}\n\nFE.DefineIconTemplate = function (name, options) {\n  FE.ICON_TEMPLATES[name] = options\n}\n\nFE.DefineIcon = function (name, options) {\n  FE.ICONS[name] = options\n}\n\nObject.assign(FE.DEFAULTS, {\n  iconsTemplate: 'font_awesome'\n})\n\nFE.MODULES.icon = function (editor) {\n  function create(command) {\n    let icon = null\n    const info = FE.ICONS[command]\n\n    if (typeof info !== 'undefined') {\n      let template = info.template || FE.ICON_DEFAULT_TEMPLATE || editor.opts.iconsTemplate\n\n      if (!info.FA5NAME) {\n        info.FA5NAME = info.NAME\n      }\n\n      if (template && (template = FE.ICON_TEMPLATES[template])) {\n        icon = template.replace(/\\[([a-zA-Z0-9]*)\\]/g, (str, a1) => {\n          if (a1 === 'NAME') {\n            return info[a1] || command\n          }\n\n          return info[a1]\n        })\n      }\n    }\n\n    return icon || command\n  }\n\n  function getTemplate(command) {\n    const info = FE.ICONS[command]\n    let template = editor.opts.iconsTemplate\n\n    if (typeof info !== 'undefined') {\n      template = info.template || FE.ICON_DEFAULT_TEMPLATE || editor.opts.iconsTemplate\n\n      return template\n    }\n\n    return template\n  }\n\n  return {\n    create,\n    getTemplate\n  }\n}\n","import $ from 'jquery'\nimport FE from 'froala_editor'\n\nFE.MODULES.modals = function (editor) {\n  if (!editor.shared.modals) {\n    editor.shared.modals = {}\n  }\n  let modals = editor.shared.modals\n  let $overlay\n\n  /**\n   * Get the modal with the specific id.\n   */\n  function get(id) {\n    return modals[id]\n  }\n\n  /*\n   *  Get modal html\n   */\n  function _modalHTML(head, body) {\n\n    // Modal wrapper.\n    let html = `<div tabIndex=\"-1\" class=\"fr-modal${editor.opts.theme ? ` ${editor.opts.theme}-theme` : ''}\"><div class=\"fr-modal-wrapper\">`\n\n    // Modal title.\n    const close_button = `<i title=\"${editor.language.translate('Cancel')}\" class=\"fa fa-times fr-modal-close\"></i>`\n    html += `<div class=\"fr-modal-head\">${head}${close_button}</div>`\n\n    // Body.\n    html += `<div tabIndex=\"-1\" class=\"fr-modal-body\">${body}</div>`\n\n    // End Modal.\n    html += '</div></div>'\n\n    const $tmp = $(editor.doc.createElement('DIV'))\n    $tmp.html(html)\n\n    return $tmp.find('> .fr-modal')\n  }\n\n  /*\n   * Create modal.\n   */\n  function create(id, head, body) {\n\n    // Build modal overlay.\n    if (!editor.shared.$overlay) {\n      editor.shared.$overlay = $(editor.doc.createElement('DIV')).addClass('fr-overlay')\n      $('body').first().append(editor.shared.$overlay)\n    }\n    $overlay = editor.shared.$overlay\n\n    if (editor.opts.theme) {\n      $overlay.addClass(`${editor.opts.theme}-theme`)\n    }\n\n    // Build modal.\n    if (!modals[id]) {\n      const $modal = _modalHTML(head, body)\n      modals[id] = {\n        $modal,\n        $head: $modal.find('.fr-modal-head'),\n        $body: $modal.find('.fr-modal-body')\n      }\n\n      // Desktop or mobile device.\n      if (!editor.helpers.isMobile()) {\n        $modal.addClass('fr-desktop')\n      }\n\n      // Append modal to body.\n      $('body').first().append($modal)\n\n      // Click on close button.\n      editor.events.$on($modal, 'click', '.fr-modal-close', () => {\n        hide(id)\n      }, true)\n\n      modals[id].$body.css('margin-top', modals[id].$head.outerHeight())\n\n      // Keydown handler.\n      editor.events.$on($modal, 'keydown', (e) => {\n        const keycode = e.which\n\n        // Esc.\n        if (keycode === FE.KEYCODE.ESC) {\n          hide(id)\n          editor.accessibility.focusModalButton($modal)\n\n          return false\n        }\n        else if (!$(e.currentTarget).is('input[type=text], textarea') && keycode !== FE.KEYCODE.ARROW_UP && keycode !== FE.KEYCODE.ARROW_DOWN && !editor.keys.isBrowserAction(e)) {\n          e.preventDefault()\n          e.stopPropagation()\n\n          return false\n        }\n\n\n        return true\n\n      }, true)\n\n      hide(id, true)\n    }\n\n    return modals[id]\n  }\n\n  /*\n   * Destroy modals.\n   */\n  function destroy() {\n\n    // Destroy all modals.\n    for (const i in modals) {\n      if (Object.prototype.hasOwnProperty.call(modals, i)) {\n        const modalHash = modals[i]\n        if (modalHash && modalHash.$modal) {\n          modalHash.$modal.removeData().remove()\n        }\n      }\n    }\n\n    if ($overlay) {\n      $overlay.removeData().remove()\n    }\n\n    modals = {}\n  }\n\n  /*\n   * Show modal.\n   */\n  function show(id) {\n    if (!modals[id]) {\n      return\n    }\n\n    const $modal = modals[id].$modal\n\n    // Set the current instance for the modal.\n    $modal.data('instance', editor)\n\n    // Show modal.\n    $modal.show()\n    $overlay.show()\n\n    // Prevent scrolling in page.\n    $(editor.o_doc).find('body').first().addClass('prevent-scroll')\n\n    // Mobile device\n    if (editor.helpers.isMobile()) {\n      $(editor.o_doc).find('body').first().addClass('fr-mobile')\n    }\n\n    $modal.addClass('fr-active')\n\n    editor.accessibility.focusModal($modal)\n  }\n\n  /*\n   * Hide modal.\n   */\n  function hide(id, init) {\n    if (!modals[id]) {\n      return\n    }\n\n    const $modal = modals[id].$modal\n    const inst = $modal.data('instance') || editor\n\n    inst.events.enableBlur()\n    $modal.hide()\n    $overlay.hide()\n    $(inst.o_doc).find('body').first().removeClass('prevent-scroll fr-mobile')\n\n    $modal.removeClass('fr-active')\n\n    if (!init) {\n\n      // Restore selection.\n      inst.accessibility.restoreSelection()\n\n      inst.events.trigger('modals.hide')\n    }\n  }\n\n  /**\n   *  Resize modal according to its body or editor heights.\n   */\n  function resize(id) {\n    if (!modals[id]) {\n      return\n    }\n\n    const modalHash = modals[id]\n    const $modal = modalHash.$modal\n    const $body = modalHash.$body\n\n    const height = $(editor.o_win).height()\n\n    // The wrapper object.\n    const $wrapper = $modal.find('.fr-modal-wrapper')\n\n    // Calculate max allowed height.\n    const allWrapperHeight = $wrapper.outerHeight(true)\n    const exteriorBodyHeight = $wrapper.height() - ($body.outerHeight(true) - $body.height())\n    const maxHeight = height - allWrapperHeight + exteriorBodyHeight\n\n    // Get body content height.\n    const body_content_height = $body.get(0).scrollHeight\n\n    // Calculate the new height.\n    let newHeight = 'auto'\n\n    if (body_content_height > maxHeight) {\n      newHeight = maxHeight\n    }\n\n    $body.height(newHeight)\n  }\n\n  /**\n   * Find visible modal.\n   */\n  function isVisible(id) {\n    let $modal\n\n    // By id.\n    if (typeof id === 'string') {\n      if (!modals[id]) {\n        return\n      }\n      $modal = modals[id].$modal\n    }\n\n    // By modal object.\n    else {\n      $modal = id\n    }\n\n    return $modal && editor.node.hasClass($modal, 'fr-active') && editor.core.sameInstance($modal) || false\n  }\n\n  /**\n   * Check if there is any modal visible.\n   */\n  function areVisible(new_instance) {\n    for (const id in modals) {\n      if (Object.prototype.hasOwnProperty.call(modals, id)) {\n        if (isVisible(id) && (typeof new_instance === 'undefined' || modals[id].$modal.data('instance') === new_instance)) {\n          return modals[id].$modal\n        }\n      }\n    }\n\n    return false\n  }\n\n  /**\n   * Initialization.\n   */\n  function _init() {\n    editor.events.on('shared.destroy', destroy, true)\n  }\n\n  return {\n    _init,\n    get,\n    create,\n    show,\n    hide,\n    resize,\n    isVisible,\n    areVisible\n  }\n}\n","import $ from 'jquery'\nimport FE from 'froala_editor'\n\nFE.POPUP_TEMPLATES = {\n  'text.edit': '[_EDIT_]'\n}\n\nFE.RegisterTemplate = function (name, template) {\n  FE.POPUP_TEMPLATES[name] = template\n}\n\nFE.MODULES.popups = function (editor) {\n  if (!editor.shared.popups) {\n    editor.shared.popups = {}\n  }\n  let popups = editor.shared.popups\n\n  function setContainer(id, $container) {\n    if (!$container.isVisible()) {\n      $container = editor.$sc\n    }\n\n    if (!$container.is(popups[id].data('container'))) {\n      popups[id].data('container', $container)\n      $container.append(popups[id])\n    }\n  }\n\n  function refreshContainer(id, $container) {\n    if (!$container.isVisible()) {\n      $container = editor.$sc\n    }\n\n    if (!$container.contains([popups[id].get(0)])) {\n      $container.append(popups[id])\n    }\n  }\n\n  /**\n   * Show popup at a specific position.\n   */\n  function show(id, left, top, obj_height) {\n\n    // Restore selection on show if it is there.\n    if (!isVisible(id)) {\n      if (areVisible() && editor.$el.find('.fr-marker').length > 0) {\n        editor.events.disableBlur()\n        editor.selection.restore()\n      }\n      else if (!areVisible()) {\n\n        // We must have focus into editor because we may want to save selection.\n        editor.events.disableBlur()\n        editor.events.focus()\n        editor.events.enableBlur()\n      }\n    }\n\n    hideAll([id])\n\n    if (!popups[id]) {\n      return false\n    }\n\n    // Hide active dropdowns.\n    const $active_dropdowns = editor.button.getButtons('.fr-dropdown.fr-active')\n    $active_dropdowns.removeClass('fr-active').attr('aria-expanded', false).parent('.fr-toolbar').css('zIndex', '')\n    $active_dropdowns.next().attr('aria-hidden', true)\n\n    // Set the current instance for the popup.\n    popups[id].data('instance', editor)\n\n    if (editor.$tb) {\n      editor.$tb.data('instance', editor)\n    }\n\n    const is_visible = isVisible(id)\n    popups[id].addClass('fr-active').removeClass('fr-hidden').find('input, textarea').removeAttr('disabled')\n    const width = popups[id].outerWidth()\n\n    let $container = popups[id].data('container')\n\n    refreshContainer(id, $container)\n\n    // Inline mode when container is toolbar.\n    if (editor.opts.toolbarInline && $container && editor.$tb && $container.get(0) === editor.$tb.get(0)) {\n      setContainer(id, editor.$sc)\n      top = editor.$tb.offset().top - editor.helpers.getPX(editor.$tb.css('margin-top'))\n      left = editor.$tb.offset().left + editor.$tb.outerWidth() / 2 + (parseFloat(editor.$tb.find('.fr-arrow').css('margin-left')) || 0) + editor.$tb.find('.fr-arrow').outerWidth() / 2\n\n      if (editor.node.hasClass(editor.$tb.get(0), 'fr-above') && top) {\n        top += editor.$tb.outerHeight()\n      }\n\n      obj_height = 0\n    }\n\n    // Apply iframe correction.\n    $container = popups[id].data('container')\n\n    if (editor.opts.iframe && !obj_height && !is_visible) {\n      if (left) {\n        left -= editor.$iframe.offset().left\n      }\n\n      if (top) {\n        top -= editor.$iframe.offset().top\n      }\n    }\n\n    // If container is toolbar then increase zindex.\n    if ($container.is(editor.$tb)) {\n      editor.$tb.css('zIndex', (editor.opts.zIndex || 1) + 4)\n    }\n    else {\n      popups[id].css('zIndex', (editor.opts.zIndex || 1) + 4)\n    }\n\n    // Apply left correction.\n    if (left) {\n      left -= width / 2\n    }\n\n    // Toolbar at the bottom and container is toolbar.\n    if (editor.opts.toolbarBottom && $container && editor.$tb && $container.get(0) === editor.$tb.get(0)) {\n      popups[id].addClass('fr-above')\n\n      if (top) {\n        top -= popups[id].outerHeight()\n      }\n    }\n\n    // Position editor.\n    popups[id].removeClass('fr-active')\n    editor.position.at(left, top, popups[id], obj_height || 0)\n    popups[id].addClass('fr-active')\n\n    if (!is_visible) {\n      editor.accessibility.focusPopup(popups[id])\n    }\n\n    if (editor.opts.toolbarInline) {\n      editor.toolbar.hide()\n    }\n\n    editor.events.trigger(`popups.show.${id}`)\n\n    // https://github.com/froala/wysiwyg-editor/issues/1248\n    _events(id)._repositionPopup()\n\n    _unmarkExit()\n  }\n\n  function onShow(id, callback) {\n    editor.events.on(`popups.show.${id}`, callback)\n  }\n\n  /**\n   * Find visible popup.\n   */\n  function isVisible(id) {\n    return popups[id] && editor.node.hasClass(popups[id], 'fr-active') && editor.core.sameInstance(popups[id]) || false\n  }\n\n  /**\n   * Check if there is any popup visible.\n   */\n  function areVisible(new_instance) {\n    for (const id in popups) {\n      if (Object.prototype.hasOwnProperty.call(popups, id)) {\n        if (isVisible(id) && (typeof new_instance === 'undefined' || popups[id].data('instance') === new_instance)) {\n          return popups[id]\n        }\n      }\n    }\n\n    return false\n  }\n\n  /**\n   * Hide popup.\n   */\n  function hide(id) {\n    let $popup = null\n\n    if (typeof id !== 'string') {\n      $popup = id\n    }\n    else {\n      $popup = popups[id]\n    }\n\n    if ($popup && editor.node.hasClass($popup, 'fr-active')) {\n      $popup.removeClass('fr-active fr-above')\n      editor.events.trigger(`popups.hide.${id}`)\n\n      // Reset toolbar zIndex.\n      if (editor.$tb) {\n        if (editor.opts.zIndex > 1) {\n          editor.$tb.css('zIndex', editor.opts.zIndex + 1)\n        }\n        else {\n          editor.$tb.css('zIndex', '')\n        }\n      }\n\n      editor.events.disableBlur()\n      $popup.find('input, textarea, button').each(function () {\n        if (this === this.ownerDocument.activeElement) {\n          this.blur()\n        }\n      })\n\n      $popup.find('input, textarea').attr('disabled', 'disabled')\n    }\n  }\n\n  /**\n   * Assign an event for hiding.\n   */\n  function onHide(id, callback) {\n    editor.events.on(`popups.hide.${id}`, callback)\n  }\n\n  /**\n   * Get the popup with the specific id.\n   */\n  function get(id) {\n    const $popup = popups[id]\n\n    if ($popup && !$popup.data(`inst${editor.id}`)) {\n      const ev = _events(id)\n      _bindInstanceEvents(ev, id)\n    }\n\n    return $popup\n  }\n\n  function onRefresh(id, callback) {\n    editor.events.on(`popups.refresh.${id}`, callback)\n  }\n\n  /**\n   * Refresh content inside the popup.\n   */\n  function refresh(id) {\n    // Set the instance id for the popup.\n    popups[id].data('instance', editor)\n\n    editor.events.trigger(`popups.refresh.${id}`)\n\n    const btns = popups[id].find('.fr-command')\n\n    for (let i = 0; i < btns.length; i++) {\n      const $btn = $(btns[i])\n\n      if ($btn.parents('.fr-dropdown-menu').length === 0) {\n        editor.button.refresh($btn)\n      }\n    }\n  }\n\n  /**\n   * Hide all popups.\n   */\n  function hideAll(except) {\n    if (typeof except === 'undefined') {\n      except = []\n    }\n\n    for (const id in popups) {\n      if (Object.prototype.hasOwnProperty.call(popups, id)) {\n        if (except.indexOf(id) < 0) {\n          hide(id)\n        }\n      }\n    }\n  }\n\n  editor.shared.exit_flag = false\n\n  function _markExit() {\n    editor.shared.exit_flag = true\n  }\n\n  function _unmarkExit() {\n    editor.shared.exit_flag = false\n  }\n\n  function _canExit() {\n    return editor.shared.exit_flag\n  }\n\n  function _buildTemplate(id, template) {\n\n    // Load template.\n    let html = FE.POPUP_TEMPLATES[id]\n\n    if (!html) {\n      return null\n    }\n\n    if (typeof html === 'function') {\n      html = html.apply(editor)\n    }\n\n    for (const nm in template) {\n      if (Object.prototype.hasOwnProperty.call(template, nm)) {\n        html = html.replace(`[_${nm.toUpperCase()}_]`, template[nm])\n      }\n    }\n\n    return html\n  }\n\n  function _build(id, template) {\n    let $container\n    const html = _buildTemplate(id, template)\n\n    const $popup = $(editor.doc.createElement('DIV'))\n    if (!html) {\n      $popup.addClass('fr-popup fr-empty')\n\n      $container = $('body').first()\n      $container.append($popup)\n      $popup.data('container', $container)\n\n      popups[id] = $popup\n\n      return $popup\n    }\n\n    $popup.addClass(`fr-popup${editor.helpers.isMobile() ? ' fr-mobile' : ' fr-desktop'}${editor.opts.toolbarInline ? ' fr-inline' : ''}`)\n    $popup.html(`<span class=\"fr-arrow\"></span>${html}`)\n\n    if (editor.opts.theme) {\n      $popup.addClass(`${editor.opts.theme}-theme`)\n    }\n\n    if (editor.opts.zIndex > 1) {\n      if (!editor.opts.editInPopup) {\n        editor.$tb.css('z-index', editor.opts.zIndex + 2)\n      }\n      else {\n        $popup.css('z-index', editor.opts.zIndex + 2)\n      }\n    }\n\n    if (editor.opts.direction !== 'auto') {\n      $popup.removeClass('fr-ltr fr-rtl').addClass(`fr-${editor.opts.direction}`)\n    }\n\n    $popup.find('input, textarea').attr('dir', editor.opts.direction).attr('disabled', 'disabled')\n\n    $container = $('body').first()\n    $container.append($popup)\n    $popup.data('container', $container)\n\n    popups[id] = $popup\n\n    // Bind commands from the popup.\n    editor.button.bindCommands($popup, false)\n\n    return $popup\n  }\n\n  function _events(id) {\n    const $popup = popups[id]\n\n    return {\n      /**\n       * Resize window.\n       */\n      _windowResize() {\n        const inst = $popup.data('instance') || editor\n\n        if (!inst.helpers.isMobile() && $popup.isVisible()) {\n          inst.events.disableBlur()\n          inst.popups.hide(id)\n          inst.events.enableBlur()\n        }\n      },\n\n      /**\n       * Focus on an input.\n       */\n      _inputFocus(e) {\n        const inst = $popup.data('instance') || editor\n\n        const $target = $(e.currentTarget)\n\n        if ($target.is('input:file')) {\n          $target.closest('.fr-layer').addClass('fr-input-focus')\n        }\n\n        e.preventDefault()\n        e.stopPropagation()\n\n        // IE workaround.\n        setTimeout(() => {\n          inst.events.enableBlur()\n        }, 100)\n\n        // Reposition scroll on mobile to the original one.\n        if (inst.helpers.isMobile()) {\n          const t = $(inst.o_win).scrollTop()\n          setTimeout(() => {\n            $(inst.o_win).scrollTop(t)\n          }, 0)\n        }\n      },\n\n      /**\n       * Blur on an input.\n       */\n      _inputBlur(e) {\n        const inst = $popup.data('instance') || editor\n\n        const $target = $(e.currentTarget)\n\n        if ($target.is('input:file')) {\n          $target.closest('.fr-layer').removeClass('fr-input-focus')\n        }\n\n        // Do not do blur on window change.\n        if (document.activeElement !== this && $(this).isVisible()) {\n          if (inst.events.blurActive()) {\n            inst.events.trigger('blur')\n          }\n\n          inst.events.enableBlur()\n        }\n      },\n\n      /**\n       * Editor keydown.\n       */\n      _editorKeydown(e) {\n        const inst = $popup.data('instance') || editor\n\n        // ESC.\n        if (!inst.keys.ctrlKey(e) && e.which !== FE.KEYCODE.ALT && e.which !== FE.KEYCODE.ESC) {\n          if (isVisible(id) && $popup.findVisible('.fr-back').length) {\n            inst.button.exec($popup.findVisible('.fr-back').first())\n          }\n          // Don't hide if alt alone is pressed to allow Alt + F10 shortcut for accessibility.\n          else if (e.which !== FE.KEYCODE.ALT) {\n            inst.popups.hide(id)\n          }\n        }\n      },\n\n      /**\n       * Handling hitting the popup elements with the mouse.\n       */\n      _preventFocus(e) {\n        const inst = $popup.data('instance') || editor\n\n        // Get the original target.\n        const originalTarget = e.originalEvent ? e.originalEvent.target || e.originalEvent.originalTarget : null\n\n        // Do not disable blur on mouseup because it is the last event in the chain.\n        if (e.type !== 'mouseup' && !$(originalTarget).is(':focus')) {\n          inst.events.disableBlur()\n        }\n\n        // Hide popup's active dropdowns on mouseup.\n        if (e.type === 'mouseup' && !($(originalTarget).hasClass('fr-command') || $(originalTarget).parents('.fr-command').length > 0) && !$(originalTarget).hasClass('fr-dropdown-content')) {\n          editor.button.hideActiveDropdowns($popup)\n        }\n\n        // https://github.com/froala/wysiwyg-editor/issues/1733\n        // https://github.com/froala/wysiwyg-editor/issues/1838 . Firefox: with Jquery > 2 $(originalTarget).is(':focus') returns the oposite to Jquery < 2.\n        if ((editor.browser.safari || editor.browser.mozilla) && e.type === 'mousedown' && $(originalTarget).is('input[type=file]')) {\n          inst.events.disableBlur()\n        }\n\n        // Define the input selector.\n        const input_selector = 'input, textarea, button, select, label, .fr-command'\n\n        // Click was not made inside an input.\n        if (originalTarget && !$(originalTarget).is(input_selector) && $(originalTarget).parents(input_selector).length === 0) {\n          e.stopPropagation()\n\n          return false\n        }\n\n        // Click was made on another input inside popup. Prevent propagation of the event.\n        else if (originalTarget && $(originalTarget).is(input_selector)) {\n          e.stopPropagation()\n        }\n\n        _unmarkExit()\n      },\n\n      /**\n       * Mouseup inside the editor.\n       */\n      _editorMouseup() {\n\n        // Check if popup is visible and we can exit.\n        if ($popup.isVisible() && _canExit()) {\n\n          // If we have an input focused, then disable blur.\n          if ($popup.findVisible('input:focus, textarea:focus, button:focus, select:focus').length > 0) {\n            editor.events.disableBlur()\n          }\n        }\n      },\n\n      /**\n       * Mouseup on window.\n       */\n      _windowMouseup(e) {\n        if (!editor.core.sameInstance($popup)) {\n          return true\n        }\n\n        const inst = $popup.data('instance') || editor\n\n        if ($popup.isVisible() && _canExit()) {\n          e.stopPropagation()\n          inst.markers.remove()\n          inst.popups.hide(id)\n\n          _unmarkExit()\n        }\n      },\n\n      /**\n       * Keydown on window.\n       */\n      _windowKeydown(e) {\n        if (!editor.core.sameInstance($popup)) {\n          return true\n        }\n\n        const inst = $popup.data('instance') || editor\n\n        const key_code = e.which\n\n        // ESC.\n        if (FE.KEYCODE.ESC === key_code) {\n          if (inst.popups.isVisible(id) && inst.opts.toolbarInline) {\n            e.stopPropagation()\n\n            if (inst.popups.isVisible(id)) {\n              if ($popup.findVisible('.fr-back').length) {\n                inst.button.exec($popup.findVisible('.fr-back').first())\n\n                // Focus back popup button.\n                inst.accessibility.focusPopupButton($popup)\n              }\n              else if ($popup.findVisible('.fr-dismiss').length) {\n                inst.button.exec($popup.findVisible('.fr-dismiss').first())\n              }\n              else {\n                inst.popups.hide(id)\n                inst.toolbar.showInline(null, true)\n\n                // Focus back popup button.\n                inst.accessibility.FocusPopupButton($popup)\n              }\n            }\n\n            return false\n          }\n          else if (inst.popups.isVisible(id)) {\n            if ($popup.findVisible('.fr-back').length) {\n              inst.button.exec($popup.findVisible('.fr-back').first)\n\n                // Focus back popup button.\n              inst.accessibility.focusPopupButton($popup)\n            }\n            else if ($popup.findVisible('.fr-dismiss').length) {\n              inst.button.exec($popup.findVisible('.fr-dismiss').first())\n            }\n            else {\n              inst.popups.hide(id)\n\n                // Focus back popup button.\n              inst.accessibility.focusPopupButton($popup)\n            }\n\n            return false\n          }\n        }\n      },\n\n      /**\n       * Placeholder effect.\n       */\n      _doPlaceholder() {\n        const $label = $(this).next()\n\n        if ($label.length === 0 && $(this).attr('placeholder')) {\n          $(this).after(`<label for=\"${$(this).attr('id')}\">${$(this).attr('placeholder')}</label>`)\n        }\n\n        $(this).toggleClass('fr-not-empty', $(this).val() !== '')\n      },\n\n      /**\n       * Reposition popup.\n       */\n      _repositionPopup() {\n\n        // No height set or toolbar inline.\n        if (!(editor.opts.height || editor.opts.heightMax) || editor.opts.toolbarInline) {\n          return true\n        }\n\n        if (editor.$wp && isVisible(id) && $popup.parent().get(0) === editor.$sc.get(0)) {\n\n          // Popup top - wrapper top.\n          let p_top = $popup.offset().top - editor.$wp.offset().top\n\n          // Wrapper height.\n          const w_height = editor.$wp.outerHeight()\n\n          if (editor.node.hasClass($popup.get(0), 'fr-above')) {\n            p_top += $popup.outerHeight()\n          }\n\n          // 1. Popup top > w_height.\n          // 2. Popup top + popup height < 0.\n          if (p_top > w_height || p_top < 0) {\n            $popup.addClass('fr-hidden')\n          }\n          else {\n            $popup.removeClass('fr-hidden')\n          }\n        }\n      }\n    }\n  }\n\n  function _bindInstanceEvents(ev, id) {\n\n    // Editor mouseup.\n    editor.events.on('mouseup', ev._editorMouseup, true)\n\n    if (editor.$wp) {\n      editor.events.on('keydown', ev._editorKeydown)\n    }\n\n    // Hide all popups on blur.\n    editor.events.on('blur', () => {\n      if (areVisible()) {\n        editor.markers.remove()\n      }\n\n      hideAll()\n    })\n\n    // Update the position of the popup.\n    if (editor.$wp && !editor.helpers.isMobile()) {\n      editor.events.$on(editor.$wp, `scroll.popup${id}`, ev._repositionPopup)\n    }\n\n    editor.events.on('window.mouseup', ev._windowMouseup, true)\n    editor.events.on('window.keydown', ev._windowKeydown, true)\n\n    popups[id].data(`inst${editor.id}`, true)\n\n    editor.events.on('destroy', () => {\n      if (editor.core.sameInstance(popups[id])) {\n        $('body').first().append(popups[id])\n        popups[id].removeClass('fr-active')\n      }\n    }, true)\n  }\n\n  /**\n   * Create a popup.\n   */\n  function create(id, template) {\n    const $popup = _build(id, template)\n\n    // Build events.\n    const ev = _events(id)\n\n    // Events binded here should be assigned in every instace.\n    _bindInstanceEvents(ev, id)\n\n    // Input Focus / Blur / Keydown.\n    editor.events.$on($popup, 'mousedown mouseup touchstart touchend touch', '*', ev._preventFocus, true)\n    editor.events.$on($popup, 'focus', 'input, textarea, button, select', ev._inputFocus, true)\n    editor.events.$on($popup, 'blur', 'input, textarea, button, select', ev._inputBlur, true)\n\n    // Register popup to handle keyboard accessibility.\n    editor.accessibility.registerPopup(id)\n\n    // Placeholder.\n    editor.events.$on($popup, 'keydown keyup change input', 'input, textarea', ev._doPlaceholder, true)\n\n    // Toggle checkbox.\n    if (editor.helpers.isIOS()) {\n      editor.events.$on($popup, 'touchend', 'label', function () {\n        $(`#${$(this).attr('for')}`).prop('checked', (i, val) => !val)\n      }, true)\n    }\n\n    // Window mouseup.\n    editor.events.$on($(editor.o_win), 'resize', ev._windowResize, true)\n\n\n    return $popup\n  }\n\n  /**\n   * Destroy.\n   */\n  function _destroy() {\n    for (const id in popups) {\n      if (Object.prototype.hasOwnProperty.call(popups, id)) {\n        const $popup = popups[id]\n\n        if ($popup) {\n          $popup.html('').removeData().remove()\n          popups[id] = null\n        }\n      }\n    }\n\n    popups = []\n  }\n\n  /**\n   * Initialization.\n   */\n  function _init() {\n    editor.events.on('shared.destroy', _destroy, true)\n\n    editor.events.on('window.mousedown', _markExit)\n    editor.events.on('window.touchmove', _unmarkExit)\n\n    // Prevent hiding popups while we scroll.\n    editor.events.$on($(editor.o_win), 'scroll', _unmarkExit)\n\n    editor.events.on('mousedown', (e) => {\n      if (areVisible()) {\n        e.stopPropagation()\n\n        // Remove markers.\n        editor.$el.find('.fr-marker').remove()\n\n        // Prepare for exit.\n        _markExit()\n\n        // Disable blur.\n        editor.events.disableBlur()\n      }\n    })\n  }\n\n  return {\n    _init,\n    create,\n    get,\n    show,\n    hide,\n    onHide,\n    hideAll,\n    setContainer,\n    refresh,\n    onRefresh,\n    onShow,\n    isVisible,\n    areVisible\n  }\n}\n","import $ from 'jquery'\nimport FE from 'froala_editor'\n\nFE.MODULES.position = function (editor) {\n  /**\n  * Get bounding rect around selection.\n  *\n  */\n  function getBoundingRect() {\n    const range = editor.selection.ranges(0)\n    let boundingRect = range.getBoundingClientRect()\n\n    if (boundingRect.top === 0 && boundingRect.left === 0 && boundingRect.width === 0 || boundingRect.height === 0) {\n      let remove = false\n\n      if (editor.$el.find('.fr-marker').length === 0) {\n        editor.selection.save()\n        remove = true\n      }\n\n      const $marker = editor.$el.find('.fr-marker').first()\n      $marker.css('display', 'inline')\n      $marker.css('line-height', '')\n      const offset = $marker.offset()\n      const height = $marker.outerHeight()\n      $marker.css('display', 'none')\n      $marker.css('line-height', 0)\n\n      boundingRect = {}\n      boundingRect.left = offset.left\n      boundingRect.width = 0\n      boundingRect.height = height\n      boundingRect.top = offset.top - (editor.helpers.isMobile() && !editor.helpers.isIOS() || editor.opts.iframe ? 0 : editor.helpers.scrollTop())\n      boundingRect.right = 1\n      boundingRect.bottom = 1\n      boundingRect.ok = true\n\n      if (remove) {\n        editor.selection.restore()\n      }\n    }\n\n    return boundingRect\n  }\n\n  /**\n   * Normalize top positioning.\n   */\n  function _topNormalized($el, top, obj_height) {\n    const height = $el.outerHeight(true)\n\n    if (!editor.helpers.isMobile() && editor.$tb && $el.parent().get(0) !== editor.$tb.get(0)) {\n      // Get the parent of the element.\n      let p_offset = $el.parent().offset().top\n      const new_top = top - height - (obj_height || 0)\n\n      // Parent is scrollable container.\n      // Substract the top of the container.\n      if ($el.parent().get(0) === editor.$sc.get(0)) {\n        p_offset -= $el.parent().position().top\n      }\n\n      // Scrollable container height.\n      const s_height = editor.$sc.get(0).clientHeight\n\n      // 1. Parent offset + toolbar top + toolbar height > scrollableContainer height.\n      // 2. Selection doesn't go above the screen.\n      if (p_offset + top + height > editor.$sc.offset().top + s_height && $el.parent().offset().top + new_top > 0 && new_top > 0) {\n\n        // Make sure we can display it.\n        if (new_top > editor.$wp.scrollTop()) {\n          top = new_top\n          $el.addClass('fr-above')\n        }\n      }\n      else {\n        $el.removeClass('fr-above')\n      }\n    }\n\n    return top\n  }\n\n  /**\n   * Normalize left position.\n   */\n  function _leftNormalized($el, left) {\n    const width = $el.outerWidth(true)\n\n    // Normalize right.\n    if (left + width > editor.$sc.get(0).clientWidth - 10) {\n      left = editor.$sc.get(0).clientWidth - width - 10\n    }\n\n    // Normalize left.\n    if (left < 0) {\n      left = 10\n    }\n\n    return left\n  }\n\n  /**\n   * Place editor below selection.\n   */\n  function forSelection($el) {\n    const selection_rect = getBoundingRect()\n\n    $el.css({\n      top: 0,\n      left: 0\n    })\n\n    let top = selection_rect.top + selection_rect.height\n    const left = selection_rect.left + selection_rect.width / 2 - $el.get(0).offsetWidth / 2 + editor.helpers.scrollLeft()\n\n    if (!editor.opts.iframe) {\n      top += editor.helpers.scrollTop()\n    }\n\n    at(left, top, $el, selection_rect.height)\n  }\n\n  /**\n   * Position element at the specified position.\n   */\n  function at(left, top, $el, obj_height) {\n    const $container = $el.data('container')\n\n    if ($container && ($container.get(0).tagName !== 'BODY' || $container.css('position') !== 'static')) {\n\n      if (left) {\n        left -= $container.offset().left\n      }\n\n      if (top) {\n        top -= $container.offset().top\n      }\n\n      if ($container.get(0).tagName !== 'BODY') {\n        if (left) {\n          left += $container.get(0).scrollLeft\n        }\n\n        if (top) {\n          top += $container.get(0).scrollTop\n        }\n      }\n      else if ($container.css('position') === 'absolute') {\n        if (left) {\n          left += $container.position().left\n        }\n\n        if (top) {\n          top += $container.position().top\n        }\n      }\n    }\n\n    // Apply iframe correction.\n    if (editor.opts.iframe && $container && editor.$tb && $container.get(0) !== editor.$tb.get(0)) {\n      if (left) {\n        left += editor.$iframe.offset().left\n      }\n\n      if (top) {\n        top += editor.$iframe.offset().top\n      }\n    }\n\n    const new_left = _leftNormalized($el, left)\n\n    if (left) {\n\n      // Set the new left.\n      $el.css('left', new_left)\n\n      // Normalize arrow.\n      let $arrow = $el.data('fr-arrow')\n\n      if (!$arrow) {\n        $arrow = $el.find('.fr-arrow')\n        $el.data('fr-arrow', $arrow)\n      }\n\n      if (!$arrow.data('margin-left')) {\n        $arrow.data('margin-left', editor.helpers.getPX($arrow.css('margin-left')))\n      }\n      $arrow.css('margin-left', left - new_left + $arrow.data('margin-left'))\n    }\n\n    if (top) {\n      $el.css('top', _topNormalized($el, top, obj_height))\n    }\n  }\n\n  /**\n   * Special case for update sticky on iOS.\n   */\n  function _updateIOSSticky(el) {\n    const $el = $(el)\n    const is_on = $el.is('.fr-sticky-on')\n    const prev_top = $el.data('sticky-top')\n    const scheduled_top = $el.data('sticky-scheduled')\n\n    // Create a dummy div that we show then sticky is on.\n    if (typeof prev_top === 'undefined') {\n      $el.data('sticky-top', 0)\n      const $dummy = $(`<div class=\"fr-sticky-dummy\" style=\"height: ${$el.outerHeight()}px;\"></div>`)\n      editor.$box.prepend($dummy)\n    }\n    else {\n      editor.$box.find('.fr-sticky-dummy').css('height', $el.outerHeight())\n    }\n\n    // Position sticky doesn't work when the keyboard is on the screen.\n    if (editor.core.hasFocus() || editor.$tb.find('input:visible:focus').length > 0) {\n\n      // Get the current scroll.\n      const x_scroll = editor.helpers.scrollTop()\n\n      // Get the current top.\n      // We make sure that we keep it within the editable box.\n      const x_top = Math.min(Math.max(x_scroll - editor.$tb.parent().offset().top, 0), editor.$tb.parent().outerHeight() - $el.outerHeight())\n\n      // Not the same top and different than the already scheduled.\n      if (x_top !== prev_top && x_top !== scheduled_top) {\n\n        // Clear any too soon change to avoid flickering.\n        clearTimeout($el.data('sticky-timeout'))\n\n        // Store the current scheduled top.\n        $el.data('sticky-scheduled', x_top)\n\n        // Hide the toolbar for a rich experience.\n        if ($el.outerHeight() < x_scroll - editor.$tb.parent().offset().top) {\n          $el.addClass('fr-opacity-0')\n        }\n\n        // Set the timeout for changing top.\n        // Based on the test 100ms seems to be the best timeout.\n        $el.data('sticky-timeout', setTimeout(() => {\n\n          // Get the current top.\n          const c_scroll = editor.helpers.scrollTop()\n          let c_top = Math.min(Math.max(c_scroll - editor.$tb.parent().offset().top, 0), editor.$tb.parent().outerHeight() - $el.outerHeight())\n\n          if (c_top > 0 && editor.$tb.parent().get(0).tagName === 'BODY') {\n            c_top += editor.$tb.parent().position().top\n          }\n\n          // Don't update if it is not different than the prev top.\n          if (c_top !== prev_top) {\n            $el.css('top', Math.max(c_top, 0))\n\n            $el.data('sticky-top', c_top)\n            $el.data('sticky-scheduled', c_top)\n          }\n\n          // Show toolbar.\n          $el.removeClass('fr-opacity-0')\n        }, 100))\n      }\n\n      // Turn on sticky mode.\n      if (!is_on) {\n        $el.css('top', '0')\n        $el.width(editor.$tb.parent().width())\n        $el.addClass('fr-sticky-on')\n        editor.$box.addClass('fr-sticky-box')\n      }\n    }\n\n    // Turn off sticky mode.\n    else {\n      clearTimeout($(el).css('sticky-timeout'))\n      $el.css('top', '0')\n      $el.css('position', '')\n      $el.width('')\n      $el.data('sticky-top', 0)\n      $el.removeClass('fr-sticky-on')\n      editor.$box.removeClass('fr-sticky-box')\n    }\n  }\n\n  /**\n   * Update sticky location for browsers that don't support sticky.\n   * https://github.com/filamentgroup/fixed-sticky\n   *\n   * The MIT License (MIT)\n   *\n   * Copyright (c) 2013 Filament Group\n   */\n  function _updateSticky(el) {\n    if (!el.offsetWidth) {\n      return\n    }\n\n    const $el = $(el)\n    const height = $el.outerHeight()\n\n    let position = $el.data('sticky-position')\n\n    // Viewport height.\n    const viewport_height = $(editor.opts.scrollableContainer === 'body' ? editor.o_win : editor.opts.scrollableContainer).outerHeight()\n\n    let scrollable_top = 0\n    let scrollable_bottom = 0\n\n    if (editor.opts.scrollableContainer !== 'body') {\n      scrollable_top = editor.$sc.offset().top\n      scrollable_bottom = $(editor.o_win).outerHeight() - scrollable_top - viewport_height\n    }\n\n    const offset_top = editor.opts.scrollableContainer === 'body' ? editor.helpers.scrollTop() : scrollable_top\n\n    const is_on = $el.is('.fr-sticky-on')\n\n    // Decide parent.\n    if (!$el.data('sticky-parent')) {\n      $el.data('sticky-parent', $el.parent())\n    }\n    const $parent = $el.data('sticky-parent')\n    const parent_top = $parent.offset().top\n    const parent_height = $parent.outerHeight()\n\n\n    if (!$el.data('sticky-offset')) {\n      $el.data('sticky-offset', true)\n      $el.after(`<div class=\"fr-sticky-dummy\" style=\"height: ${height}px;\"></div>`)\n    }\n    else {\n      editor.$box.find('.fr-sticky-dummy').css('height', `${height}px`)\n    }\n\n    // Detect position placement.\n    if (!position) {\n\n      // Some browsers require fixed/absolute to report accurate top/left values.\n      const skip_setting_fixed = $el.css('top') !== 'auto' || $el.css('bottom') !== 'auto'\n\n      // Set to position fixed for a split of second.\n      if (!skip_setting_fixed) {\n        $el.css('position', 'fixed')\n      }\n\n      // Find position.\n      position = {\n        top: editor.node.hasClass($el.get(0), 'fr-top'),\n        bottom: editor.node.hasClass($el.get(0), 'fr-bottom')\n      }\n\n      // Remove position fixed.\n      if (!skip_setting_fixed) {\n        $el.css('position', '')\n      }\n\n      // Store position.\n      $el.data('sticky-position', position)\n\n      $el.data('top', editor.node.hasClass($el.get(0), 'fr-top') ? $el.css('top') : 'auto')\n      $el.data('bottom', editor.node.hasClass($el.get(0), 'fr-bottom') ? $el.css('bottom') : 'auto')\n    }\n\n    const el_top = editor.helpers.getPX($el.data('top'))\n    const el_bottom = editor.helpers.getPX($el.data('bottom'))\n\n    // Detect if is OK to fix at the top.\n    function isFixedToTop() {\n\n      // 1. Top condition.\n      // 2. Bottom condition.\n      return parent_top < offset_top + el_top &&\n              parent_top + parent_height - height >= offset_top + el_top\n    }\n\n    // Detect if it is OK to fix at the bottom.\n    function isFixedToBottom() {\n      return parent_top + height < offset_top + viewport_height - el_bottom &&\n              parent_top + parent_height > offset_top + viewport_height - el_bottom\n    }\n\n    const at_top = position.top && isFixedToTop() && (editor.helpers.isInViewPort(editor.$sc.get(0)) || editor.opts.scrollableContainer === 'body')\n    const at_bottom = position.bottom && isFixedToBottom()\n\n    // Should be fixed.\n    if (at_top || at_bottom) {\n      $el.css('width', `${$parent.get(0).getBoundingClientRect().width}px`)\n\n      if (!is_on) {\n        $el.addClass('fr-sticky-on')\n        $el.removeClass('fr-sticky-off')\n\n        if ($el.css('top')) {\n          if ($el.data('top') !== 'auto') {\n            $el.css('top', editor.helpers.getPX($el.data('top')) + scrollable_top)\n          }\n          else {\n            $el.data('top', 'auto')\n          }\n        }\n\n        if ($el.css('bottom')) {\n          if ($el.data('bottom') !== 'auto') {\n            $el.css('bottom', editor.helpers.getPX($el.data('bottom')) + scrollable_bottom)\n          }\n          else {\n            $el.css('bottom', 'auto')\n          }\n        }\n      }\n    }\n\n    // Shouldn't be fixed.\n    else if (!editor.node.hasClass($el.get(0), 'fr-sticky-off')) {\n\n        // Reset.\n      $el.width('')\n      $el.removeClass('fr-sticky-on')\n      $el.addClass('fr-sticky-off')\n\n      if ($el.css('top') && $el.data('top') !== 'auto' && position.top) {\n        $el.css('top', 0)\n      }\n\n      if ($el.css('bottom') && $el.data('bottom') !== 'auto' && position.bottom) {\n        $el.css('bottom', 0)\n      }\n    }\n  }\n\n  /**\n   * Test if browser supports sticky.\n   * https://github.com/filamentgroup/fixed-sticky\n   *\n   * The MIT License (MIT)\n   *\n   * Copyright (c) 2013 Filament Group\n   */\n  function _testSticky() {\n    const el = document.createElement('test')\n    const mStyle = el.style\n\n    mStyle.cssText = `position:${['-webkit-', '-moz-', '-ms-', '-o-', ''].join('sticky; position:')} sticky;`\n\n    return mStyle.position.indexOf('sticky') !== -1 && !editor.helpers.isIOS() && !editor.helpers.isAndroid() && !editor.browser.chrome\n  }\n\n  // Use an animation frame to make sure we're always OK with the updates.\n  function animate() {\n    editor.helpers.requestAnimationFrame()(animate)\n\n    if (editor.events.trigger('position.refresh') === false) {\n      return\n    }\n\n    for (let i = 0; i < editor._stickyElements.length; i++) {\n      _updateIOSSticky(editor._stickyElements[i])\n    }\n  }\n\n  /**\n   * Initialize sticky position.\n   */\n  function _initSticky() {\n    if (!_testSticky()) {\n      editor._stickyElements = []\n\n      // iOS special case.\n      if (editor.helpers.isIOS()) {\n        animate()\n\n        // Hide toolbar on touchmove. This is very useful on iOS versions < 8.\n        editor.events.$on($(editor.o_win), 'scroll', () => {\n          if (editor.core.hasFocus()) {\n            for (let i = 0; i < editor._stickyElements.length; i++) {\n              const $el = $(editor._stickyElements[i])\n              const $parent = $el.parent()\n              const c_scroll = editor.helpers.scrollTop()\n\n              if ($el.outerHeight() < c_scroll - $parent.offset().top) {\n                $el.addClass('fr-opacity-0')\n                $el.data('sticky-top', -1)\n                $el.data('sticky-scheduled', -1)\n              }\n            }\n          }\n        }, true)\n      }\n\n      // Default case. Do the updates on scroll.\n      else {\n        if (editor.opts.scrollableContainer !== 'body') {\n          editor.events.$on($(editor.opts.scrollableContainer), 'scroll', refresh, true)\n        }\n\n        editor.events.$on($(editor.o_win), 'scroll', refresh, true)\n        editor.events.$on($(editor.o_win), 'resize', refresh, true)\n\n        editor.events.on('initialized', refresh)\n        editor.events.on('focus', refresh)\n\n        editor.events.$on($(editor.o_win), 'resize', 'textarea', refresh, true)\n      }\n    }\n\n    editor.events.on('destroy', () => {\n      editor._stickyElements = []\n    })\n  }\n\n  function refresh() {\n    if (editor._stickyElements) {\n      for (let i = 0; i < editor._stickyElements.length; i++) {\n        _updateSticky(editor._stickyElements[i])\n      }\n    }\n  }\n\n  /**\n   * Mark element as sticky.\n   */\n  function addSticky($el) {\n    $el.addClass('fr-sticky')\n\n    if (editor.helpers.isIOS()) {\n      $el.addClass('fr-sticky-ios')\n    }\n\n    if (!_testSticky()) {\n      $el.removeClass('fr-sticky')\n      editor._stickyElements.push($el.get(0))\n    }\n  }\n\n  function _init() {\n    _initSticky()\n  }\n\n  return {\n    _init,\n    forSelection,\n    addSticky,\n    refresh,\n    at,\n    getBoundingRect\n  }\n}\n","import $ from 'jquery'\nimport FE from 'froala_editor'\n\nFE.MODULES.refresh = function (editor) {\n  function undo($btn) {\n    _setDisabled($btn, !editor.undo.canDo())\n  }\n\n  function redo($btn) {\n    _setDisabled($btn, !editor.undo.canRedo())\n  }\n\n  function indent($btn) {\n    if (editor.node.hasClass($btn.get(0), 'fr-no-refresh')) {\n      return false\n    }\n\n    const blocks = editor.selection.blocks()\n\n    for (let i = 0; i < blocks.length; i++) {\n      let p_node = blocks[i].previousSibling\n\n      while (p_node && p_node.nodeType === Node.TEXT_NODE && p_node.textContent.length === 0) {\n        p_node = p_node.previousSibling\n      }\n\n      if (blocks[i].tagName === 'LI' && !p_node) {\n        _setDisabled($btn, true)\n      }\n      else {\n        _setDisabled($btn, false)\n\n        return true\n      }\n    }\n  }\n\n  function outdent($btn) {\n    if (editor.node.hasClass($btn.get(0), 'fr-no-refresh')) {\n      return false\n    }\n\n    const blocks = editor.selection.blocks()\n\n    for (let i = 0; i < blocks.length; i++) {\n      const prop = editor.opts.direction === 'rtl' || $(blocks[i]).css('direction') === 'rtl' ? 'margin-right' : 'margin-left'\n\n      if (blocks[i].tagName === 'LI' || blocks[i].parentNode.tagName === 'LI') {\n        _setDisabled($btn, false)\n\n        return true\n      }\n\n      if (editor.helpers.getPX($(blocks[i]).css(prop)) > 0) {\n        _setDisabled($btn, false)\n\n        return true\n      }\n    }\n\n    _setDisabled($btn, true)\n  }\n\n  /**\n   * Disable/enable buton.\n   */\n  function _setDisabled($btn, disabled) {\n    $btn.toggleClass('fr-disabled', disabled).attr('aria-disabled', disabled)\n  }\n\n  return {\n    undo,\n    redo,\n    outdent,\n    indent\n  }\n}\n","import FE from 'froala_editor'\n\nObject.assign(FE.DEFAULTS, {\n  editInPopup: false\n})\n\nFE.MODULES.textEdit = function (editor) {\n  function _initPopup() {\n\n    // Image buttons.\n    const txt = `<div id=\"fr-text-edit-${editor.id}\" class=\"fr-layer fr-text-edit-layer\"><div class=\"fr-input-line\"><input type=\"text\" placeholder=\"${editor.language.translate('Text')}\" tabIndex=\"1\"></div><div class=\"fr-action-buttons\"><button type=\"button\" class=\"fr-command fr-submit\" data-cmd=\"updateText\" tabIndex=\"2\">${editor.language.translate('Update')}</button></div></div>`\n\n    const template = {\n      edit: txt\n    }\n\n    editor.popups.create('text.edit', template)\n  }\n\n  function _showPopup() {\n    const $popup = editor.popups.get('text.edit')\n\n    let text\n\n    if (editor.$el.prop('tagName') === 'INPUT') {\n      text = editor.$el.attr('placeholder')\n    }\n    else {\n      text = editor.$el.text()\n    }\n\n    $popup.find('input').val(text).trigger('change')\n    editor.popups.setContainer('text.edit', editor.$sc)\n    editor.popups.show('text.edit', editor.$el.offset().left + editor.$el.outerWidth() / 2, editor.$el.offset().top + editor.$el.outerHeight(), editor.$el.outerHeight())\n  }\n\n  function _initEvents() {\n\n    // Show edit popup.\n    editor.events.$on(editor.$el, editor._mouseup, () => {\n      setTimeout(() => {\n        _showPopup()\n      }, 10)\n    })\n  }\n\n  function update() {\n    const $popup = editor.popups.get('text.edit')\n\n    let new_text = $popup.find('input').val()\n\n    if (new_text.length === 0) {\n      new_text = editor.opts.placeholderText\n    }\n\n    if (editor.$el.prop('tagName') === 'INPUT') {\n      editor.$el.attr('placeholder', new_text)\n    }\n    else {\n      editor.$el.text(new_text)\n    }\n\n    editor.events.trigger('contentChanged')\n\n    editor.popups.hide('text.edit')\n  }\n\n  /**\n   * Initialize.\n   */\n  function _init() {\n    if (editor.opts.editInPopup) {\n      _initPopup()\n      _initEvents()\n    }\n  }\n\n  return {\n    _init,\n    update\n  }\n}\n\nFE.RegisterCommand('updateText', {\n  focus: false,\n  undo: false,\n  callback() {\n    this.textEdit.update()\n  }\n})\n","import $ from 'jquery'\nimport FE from 'froala_editor'\n\n// Extend defaults.\nObject.assign(FE.DEFAULTS, {\n  toolbarBottom: false,\n  toolbarButtons: null,\n  toolbarButtonsXS: null,\n  toolbarButtonsSM: null,\n  toolbarButtonsMD: null,\n  toolbarContainer: null,\n  toolbarInline: false,\n  toolbarSticky: true,\n  toolbarStickyOffset: 0,\n  toolbarVisibleWithoutSelection: false\n})\n\n// Default toolbar buttons.\nFE.TOOLBAR_BUTTONS = ['fullscreen', 'bold', 'italic', 'underline', 'strikeThrough', 'subscript', 'superscript', '|', 'fontFamily', 'fontSize', 'color', 'inlineStyle', 'paragraphStyle', '|', 'paragraphFormat', 'align', 'formatOL', 'formatUL', 'outdent', 'indent', 'quote', '-', 'insertLink', 'insertImage', 'insertVideo', 'embedly', 'insertFile', 'insertTable', '|', 'emoticons', 'specialCharacters', 'insertHR', 'selectAll', 'clearFormatting', '|', 'print', 'spellChecker', 'help', 'html', '|', 'undo', 'redo']\nFE.TOOLBAR_BUTTONS_MD = null\nFE.TOOLBAR_BUTTONS_SM = ['bold', 'italic', 'underline', '|', 'fontFamily', 'fontSize', 'insertLink', 'insertImage', 'table', '|', 'undo', 'redo']\nFE.TOOLBAR_BUTTONS_XS = ['bold', 'italic', 'fontFamily', 'fontSize', '|', 'undo', 'redo']\n\nFE.MODULES.toolbar = function (editor) {\n\n  // Create a button map for each screen size.\n  const _buttons_map = []\n  _buttons_map[FE.XS] = editor.opts.toolbarButtonsXS || editor.opts.toolbarButtons || FE.TOOLBAR_BUTTONS_XS || FE.TOOLBAR_BUTTONS || []\n  _buttons_map[FE.SM] = editor.opts.toolbarButtonsSM || editor.opts.toolbarButtons || FE.TOOLBAR_BUTTONS_SM || FE.TOOLBAR_BUTTONS || []\n  _buttons_map[FE.MD] = editor.opts.toolbarButtonsMD || editor.opts.toolbarButtons || FE.TOOLBAR_BUTTONS_MD || FE.TOOLBAR_BUTTONS || []\n  _buttons_map[FE.LG] = editor.opts.toolbarButtons || FE.TOOLBAR_BUTTONS || []\n\n  function _addOtherButtons(buttons, toolbarButtons) {\n    for (let i = 0; i < toolbarButtons.length; i++) {\n      if (toolbarButtons[i] !== '-' && toolbarButtons[i] !== '|' && buttons.indexOf(toolbarButtons[i]) < 0) {\n        buttons.push(toolbarButtons[i])\n      }\n    }\n  }\n\n  /**\n   * Add buttons to the toolbar.\n   */\n  function _addButtons() {\n    const _buttons = $.merge([], _screenButtons())\n    _addOtherButtons(_buttons, _buttons_map[FE.XS])\n    _addOtherButtons(_buttons, _buttons_map[FE.SM])\n    _addOtherButtons(_buttons, _buttons_map[FE.MD])\n    _addOtherButtons(_buttons, _buttons_map[FE.LG])\n\n    for (let i = _buttons.length - 1; i >= 0; i--) {\n      if (_buttons[i] !== '-' && _buttons[i] !== '|' && _buttons.indexOf(_buttons[i]) < i) {\n        _buttons.splice(i, 1)\n      }\n    }\n\n    const buttons_list = editor.button.buildList(_buttons, _screenButtons())\n    editor.$tb.append(buttons_list)\n    editor.button.bindCommands(editor.$tb)\n  }\n\n  /**\n   * The buttons that should be visible on the current screen size.\n   */\n  function _screenButtons() {\n    const screen_size = editor.helpers.screenSize()\n\n    return _buttons_map[screen_size]\n  }\n\n  function _showScreenButtons() {\n    const c_buttons = _screenButtons()\n\n    // Remove separator from toolbar.\n    editor.$tb.find('.fr-separator').remove()\n\n    // Hide all buttons.\n    editor.$tb.find('> .fr-command').addClass('fr-hidden')\n\n    // Reorder buttons.\n    for (let i = 0; i < c_buttons.length; i++) {\n      if (c_buttons[i] === '|' || c_buttons[i] === '-') {\n        editor.$tb.append(editor.button.buildList([c_buttons[i]]))\n      }\n      else {\n        const $btn = editor.$tb.find(`> .fr-command[data-cmd=\"${c_buttons[i]}\"]`)\n        let $dropdown = null\n\n        if (editor.node.hasClass($btn.next().get(0), 'fr-dropdown-menu')) {\n          $dropdown = $btn.next()\n        }\n\n        $btn.removeClass('fr-hidden')\n        editor.$tb.append($btn)\n\n        if ($dropdown) {\n          editor.$tb.append($dropdown)\n        }\n      }\n    }\n  }\n\n  /**\n   * Set the buttons visibility based on screen size.\n   */\n  function _setVisibility() {\n    editor.events.$on($(editor.o_win), 'resize', _showScreenButtons)\n    editor.events.$on($(editor.o_win), 'orientationchange', _showScreenButtons)\n  }\n\n  function showInline(e, force) {\n    setTimeout(() => {\n      if ((!e || e.which !== FE.KEYCODE.ESC) && editor.selection.inEditor() && editor.core.hasFocus() && !editor.popups.areVisible()) {\n        if (editor.opts.toolbarVisibleWithoutSelection || !editor.selection.isCollapsed() && !editor.keys.isIME() || force) {\n          editor.$tb.data('instance', editor)\n\n          // Check if we should actually show the toolbar.\n          if (editor.events.trigger('toolbar.show', [e]) === false) {\n            return\n          }\n\n          editor.$tb.show()\n\n          if (!editor.opts.toolbarContainer) {\n            editor.position.forSelection(editor.$tb)\n          }\n\n          if (editor.opts.zIndex > 1) {\n            editor.$tb.css('z-index', editor.opts.zIndex + 1)\n          }\n          else {\n            editor.$tb.css('z-index', null)\n          }\n        }\n      }\n    }, 0)\n  }\n\n  function hide(e) {\n\n    // Prevent hiding the editor toolbar when changing the window.\n    if (e && e.type === 'blur' && document.activeElement === editor.el) {\n      return false\n    }\n\n    // Do not hide toolbar if we press CTRL.\n    if (e && e.type === 'keydown' && editor.keys.ctrlKey(e)) {\n      return true\n    }\n\n    // Prevent hiding when dropdown is active and we scoll in it.\n    // https://github.com/froala/wysiwyg-editor/issues/1290\n    const $active_dropdowns = editor.button.getButtons('.fr-dropdown.fr-active')\n\n    if ($active_dropdowns.next().find(editor.o_doc.activeElement).length) {\n      return true\n    }\n\n    // Check if we should actually hide the toolbar.\n    if (editor.events.trigger('toolbar.hide') !== false) {\n      editor.$tb.hide()\n    }\n  }\n\n  function show() {\n\n    // Check if we should actually hide the toolbar.\n    if (editor.events.trigger('toolbar.show') === false) {\n      return false\n    }\n\n    editor.$tb.show()\n  }\n\n  let tm = null\n\n  function _showInlineWithTimeout(e) {\n    clearTimeout(tm)\n\n    if (!e || e.which !== FE.KEYCODE.ESC) {\n      tm = setTimeout(showInline, editor.opts.typingTimer)\n    }\n  }\n\n  /**\n   * Set the events for show / hide toolbar.\n   */\n  function _initInlineBehavior() {\n\n    // Window mousedown.\n    editor.events.on('window.mousedown', hide)\n\n    // Element keydown.\n    editor.events.on('keydown', hide)\n\n    // Element blur.\n    editor.events.on('blur', hide)\n\n    // Window mousedown.\n    if (!editor.helpers.isMobile()) {\n      editor.events.on('window.mouseup', showInline)\n    }\n\n    if (editor.helpers.isMobile()) {\n      if (!editor.helpers.isIOS()) {\n        editor.events.on('window.touchend', showInline)\n\n        if (editor.browser.mozilla) {\n          setInterval(showInline, 200)\n        }\n      }\n    }\n    else {\n      editor.events.on('window.keyup', _showInlineWithTimeout)\n    }\n\n    // Hide editor on ESC.\n    editor.events.on('keydown', (e) => {\n      if (e && e.which === FE.KEYCODE.ESC) {\n        hide()\n      }\n    })\n\n    // Enable accessibility shortcut.\n    editor.events.on('keydown', (e) => {\n      if (e.which === FE.KEYCODE.ALT) {\n        e.stopPropagation()\n\n        return false\n      }\n    }, true)\n\n    editor.events.$on(editor.$wp, 'scroll.toolbar', showInline)\n    editor.events.on('commands.after', showInline)\n\n    if (editor.helpers.isMobile()) {\n      editor.events.$on(editor.$doc, 'selectionchange', _showInlineWithTimeout)\n      editor.events.$on(editor.$doc, 'orientationchange', showInline)\n    }\n  }\n\n\n  function _initPositioning() {\n\n    // Toolbar is inline.\n    if (editor.opts.toolbarInline) {\n\n      // Mobile should handle this as regular.\n      editor.$sc.append(editor.$tb)\n\n      // Add toolbar to body.\n      editor.$tb.data('container', editor.$sc)\n\n      // Add inline class.\n      editor.$tb.addClass('fr-inline')\n\n      // Add arrow.\n      editor.$tb.prepend('<span class=\"fr-arrow\"></span>')\n\n      // Init mouse behavior.\n      _initInlineBehavior()\n\n      editor.opts.toolbarBottom = false\n    }\n\n    // Toolbar is normal.\n    else {\n\n      // Won't work on iOS.\n      if (editor.opts.toolbarBottom && !editor.helpers.isIOS()) {\n        editor.$box.append(editor.$tb)\n        editor.$tb.addClass('fr-bottom')\n        editor.$box.addClass('fr-bottom')\n      }\n      else {\n        editor.opts.toolbarBottom = false\n        editor.$box.prepend(editor.$tb)\n        editor.$tb.addClass('fr-top')\n        editor.$box.addClass('fr-top')\n      }\n\n      editor.$tb.addClass('fr-basic')\n\n      if (editor.opts.toolbarSticky) {\n        if (editor.opts.toolbarStickyOffset) {\n          if (editor.opts.toolbarBottom) {\n            editor.$tb.css('bottom', editor.opts.toolbarStickyOffset)\n          }\n          else {\n            editor.$tb.css('top', editor.opts.toolbarStickyOffset)\n          }\n        }\n\n        editor.position.addSticky(editor.$tb)\n      }\n    }\n  }\n\n  /**\n   * Destroy.\n   */\n  function _sharedDestroy() {\n    editor.$tb.html('').removeData().remove()\n    editor.$tb = null\n  }\n\n  function _destroy() {\n    editor.$box.removeClass('fr-top fr-bottom fr-inline fr-basic')\n    editor.$box.find('.fr-sticky-dummy').remove()\n  }\n\n  function _setDefaults() {\n    if (editor.opts.theme) {\n      editor.$tb.addClass(`${editor.opts.theme}-theme`)\n    }\n\n    if (editor.opts.zIndex > 1) {\n      editor.$tb.css('z-index', editor.opts.zIndex + 1)\n    }\n\n    // Set direction.\n    if (editor.opts.direction !== 'auto') {\n      editor.$tb.removeClass('fr-ltr fr-rtl').addClass(`fr-${editor.opts.direction}`)\n    }\n\n    // Mark toolbar for desktop / mobile.\n    if (!editor.helpers.isMobile()) {\n      editor.$tb.addClass('fr-desktop')\n    }\n    else {\n      editor.$tb.addClass('fr-mobile')\n    }\n\n    // Set the toolbar specific position inline / normal.\n    if (!editor.opts.toolbarContainer) {\n      _initPositioning()\n    }\n    else {\n      if (editor.opts.toolbarInline) {\n        _initInlineBehavior()\n        hide()\n      }\n\n      if (editor.opts.toolbarBottom) {\n        editor.$tb.addClass('fr-bottom')\n      }\n      else {\n        editor.$tb.addClass('fr-top')\n      }\n    }\n\n    // Add buttons to the toolbar.\n    // Set their visibility for different screens.\n    // Asses commands to the butttons.\n    _addButtons()\n    _setVisibility()\n\n    editor.accessibility.registerToolbar(editor.$tb)\n\n    // Make sure we don't trigger blur.\n    editor.events.$on(editor.$tb, `${editor._mousedown} ${editor._mouseup}`, (e) => {\n      const originalTarget = e.originalEvent ? e.originalEvent.target || e.originalEvent.originalTarget : null\n\n      if (originalTarget && originalTarget.tagName !== 'INPUT' && !editor.edit.isDisabled()) {\n        e.stopPropagation()\n        e.preventDefault()\n\n        return false\n      }\n    }, true)\n  }\n\n  /**\n   * Initialize\n   */\n  function _init() {\n    editor.$sc = $(editor.opts.scrollableContainer).first()\n\n    if (!editor.$wp) {\n      return false\n    }\n\n    // Container for toolbar.\n    if (editor.opts.toolbarContainer) {\n\n      // Shared toolbar.\n      if (!editor.shared.$tb) {\n        editor.shared.$tb = $(editor.doc.createElement('DIV'))\n        editor.shared.$tb.addClass('fr-toolbar')\n        editor.$tb = editor.shared.$tb\n        $(editor.opts.toolbarContainer).append(editor.$tb)\n        _setDefaults()\n        editor.$tb.data('instance', editor)\n      }\n      else {\n        editor.$tb = editor.shared.$tb\n\n        if (editor.opts.toolbarInline) {\n          _initInlineBehavior()\n        }\n      }\n\n      if (editor.opts.toolbarInline) {\n\n        // Update box.\n        editor.$box.addClass('fr-inline')\n      }\n      else {\n        editor.$box.addClass('fr-basic')\n      }\n\n      // On focus set the current instance.\n      editor.events.on('focus', () => {\n        editor.$tb.data('instance', editor)\n      }, true)\n\n      editor.opts.toolbarInline = false\n    }\n    else if (editor.opts.toolbarInline) {\n      // Update box.\n      editor.$box.addClass('fr-inline')\n\n      // Check for shared toolbar.\n      if (!editor.shared.$tb) {\n        editor.shared.$tb = $(editor.doc.createElement('DIV'))\n        editor.shared.$tb.addClass('fr-toolbar')\n        editor.$tb = editor.shared.$tb\n        _setDefaults()\n      }\n      else {\n        editor.$tb = editor.shared.$tb\n\n        // Init mouse behavior.\n        _initInlineBehavior()\n      }\n    }\n    else {\n      editor.$box.addClass('fr-basic')\n      editor.$tb = $(editor.doc.createElement('DIV'))\n      editor.$tb.addClass('fr-toolbar')\n      _setDefaults()\n\n      editor.$tb.data('instance', editor)\n    }\n\n    // Destroy.\n    editor.events.on('destroy', _destroy, true)\n    editor.events.on(!editor.opts.toolbarInline && !editor.opts.toolbarContainer ? 'destroy' : 'shared.destroy', _sharedDestroy, true)\n  }\n\n  let disabled = false\n\n  function disable() {\n    if (!disabled && editor.$tb) {\n      editor.$tb.find('> .fr-command').addClass('fr-disabled fr-no-refresh').attr('aria-disabled', true)\n      disabled = true\n    }\n  }\n\n  function enable() {\n    if (disabled && editor.$tb) {\n      editor.$tb.find('> .fr-command').removeClass('fr-disabled fr-no-refresh').attr('aria-disabled', false)\n      disabled = false\n    }\n\n    editor.button.bulkRefresh()\n  }\n\n  return {\n    _init,\n    hide,\n    show,\n    showInline,\n    disable,\n    enable\n  }\n}\n","import './modules/accessibility.js'\nimport './modules/clean.js'\nimport './modules/commands.js'\nimport './modules/core.js'\nimport './modules/cursor_lists.js'\nimport './modules/cursor.js'\nimport './modules/data.min.js'\nimport './modules/edit.js'\nimport './modules/events.js'\nimport './modules/format.js'\nimport './modules/helpers.js'\nimport './modules/html.js'\nimport './modules/keys.js'\nimport './modules/paste.js'\nimport './modules/shortcuts.js'\nimport './modules/snapshot.js'\nimport './modules/undo.js'\nimport './modules/dom/markers.js'\nimport './modules/dom/node.js'\nimport './modules/dom/selection.js'\nimport './modules/dom/spaces.js'\nimport './modules/options/language.js'\nimport './modules/options/size.js'\nimport './modules/ui/button.js'\nimport './modules/ui/icon.js'\nimport './modules/ui/modals.js'\nimport './modules/ui/popups.js'\nimport './modules/ui/position.js'\nimport './modules/ui/refresh.js'\nimport './modules/ui/text_edit.js'\nimport './modules/ui/toolbar.js'\nimport './modules/ui/tooltip.js'\n\nimport $ from 'jquery'\n/*  global $  */\nimport FroalaEditor from 'froala_editor'\n\nconst FE = FroalaEditor\n\nfunction init(e) {\n  if (e.type === 'touchend' && !this.$el.data('touched')) {\n    return true\n  }\n\n  if (e.which === 1 || !e.which) {\n    this.$el.off('mousedown.init touchstart.init touchmove.init touchend.init dragenter.init focus.init')\n\n    this.load(FE.MODULES)\n    this.load(FE.PLUGINS)\n\n    const target = e.originalEvent && e.originalEvent.originalTarget\n\n    if (target && target.tagName === 'IMG') {\n      $(target).trigger('mousedown')\n    }\n\n    if (typeof this.ul === 'undefined') {\n      this.destroy()\n    }\n\n    if (e.type === 'touchend' && this.image && e.originalEvent && e.originalEvent.target && $(e.originalEvent.target).is('img')) {\n      const that = this\n\n      setTimeout(() => {\n        that.image.edit($(e.originalEvent.target))\n      }, 100)\n    }\n\n    this.ready = true\n    this.events.trigger('initialized')\n  }\n}\n\nfunction doInit() {\n  this.doc = this.$el.get(0).ownerDocument\n  this.win = 'defaultView' in this.doc ? this.doc.defaultView : this.doc.parentWindow\n  this.$doc = $(this.doc)\n  this.$win = $(this.win)\n\n  if (!this.opts.pluginsEnabled) {\n    this.opts.pluginsEnabled = Object.keys(FE.PLUGINS)\n  }\n\n  if (this.opts.initOnClick) {\n    this.load(FE.MODULES)\n\n    // https://github.com/froala/wysiwyg-editor/issues/1207.\n    this.$el.on('touchstart.init', function () {\n      $(this).data('touched', true)\n    })\n\n    this.$el.on('touchmove.init', function () {\n      $(this).removeData('touched')\n    })\n\n    this.$el.on('mousedown.init touchend.init dragenter.init focus.init', init.bind(this))\n\n    this.events.trigger('initializationDelayed')\n  }\n  else {\n    this.load(FE.MODULES)\n    this.load(FE.PLUGINS)\n\n    $(this.o_win).scrollTop(this.c_scroll)\n\n    if (typeof this.ul === 'undefined') {\n      this.destroy()\n    }\n\n    this.ready = true\n    this.events.trigger('initialized')\n  }\n}\n\nFE.Bootstrap = function (element, options) {\n  this.id = ++FE.ID\n  this.$ = $\n\n  this.opts = Object.assign({}, Object.assign({}, FE.DEFAULTS, typeof options === 'object' && options))\n  const opts_string = JSON.stringify(this.opts)\n\n  FE.OPTS_MAPPING[opts_string] = FE.OPTS_MAPPING[opts_string] || this.id\n  this.sid = FE.OPTS_MAPPING[opts_string]\n  FE.SHARED[this.sid] = FE.SHARED[this.sid] || {}\n  this.shared = FE.SHARED[this.sid]\n  this.shared.count = (this.shared.count || 0) + 1\n\n  this.$oel = $(element)\n  this.$oel.data('froala.editor', this)\n\n  this.o_doc = element.ownerDocument\n  this.o_win = 'defaultView' in this.o_doc ? this.o_doc.defaultView : this.o_doc.parentWindow\n  this.c_scroll = $(this.o_win).scrollTop()\n\n  this._init()\n}\n\nFE.Bootstrap.prototype._init = function () {\n\n  // Get the tag name of the original element.\n  const tag_name = this.$oel.get(0).tagName\n\n  if (this.$oel.closest('label').length >= 1) {\n    console.warn('Note! It is not recommended to initialize the Froala Editor within a label tag.')\n  }\n\n  const initOnDefault = function () {\n    if (tag_name !== 'TEXTAREA') {\n      this._original_html = this._original_html || this.$oel.html()\n    }\n\n    this.$box = this.$box || this.$oel\n\n    // Turn on iframe if fullPage is on.\n    if (this.opts.fullPage) {\n      this.opts.iframe = true\n    }\n\n    if (!this.opts.iframe) {\n      this.$el = $(this.o_doc.createElement('DIV'))\n      this.el = this.$el.get(0)\n      this.$wp = $(this.o_doc.createElement('DIV')).append(this.$el)\n      this.$box.html(this.$wp)\n\n      setTimeout(doInit.bind(this), 0)\n    }\n    else {\n      this.$iframe = $('<iframe src=\"about:blank\" frameBorder=\"0\">')\n      this.$wp = $('<div></div>')\n      this.$box.html(this.$wp)\n      this.$wp.append(this.$iframe)\n      this.$iframe.get(0).contentWindow.document.open()\n      this.$iframe.get(0).contentWindow.document.write('<!DOCTYPE html>')\n      this.$iframe.get(0).contentWindow.document.write('<html><head></head><body></body></html>')\n      this.$iframe.get(0).contentWindow.document.close()\n\n      this.iframe_document = this.$iframe.get(0).contentWindow.document\n\n      this.$el = $(this.iframe_document.querySelector('body'))\n      this.el = this.$el.get(0)\n      this.$head = $(this.iframe_document.querySelector('head'))\n      this.$html = $(this.iframe_document.querySelector('html'))\n\n      setTimeout(doInit.bind(this), 0)\n    }\n  }.bind(this)\n\n  const initOnTextarea = function () {\n    this.$box = $('<div>')\n    this.$oel.before(this.$box).hide()\n\n    this._original_html = this.$oel.val()\n\n    // Before submit textarea do a sync.\n    const that = this\n\n    this.$oel.parents('form').on(`submit.${this.id}`, () => {\n      that.events.trigger('form.submit')\n    })\n\n    this.$oel.parents('form').on(`reset.${this.id}`, () => {\n      that.events.trigger('form.reset')\n    })\n\n    initOnDefault()\n  }.bind(this)\n\n  const initOnA = function () {\n    this.$el = this.$oel\n    this.el = this.$el.get(0)\n    this.$el.attr('contenteditable', true).css('outline', 'none').css('display', 'inline-block')\n    this.opts.multiLine = false\n    this.opts.toolbarInline = false\n\n    setTimeout(doInit.bind(this), 0)\n  }.bind(this)\n\n  const initOnImg = function () {\n    this.$el = this.$oel\n    this.el = this.$el.get(0)\n    this.opts.toolbarInline = false\n\n    setTimeout(doInit.bind(this), 0)\n  }.bind(this)\n\n  const editInPopup = function () {\n    this.$el = this.$oel\n    this.el = this.$el.get(0)\n    this.opts.toolbarInline = false\n\n    this.$oel.on('click.popup', (e) => {\n      e.preventDefault()\n    })\n\n    setTimeout(doInit.bind(this), 0)\n  }.bind(this)\n\n  // Check on what element it was initialized.\n  if (this.opts.editInPopup) {\n    editInPopup()\n  }\n  else if (tag_name === 'TEXTAREA') {\n    initOnTextarea()\n  }\n  else if (tag_name === 'A') {\n    initOnA()\n  }\n  else if (tag_name === 'IMG') {\n    initOnImg()\n  }\n  else if (tag_name === 'BUTTON' || tag_name === 'INPUT') {\n    this.opts.editInPopup = true\n    this.opts.toolbarInline = false\n    editInPopup()\n  }\n  else {\n    initOnDefault()\n  }\n}\n\nFE.Bootstrap.prototype.load = function (module_list) {\n  // Bind modules to the current instance and tear them up.\n  for (const m_name in module_list) {\n    if (Object.prototype.hasOwnProperty.call(module_list, m_name)) {\n      if (this[m_name]) {\n        continue\n      }\n\n      // Do not include plugin.\n      if (FE.PLUGINS[m_name] && this.opts.pluginsEnabled.indexOf(m_name) < 0) {\n        continue\n      }\n\n      this[m_name] = new module_list[m_name](this)\n\n      if (this[m_name]._init) {\n        this[m_name]._init()\n\n        if (this.opts.initOnClick && m_name === 'core') {\n\n          return false\n        }\n      }\n    }\n  }\n}\n\nFE.Bootstrap.prototype.destroy = function () {\n  this.shared.count--\n\n  this.events.$off()\n\n  // HTML.\n  const html = this.html.get()\n\n  // Focus main frame.\n  if (this.opts.iframe) {\n    this.events.disableBlur()\n    this.win.focus()\n    this.events.enableBlur()\n  }\n\n  this.events.trigger('destroy', [], true)\n  this.events.trigger('shared.destroy', [], true)\n\n  // Remove shared.\n  if (this.shared.count === 0) {\n    for (const k in this.shared) {\n      if (Object.prototype.hasOwnProperty.call(this.shared, k)) {\n        this.shared[k] = null\n        FE.SHARED[this.sid][k] = null\n      }\n    }\n\n    delete FE.SHARED[this.sid]\n  }\n\n  this.$oel.parents('form').off(`.${this.id}`)\n  this.$oel.off('click.popup')\n  this.$oel.removeData('froala.editor')\n\n  this.$oel.off('froalaEditor')\n\n  // Destroy editor basic elements.\n  this.core.destroy(html)\n\n  FE.INSTANCES.splice(FE.INSTANCES.indexOf(this), 1)\n}\n\nexport default FroalaEditor\n","import FE from 'FroalaEditor';\n\nFE.DefineIcon('align', { NAME: 'align-left' });\nFE.DefineIcon('align-left', { NAME: 'align-left' });\nFE.DefineIcon('align-right', { NAME: 'align-right' });\nFE.DefineIcon('align-center', { NAME: 'align-center' });\nFE.DefineIcon('align-justify', { NAME: 'align-justify' });\nFE.RegisterCommand('align', {\n  type: 'dropdown',\n  title: 'Align',\n  options: {\n    left: 'Align Left',\n    center: 'Align Center',\n    right: 'Align Right',\n    justify: 'Align Justify'\n  },\n  html: function () {\n    var c = '<ul class=\"fr-dropdown-list\" role=\"presentation\">';\n    var options =  FE.COMMANDS.align.options;\n\n    for (var val in options) {\n      if (Object.prototype.hasOwnProperty.call(options, val)) {\n        c += '<li role=\"presentation\"><a class=\"fr-command fr-title\" tabIndex=\"-1\" role=\"option\" data-cmd=\"align\" data-param1=\"' + val + '\" title=\"' + this.language.translate(options[val]) + '\">' + this.icon.create('align-' + val) + '<span class=\"fr-sr-only\">' + this.language.translate(options[val]) + '</span></a></li>';\n      }\n    }\n    c += '</ul>';\n\n    return c;\n  },\n  callback: function (cmd, val) {\n    this.align.apply(val);\n  },\n  refresh: function ($btn) {\n    this.align.refresh($btn);\n  },\n  refreshOnShow: function ($btn, $dropdown) {\n    this.align.refreshOnShow($btn, $dropdown);\n  },\n  plugin: 'align'\n})\n\nFE.PLUGINS.align = function (editor) {\n  let $ = editor.$;\n\n  function apply (val) {\n\n    var el = editor.selection.element();\n\n    if ($(el).parents('.fr-img-caption').length) {\n      $(el).css('text-align', val);\n    }\n    else {\n      // Wrap.\n      editor.selection.save();\n      editor.html.wrap(true, true, true, true);\n      editor.selection.restore();\n\n      var blocks = editor.selection.blocks();\n\n      for (var i = 0; i < blocks.length; i++) {\n\n        // Check if we should reset to default value.\n        if (editor.helpers.getAlignment($(blocks[i].parentNode)) == val) {\n          $(blocks[i]).css('text-align', '').removeClass('fr-temp-div');\n        }\n        else {\n          $(blocks[i]).css('text-align', val).removeClass('fr-temp-div');\n        }\n\n        if ($(blocks[i]).attr('class') === '') $(blocks[i]).removeAttr('class');\n\n        if ($(blocks[i]).attr('style') === '') $(blocks[i]).removeAttr('style');\n      }\n\n      editor.selection.save();\n      editor.html.unwrap();\n      editor.selection.restore();\n    }\n  }\n\n  function refresh ($btn) {\n    var blocks = editor.selection.blocks();\n\n    if (blocks.length) {\n      var alignment = editor.helpers.getAlignment($(blocks[0]));\n\n      $btn.find('> *').first().replaceWith(editor.icon.create('align-' + alignment));\n    }\n  }\n\n  function refreshOnShow($btn, $dropdown) {\n    var blocks = editor.selection.blocks();\n\n    if (blocks.length) {\n      var alignment = editor.helpers.getAlignment($(blocks[0]));\n\n      $dropdown.find('a.fr-command[data-param1=\"' + alignment + '\"]').addClass('fr-active').attr('aria-selected', true);\n    }\n  }\n\n  return {\n    apply: apply,\n    refresh: refresh,\n    refreshOnShow: refreshOnShow\n  }\n}\n","import FE from 'FroalaEditor';\n\n// Extend defaults.\nObject.assign(FE.DEFAULTS, {\n  charCounterMax: -1,\n  charCounterCount: true\n});\n\n\nFE.PLUGINS.charCounter = function (editor) {\n  let $ = editor.$;\n\n  var $counter;\n\n  /**\n   * Get the char number.\n   */\n  function count () {\n    return (editor.el.textContent || '').replace(/\\u200B/g, '').length;\n  }\n\n  /**\n   * Check chars on typing.\n   */\n  function _checkCharNumber (e) {\n\n    // Continue if infinite characters;\n    if (editor.opts.charCounterMax < 0) return true;\n\n    // Continue if enough characters.\n    if (count() < editor.opts.charCounterMax) return true;\n\n    // Stop if the key will produce a new char.\n    var keyCode = e.which;\n\n    if ((!editor.keys.ctrlKey(e) && editor.keys.isCharacter(keyCode)) || (keyCode === FE.KEYCODE.IME)) {\n      e.preventDefault();\n      e.stopPropagation();\n      editor.events.trigger('charCounter.exceeded');\n\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Check chars on paste.\n   */\n  function _checkCharNumberOnPaste (html) {\n    if (editor.opts.charCounterMax < 0) return html;\n\n    var len = $('<div>').html(html).text().length;\n\n    if (len + count() <= editor.opts.charCounterMax) return html;\n\n    editor.events.trigger('charCounter.exceeded');\n\n    return '';\n  }\n\n  /**\n   * Update the char counter.\n   */\n  function _updateCharNumber () {\n    if (editor.opts.charCounterCount) {\n      var chars = count() + (editor.opts.charCounterMax > 0 ?  '/' + editor.opts.charCounterMax : '');\n\n      $counter.text(chars);\n\n      if (editor.opts.toolbarBottom) {\n        $counter.css('margin-bottom', editor.$tb.outerHeight(true))\n      }\n\n      // Scroll size correction.\n      var scroll_size = editor.$wp.get(0).offsetWidth - editor.$wp.get(0).clientWidth;\n\n      if (scroll_size >= 0) {\n        if (editor.opts.direction == 'rtl') {\n          $counter.css('margin-left', scroll_size);\n        }\n        else {\n          $counter.css('margin-right', scroll_size);\n        }\n      }\n    }\n  }\n\n  /*\n   * Initialize.\n   */\n  function _init () {\n    if (!editor.$wp) return false;\n\n    if (!editor.opts.charCounterCount) return false;\n\n    $counter = $(editor.doc.createElement('span')).addClass('fr-counter');\n    $counter.css('bottom', editor.$wp.css('border-bottom-width'));\n    editor.$box.append($counter);\n\n    editor.events.on('keydown', _checkCharNumber, true);\n    editor.events.on('paste.afterCleanup', _checkCharNumberOnPaste);\n    editor.events.on('keyup contentChanged input', function () {\n      editor.events.trigger('charCounter.update');\n    });\n\n    editor.events.on('charCounter.update', _updateCharNumber);\n    editor.events.trigger('charCounter.update');\n\n    editor.events.on('destroy', function () {\n      $(editor.o_win).off('resize.char' + editor.id);\n      $counter.removeData().remove();\n      $counter = null;\n    });\n  }\n\n  return {\n    _init: _init,\n    count: count\n  }\n}\n","import FE from 'FroalaEditor';\n\nFE.PLUGINS.codeBeautifier = function () {\n  /**\n   * HTML BEAUTIFIER\n   *\n   * LICENSE: The MIT License (MIT)\n   *\n   * Written by Nochum Sossonko, (nsossonko@hotmail.com)\n   *\n   * Based on code initially developed by: Einar Lielmanis, <einar@jsbeautifier.org>\n   * http://jsbeautifier.org/\n   *\n   */\n  /* jshint ignore:start */\n  /* jscs:disable */\n\n\n  var acorn = {};\n  (function(exports) {\n      /* jshint curly: false */\n      // This section of code is taken from acorn.\n      //\n      // Acorn was written by Marijn Haverbeke and released under an MIT\n      // license. The Unicode regexps (for identifiers and whitespace) were\n      // taken from [Esprima](http://esprima.org) by Ariya Hidayat.\n      //\n      // Git repositories for Acorn are available at\n      //\n      //     http://marijnhaverbeke.nl/git/acorn\n      //     https://github.com/marijnh/acorn.git\n\n      // ## Character categories\n\n      // Big ugly regular expressions that match characters in the\n      // whitespace, identifier, and identifier-start categories. These\n      // are only applied when a character is found to actually have a\n      // code point above 128.\n\n      var nonASCIIwhitespace = /[\\u1680\\u180e\\u2000-\\u200a\\u202f\\u205f\\u3000\\ufeff]/; // jshint ignore:line\n      var nonASCIIidentifierStartChars = \"\\xaa\\xb5\\xba\\xc0-\\xd6\\xd8-\\xf6\\xf8-\\u02c1\\u02c6-\\u02d1\\u02e0-\\u02e4\\u02ec\\u02ee\\u0370-\\u0374\\u0376\\u0377\\u037a-\\u037d\\u0386\\u0388-\\u038a\\u038c\\u038e-\\u03a1\\u03a3-\\u03f5\\u03f7-\\u0481\\u048a-\\u0527\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05d0-\\u05ea\\u05f0-\\u05f2\\u0620-\\u064a\\u066e\\u066f\\u0671-\\u06d3\\u06d5\\u06e5\\u06e6\\u06ee\\u06ef\\u06fa-\\u06fc\\u06ff\\u0710\\u0712-\\u072f\\u074d-\\u07a5\\u07b1\\u07ca-\\u07ea\\u07f4\\u07f5\\u07fa\\u0800-\\u0815\\u081a\\u0824\\u0828\\u0840-\\u0858\\u08a0\\u08a2-\\u08ac\\u0904-\\u0939\\u093d\\u0950\\u0958-\\u0961\\u0971-\\u0977\\u0979-\\u097f\\u0985-\\u098c\\u098f\\u0990\\u0993-\\u09a8\\u09aa-\\u09b0\\u09b2\\u09b6-\\u09b9\\u09bd\\u09ce\\u09dc\\u09dd\\u09df-\\u09e1\\u09f0\\u09f1\\u0a05-\\u0a0a\\u0a0f\\u0a10\\u0a13-\\u0a28\\u0a2a-\\u0a30\\u0a32\\u0a33\\u0a35\\u0a36\\u0a38\\u0a39\\u0a59-\\u0a5c\\u0a5e\\u0a72-\\u0a74\\u0a85-\\u0a8d\\u0a8f-\\u0a91\\u0a93-\\u0aa8\\u0aaa-\\u0ab0\\u0ab2\\u0ab3\\u0ab5-\\u0ab9\\u0abd\\u0ad0\\u0ae0\\u0ae1\\u0b05-\\u0b0c\\u0b0f\\u0b10\\u0b13-\\u0b28\\u0b2a-\\u0b30\\u0b32\\u0b33\\u0b35-\\u0b39\\u0b3d\\u0b5c\\u0b5d\\u0b5f-\\u0b61\\u0b71\\u0b83\\u0b85-\\u0b8a\\u0b8e-\\u0b90\\u0b92-\\u0b95\\u0b99\\u0b9a\\u0b9c\\u0b9e\\u0b9f\\u0ba3\\u0ba4\\u0ba8-\\u0baa\\u0bae-\\u0bb9\\u0bd0\\u0c05-\\u0c0c\\u0c0e-\\u0c10\\u0c12-\\u0c28\\u0c2a-\\u0c33\\u0c35-\\u0c39\\u0c3d\\u0c58\\u0c59\\u0c60\\u0c61\\u0c85-\\u0c8c\\u0c8e-\\u0c90\\u0c92-\\u0ca8\\u0caa-\\u0cb3\\u0cb5-\\u0cb9\\u0cbd\\u0cde\\u0ce0\\u0ce1\\u0cf1\\u0cf2\\u0d05-\\u0d0c\\u0d0e-\\u0d10\\u0d12-\\u0d3a\\u0d3d\\u0d4e\\u0d60\\u0d61\\u0d7a-\\u0d7f\\u0d85-\\u0d96\\u0d9a-\\u0db1\\u0db3-\\u0dbb\\u0dbd\\u0dc0-\\u0dc6\\u0e01-\\u0e30\\u0e32\\u0e33\\u0e40-\\u0e46\\u0e81\\u0e82\\u0e84\\u0e87\\u0e88\\u0e8a\\u0e8d\\u0e94-\\u0e97\\u0e99-\\u0e9f\\u0ea1-\\u0ea3\\u0ea5\\u0ea7\\u0eaa\\u0eab\\u0ead-\\u0eb0\\u0eb2\\u0eb3\\u0ebd\\u0ec0-\\u0ec4\\u0ec6\\u0edc-\\u0edf\\u0f00\\u0f40-\\u0f47\\u0f49-\\u0f6c\\u0f88-\\u0f8c\\u1000-\\u102a\\u103f\\u1050-\\u1055\\u105a-\\u105d\\u1061\\u1065\\u1066\\u106e-\\u1070\\u1075-\\u1081\\u108e\\u10a0-\\u10c5\\u10c7\\u10cd\\u10d0-\\u10fa\\u10fc-\\u1248\\u124a-\\u124d\\u1250-\\u1256\\u1258\\u125a-\\u125d\\u1260-\\u1288\\u128a-\\u128d\\u1290-\\u12b0\\u12b2-\\u12b5\\u12b8-\\u12be\\u12c0\\u12c2-\\u12c5\\u12c8-\\u12d6\\u12d8-\\u1310\\u1312-\\u1315\\u1318-\\u135a\\u1380-\\u138f\\u13a0-\\u13f4\\u1401-\\u166c\\u166f-\\u167f\\u1681-\\u169a\\u16a0-\\u16ea\\u16ee-\\u16f0\\u1700-\\u170c\\u170e-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176c\\u176e-\\u1770\\u1780-\\u17b3\\u17d7\\u17dc\\u1820-\\u1877\\u1880-\\u18a8\\u18aa\\u18b0-\\u18f5\\u1900-\\u191c\\u1950-\\u196d\\u1970-\\u1974\\u1980-\\u19ab\\u19c1-\\u19c7\\u1a00-\\u1a16\\u1a20-\\u1a54\\u1aa7\\u1b05-\\u1b33\\u1b45-\\u1b4b\\u1b83-\\u1ba0\\u1bae\\u1baf\\u1bba-\\u1be5\\u1c00-\\u1c23\\u1c4d-\\u1c4f\\u1c5a-\\u1c7d\\u1ce9-\\u1cec\\u1cee-\\u1cf1\\u1cf5\\u1cf6\\u1d00-\\u1dbf\\u1e00-\\u1f15\\u1f18-\\u1f1d\\u1f20-\\u1f45\\u1f48-\\u1f4d\\u1f50-\\u1f57\\u1f59\\u1f5b\\u1f5d\\u1f5f-\\u1f7d\\u1f80-\\u1fb4\\u1fb6-\\u1fbc\\u1fbe\\u1fc2-\\u1fc4\\u1fc6-\\u1fcc\\u1fd0-\\u1fd3\\u1fd6-\\u1fdb\\u1fe0-\\u1fec\\u1ff2-\\u1ff4\\u1ff6-\\u1ffc\\u2071\\u207f\\u2090-\\u209c\\u2102\\u2107\\u210a-\\u2113\\u2115\\u2119-\\u211d\\u2124\\u2126\\u2128\\u212a-\\u212d\\u212f-\\u2139\\u213c-\\u213f\\u2145-\\u2149\\u214e\\u2160-\\u2188\\u2c00-\\u2c2e\\u2c30-\\u2c5e\\u2c60-\\u2ce4\\u2ceb-\\u2cee\\u2cf2\\u2cf3\\u2d00-\\u2d25\\u2d27\\u2d2d\\u2d30-\\u2d67\\u2d6f\\u2d80-\\u2d96\\u2da0-\\u2da6\\u2da8-\\u2dae\\u2db0-\\u2db6\\u2db8-\\u2dbe\\u2dc0-\\u2dc6\\u2dc8-\\u2dce\\u2dd0-\\u2dd6\\u2dd8-\\u2dde\\u2e2f\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303c\\u3041-\\u3096\\u309d-\\u309f\\u30a1-\\u30fa\\u30fc-\\u30ff\\u3105-\\u312d\\u3131-\\u318e\\u31a0-\\u31ba\\u31f0-\\u31ff\\u3400-\\u4db5\\u4e00-\\u9fcc\\ua000-\\ua48c\\ua4d0-\\ua4fd\\ua500-\\ua60c\\ua610-\\ua61f\\ua62a\\ua62b\\ua640-\\ua66e\\ua67f-\\ua697\\ua6a0-\\ua6ef\\ua717-\\ua71f\\ua722-\\ua788\\ua78b-\\ua78e\\ua790-\\ua793\\ua7a0-\\ua7aa\\ua7f8-\\ua801\\ua803-\\ua805\\ua807-\\ua80a\\ua80c-\\ua822\\ua840-\\ua873\\ua882-\\ua8b3\\ua8f2-\\ua8f7\\ua8fb\\ua90a-\\ua925\\ua930-\\ua946\\ua960-\\ua97c\\ua984-\\ua9b2\\ua9cf\\uaa00-\\uaa28\\uaa40-\\uaa42\\uaa44-\\uaa4b\\uaa60-\\uaa76\\uaa7a\\uaa80-\\uaaaf\\uaab1\\uaab5\\uaab6\\uaab9-\\uaabd\\uaac0\\uaac2\\uaadb-\\uaadd\\uaae0-\\uaaea\\uaaf2-\\uaaf4\\uab01-\\uab06\\uab09-\\uab0e\\uab11-\\uab16\\uab20-\\uab26\\uab28-\\uab2e\\uabc0-\\uabe2\\uac00-\\ud7a3\\ud7b0-\\ud7c6\\ud7cb-\\ud7fb\\uf900-\\ufa6d\\ufa70-\\ufad9\\ufb00-\\ufb06\\ufb13-\\ufb17\\ufb1d\\ufb1f-\\ufb28\\ufb2a-\\ufb36\\ufb38-\\ufb3c\\ufb3e\\ufb40\\ufb41\\ufb43\\ufb44\\ufb46-\\ufbb1\\ufbd3-\\ufd3d\\ufd50-\\ufd8f\\ufd92-\\ufdc7\\ufdf0-\\ufdfb\\ufe70-\\ufe74\\ufe76-\\ufefc\\uff21-\\uff3a\\uff41-\\uff5a\\uff66-\\uffbe\\uffc2-\\uffc7\\uffca-\\uffcf\\uffd2-\\uffd7\\uffda-\\uffdc\";\n      var nonASCIIidentifierChars = \"\\u0300-\\u036f\\u0483-\\u0487\\u0591-\\u05bd\\u05bf\\u05c1\\u05c2\\u05c4\\u05c5\\u05c7\\u0610-\\u061a\\u0620-\\u0649\\u0672-\\u06d3\\u06e7-\\u06e8\\u06fb-\\u06fc\\u0730-\\u074a\\u0800-\\u0814\\u081b-\\u0823\\u0825-\\u0827\\u0829-\\u082d\\u0840-\\u0857\\u08e4-\\u08fe\\u0900-\\u0903\\u093a-\\u093c\\u093e-\\u094f\\u0951-\\u0957\\u0962-\\u0963\\u0966-\\u096f\\u0981-\\u0983\\u09bc\\u09be-\\u09c4\\u09c7\\u09c8\\u09d7\\u09df-\\u09e0\\u0a01-\\u0a03\\u0a3c\\u0a3e-\\u0a42\\u0a47\\u0a48\\u0a4b-\\u0a4d\\u0a51\\u0a66-\\u0a71\\u0a75\\u0a81-\\u0a83\\u0abc\\u0abe-\\u0ac5\\u0ac7-\\u0ac9\\u0acb-\\u0acd\\u0ae2-\\u0ae3\\u0ae6-\\u0aef\\u0b01-\\u0b03\\u0b3c\\u0b3e-\\u0b44\\u0b47\\u0b48\\u0b4b-\\u0b4d\\u0b56\\u0b57\\u0b5f-\\u0b60\\u0b66-\\u0b6f\\u0b82\\u0bbe-\\u0bc2\\u0bc6-\\u0bc8\\u0bca-\\u0bcd\\u0bd7\\u0be6-\\u0bef\\u0c01-\\u0c03\\u0c46-\\u0c48\\u0c4a-\\u0c4d\\u0c55\\u0c56\\u0c62-\\u0c63\\u0c66-\\u0c6f\\u0c82\\u0c83\\u0cbc\\u0cbe-\\u0cc4\\u0cc6-\\u0cc8\\u0cca-\\u0ccd\\u0cd5\\u0cd6\\u0ce2-\\u0ce3\\u0ce6-\\u0cef\\u0d02\\u0d03\\u0d46-\\u0d48\\u0d57\\u0d62-\\u0d63\\u0d66-\\u0d6f\\u0d82\\u0d83\\u0dca\\u0dcf-\\u0dd4\\u0dd6\\u0dd8-\\u0ddf\\u0df2\\u0df3\\u0e34-\\u0e3a\\u0e40-\\u0e45\\u0e50-\\u0e59\\u0eb4-\\u0eb9\\u0ec8-\\u0ecd\\u0ed0-\\u0ed9\\u0f18\\u0f19\\u0f20-\\u0f29\\u0f35\\u0f37\\u0f39\\u0f41-\\u0f47\\u0f71-\\u0f84\\u0f86-\\u0f87\\u0f8d-\\u0f97\\u0f99-\\u0fbc\\u0fc6\\u1000-\\u1029\\u1040-\\u1049\\u1067-\\u106d\\u1071-\\u1074\\u1082-\\u108d\\u108f-\\u109d\\u135d-\\u135f\\u170e-\\u1710\\u1720-\\u1730\\u1740-\\u1750\\u1772\\u1773\\u1780-\\u17b2\\u17dd\\u17e0-\\u17e9\\u180b-\\u180d\\u1810-\\u1819\\u1920-\\u192b\\u1930-\\u193b\\u1951-\\u196d\\u19b0-\\u19c0\\u19c8-\\u19c9\\u19d0-\\u19d9\\u1a00-\\u1a15\\u1a20-\\u1a53\\u1a60-\\u1a7c\\u1a7f-\\u1a89\\u1a90-\\u1a99\\u1b46-\\u1b4b\\u1b50-\\u1b59\\u1b6b-\\u1b73\\u1bb0-\\u1bb9\\u1be6-\\u1bf3\\u1c00-\\u1c22\\u1c40-\\u1c49\\u1c5b-\\u1c7d\\u1cd0-\\u1cd2\\u1d00-\\u1dbe\\u1e01-\\u1f15\\u200c\\u200d\\u203f\\u2040\\u2054\\u20d0-\\u20dc\\u20e1\\u20e5-\\u20f0\\u2d81-\\u2d96\\u2de0-\\u2dff\\u3021-\\u3028\\u3099\\u309a\\ua640-\\ua66d\\ua674-\\ua67d\\ua69f\\ua6f0-\\ua6f1\\ua7f8-\\ua800\\ua806\\ua80b\\ua823-\\ua827\\ua880-\\ua881\\ua8b4-\\ua8c4\\ua8d0-\\ua8d9\\ua8f3-\\ua8f7\\ua900-\\ua909\\ua926-\\ua92d\\ua930-\\ua945\\ua980-\\ua983\\ua9b3-\\ua9c0\\uaa00-\\uaa27\\uaa40-\\uaa41\\uaa4c-\\uaa4d\\uaa50-\\uaa59\\uaa7b\\uaae0-\\uaae9\\uaaf2-\\uaaf3\\uabc0-\\uabe1\\uabec\\uabed\\uabf0-\\uabf9\\ufb20-\\ufb28\\ufe00-\\ufe0f\\ufe20-\\ufe26\\ufe33\\ufe34\\ufe4d-\\ufe4f\\uff10-\\uff19\\uff3f\";\n      var nonASCIIidentifierStart = new RegExp(\"[\" + nonASCIIidentifierStartChars + \"]\");\n      var nonASCIIidentifier = new RegExp(\"[\" + nonASCIIidentifierStartChars + nonASCIIidentifierChars + \"]\");\n\n      // Whether a single character denotes a newline.\n\n      exports.newline = /[\\n\\r\\u2028\\u2029]/;\n\n      // Matches a whole line break (where CRLF is considered a single\n      // line break). Used to count lines.\n\n      // in javascript, these two differ\n      // in python they are the same, different methods are called on them\n      exports.lineBreak = new RegExp('\\r\\n|' + exports.newline.source);\n      exports.allLineBreaks = new RegExp(exports.lineBreak.source, 'g');\n\n\n      // Test whether a given character code starts an identifier.\n\n      exports.isIdentifierStart = function(code) {\n          // permit $ (36) and @ (64). @ is used in ES7 decorators.\n          if (code < 65) return code === 36 || code === 64;\n          // 65 through 91 are uppercase letters.\n          if (code < 91) return true;\n          // permit _ (95).\n          if (code < 97) return code === 95;\n          // 97 through 123 are lowercase letters.\n          if (code < 123) return true;\n          return code >= 0xaa && nonASCIIidentifierStart.test(String.fromCharCode(code));\n      };\n\n      // Test whether a given character is part of an identifier.\n\n      exports.isIdentifierChar = function(code) {\n          if (code < 48) return code === 36;\n          if (code < 58) return true;\n          if (code < 65) return false;\n          if (code < 91) return true;\n          if (code < 97) return code === 95;\n          if (code < 123) return true;\n          return code >= 0xaa && nonASCIIidentifier.test(String.fromCharCode(code));\n      };\n  })(acorn);\n\n  function run (html_source, options) {\n    function ltrim(s) {\n      return s.replace(/^\\s+/g, '');\n    }\n\n    function rtrim(s) {\n      return s.replace(/\\s+$/g, '');\n    }\n\n    var multi_parser;\n    var indent_inner_html;\n    var indent_size;\n    var indent_character;\n    var wrap_line_length;\n    var brace_style;\n    var unformatted;\n    var preserve_newlines;\n    var max_preserve_newlines;\n    var indent_handlebars;\n    var wrap_attributes;\n    var wrap_attributes_indent_size;\n    var end_with_newline;\n    var extra_liners;\n\n    options = options || {};\n\n    // backwards compatibility to 1.3.4\n    if ((options.wrap_line_length === undefined || parseInt(options.wrap_line_length, 10) === 0) &&\n      (options.max_char !== undefined && parseInt(options.max_char, 10) !== 0)) {\n      options.wrap_line_length = options.max_char;\n    }\n\n    indent_inner_html = (options.indent_inner_html === undefined) ? false : options.indent_inner_html;\n    indent_size = (options.indent_size === undefined) ? 4 : parseInt(options.indent_size, 10);\n    indent_character = (options.indent_char === undefined) ? ' ' : options.indent_char;\n    brace_style = (options.brace_style === undefined) ? 'collapse' : options.brace_style;\n    wrap_line_length = parseInt(options.wrap_line_length, 10) === 0 ? 32786 : parseInt(options.wrap_line_length || 250, 10);\n    unformatted = options.unformatted || ['a', 'span', 'img', 'bdo', 'em', 'strong', 'dfn', 'code', 'samp', 'kbd',\n      'var', 'cite', 'abbr', 'acronym', 'q', 'sub', 'sup', 'tt', 'i', 'b', 'big', 'small', 'u', 's', 'strike',\n      'font', 'ins', 'del', 'address', 'pre'\n    ];\n    preserve_newlines = (options.preserve_newlines === undefined) ? true : options.preserve_newlines;\n    max_preserve_newlines = preserve_newlines ?\n      (isNaN(parseInt(options.max_preserve_newlines, 10)) ? 32786 : parseInt(options.max_preserve_newlines, 10)) : 0;\n    indent_handlebars = (options.indent_handlebars === undefined) ? false : options.indent_handlebars;\n    wrap_attributes = (options.wrap_attributes === undefined) ? 'auto' : options.wrap_attributes;\n    wrap_attributes_indent_size = (options.wrap_attributes_indent_size === undefined) ? indent_size : parseInt(options.wrap_attributes_indent_size, 10) || indent_size;\n    end_with_newline = (options.end_with_newline === undefined) ? false : options.end_with_newline;\n    extra_liners = Array.isArray(options.extra_liners) ?\n      options.extra_liners.concat() : (typeof options.extra_liners == 'string') ?\n      options.extra_liners.split(',') : 'head,body,/html'.split(',');\n\n    if (options.indent_with_tabs) {\n      indent_character = '\\t';\n      indent_size = 1;\n    }\n\n    function Parser() {\n\n      this.pos = 0; //Parser position\n      this.token = '';\n      this.current_mode = 'CONTENT'; //reflects the current Parser mode: TAG/CONTENT\n      this.tags = { //An object to hold tags, their position, and their parent-tags, initiated with default values\n        parent: 'parent1',\n        parentcount: 1,\n        parent1: ''\n      };\n      this.tag_type = '';\n      this.token_text = this.last_token = this.last_text = this.token_type = '';\n      this.newlines = 0;\n      this.indent_content = indent_inner_html;\n\n      this.Utils = { //Uilities made available to the various functions\n        whitespace: \"\\n\\r\\t \".split(''),\n        single_token: 'br,input,link,meta,source,!doctype,basefont,base,area,hr,wbr,param,img,isindex,embed'.split(','), //all the single tags for HTML\n        extra_liners: extra_liners, //for tags that need a line of whitespace before them\n        in_array: function(what, arr) {\n          for (var i = 0; i < arr.length; i++) {\n            if (what == arr[i]) {\n              return true;\n            }\n          }\n          return false;\n        }\n      };\n\n      // Return true if the given text is composed entirely of whitespace.\n      this.is_whitespace = function(text) {\n        for (var n = 0; n < text.length; text++) {\n          if (!this.Utils.in_array(text.charAt(n), this.Utils.whitespace)) {\n            return false;\n          }\n        }\n        return true;\n      };\n\n      this.traverse_whitespace = function() {\n        var input_char = '';\n\n        input_char = this.input.charAt(this.pos);\n        if (this.Utils.in_array(input_char, this.Utils.whitespace)) {\n          this.newlines = 0;\n          while (this.Utils.in_array(input_char, this.Utils.whitespace)) {\n            if (preserve_newlines && input_char == '\\n' && this.newlines <= max_preserve_newlines) {\n              this.newlines += 1;\n            }\n\n            this.pos++;\n            input_char = this.input.charAt(this.pos);\n          }\n          return true;\n        }\n        return false;\n      };\n\n      // Append a space to the given content (string array) or, if we are\n      // at the wrap_line_length, append a newline/indentation.\n      this.space_or_wrap = function(content) {\n        if (this.line_char_count >= this.wrap_line_length) { //insert a line when the wrap_line_length is reached\n          this.print_newline(false, content);\n          this.print_indentation(content);\n        } else {\n          this.line_char_count++;\n          content.push(' ');\n        }\n      };\n\n      this.get_content = function() { //function to capture regular content between tags\n        var input_char = '',\n            content = [];\n\n        while (this.input.charAt(this.pos) != '<') {\n          if (this.pos >= this.input.length) {\n            return content.length ? content.join('') : ['', 'TK_EOF'];\n          }\n\n          if (this.traverse_whitespace()) {\n            this.space_or_wrap(content);\n            continue;\n          }\n\n          if (indent_handlebars) {\n            // Handlebars parsing is complicated.\n            // {{#foo}} and {{/foo}} are formatted tags.\n            // {{something}} should get treated as content, except:\n            // {{else}} specifically behaves like {{#if}} and {{/if}}\n            var peek3 = this.input.substr(this.pos, 3);\n            if (peek3 == '{{#' || peek3 == '{{/') {\n              // These are tags and not content.\n              break;\n            } else if (peek3 == '{{!') {\n              return [this.get_tag(), 'TK_TAG_HANDLEBARS_COMMENT'];\n            } else if (this.input.substr(this.pos, 2) == '{{') {\n              if (this.get_tag(true) == '{{else}}') {\n                break;\n              }\n            }\n          }\n\n          input_char = this.input.charAt(this.pos);\n          this.pos++;\n          this.line_char_count++;\n          content.push(input_char); //letter at-a-time (or string) inserted to an array\n        }\n        return content.length ? content.join('') : '';\n      };\n\n      this.get_contents_to = function(name) { //get the full content of a script or style to pass to js_beautify\n        if (this.pos == this.input.length) {\n          return ['', 'TK_EOF'];\n        }\n        var content = '';\n        var reg_match = new RegExp('</' + name + '\\\\s*>', 'igm');\n        reg_match.lastIndex = this.pos;\n        var reg_array = reg_match.exec(this.input);\n        var end_script = reg_array ? reg_array.index : this.input.length; //absolute end of script\n        if (this.pos < end_script) { //get everything in between the script tags\n          content = this.input.substring(this.pos, end_script);\n          this.pos = end_script;\n        }\n        return content;\n      };\n\n      this.record_tag = function(tag) { //function to record a tag and its parent in this.tags Object\n        if (this.tags[tag + 'count']) { //check for the existence of this tag type\n          this.tags[tag + 'count']++;\n          this.tags[tag + this.tags[tag + 'count']] = this.indent_level; //and record the present indent level\n        } else { //otherwise initialize this tag type\n          this.tags[tag + 'count'] = 1;\n          this.tags[tag + this.tags[tag + 'count']] = this.indent_level; //and record the present indent level\n        }\n        this.tags[tag + this.tags[tag + 'count'] + 'parent'] = this.tags.parent; //set the parent (i.e. in the case of a div this.tags.div1parent)\n        this.tags.parent = tag + this.tags[tag + 'count']; //and make this the current parent (i.e. in the case of a div 'div1')\n      };\n\n      this.retrieve_tag = function(tag) { //function to retrieve the opening tag to the corresponding closer\n        if (this.tags[tag + 'count']) { //if the openener is not in the Object we ignore it\n          var temp_parent = this.tags.parent; //check to see if it's a closable tag.\n          while (temp_parent) { //till we reach '' (the initial value);\n            if (tag + this.tags[tag + 'count'] == temp_parent) { //if this is it use it\n              break;\n            }\n            temp_parent = this.tags[temp_parent + 'parent']; //otherwise keep on climbing up the DOM Tree\n          }\n          if (temp_parent) { //if we caught something\n            this.indent_level = this.tags[tag + this.tags[tag + 'count']]; //set the indent_level accordingly\n            this.tags.parent = this.tags[temp_parent + 'parent']; //and set the current parent\n          }\n          delete this.tags[tag + this.tags[tag + 'count'] + 'parent']; //delete the closed tags parent reference...\n          delete this.tags[tag + this.tags[tag + 'count']]; //...and the tag itself\n          if (this.tags[tag + 'count'] == 1) {\n            delete this.tags[tag + 'count'];\n          } else {\n            this.tags[tag + 'count']--;\n          }\n        }\n      };\n\n      this.indent_to_tag = function(tag) {\n        // Match the indentation level to the last use of this tag, but don't remove it.\n        if (!this.tags[tag + 'count']) {\n          return;\n        }\n        var temp_parent = this.tags.parent;\n        while (temp_parent) {\n          if (tag + this.tags[tag + 'count'] == temp_parent) {\n            break;\n          }\n          temp_parent = this.tags[temp_parent + 'parent'];\n        }\n        if (temp_parent) {\n          this.indent_level = this.tags[tag + this.tags[tag + 'count']];\n        }\n      };\n\n      this.get_tag = function(peek) { //function to get a full tag and parse its type\n        var input_char = '',\n          content = [],\n          comment = '',\n          space = false,\n          first_attr = true,\n          tag_start, tag_end,\n          tag_start_char,\n          orig_pos = this.pos,\n          orig_line_char_count = this.line_char_count;\n\n        peek = peek !== undefined ? peek : false;\n\n        do {\n          if (this.pos >= this.input.length) {\n            if (peek) {\n              this.pos = orig_pos;\n              this.line_char_count = orig_line_char_count;\n            }\n            return content.length ? content.join('') : ['', 'TK_EOF'];\n          }\n\n          input_char = this.input.charAt(this.pos);\n          this.pos++;\n\n          if (this.Utils.in_array(input_char, this.Utils.whitespace)) { //don't want to insert unnecessary space\n            space = true;\n            continue;\n          }\n\n          if (input_char == \"'\" || input_char == '\"') {\n            input_char += this.get_unformatted(input_char);\n            space = true;\n\n          }\n\n          if (input_char == '=') { //no space before =\n            space = false;\n          }\n\n          if (content.length && content[content.length - 1] != '=' && input_char != '>' && space) {\n            //no space after = or before >\n            this.space_or_wrap(content);\n            space = false;\n            if (!first_attr && wrap_attributes == 'force' && input_char != '/') {\n              this.print_newline(true, content);\n              this.print_indentation(content);\n              for (var count = 0; count < wrap_attributes_indent_size; count++) {\n                content.push(indent_character);\n              }\n            }\n            for (var i = 0; i < content.length; i++) {\n              if (content[i] == ' ') {\n                first_attr = false;\n                break;\n              }\n            }\n          }\n\n          if (indent_handlebars && tag_start_char == '<') {\n            // When inside an angle-bracket tag, put spaces around\n            // handlebars not inside of strings.\n            if ((input_char + this.input.charAt(this.pos)) == '{{') {\n              input_char += this.get_unformatted('}}');\n              if (content.length && content[content.length - 1] != ' ' && content[content.length - 1] != '<') {\n                input_char = ' ' + input_char;\n              }\n              space = true;\n            }\n          }\n\n          if (input_char == '<' && !tag_start_char) {\n            tag_start = this.pos - 1;\n            tag_start_char = '<';\n          }\n\n          if (indent_handlebars && !tag_start_char) {\n            if (content.length >= 2 && content[content.length - 1] == '{' && content[content.length - 2] == '{') {\n              if (input_char == '#' || input_char == '/' || input_char == '!') {\n                tag_start = this.pos - 3;\n              } else {\n                tag_start = this.pos - 2;\n              }\n              tag_start_char = '{';\n            }\n          }\n\n          this.line_char_count++;\n          content.push(input_char); //inserts character at-a-time (or string)\n\n          if (content[1] && (content[1] == '!' || content[1] == '?' || content[1] == '%')) { //if we're in a comment, do something special\n            // We treat all comments as literals, even more than preformatted tags\n            // we just look for the appropriate close tag\n            content = [this.get_comment(tag_start)];\n            break;\n          }\n\n          if (indent_handlebars && content[1] && content[1] == '{' && content[2] && content[2] == '!') { //if we're in a comment, do something special\n            // We treat all comments as literals, even more than preformatted tags\n            // we just look for the appropriate close tag\n            content = [this.get_comment(tag_start)];\n            break;\n          }\n\n          if (indent_handlebars && tag_start_char == '{' && content.length > 2 && content[content.length - 2] == '}' && content[content.length - 1] == '}') {\n            break;\n          }\n        } while (input_char != '>');\n\n        var tag_complete = content.join('');\n        var tag_index;\n        var tag_offset;\n\n        if (tag_complete.indexOf(' ') != -1) { //if there's whitespace, thats where the tag name ends\n          tag_index = tag_complete.indexOf(' ');\n        } else if (tag_complete[0] == '{') {\n          tag_index = tag_complete.indexOf('}');\n        } else { //otherwise go with the tag ending\n          tag_index = tag_complete.indexOf('>');\n        }\n        if (tag_complete[0] == '<' || !indent_handlebars) {\n          tag_offset = 1;\n        } else {\n          tag_offset = tag_complete[2] == '#' ? 3 : 2;\n        }\n        var tag_check = tag_complete.substring(tag_offset, tag_index).toLowerCase();\n        if (tag_complete.charAt(tag_complete.length - 2) == '/' ||\n          this.Utils.in_array(tag_check, this.Utils.single_token)) { //if this tag name is a single tag type (either in the list or has a closing /)\n          if (!peek) {\n            this.tag_type = 'SINGLE';\n          }\n        } else if (indent_handlebars && tag_complete[0] == '{' && tag_check == 'else') {\n          if (!peek) {\n            this.indent_to_tag('if');\n            this.tag_type = 'HANDLEBARS_ELSE';\n            this.indent_content = true;\n            this.traverse_whitespace();\n          }\n        } else if (this.is_unformatted(tag_check, unformatted)) { // do not reformat the \"unformatted\" tags\n          comment = this.get_unformatted('</' + tag_check + '>', tag_complete); //...delegate to get_unformatted function\n          content.push(comment);\n          tag_end = this.pos - 1;\n          this.tag_type = 'SINGLE';\n        } else if (tag_check == 'script' &&\n          (tag_complete.search('type') == -1 ||\n            (tag_complete.search('type') > -1 &&\n              tag_complete.search(/\\b(text|application)\\/(x-)?(javascript|ecmascript|jscript|livescript)/) > -1))) {\n          if (!peek) {\n            this.record_tag(tag_check);\n            this.tag_type = 'SCRIPT';\n          }\n        } else if (tag_check == 'style' &&\n          (tag_complete.search('type') == -1 ||\n            (tag_complete.search('type') > -1 && tag_complete.search('text/css') > -1))) {\n          if (!peek) {\n            this.record_tag(tag_check);\n            this.tag_type = 'STYLE';\n          }\n        } else if (tag_check.charAt(0) == '!') { //peek for <! comment\n          // for comments content is already correct.\n          if (!peek) {\n            this.tag_type = 'SINGLE';\n            this.traverse_whitespace();\n          }\n        } else if (!peek) {\n          if (tag_check.charAt(0) == '/') { //this tag is a double tag so check for tag-ending\n            this.retrieve_tag(tag_check.substring(1)); //remove it and all ancestors\n            this.tag_type = 'END';\n          } else { //otherwise it's a start-tag\n            this.record_tag(tag_check); //push it on the tag stack\n            if (tag_check.toLowerCase() != 'html') {\n              this.indent_content = true;\n            }\n            this.tag_type = 'START';\n          }\n\n          // Allow preserving of newlines after a start or end tag\n          if (this.traverse_whitespace()) {\n            this.space_or_wrap(content);\n          }\n\n          if (this.Utils.in_array(tag_check, this.Utils.extra_liners)) { //check if this double needs an extra line\n            this.print_newline(false, this.output);\n            if (this.output.length && this.output[this.output.length - 2] != '\\n') {\n              this.print_newline(true, this.output);\n            }\n          }\n        }\n\n        if (peek) {\n          this.pos = orig_pos;\n          this.line_char_count = orig_line_char_count;\n        }\n\n        return content.join(''); //returns fully formatted tag\n      };\n\n      this.get_comment = function(start_pos) { //function to return comment content in its entirety\n        // this is will have very poor perf, but will work for now.\n        var comment = '',\n          delimiter = '>',\n          matched = false;\n\n        this.pos = start_pos;\n        var input_char = this.input.charAt(this.pos);\n        this.pos++;\n\n        while (this.pos <= this.input.length) {\n          comment += input_char;\n\n          // only need to check for the delimiter if the last chars match\n          if (comment[comment.length - 1] == delimiter[delimiter.length - 1] &&\n            comment.indexOf(delimiter) != -1) {\n            break;\n          }\n\n          // only need to search for custom delimiter for the first few characters\n          if (!matched && comment.length < 10) {\n            if (comment.indexOf('<![if') === 0) { //peek for <![if conditional comment\n              delimiter = '<![endif]>';\n              matched = true;\n            } else if (comment.indexOf('<![cdata[') === 0) { //if it's a <[cdata[ comment...\n              delimiter = ']]>';\n              matched = true;\n            } else if (comment.indexOf('<![') === 0) { // some other ![ comment? ...\n              delimiter = ']>';\n              matched = true;\n            } else if (comment.indexOf('<!--') === 0) { // <!-- comment ...\n              delimiter = '-->';\n              matched = true;\n            } else if (comment.indexOf('{{!') === 0) { // {{! handlebars comment\n              delimiter = '}}';\n              matched = true;\n            } else if (comment.indexOf('<?') === 0) { // {{! handlebars comment\n              delimiter = '?>';\n              matched = true;\n            } else if (comment.indexOf('<%') === 0) { // {{! handlebars comment\n              delimiter = '%>';\n              matched = true;\n            }\n          }\n\n          input_char = this.input.charAt(this.pos);\n          this.pos++;\n        }\n\n        return comment;\n      };\n\n      this.get_unformatted = function(delimiter, orig_tag) { //function to return unformatted content in its entirety\n\n        if (orig_tag && orig_tag.toLowerCase().indexOf(delimiter) != -1) {\n          return '';\n        }\n        var input_char = '';\n        var content = '';\n        var min_index = 0;\n        var space = true;\n        do {\n\n          if (this.pos >= this.input.length) {\n            return content;\n          }\n\n          input_char = this.input.charAt(this.pos);\n          this.pos++;\n\n          if (this.Utils.in_array(input_char, this.Utils.whitespace)) {\n            if (!space) {\n              this.line_char_count--;\n              continue;\n            }\n            if (input_char == '\\n' || input_char == '\\r') {\n              content += '\\n';\n              /*  Don't change tab indention for unformatted blocks.  If using code for html editing, this will greatly affect <pre> tags if they are specified in the 'unformatted array'\n            for (var i=0; i<this.indent_level; i++) {\n              content += this.indent_string;\n            }\n            space = false; //...and make sure other indentation is erased\n            */\n              this.line_char_count = 0;\n              continue;\n            }\n          }\n          content += input_char;\n          this.line_char_count++;\n          space = true;\n\n          if (indent_handlebars && input_char == '{' && content.length && content[content.length - 2] == '{') {\n            // Handlebars expressions in strings should also be unformatted.\n            content += this.get_unformatted('}}');\n            // These expressions are opaque.  Ignore delimiters found in them.\n            min_index = content.length;\n          }\n        } while (content.toLowerCase().indexOf(delimiter, min_index) == -1);\n        return content;\n      };\n\n      this.get_token = function() { //initial handler for token-retrieval\n        var token;\n\n        if (this.last_token == 'TK_TAG_SCRIPT' || this.last_token == 'TK_TAG_STYLE') { //check if we need to format javascript\n          var type = this.last_token.substr(7);\n          token = this.get_contents_to(type);\n          if (typeof token != 'string') {\n            return token;\n          }\n          return [token, 'TK_' + type];\n        }\n        if (this.current_mode == 'CONTENT') {\n          token = this.get_content();\n          if (typeof token != 'string') {\n            return token;\n          } else {\n            return [token, 'TK_CONTENT'];\n          }\n        }\n\n        if (this.current_mode == 'TAG') {\n          token = this.get_tag();\n          if (typeof token != 'string') {\n            return token;\n          } else {\n            var tag_name_type = 'TK_TAG_' + this.tag_type;\n            return [token, tag_name_type];\n          }\n        }\n      };\n\n      this.get_full_indent = function(level) {\n        level = this.indent_level + level || 0;\n        if (level < 1) {\n          return '';\n        }\n\n        return (new Array(level + 1)).join(this.indent_string);\n      };\n\n      this.is_unformatted = function(tag_check, unformatted) {\n        //is this an HTML5 block-level link?\n        if (!this.Utils.in_array(tag_check, unformatted)) {\n          return false;\n        }\n\n        if (tag_check.toLowerCase() != 'a' || !this.Utils.in_array('a', unformatted)) {\n          return true;\n        }\n\n        //at this point we have an  tag; is its first child something we want to remain\n        //unformatted?\n        var next_tag = this.get_tag(true /* peek. */ );\n\n        // test next_tag to see if it is just html tag (no external content)\n        var tag = (next_tag || '').match(/^\\s*<\\s*\\/?([a-z]*)\\s*[^>]*>\\s*$/);\n\n        // if next_tag comes back but is not an isolated tag, then\n        // let's treat the 'a' tag as having content\n        // and respect the unformatted option\n        if (!tag || this.Utils.in_array(tag, unformatted)) {\n          return true;\n        } else {\n          return false;\n        }\n      };\n\n      this.printer = function(js_source, indent_character, indent_size, wrap_line_length, brace_style) { //handles input/output and some other printing functions\n\n        this.input = js_source || ''; //gets the input for the Parser\n        this.output = [];\n        this.indent_character = indent_character;\n        this.indent_string = '';\n        this.indent_size = indent_size;\n        this.brace_style = brace_style;\n        this.indent_level = 0;\n        this.wrap_line_length = wrap_line_length;\n        this.line_char_count = 0; //count to see if wrap_line_length was exceeded\n\n        for (var i = 0; i < this.indent_size; i++) {\n          this.indent_string += this.indent_character;\n        }\n\n        this.print_newline = function(force, arr) {\n          this.line_char_count = 0;\n          if (!arr || !arr.length) {\n            return;\n          }\n          if (force || (arr[arr.length - 1] != '\\n')) { //we might want the extra line\n            if ((arr[arr.length - 1] != '\\n')) {\n              arr[arr.length - 1] = rtrim(arr[arr.length - 1]);\n            }\n            arr.push('\\n');\n          }\n        };\n\n        this.print_indentation = function(arr) {\n          for (var i = 0; i < this.indent_level; i++) {\n            arr.push(this.indent_string);\n            this.line_char_count += this.indent_string.length;\n          }\n        };\n\n        this.print_token = function(text) {\n          // Avoid printing initial whitespace.\n          if (this.is_whitespace(text) && !this.output.length) {\n            return;\n          }\n          if (text || text !== '') {\n            if (this.output.length && this.output[this.output.length - 1] == '\\n') {\n              this.print_indentation(this.output);\n              text = ltrim(text);\n            }\n          }\n          this.print_token_raw(text);\n        };\n\n        this.print_token_raw = function(text) {\n          // If we are going to print newlines, truncate trailing\n          // whitespace, as the newlines will represent the space.\n          if (this.newlines > 0) {\n            text = rtrim(text);\n          }\n\n          if (text && text !== '') {\n            if (text.length > 1 && text[text.length - 1] == '\\n') {\n              // unformatted tags can grab newlines as their last character\n              this.output.push(text.slice(0, -1));\n              this.print_newline(false, this.output);\n            } else {\n              this.output.push(text);\n            }\n          }\n\n          for (var n = 0; n < this.newlines; n++) {\n            this.print_newline(n > 0, this.output);\n          }\n          this.newlines = 0;\n        };\n\n        this.indent = function() {\n          this.indent_level++;\n        };\n\n        this.unindent = function() {\n          if (this.indent_level > 0) {\n            this.indent_level--;\n          }\n        };\n      };\n      return this;\n    }\n\n    /*_____________________--------------------_____________________*/\n\n    multi_parser = new Parser(); //wrapping functions Parser\n    multi_parser.printer(html_source, indent_character, indent_size, wrap_line_length, brace_style); //initialize starting values\n\n    while (true) {\n      var t = multi_parser.get_token();\n      multi_parser.token_text = t[0];\n      multi_parser.token_type = t[1];\n\n      if (multi_parser.token_type == 'TK_EOF') {\n        break;\n      }\n\n      switch (multi_parser.token_type) {\n        case 'TK_TAG_START':\n          multi_parser.print_newline(false, multi_parser.output);\n          multi_parser.print_token(multi_parser.token_text);\n          if (multi_parser.indent_content) {\n            multi_parser.indent();\n            multi_parser.indent_content = false;\n          }\n          multi_parser.current_mode = 'CONTENT';\n          break;\n        case 'TK_TAG_STYLE':\n        case 'TK_TAG_SCRIPT':\n          multi_parser.print_newline(false, multi_parser.output);\n          multi_parser.print_token(multi_parser.token_text);\n          multi_parser.current_mode = 'CONTENT';\n          break;\n        case 'TK_TAG_END':\n          // Print new line only if the tag has no content and has child\n          if (multi_parser.last_token == 'TK_CONTENT' && multi_parser.last_text === '') {\n            var tag_name = multi_parser.token_text.match(/\\w+/)[0];\n            var tag_extracted_from_last_output = null;\n            if (multi_parser.output.length) {\n              tag_extracted_from_last_output = multi_parser.output[multi_parser.output.length - 1].match(/(?:<|{{#)\\s*(\\w+)/);\n            }\n            if (tag_extracted_from_last_output == null ||\n              (tag_extracted_from_last_output[1] != tag_name && !multi_parser.Utils.in_array(tag_extracted_from_last_output[1], unformatted))) {\n              multi_parser.print_newline(false, multi_parser.output);\n            }\n          }\n          multi_parser.print_token(multi_parser.token_text);\n          multi_parser.current_mode = 'CONTENT';\n          break;\n        case 'TK_TAG_SINGLE':\n          // Don't add a newline before elements that should remain unformatted.\n          var tag_check = multi_parser.token_text.match(/^\\s*<([a-z-]+)/i);\n          if (!tag_check || !multi_parser.Utils.in_array(tag_check[1], unformatted)) {\n            multi_parser.print_newline(false, multi_parser.output);\n          }\n          multi_parser.print_token(multi_parser.token_text);\n          multi_parser.current_mode = 'CONTENT';\n          break;\n        case 'TK_TAG_HANDLEBARS_ELSE':\n          multi_parser.print_token(multi_parser.token_text);\n          if (multi_parser.indent_content) {\n            multi_parser.indent();\n            multi_parser.indent_content = false;\n          }\n          multi_parser.current_mode = 'CONTENT';\n          break;\n        case 'TK_TAG_HANDLEBARS_COMMENT':\n          multi_parser.print_token(multi_parser.token_text);\n          multi_parser.current_mode = 'TAG';\n          break;\n        case 'TK_CONTENT':\n          multi_parser.print_token(multi_parser.token_text);\n          multi_parser.current_mode = 'TAG';\n          break;\n        case 'TK_STYLE':\n        case 'TK_SCRIPT':\n          if (multi_parser.token_text !== '') {\n            multi_parser.print_newline(false, multi_parser.output);\n            var text = multi_parser.token_text;\n            var _beautifier;\n            var script_indent_level = 1;\n\n            if (multi_parser.token_type == 'TK_SCRIPT') {\n              _beautifier = typeof js_beautify == 'function' && js_beautify;\n            } else if (multi_parser.token_type == 'TK_STYLE') {\n              _beautifier = typeof css_beautify == 'function' && css_beautify;\n            }\n\n            if (options.indent_scripts == 'keep') {\n              script_indent_level = 0;\n            } else if (options.indent_scripts == 'separate') {\n              script_indent_level = -multi_parser.indent_level;\n            }\n\n            var indentation = multi_parser.get_full_indent(script_indent_level);\n            if (_beautifier) {\n              // call the Beautifier if avaliable\n              text = _beautifier(text.replace(/^\\s*/, indentation), options);\n            } else {\n              // simply indent the string otherwise\n              var white = text.match(/^\\s*/)[0];\n              var _level = white.match(/[^\\n\\r]*$/)[0].split(multi_parser.indent_string).length - 1;\n              var reindent = multi_parser.get_full_indent(script_indent_level - _level);\n\n              text = text.replace(/^\\s*/, indentation)\n                .replace(/\\r\\n|\\r|\\n/g, '\\n' + reindent)\n                .replace(/\\s+$/, '');\n            }\n            if (text) {\n              multi_parser.print_token_raw(text);\n              multi_parser.print_newline(true, multi_parser.output);\n            }\n          }\n          multi_parser.current_mode = 'TAG';\n          break;\n        default:\n          // We should not be getting here but we don't want to drop input on the floor\n          // Just output the text and move on\n          if (multi_parser.token_text !== '') {\n            multi_parser.print_token(multi_parser.token_text);\n          }\n          break;\n      }\n      multi_parser.last_token = multi_parser.token_type;\n      multi_parser.last_text = multi_parser.token_text;\n    }\n    var sweet_code = multi_parser.output.join('').replace(/[\\r\\n\\t ]+$/, '');\n    if (end_with_newline) {\n      sweet_code += '\\n';\n    }\n    return sweet_code;\n  }\n\n  function css_beautify (source_text, options) {\n      var NESTED_AT_RULE = {\n          \"@page\": true,\n          \"@font-face\": true,\n          \"@keyframes\": true,\n          // also in CONDITIONAL_GROUP_RULE below\n          \"@media\": true,\n          \"@supports\": true,\n          \"@document\": true\n      };\n      var CONDITIONAL_GROUP_RULE = {\n          \"@media\": true,\n          \"@supports\": true,\n          \"@document\": true\n      };\n\n      options = options || {};\n      source_text = source_text || '';\n      // HACK: newline parsing inconsistent. This brute force normalizes the input.\n      source_text = source_text.replace(/\\r\\n|[\\r\\u2028\\u2029]/g, '\\n')\n\n      var indentSize = options.indent_size || 4;\n      var indentCharacter = options.indent_char || ' ';\n      var selectorSeparatorNewline = (options.selector_separator_newline === undefined) ? true : options.selector_separator_newline;\n      var end_with_newline = (options.end_with_newline === undefined) ? false : options.end_with_newline;\n      var newline_between_rules = (options.newline_between_rules === undefined) ? true : options.newline_between_rules;\n      var eol = options.eol ? options.eol : '\\n';\n\n      // compatibility\n      if (typeof indentSize === \"string\") {\n          indentSize = parseInt(indentSize, 10);\n      }\n\n      if(options.indent_with_tabs){\n          indentCharacter = '\\t';\n          indentSize = 1;\n      }\n\n      eol = eol.replace(/\\\\r/, '\\r').replace(/\\\\n/, '\\n')\n\n\n      // tokenizer\n      var whiteRe = /^\\s+$/;\n      var wordRe = /[\\w$\\-_]/;\n\n      var pos = -1,\n          ch;\n      var parenLevel = 0;\n\n      function next() {\n          ch = source_text.charAt(++pos);\n          return ch || '';\n      }\n\n      function peek(skipWhitespace) {\n          var result = '';\n          var prev_pos = pos;\n          if (skipWhitespace) {\n              eatWhitespace();\n          }\n          result = source_text.charAt(pos + 1) || '';\n          pos = prev_pos - 1;\n          next();\n          return result;\n      }\n\n      function eatString(endChars) {\n          var start = pos;\n          while (next()) {\n              if (ch === \"\\\\\") {\n                  next();\n              } else if (endChars.indexOf(ch) !== -1) {\n                  break;\n              } else if (ch === \"\\n\") {\n                  break;\n              }\n          }\n          return source_text.substring(start, pos + 1);\n      }\n\n      function peekString(endChar) {\n          var prev_pos = pos;\n          var str = eatString(endChar);\n          pos = prev_pos - 1;\n          next();\n          return str;\n      }\n\n      function eatWhitespace() {\n          var result = '';\n          while (whiteRe.test(peek())) {\n              next();\n              result += ch;\n          }\n          return result;\n      }\n\n      function skipWhitespace() {\n          var result = '';\n          if (ch && whiteRe.test(ch)) {\n              result = ch;\n          }\n          while (whiteRe.test(next())) {\n              result += ch;\n          }\n          return result;\n      }\n\n      function eatComment(singleLine) {\n          var start = pos;\n          singleLine = peek() === \"/\";\n          next();\n          while (next()) {\n              if (!singleLine && ch === \"*\" && peek() === \"/\") {\n                  next();\n                  break;\n              } else if (singleLine && ch === \"\\n\") {\n                  return source_text.substring(start, pos);\n              }\n          }\n\n          return source_text.substring(start, pos) + ch;\n      }\n\n\n      function lookBack(str) {\n          return source_text.substring(pos - str.length, pos).toLowerCase() ===\n              str;\n      }\n\n      // Nested pseudo-class if we are insideRule\n      // and the next special character found opens\n      // a new block\n      function foundNestedPseudoClass() {\n          var openParen = 0;\n          for (var i = pos + 1; i < source_text.length; i++) {\n              var ch = source_text.charAt(i);\n              if (ch === \"{\") {\n                  return true;\n              } else if (ch === '(') {\n                  // pseudoclasses can contain ()\n                  openParen += 1;\n              } else if (ch === ')') {\n                  if (openParen == 0) {\n                      return false;\n                  }\n                  openParen -= 1;\n              } else if (ch === \";\" || ch === \"}\") {\n                  return false;\n              }\n          }\n          return false;\n      }\n\n      // printer\n      var basebaseIndentString = source_text.match(/^[\\t ]*/)[0];\n      var singleIndent = new Array(indentSize + 1).join(indentCharacter);\n      var indentLevel = 0;\n      var nestedLevel = 0;\n\n      function indent() {\n          indentLevel++;\n          basebaseIndentString += singleIndent;\n      }\n\n      function outdent() {\n          indentLevel--;\n          basebaseIndentString = basebaseIndentString.slice(0, -indentSize);\n      }\n\n      var print = {};\n      print[\"{\"] = function(ch) {\n          print.singleSpace();\n          output.push(ch);\n          print.newLine();\n      };\n      print[\"}\"] = function(ch) {\n          print.newLine();\n          output.push(ch);\n          print.newLine();\n      };\n\n      print._lastCharWhitespace = function() {\n          return whiteRe.test(output[output.length - 1]);\n      };\n\n      print.newLine = function(keepWhitespace) {\n          if (output.length) {\n              if (!keepWhitespace && output[output.length - 1] !== '\\n') {\n                  print.trim();\n              }\n\n              output.push('\\n');\n\n              if (basebaseIndentString) {\n                  output.push(basebaseIndentString);\n              }\n          }\n      };\n      print.singleSpace = function() {\n          if (output.length && !print._lastCharWhitespace()) {\n              output.push(' ');\n          }\n      };\n\n      print.preserveSingleSpace = function() {\n          if (isAfterSpace) {\n              print.singleSpace();\n          }\n      };\n\n      print.trim = function() {\n          while (print._lastCharWhitespace()) {\n              output.pop();\n          }\n      };\n\n\n      var output = [];\n      /*_____________________--------------------_____________________*/\n\n      var insideRule = false;\n      var insidePropertyValue = false;\n      var enteringConditionalGroup = false;\n      var top_ch = '';\n      var last_top_ch = '';\n\n      while (true) {\n          var whitespace = skipWhitespace();\n          var isAfterSpace = whitespace !== '';\n          var isAfterNewline = whitespace.indexOf('\\n') !== -1;\n          last_top_ch = top_ch;\n          top_ch = ch;\n\n          if (!ch) {\n              break;\n          } else if (ch === '/' && peek() === '*') { /* css comment */\n              var header = indentLevel === 0;\n\n              if (isAfterNewline || header) {\n                  print.newLine();\n              }\n\n              output.push(eatComment());\n              print.newLine();\n              if (header) {\n                  print.newLine(true);\n              }\n          } else if (ch === '/' && peek() === '/') { // single line comment\n              if (!isAfterNewline && last_top_ch !== '{' ) {\n                  print.trim();\n              }\n              print.singleSpace();\n              output.push(eatComment());\n              print.newLine();\n          } else if (ch === '@') {\n              print.preserveSingleSpace();\n              output.push(ch);\n\n              // strip trailing space, if present, for hash property checks\n              var variableOrRule = peekString(\": ,;{}()[]/='\\\"\");\n\n              if (variableOrRule.match(/[ :]$/)) {\n                  // we have a variable or pseudo-class, add it and insert one space before continuing\n                  next();\n                  variableOrRule = eatString(\": \").replace(/\\s$/, '');\n                  output.push(variableOrRule);\n                  print.singleSpace();\n              }\n\n              variableOrRule = variableOrRule.replace(/\\s$/, '')\n\n              // might be a nesting at-rule\n              if (variableOrRule in NESTED_AT_RULE) {\n                  nestedLevel += 1;\n                  if (variableOrRule in CONDITIONAL_GROUP_RULE) {\n                      enteringConditionalGroup = true;\n                  }\n              }\n          } else if (ch === '#' && peek() === '{') {\n            print.preserveSingleSpace();\n            output.push(eatString('}'));\n          } else if (ch === '{') {\n              if (peek(true) === '}') {\n                  eatWhitespace();\n                  next();\n                  print.singleSpace();\n                  output.push(\"{}\");\n                  print.newLine();\n                  if (newline_between_rules && indentLevel === 0) {\n                      print.newLine(true);\n                  }\n              } else {\n                  indent();\n                  print[\"{\"](ch);\n                  // when entering conditional groups, only rulesets are allowed\n                  if (enteringConditionalGroup) {\n                      enteringConditionalGroup = false;\n                      insideRule = (indentLevel > nestedLevel);\n                  } else {\n                      // otherwise, declarations are also allowed\n                      insideRule = (indentLevel >= nestedLevel);\n                  }\n              }\n          } else if (ch === '}') {\n              outdent();\n              print[\"}\"](ch);\n              insideRule = false;\n              insidePropertyValue = false;\n              if (nestedLevel) {\n                  nestedLevel--;\n              }\n              if (newline_between_rules && indentLevel === 0) {\n                  print.newLine(true);\n              }\n          } else if (ch === \":\") {\n              eatWhitespace();\n              if ((insideRule || enteringConditionalGroup) &&\n                  !(lookBack(\"&\") || foundNestedPseudoClass())) {\n                  // 'property: value' delimiter\n                  // which could be in a conditional group query\n                  insidePropertyValue = true;\n                  output.push(':');\n                  print.singleSpace();\n              } else {\n                  // sass/less parent reference don't use a space\n                  // sass nested pseudo-class don't use a space\n                  if (peek() === \":\") {\n                      // pseudo-element\n                      next();\n                      output.push(\"::\");\n                  } else {\n                      // pseudo-class\n                      output.push(':');\n                  }\n              }\n          } else if (ch === '\"' || ch === '\\'') {\n              print.preserveSingleSpace();\n              output.push(eatString(ch));\n          } else if (ch === ';') {\n              insidePropertyValue = false;\n              output.push(ch);\n              print.newLine();\n          } else if (ch === '(') { // may be a url\n              if (lookBack(\"url\")) {\n                  output.push(ch);\n                  eatWhitespace();\n                  if (next()) {\n                      if (ch !== ')' && ch !== '\"' && ch !== '\\'') {\n                          output.push(eatString(')'));\n                      } else {\n                          pos--;\n                      }\n                  }\n              } else {\n                  parenLevel++;\n                  print.preserveSingleSpace();\n                  output.push(ch);\n                  eatWhitespace();\n              }\n          } else if (ch === ')') {\n              output.push(ch);\n              parenLevel--;\n          } else if (ch === ',') {\n              output.push(ch);\n              eatWhitespace();\n              if (selectorSeparatorNewline && !insidePropertyValue && parenLevel < 1) {\n                  print.newLine();\n              } else {\n                  print.singleSpace();\n              }\n          } else if (ch === ']') {\n              output.push(ch);\n          } else if (ch === '[') {\n              print.preserveSingleSpace();\n              output.push(ch);\n          } else if (ch === '=') { // no whitespace before or after\n              eatWhitespace()\n              ch = '=';\n              output.push(ch);\n          } else {\n              print.preserveSingleSpace();\n              output.push(ch);\n          }\n      }\n\n\n      var sweetCode = '';\n      if (basebaseIndentString) {\n          sweetCode += basebaseIndentString;\n      }\n\n      sweetCode += output.join('').replace(/[\\r\\n\\t ]+$/, '');\n\n      // establish end_with_newline\n      if (end_with_newline) {\n          sweetCode += '\\n';\n      }\n\n      if (eol != '\\n') {\n          sweetCode = sweetCode.replace(/[\\n]/g, eol);\n      }\n\n      return sweetCode;\n  }\n\n  function in_array(what, arr) {\n      for (var i = 0; i < arr.length; i += 1) {\n          if (arr[i] === what) {\n              return true;\n          }\n      }\n      return false;\n  }\n\n  function trim(s) {\n      return s.replace(/^\\s+|\\s+$/g, '');\n  }\n\n  function ltrim(s) {\n      return s.replace(/^\\s+/g, '');\n  }\n\n  function rtrim(s) {\n      return s.replace(/\\s+$/g, '');\n  }\n\n  function js_beautify(js_source_text, options) {\n      \"use strict\";\n      var beautifier = new Beautifier(js_source_text, options);\n      return beautifier.beautify();\n  }\n\n  var MODE = {\n          BlockStatement: 'BlockStatement', // 'BLOCK'\n          Statement: 'Statement', // 'STATEMENT'\n          ObjectLiteral: 'ObjectLiteral', // 'OBJECT',\n          ArrayLiteral: 'ArrayLiteral', //'[EXPRESSION]',\n          ForInitializer: 'ForInitializer', //'(FOR-EXPRESSION)',\n          Conditional: 'Conditional', //'(COND-EXPRESSION)',\n          Expression: 'Expression' //'(EXPRESSION)'\n      };\n\n  function Beautifier(js_source_text, options) {\n      \"use strict\";\n      var output\n      var tokens = [], token_pos;\n      var Tokenizer;\n      var current_token;\n      var last_type, last_last_text, indent_string;\n      var flags, previous_flags, flag_store;\n      var prefix;\n\n      var handlers, opt;\n      var baseIndentString = '';\n\n      handlers = {\n          'TK_START_EXPR': handle_start_expr,\n          'TK_END_EXPR': handle_end_expr,\n          'TK_START_BLOCK': handle_start_block,\n          'TK_END_BLOCK': handle_end_block,\n          'TK_WORD': handle_word,\n          'TK_RESERVED': handle_word,\n          'TK_SEMICOLON': handle_semicolon,\n          'TK_STRING': handle_string,\n          'TK_EQUALS': handle_equals,\n          'TK_OPERATOR': handle_operator,\n          'TK_COMMA': handle_comma,\n          'TK_BLOCK_COMMENT': handle_block_comment,\n          'TK_COMMENT': handle_comment,\n          'TK_DOT': handle_dot,\n          'TK_UNKNOWN': handle_unknown,\n          'TK_EOF': handle_eof\n      };\n\n      function create_flags(flags_base, mode) {\n          var next_indent_level = 0;\n          if (flags_base) {\n              next_indent_level = flags_base.indentation_level;\n              if (!output.just_added_newline() &&\n                  flags_base.line_indent_level > next_indent_level) {\n                  next_indent_level = flags_base.line_indent_level;\n              }\n          }\n\n          var next_flags = {\n              mode: mode,\n              parent: flags_base,\n              last_text: flags_base ? flags_base.last_text : '', // last token text\n              last_word: flags_base ? flags_base.last_word : '', // last 'TK_WORD' passed\n              declaration_statement: false,\n              declaration_assignment: false,\n              multiline_frame: false,\n              if_block: false,\n              else_block: false,\n              do_block: false,\n              do_while: false,\n              in_case_statement: false, // switch(..){ INSIDE HERE }\n              in_case: false, // we're on the exact line with \"case 0:\"\n              case_body: false, // the indented case-action block\n              indentation_level: next_indent_level,\n              line_indent_level: flags_base ? flags_base.line_indent_level : next_indent_level,\n              start_line_index: output.get_line_number(),\n              ternary_depth: 0\n          };\n          return next_flags;\n      }\n\n      // Some interpreters have unexpected results with foo = baz || bar;\n      options = options ? options : {};\n      opt = {};\n\n      // compatibility\n      if (options.braces_on_own_line !== undefined) { //graceful handling of deprecated option\n          opt.brace_style = options.braces_on_own_line ? \"expand\" : \"collapse\";\n      }\n      opt.brace_style = options.brace_style ? options.brace_style : (opt.brace_style ? opt.brace_style : \"collapse\");\n\n      // graceful handling of deprecated option\n      if (opt.brace_style === \"expand-strict\") {\n          opt.brace_style = \"expand\";\n      }\n\n\n      opt.indent_size = options.indent_size ? parseInt(options.indent_size, 10) : 4;\n      opt.indent_char = options.indent_char ? options.indent_char : ' ';\n      opt.eol = options.eol ? options.eol : '\\n';\n      opt.preserve_newlines = (options.preserve_newlines === undefined) ? true : options.preserve_newlines;\n      opt.break_chained_methods = (options.break_chained_methods === undefined) ? false : options.break_chained_methods;\n      opt.max_preserve_newlines = (options.max_preserve_newlines === undefined) ? 0 : parseInt(options.max_preserve_newlines, 10);\n      opt.space_in_paren = (options.space_in_paren === undefined) ? false : options.space_in_paren;\n      opt.space_in_empty_paren = (options.space_in_empty_paren === undefined) ? false : options.space_in_empty_paren;\n      opt.jslint_happy = (options.jslint_happy === undefined) ? false : options.jslint_happy;\n      opt.space_after_anon_function = (options.space_after_anon_function === undefined) ? false : options.space_after_anon_function;\n      opt.keep_array_indentation = (options.keep_array_indentation === undefined) ? false : options.keep_array_indentation;\n      opt.space_before_conditional = (options.space_before_conditional === undefined) ? true : options.space_before_conditional;\n      opt.unescape_strings = (options.unescape_strings === undefined) ? false : options.unescape_strings;\n      opt.wrap_line_length = (options.wrap_line_length === undefined) ? 0 : parseInt(options.wrap_line_length, 10);\n      opt.e4x = (options.e4x === undefined) ? false : options.e4x;\n      opt.end_with_newline = (options.end_with_newline === undefined) ? false : options.end_with_newline;\n      opt.comma_first = (options.comma_first === undefined) ? false : options.comma_first;\n\n      // For testing of beautify ignore:start directive\n      opt.test_output_raw = (options.test_output_raw === undefined) ? false : options.test_output_raw;\n\n      // force opt.space_after_anon_function to true if opt.jslint_happy\n      if(opt.jslint_happy) {\n          opt.space_after_anon_function = true;\n      }\n\n      if(options.indent_with_tabs){\n          opt.indent_char = '\\t';\n          opt.indent_size = 1;\n      }\n\n      opt.eol = opt.eol.replace(/\\\\r/, '\\r').replace(/\\\\n/, '\\n')\n\n      //----------------------------------\n      indent_string = '';\n      while (opt.indent_size > 0) {\n          indent_string += opt.indent_char;\n          opt.indent_size -= 1;\n      }\n\n      var preindent_index = 0;\n      if(js_source_text && js_source_text.length) {\n          while ( (js_source_text.charAt(preindent_index) === ' ' ||\n                  js_source_text.charAt(preindent_index) === '\\t')) {\n              baseIndentString += js_source_text.charAt(preindent_index);\n              preindent_index += 1;\n          }\n          js_source_text = js_source_text.substring(preindent_index);\n      }\n\n      last_type = 'TK_START_BLOCK'; // last token type\n      last_last_text = ''; // pre-last token text\n      output = new Output(indent_string, baseIndentString);\n\n      // If testing the ignore directive, start with output disable set to true\n      output.raw = opt.test_output_raw;\n\n\n      // Stack of parsing/formatting states, including MODE.\n      // We tokenize, parse, and output in an almost purely a forward-only stream of token input\n      // and formatted output.  This makes the beautifier less accurate than full parsers\n      // but also far more tolerant of syntax errors.\n      //\n      // For example, the default mode is MODE.BlockStatement. If we see a '{' we push a new frame of type\n      // MODE.BlockStatement on the the stack, even though it could be object literal.  If we later\n      // encounter a \":\", we'll switch to to MODE.ObjectLiteral.  If we then see a \";\",\n      // most full parsers would die, but the beautifier gracefully falls back to\n      // MODE.BlockStatement and continues on.\n      flag_store = [];\n      set_mode(MODE.BlockStatement);\n\n      this.beautify = function() {\n\n          /*jshint onevar:true */\n          var local_token, sweet_code;\n          Tokenizer = new tokenizer(js_source_text, opt, indent_string);\n          tokens = Tokenizer.tokenize();\n          token_pos = 0;\n\n          while (local_token = get_token()) {\n              for(var i = 0; i < local_token.comments_before.length; i++) {\n                  // The cleanest handling of inline comments is to treat them as though they aren't there.\n                  // Just continue formatting and the behavior should be logical.\n                  // Also ignore unknown tokens.  Again, this should result in better behavior.\n                  handle_token(local_token.comments_before[i]);\n              }\n              handle_token(local_token);\n\n              last_last_text = flags.last_text;\n              last_type = local_token.type;\n              flags.last_text = local_token.text;\n\n              token_pos += 1;\n          }\n\n          sweet_code = output.get_code();\n          if (opt.end_with_newline) {\n              sweet_code += '\\n';\n          }\n\n          if (opt.eol != '\\n') {\n              sweet_code = sweet_code.replace(/[\\n]/g, opt.eol);\n          }\n\n          return sweet_code;\n      };\n\n      function handle_token(local_token) {\n          var newlines = local_token.newlines;\n          var keep_whitespace = opt.keep_array_indentation && is_array(flags.mode);\n\n          if (keep_whitespace) {\n              for (i = 0; i < newlines; i += 1) {\n                  print_newline(i > 0);\n              }\n          } else {\n              if (opt.max_preserve_newlines && newlines > opt.max_preserve_newlines) {\n                  newlines = opt.max_preserve_newlines;\n              }\n\n              if (opt.preserve_newlines) {\n                  if (local_token.newlines > 1) {\n                      print_newline();\n                      for (var i = 1; i < newlines; i += 1) {\n                          print_newline(true);\n                      }\n                  }\n              }\n          }\n\n          current_token = local_token;\n          handlers[current_token.type]();\n      }\n\n      // we could use just string.split, but\n      // IE doesn't like returning empty strings\n      function split_newlines(s) {\n          //return s.split(/\\x0d\\x0a|\\x0a/);\n\n          s = s.replace(/\\x0d/g, '');\n          var out = [],\n              idx = s.indexOf(\"\\n\");\n          while (idx !== -1) {\n              out.push(s.substring(0, idx));\n              s = s.substring(idx + 1);\n              idx = s.indexOf(\"\\n\");\n          }\n          if (s.length) {\n              out.push(s);\n          }\n          return out;\n      }\n\n      function allow_wrap_or_preserved_newline(force_linewrap) {\n          force_linewrap = (force_linewrap === undefined) ? false : force_linewrap;\n\n          // Never wrap the first token on a line\n          if (output.just_added_newline()) {\n              return\n          }\n\n          if ((opt.preserve_newlines && current_token.wanted_newline) || force_linewrap) {\n              print_newline(false, true);\n          } else if (opt.wrap_line_length) {\n              var proposed_line_length = output.current_line.get_character_count() + current_token.text.length +\n                  (output.space_before_token ? 1 : 0);\n              if (proposed_line_length >= opt.wrap_line_length) {\n                  print_newline(false, true);\n              }\n          }\n      }\n\n      function print_newline(force_newline, preserve_statement_flags) {\n          if (!preserve_statement_flags) {\n              if (flags.last_text !== ';' && flags.last_text !== ',' && flags.last_text !== '=' && last_type !== 'TK_OPERATOR') {\n                  while (flags.mode === MODE.Statement && !flags.if_block && !flags.do_block) {\n                      restore_mode();\n                  }\n              }\n          }\n\n          if (output.add_new_line(force_newline)) {\n              flags.multiline_frame = true;\n          }\n      }\n\n      function print_token_line_indentation() {\n          if (output.just_added_newline()) {\n              if (opt.keep_array_indentation && is_array(flags.mode) && current_token.wanted_newline) {\n                  output.current_line.push(current_token.whitespace_before);\n                  output.space_before_token = false;\n              } else if (output.set_indent(flags.indentation_level)) {\n                  flags.line_indent_level = flags.indentation_level;\n              }\n          }\n      }\n\n      function print_token(printable_token) {\n          if (output.raw) {\n              output.add_raw_token(current_token)\n              return;\n          }\n\n          if (opt.comma_first && last_type === 'TK_COMMA'\n              && output.just_added_newline()) {\n              if(output.previous_line.last() === ',') {\n                  output.previous_line.pop();\n                  print_token_line_indentation();\n                  output.add_token(',');\n                  output.space_before_token = true;\n              }\n          }\n\n          printable_token = printable_token || current_token.text;\n          print_token_line_indentation();\n          output.add_token(printable_token);\n      }\n\n      function indent() {\n          flags.indentation_level += 1;\n      }\n\n      function deindent() {\n          if (flags.indentation_level > 0 &&\n              ((!flags.parent) || flags.indentation_level > flags.parent.indentation_level))\n              flags.indentation_level -= 1;\n      }\n\n      function set_mode(mode) {\n          if (flags) {\n              flag_store.push(flags);\n              previous_flags = flags;\n          } else {\n              previous_flags = create_flags(null, mode);\n          }\n\n          flags = create_flags(previous_flags, mode);\n      }\n\n      function is_array(mode) {\n          return mode === MODE.ArrayLiteral;\n      }\n\n      function is_expression(mode) {\n          return in_array(mode, [MODE.Expression, MODE.ForInitializer, MODE.Conditional]);\n      }\n\n      function restore_mode() {\n          if (flag_store.length > 0) {\n              previous_flags = flags;\n              flags = flag_store.pop();\n              if (previous_flags.mode === MODE.Statement) {\n                  output.remove_redundant_indentation(previous_flags);\n              }\n          }\n      }\n\n      function start_of_object_property() {\n          return flags.parent.mode === MODE.ObjectLiteral && flags.mode === MODE.Statement && (\n              (flags.last_text === ':' && flags.ternary_depth === 0) || (last_type === 'TK_RESERVED' && in_array(flags.last_text, ['get', 'set'])));\n      }\n\n      function start_of_statement() {\n          if (\n                  (last_type === 'TK_RESERVED' && in_array(flags.last_text, ['var', 'let', 'const']) && current_token.type === 'TK_WORD') ||\n                  (last_type === 'TK_RESERVED' && flags.last_text === 'do') ||\n                  (last_type === 'TK_RESERVED' && flags.last_text === 'return' && !current_token.wanted_newline) ||\n                  (last_type === 'TK_RESERVED' && flags.last_text === 'else' && !(current_token.type === 'TK_RESERVED' && current_token.text === 'if')) ||\n                  (last_type === 'TK_END_EXPR' && (previous_flags.mode === MODE.ForInitializer || previous_flags.mode === MODE.Conditional)) ||\n                  (last_type === 'TK_WORD' && flags.mode === MODE.BlockStatement\n                      && !flags.in_case\n                      && !(current_token.text === '--' || current_token.text === '++')\n                      && last_last_text !== 'function'\n                      && current_token.type !== 'TK_WORD' && current_token.type !== 'TK_RESERVED') ||\n                  (flags.mode === MODE.ObjectLiteral && (\n                      (flags.last_text === ':' && flags.ternary_depth === 0) || (last_type === 'TK_RESERVED' && in_array(flags.last_text, ['get', 'set']))))\n              ) {\n\n              set_mode(MODE.Statement);\n              indent();\n\n              if (last_type === 'TK_RESERVED' && in_array(flags.last_text, ['var', 'let', 'const']) && current_token.type === 'TK_WORD') {\n                  flags.declaration_statement = true;\n              }\n\n              // Issue #276:\n              // If starting a new statement with [if, for, while, do], push to a new line.\n              // if (a) if (b) if(c) d(); else e(); else f();\n              if (!start_of_object_property()) {\n                  allow_wrap_or_preserved_newline(\n                      current_token.type === 'TK_RESERVED' && in_array(current_token.text, ['do', 'for', 'if', 'while']));\n              }\n\n              return true;\n          }\n          return false;\n      }\n\n      function all_lines_start_with(lines, c) {\n          for (var i = 0; i < lines.length; i++) {\n              var line = trim(lines[i]);\n              if (line.charAt(0) !== c) {\n                  return false;\n              }\n          }\n          return true;\n      }\n\n      function each_line_matches_indent(lines, indent) {\n          var i = 0,\n              len = lines.length,\n              line;\n          for (; i < len; i++) {\n              line = lines[i];\n              // allow empty lines to pass through\n              if (line && line.indexOf(indent) !== 0) {\n                  return false;\n              }\n          }\n          return true;\n      }\n\n      function is_special_word(word) {\n          return in_array(word, ['case', 'return', 'do', 'if', 'throw', 'else']);\n      }\n\n      function get_token(offset) {\n          var index = token_pos + (offset || 0);\n          return (index < 0 || index >= tokens.length) ? null : tokens[index];\n      }\n\n      function handle_start_expr() {\n          if (start_of_statement()) {\n              // The conditional starts the statement if appropriate.\n          }\n\n          var next_mode = MODE.Expression;\n          if (current_token.text === '[') {\n\n              if (last_type === 'TK_WORD' || flags.last_text === ')') {\n                  // this is array index specifier, break immediately\n                  // a[x], fn()[x]\n                  if (last_type === 'TK_RESERVED' && in_array(flags.last_text, Tokenizer.line_starters)) {\n                      output.space_before_token = true;\n                  }\n                  set_mode(next_mode);\n                  print_token();\n                  indent();\n                  if (opt.space_in_paren) {\n                      output.space_before_token = true;\n                  }\n                  return;\n              }\n\n              next_mode = MODE.ArrayLiteral;\n              if (is_array(flags.mode)) {\n                  if (flags.last_text === '[' ||\n                      (flags.last_text === ',' && (last_last_text === ']' || last_last_text === '}'))) {\n                      // ], [ goes to new line\n                      // }, [ goes to new line\n                      if (!opt.keep_array_indentation) {\n                          print_newline();\n                      }\n                  }\n              }\n\n          } else {\n              if (last_type === 'TK_RESERVED' && flags.last_text === 'for') {\n                  next_mode = MODE.ForInitializer;\n              } else if (last_type === 'TK_RESERVED' && in_array(flags.last_text, ['if', 'while'])) {\n                  next_mode = MODE.Conditional;\n              } else {\n                  // next_mode = MODE.Expression;\n              }\n          }\n\n          if (flags.last_text === ';' || last_type === 'TK_START_BLOCK') {\n              print_newline();\n          } else if (last_type === 'TK_END_EXPR' || last_type === 'TK_START_EXPR' || last_type === 'TK_END_BLOCK' || flags.last_text === '.') {\n              // TODO: Consider whether forcing this is required.  Review failing tests when removed.\n              allow_wrap_or_preserved_newline(current_token.wanted_newline);\n              // do nothing on (( and )( and ][ and ]( and .(\n          } else if (!(last_type === 'TK_RESERVED' && current_token.text === '(') && last_type !== 'TK_WORD' && last_type !== 'TK_OPERATOR') {\n              output.space_before_token = true;\n          } else if ((last_type === 'TK_RESERVED' && (flags.last_word === 'function' || flags.last_word === 'typeof')) ||\n              (flags.last_text === '*' && last_last_text === 'function')) {\n              // function() vs function ()\n              if (opt.space_after_anon_function) {\n                  output.space_before_token = true;\n              }\n          } else if (last_type === 'TK_RESERVED' && (in_array(flags.last_text, Tokenizer.line_starters) || flags.last_text === 'catch')) {\n              if (opt.space_before_conditional) {\n                  output.space_before_token = true;\n              }\n          }\n\n          // Should be a space between await and an IIFE\n          if(current_token.text === '(' && last_type === 'TK_RESERVED' && flags.last_word === 'await'){\n              output.space_before_token = true;\n          }\n\n          // Support of this kind of newline preservation.\n          // a = (b &&\n          //     (c || d));\n          if (current_token.text === '(') {\n              if (last_type === 'TK_EQUALS' || last_type === 'TK_OPERATOR') {\n                  if (!start_of_object_property()) {\n                      allow_wrap_or_preserved_newline();\n                  }\n              }\n          }\n\n          set_mode(next_mode);\n          print_token();\n          if (opt.space_in_paren) {\n              output.space_before_token = true;\n          }\n\n          // In all cases, if we newline while inside an expression it should be indented.\n          indent();\n      }\n\n      function handle_end_expr() {\n          // statements inside expressions are not valid syntax, but...\n          // statements must all be closed when their container closes\n          while (flags.mode === MODE.Statement) {\n              restore_mode();\n          }\n\n          if (flags.multiline_frame) {\n              allow_wrap_or_preserved_newline(current_token.text === ']' && is_array(flags.mode) && !opt.keep_array_indentation);\n          }\n\n          if (opt.space_in_paren) {\n              if (last_type === 'TK_START_EXPR' && ! opt.space_in_empty_paren) {\n                  // () [] no inner space in empty parens like these, ever, ref #320\n                  output.trim();\n                  output.space_before_token = false;\n              } else {\n                  output.space_before_token = true;\n              }\n          }\n          if (current_token.text === ']' && opt.keep_array_indentation) {\n              print_token();\n              restore_mode();\n          } else {\n              restore_mode();\n              print_token();\n          }\n          output.remove_redundant_indentation(previous_flags);\n\n          // do {} while () // no statement required after\n          if (flags.do_while && previous_flags.mode === MODE.Conditional) {\n              previous_flags.mode = MODE.Expression;\n              flags.do_block = false;\n              flags.do_while = false;\n\n          }\n      }\n\n      function handle_start_block() {\n          // Check if this is should be treated as a ObjectLiteral\n          var next_token = get_token(1)\n          var second_token = get_token(2)\n          if (second_token && (\n                  (second_token.text === ':' && in_array(next_token.type, ['TK_STRING', 'TK_WORD', 'TK_RESERVED']))\n                  || (in_array(next_token.text, ['get', 'set']) && in_array(second_token.type, ['TK_WORD', 'TK_RESERVED']))\n              )) {\n              // We don't support TypeScript,but we didn't break it for a very long time.\n              // We'll try to keep not breaking it.\n              if (!in_array(last_last_text, ['class','interface'])) {\n                  set_mode(MODE.ObjectLiteral);\n              } else {\n                  set_mode(MODE.BlockStatement);\n              }\n          } else {\n              set_mode(MODE.BlockStatement);\n          }\n\n          var empty_braces = !next_token.comments_before.length &&  next_token.text === '}';\n          var empty_anonymous_function = empty_braces && flags.last_word === 'function' &&\n              last_type === 'TK_END_EXPR';\n\n          if (opt.brace_style === \"expand\" ||\n              (opt.brace_style === \"none\" && current_token.wanted_newline)) {\n              if (last_type !== 'TK_OPERATOR' &&\n                  (empty_anonymous_function ||\n                      last_type === 'TK_EQUALS' ||\n                      (last_type === 'TK_RESERVED' && is_special_word(flags.last_text) && flags.last_text !== 'else'))) {\n                  output.space_before_token = true;\n              } else {\n                  print_newline(false, true);\n              }\n          } else { // collapse\n              if (last_type !== 'TK_OPERATOR' && last_type !== 'TK_START_EXPR') {\n                  if (last_type === 'TK_START_BLOCK') {\n                      print_newline();\n                  } else {\n                      output.space_before_token = true;\n                  }\n              } else {\n                  // if TK_OPERATOR or TK_START_EXPR\n                  if (is_array(previous_flags.mode) && flags.last_text === ',') {\n                      if (last_last_text === '}') {\n                          // }, { in array context\n                          output.space_before_token = true;\n                      } else {\n                          print_newline(); // [a, b, c, {\n                      }\n                  }\n              }\n          }\n          print_token();\n          indent();\n      }\n\n      function handle_end_block() {\n          // statements must all be closed when their container closes\n          while (flags.mode === MODE.Statement) {\n              restore_mode();\n          }\n          var empty_braces = last_type === 'TK_START_BLOCK';\n\n          if (opt.brace_style === \"expand\") {\n              if (!empty_braces) {\n                  print_newline();\n              }\n          } else {\n              // skip {}\n              if (!empty_braces) {\n                  if (is_array(flags.mode) && opt.keep_array_indentation) {\n                      // we REALLY need a newline here, but newliner would skip that\n                      opt.keep_array_indentation = false;\n                      print_newline();\n                      opt.keep_array_indentation = true;\n\n                  } else {\n                      print_newline();\n                  }\n              }\n          }\n          restore_mode();\n          print_token();\n      }\n\n      function handle_word() {\n          if (current_token.type === 'TK_RESERVED' && flags.mode !== MODE.ObjectLiteral &&\n              in_array(current_token.text, ['set', 'get'])) {\n              current_token.type = 'TK_WORD';\n          }\n\n          if (current_token.type === 'TK_RESERVED' && flags.mode === MODE.ObjectLiteral) {\n              var next_token = get_token(1);\n              if (next_token.text == ':') {\n                  current_token.type = 'TK_WORD';\n              }\n          }\n\n          if (start_of_statement()) {\n              // The conditional starts the statement if appropriate.\n          } else if (current_token.wanted_newline && !is_expression(flags.mode) &&\n              (last_type !== 'TK_OPERATOR' || (flags.last_text === '--' || flags.last_text === '++')) &&\n              last_type !== 'TK_EQUALS' &&\n              (opt.preserve_newlines || !(last_type === 'TK_RESERVED' && in_array(flags.last_text, ['var', 'let', 'const', 'set', 'get'])))) {\n\n              print_newline();\n          }\n\n          if (flags.do_block && !flags.do_while) {\n              if (current_token.type === 'TK_RESERVED' && current_token.text === 'while') {\n                  // do {} ## while ()\n                  output.space_before_token = true;\n                  print_token();\n                  output.space_before_token = true;\n                  flags.do_while = true;\n                  return;\n              } else {\n                  // do {} should always have while as the next word.\n                  // if we don't see the expected while, recover\n                  print_newline();\n                  flags.do_block = false;\n              }\n          }\n\n          // if may be followed by else, or not\n          // Bare/inline ifs are tricky\n          // Need to unwind the modes correctly: if (a) if (b) c(); else d(); else e();\n          if (flags.if_block) {\n              if (!flags.else_block && (current_token.type === 'TK_RESERVED' && current_token.text === 'else')) {\n                  flags.else_block = true;\n              } else {\n                  while (flags.mode === MODE.Statement) {\n                      restore_mode();\n                  }\n                  flags.if_block = false;\n                  flags.else_block = false;\n              }\n          }\n\n          if (current_token.type === 'TK_RESERVED' && (current_token.text === 'case' || (current_token.text === 'default' && flags.in_case_statement))) {\n              print_newline();\n              if (flags.case_body || opt.jslint_happy) {\n                  // switch cases following one another\n                  deindent();\n                  flags.case_body = false;\n              }\n              print_token();\n              flags.in_case = true;\n              flags.in_case_statement = true;\n              return;\n          }\n\n          if (current_token.type === 'TK_RESERVED' && current_token.text === 'function') {\n              if (in_array(flags.last_text, ['}', ';']) || (output.just_added_newline() && ! in_array(flags.last_text, ['[', '{', ':', '=', ',']))) {\n                  // make sure there is a nice clean space of at least one blank line\n                  // before a new function definition\n                  if ( !output.just_added_blankline() && !current_token.comments_before.length) {\n                      print_newline();\n                      print_newline(true);\n                  }\n              }\n              if (last_type === 'TK_RESERVED' || last_type === 'TK_WORD') {\n                  if (last_type === 'TK_RESERVED' && in_array(flags.last_text, ['get', 'set', 'new', 'return', 'export', 'async'])) {\n                      output.space_before_token = true;\n                  } else if (last_type === 'TK_RESERVED' && flags.last_text === 'default' && last_last_text === 'export') {\n                      output.space_before_token = true;\n                  } else {\n                      print_newline();\n                  }\n              } else if (last_type === 'TK_OPERATOR' || flags.last_text === '=') {\n                  // foo = function\n                  output.space_before_token = true;\n              } else if (!flags.multiline_frame && (is_expression(flags.mode) || is_array(flags.mode))) {\n                  // (function\n              } else {\n                  print_newline();\n              }\n          }\n\n          if (last_type === 'TK_COMMA' || last_type === 'TK_START_EXPR' || last_type === 'TK_EQUALS' || last_type === 'TK_OPERATOR') {\n              if (!start_of_object_property()) {\n                  allow_wrap_or_preserved_newline();\n              }\n          }\n\n          if (current_token.type === 'TK_RESERVED' &&  in_array(current_token.text, ['function', 'get', 'set'])) {\n              print_token();\n              flags.last_word = current_token.text;\n              return;\n          }\n\n          prefix = 'NONE';\n\n          if (last_type === 'TK_END_BLOCK') {\n              if (!(current_token.type === 'TK_RESERVED' && in_array(current_token.text, ['else', 'catch', 'finally']))) {\n                  prefix = 'NEWLINE';\n              } else {\n                  if (opt.brace_style === \"expand\" ||\n                      opt.brace_style === \"end-expand\" ||\n                      (opt.brace_style === \"none\" && current_token.wanted_newline)) {\n                      prefix = 'NEWLINE';\n                  } else {\n                      prefix = 'SPACE';\n                      output.space_before_token = true;\n                  }\n              }\n          } else if (last_type === 'TK_SEMICOLON' && flags.mode === MODE.BlockStatement) {\n              // TODO: Should this be for STATEMENT as well?\n              prefix = 'NEWLINE';\n          } else if (last_type === 'TK_SEMICOLON' && is_expression(flags.mode)) {\n              prefix = 'SPACE';\n          } else if (last_type === 'TK_STRING') {\n              prefix = 'NEWLINE';\n          } else if (last_type === 'TK_RESERVED' || last_type === 'TK_WORD' ||\n              (flags.last_text === '*' && last_last_text === 'function')) {\n              prefix = 'SPACE';\n          } else if (last_type === 'TK_START_BLOCK') {\n              prefix = 'NEWLINE';\n          } else if (last_type === 'TK_END_EXPR') {\n              output.space_before_token = true;\n              prefix = 'NEWLINE';\n          }\n\n          if (current_token.type === 'TK_RESERVED' && in_array(current_token.text, Tokenizer.line_starters) && flags.last_text !== ')') {\n              if (flags.last_text === 'else' || flags.last_text === 'export') {\n                  prefix = 'SPACE';\n              } else {\n                  prefix = 'NEWLINE';\n              }\n\n          }\n\n          if (current_token.type === 'TK_RESERVED' && in_array(current_token.text, ['else', 'catch', 'finally'])) {\n              if (last_type !== 'TK_END_BLOCK' ||\n                  opt.brace_style === \"expand\" ||\n                  opt.brace_style === \"end-expand\" ||\n                  (opt.brace_style === \"none\" && current_token.wanted_newline)) {\n                  print_newline();\n              } else {\n                  output.trim(true);\n                  var line = output.current_line;\n                  // If we trimmed and there's something other than a close block before us\n                  // put a newline back in.  Handles '} // comment' scenario.\n                  if (line.last() !== '}') {\n                      print_newline();\n                  }\n                  output.space_before_token = true;\n              }\n          } else if (prefix === 'NEWLINE') {\n              if (last_type === 'TK_RESERVED' && is_special_word(flags.last_text)) {\n                  // no newline between 'return nnn'\n                  output.space_before_token = true;\n              } else if (last_type !== 'TK_END_EXPR') {\n                  if ((last_type !== 'TK_START_EXPR' || !(current_token.type === 'TK_RESERVED' && in_array(current_token.text, ['var', 'let', 'const']))) && flags.last_text !== ':') {\n                      // no need to force newline on 'var': for (var x = 0...)\n                      if (current_token.type === 'TK_RESERVED' && current_token.text === 'if' && flags.last_text === 'else') {\n                          // no newline for } else if {\n                          output.space_before_token = true;\n                      } else {\n                          print_newline();\n                      }\n                  }\n              } else if (current_token.type === 'TK_RESERVED' && in_array(current_token.text, Tokenizer.line_starters) && flags.last_text !== ')') {\n                  print_newline();\n              }\n          } else if (flags.multiline_frame && is_array(flags.mode) && flags.last_text === ',' && last_last_text === '}') {\n              print_newline(); // }, in lists get a newline treatment\n          } else if (prefix === 'SPACE') {\n              output.space_before_token = true;\n          }\n          print_token();\n          flags.last_word = current_token.text;\n\n          if (current_token.type === 'TK_RESERVED' && current_token.text === 'do') {\n              flags.do_block = true;\n          }\n\n          if (current_token.type === 'TK_RESERVED' && current_token.text === 'if') {\n              flags.if_block = true;\n          }\n      }\n\n      function handle_semicolon() {\n          if (start_of_statement()) {\n              // The conditional starts the statement if appropriate.\n              // Semicolon can be the start (and end) of a statement\n              output.space_before_token = false;\n          }\n          while (flags.mode === MODE.Statement && !flags.if_block && !flags.do_block) {\n              restore_mode();\n          }\n          print_token();\n      }\n\n      function handle_string() {\n          if (start_of_statement()) {\n              // The conditional starts the statement if appropriate.\n              // One difference - strings want at least a space before\n              output.space_before_token = true;\n          } else if (last_type === 'TK_RESERVED' || last_type === 'TK_WORD') {\n              output.space_before_token = true;\n          } else if (last_type === 'TK_COMMA' || last_type === 'TK_START_EXPR' || last_type === 'TK_EQUALS' || last_type === 'TK_OPERATOR') {\n              if (!start_of_object_property()) {\n                  allow_wrap_or_preserved_newline();\n              }\n          } else {\n              print_newline();\n          }\n          print_token();\n      }\n\n      function handle_equals() {\n          if (start_of_statement()) {\n              // The conditional starts the statement if appropriate.\n          }\n\n          if (flags.declaration_statement) {\n              // just got an '=' in a var-line, different formatting/line-breaking, etc will now be done\n              flags.declaration_assignment = true;\n          }\n          output.space_before_token = true;\n          print_token();\n          output.space_before_token = true;\n      }\n\n      function handle_comma() {\n          if (flags.declaration_statement) {\n              if (is_expression(flags.parent.mode)) {\n                  // do not break on comma, for(var a = 1, b = 2)\n                  flags.declaration_assignment = false;\n              }\n\n              print_token();\n\n              if (flags.declaration_assignment) {\n                  flags.declaration_assignment = false;\n                  print_newline(false, true);\n              } else {\n                  output.space_before_token = true;\n                  // for comma-first, we want to allow a newline before the comma\n                  // to turn into a newline after the comma, which we will fixup later\n                  if (opt.comma_first) {\n                      allow_wrap_or_preserved_newline();\n                  }\n              }\n              return;\n          }\n\n          print_token();\n          if (flags.mode === MODE.ObjectLiteral ||\n              (flags.mode === MODE.Statement && flags.parent.mode === MODE.ObjectLiteral)) {\n              if (flags.mode === MODE.Statement) {\n                  restore_mode();\n              }\n              print_newline();\n          } else {\n              // EXPR or DO_BLOCK\n              output.space_before_token = true;\n              // for comma-first, we want to allow a newline before the comma\n              // to turn into a newline after the comma, which we will fixup later\n              if (opt.comma_first) {\n                  allow_wrap_or_preserved_newline();\n              }\n          }\n\n      }\n\n      function handle_operator() {\n          if (start_of_statement()) {\n              // The conditional starts the statement if appropriate.\n          }\n\n          if (last_type === 'TK_RESERVED' && is_special_word(flags.last_text)) {\n              // \"return\" had a special handling in TK_WORD. Now we need to return the favor\n              output.space_before_token = true;\n              print_token();\n              return;\n          }\n\n          // hack for actionscript's import .*;\n          if (current_token.text === '*' && last_type === 'TK_DOT') {\n              print_token();\n              return;\n          }\n\n          if (current_token.text === ':' && flags.in_case) {\n              flags.case_body = true;\n              indent();\n              print_token();\n              print_newline();\n              flags.in_case = false;\n              return;\n          }\n\n          if (current_token.text === '::') {\n              // no spaces around exotic namespacing syntax operator\n              print_token();\n              return;\n          }\n\n          // Allow line wrapping between operators\n          if (last_type === 'TK_OPERATOR') {\n              allow_wrap_or_preserved_newline();\n          }\n\n          var space_before = true;\n          var space_after = true;\n\n          if (in_array(current_token.text, ['--', '++', '!', '~']) || (in_array(current_token.text, ['-', '+']) && (in_array(last_type, ['TK_START_BLOCK', 'TK_START_EXPR', 'TK_EQUALS', 'TK_OPERATOR']) || in_array(flags.last_text, Tokenizer.line_starters) || flags.last_text === ','))) {\n              // unary operators (and binary +/- pretending to be unary) special cases\n\n              space_before = false;\n              space_after = false;\n\n              // http://www.ecma-international.org/ecma-262/5.1/#sec-7.9.1\n              // if there is a newline between -- or ++ and anything else we should preserve it.\n              if (current_token.wanted_newline && (current_token.text === '--' || current_token.text === '++')) {\n                  print_newline(false, true);\n              }\n\n              if (flags.last_text === ';' && is_expression(flags.mode)) {\n                  // for (;; ++i)\n                  //        ^^^\n                  space_before = true;\n              }\n\n              if (last_type === 'TK_RESERVED') {\n                  space_before = true;\n              } else if (last_type === 'TK_END_EXPR') {\n                  space_before = !(flags.last_text === ']' && (current_token.text === '--' || current_token.text === '++'));\n              } else if (last_type === 'TK_OPERATOR') {\n                  // a++ + ++b;\n                  // a - -b\n                  space_before = in_array(current_token.text, ['--', '-', '++', '+']) && in_array(flags.last_text, ['--', '-', '++', '+']);\n                  // + and - are not unary when preceeded by -- or ++ operator\n                  // a-- + b\n                  // a * +b\n                  // a - -b\n                  if (in_array(current_token.text, ['+', '-']) && in_array(flags.last_text, ['--', '++'])) {\n                      space_after = true;\n                  }\n              }\n\n              if ((flags.mode === MODE.BlockStatement || flags.mode === MODE.Statement) && (flags.last_text === '{' || flags.last_text === ';')) {\n                  // { foo; --i }\n                  // foo(); --bar;\n                  print_newline();\n              }\n          } else if (current_token.text === ':') {\n              if (flags.ternary_depth === 0) {\n                  // Colon is invalid javascript outside of ternary and object, but do our best to guess what was meant.\n                  space_before = false;\n              } else {\n                  flags.ternary_depth -= 1;\n              }\n          } else if (current_token.text === '?') {\n              flags.ternary_depth += 1;\n          } else if (current_token.text === '*' && last_type === 'TK_RESERVED' && flags.last_text === 'function') {\n              space_before = false;\n              space_after = false;\n          }\n          output.space_before_token = output.space_before_token || space_before;\n          print_token();\n          output.space_before_token = space_after;\n      }\n\n      function handle_block_comment() {\n          if (output.raw) {\n              output.add_raw_token(current_token)\n              if (current_token.directives && current_token.directives['preserve'] === 'end') {\n                  // If we're testing the raw output behavior, do not allow a directive to turn it off.\n                  if (!opt.test_output_raw) {\n                      output.raw = false;\n                  }\n              }\n              return;\n          }\n\n          if (current_token.directives) {\n              print_newline(false, true);\n              print_token();\n              if (current_token.directives['preserve'] === 'start') {\n                  output.raw = true;\n              }\n              print_newline(false, true);\n              return;\n          }\n\n          // inline block\n          if (!acorn.newline.test(current_token.text) && !current_token.wanted_newline) {\n              output.space_before_token = true;\n              print_token();\n              output.space_before_token = true;\n              return;\n          }\n\n          var lines = split_newlines(current_token.text);\n          var j; // iterator for this case\n          var javadoc = false;\n          var starless = false;\n          var lastIndent = current_token.whitespace_before;\n          var lastIndentLength = lastIndent.length;\n\n          // block comment starts with a new line\n          print_newline(false, true);\n          if (lines.length > 1) {\n              if (all_lines_start_with(lines.slice(1), '*')) {\n                  javadoc = true;\n              }\n              else if (each_line_matches_indent(lines.slice(1), lastIndent)) {\n                  starless = true;\n              }\n          }\n\n          // first line always indented\n          print_token(lines[0]);\n          for (j = 1; j < lines.length; j++) {\n              print_newline(false, true);\n              if (javadoc) {\n                  // javadoc: reformat and re-indent\n                  print_token(' ' + ltrim(lines[j]));\n              } else if (starless && lines[j].length > lastIndentLength) {\n                  // starless: re-indent non-empty content, avoiding trim\n                  print_token(lines[j].substring(lastIndentLength));\n              } else {\n                  // normal comments output raw\n                  output.add_token(lines[j]);\n              }\n          }\n\n          // for comments of more than one line, make sure there's a new line after\n          print_newline(false, true);\n      }\n\n      function handle_comment() {\n          if (current_token.wanted_newline) {\n              print_newline(false, true);\n          } else {\n              output.trim(true);\n          }\n\n          output.space_before_token = true;\n          print_token();\n          print_newline(false, true);\n      }\n\n      function handle_dot() {\n          if (start_of_statement()) {\n              // The conditional starts the statement if appropriate.\n          }\n\n          if (last_type === 'TK_RESERVED' && is_special_word(flags.last_text)) {\n              output.space_before_token = true;\n          } else {\n              // allow preserved newlines before dots in general\n              // force newlines on dots after close paren when break_chained - for bar().baz()\n              allow_wrap_or_preserved_newline(flags.last_text === ')' && opt.break_chained_methods);\n          }\n\n          print_token();\n      }\n\n      function handle_unknown() {\n          print_token();\n\n          if (current_token.text[current_token.text.length - 1] === '\\n') {\n              print_newline();\n          }\n      }\n\n      function handle_eof() {\n          // Unwind any open statements\n          while (flags.mode === MODE.Statement) {\n              restore_mode();\n          }\n      }\n  }\n\n\n  function OutputLine(parent) {\n      var _character_count = 0;\n      // use indent_count as a marker for lines that have preserved indentation\n      var _indent_count = -1;\n\n      var _items = [];\n      var _empty = true;\n\n      this.set_indent = function(level) {\n          _character_count = parent.baseIndentLength + level * parent.indent_length\n          _indent_count = level;\n      }\n\n      this.get_character_count = function() {\n          return _character_count;\n      }\n\n      this.is_empty = function() {\n          return _empty;\n      }\n\n      this.last = function() {\n          if (!this._empty) {\n            return _items[_items.length - 1];\n          } else {\n            return null;\n          }\n      }\n\n      this.push = function(input) {\n          _items.push(input);\n          _character_count += input.length;\n          _empty = false;\n      }\n\n      this.pop = function() {\n          var item = null;\n          if (!_empty) {\n              item = _items.pop();\n              _character_count -= item.length;\n              _empty = _items.length === 0;\n          }\n          return item;\n      }\n\n      this.remove_indent = function() {\n          if (_indent_count > 0) {\n              _indent_count -= 1;\n              _character_count -= parent.indent_length\n          }\n      }\n\n      this.trim = function() {\n          while (this.last() === ' ') {\n              var item = _items.pop();\n              _character_count -= 1;\n          }\n          _empty = _items.length === 0;\n      }\n\n      this.toString = function() {\n          var result = '';\n          if (!this._empty) {\n              if (_indent_count >= 0) {\n                  result = parent.indent_cache[_indent_count];\n              }\n              result += _items.join('')\n          }\n          return result;\n      }\n  }\n\n  function Output(indent_string, baseIndentString) {\n      baseIndentString = baseIndentString || '';\n      this.indent_cache = [ baseIndentString ];\n      this.baseIndentLength = baseIndentString.length;\n      this.indent_length = indent_string.length;\n      this.raw = false;\n\n      var lines =[];\n      this.baseIndentString = baseIndentString;\n      this.indent_string = indent_string;\n      this.previous_line = null;\n      this.current_line = null;\n      this.space_before_token = false;\n\n      this.add_outputline = function() {\n          this.previous_line = this.current_line;\n          this.current_line = new OutputLine(this);\n          lines.push(this.current_line);\n      }\n\n      // initialize\n      this.add_outputline();\n\n\n      this.get_line_number = function() {\n          return lines.length;\n      }\n\n      // Using object instead of string to allow for later expansion of info about each line\n      this.add_new_line = function(force_newline) {\n          if (this.get_line_number() === 1 && this.just_added_newline()) {\n              return false; // no newline on start of file\n          }\n\n          if (force_newline || !this.just_added_newline()) {\n              if (!this.raw) {\n                  this.add_outputline();\n              }\n              return true;\n          }\n\n          return false;\n      }\n\n      this.get_code = function() {\n          var sweet_code = lines.join('\\n').replace(/[\\r\\n\\t ]+$/, '');\n          return sweet_code;\n      }\n\n      this.set_indent = function(level) {\n          // Never indent your first output indent at the start of the file\n          if (lines.length > 1) {\n              while(level >= this.indent_cache.length) {\n                  this.indent_cache.push(this.indent_cache[this.indent_cache.length - 1] + this.indent_string);\n              }\n\n              this.current_line.set_indent(level);\n              return true;\n          }\n          this.current_line.set_indent(0);\n          return false;\n      }\n\n      this.add_raw_token = function(token) {\n          for (var x = 0; x < token.newlines; x++) {\n              this.add_outputline();\n          }\n          this.current_line.push(token.whitespace_before);\n          this.current_line.push(token.text);\n          this.space_before_token = false;\n      }\n\n      this.add_token = function(printable_token) {\n          this.add_space_before_token();\n          this.current_line.push(printable_token);\n      }\n\n      this.add_space_before_token = function() {\n          if (this.space_before_token && !this.just_added_newline()) {\n              this.current_line.push(' ');\n          }\n          this.space_before_token = false;\n      }\n\n      this.remove_redundant_indentation = function (frame) {\n          // This implementation is effective but has some issues:\n          //     - can cause line wrap to happen too soon due to indent removal\n          //           after wrap points are calculated\n          // These issues are minor compared to ugly indentation.\n\n          if (frame.multiline_frame ||\n              frame.mode === MODE.ForInitializer ||\n              frame.mode === MODE.Conditional) {\n              return;\n          }\n\n          // remove one indent from each line inside this section\n          var index = frame.start_line_index;\n          var line;\n\n          var output_length = lines.length;\n          while (index < output_length) {\n              lines[index].remove_indent();\n              index++;\n          }\n      }\n\n      this.trim = function(eat_newlines) {\n          eat_newlines = (eat_newlines === undefined) ? false : eat_newlines;\n\n          this.current_line.trim(indent_string, baseIndentString);\n\n          while (eat_newlines && lines.length > 1 &&\n              this.current_line.is_empty()) {\n              lines.pop();\n              this.current_line = lines[lines.length - 1]\n              this.current_line.trim();\n          }\n\n          this.previous_line = lines.length > 1 ? lines[lines.length - 2] : null;\n      }\n\n      this.just_added_newline = function() {\n          return this.current_line.is_empty();\n      }\n\n      this.just_added_blankline = function() {\n          if (this.just_added_newline()) {\n              if (lines.length === 1) {\n                  return true; // start of the file and newline = blank\n              }\n\n              var line = lines[lines.length - 2];\n              return line.is_empty();\n          }\n          return false;\n      }\n  }\n\n\n  var Token = function(type, text, newlines, whitespace_before, mode, parent) {\n      this.type = type;\n      this.text = text;\n      this.comments_before = [];\n      this.newlines = newlines || 0;\n      this.wanted_newline = newlines > 0;\n      this.whitespace_before = whitespace_before || '';\n      this.parent = null;\n      this.directives = null;\n  }\n\n  function tokenizer(input, opts, indent_string) {\n\n      var whitespace = \"\\n\\r\\t \".split('');\n      var digit = /[0-9]/;\n      var digit_oct = /[01234567]/;\n      var digit_hex = /[0123456789abcdefABCDEF]/;\n\n      var punct = ('+ - * / % & ++ -- = += -= *= /= %= == === != !== > < >= <= >> << >>> >>>= >>= <<= && &= | || ! ~ , : ? ^ ^= |= :: =>').split(' ');\n      // words which should always start on new line.\n      this.line_starters = 'continue,try,throw,return,var,let,const,if,switch,case,default,for,while,break,function,import,export'.split(',');\n      var reserved_words = this.line_starters.concat(['do', 'in', 'else', 'get', 'set', 'new', 'catch', 'finally', 'typeof', 'yield', 'async', 'await']);\n\n      //  /* ... */ comment ends with nearest */ or end of file\n      var block_comment_pattern = /([\\s\\S]*?)((?:\\*\\/)|$)/g;\n\n      // comment ends just before nearest linefeed or end of file\n      var comment_pattern = /([^\\n\\r\\u2028\\u2029]*)/g;\n\n      var directives_block_pattern = /\\/\\* beautify( \\w+[:]\\w+)+ \\*\\//g;\n      var directive_pattern = / (\\w+)[:](\\w+)/g;\n      var directives_end_ignore_pattern = /([\\s\\S]*?)((?:\\/\\*\\sbeautify\\signore:end\\s\\*\\/)|$)/g;\n\n      var template_pattern = /((<\\?php|<\\?=)[\\s\\S]*?\\?>)|(<%[\\s\\S]*?%>)/g\n\n      var n_newlines, whitespace_before_token, in_html_comment, tokens, parser_pos;\n      var input_length;\n\n      this.tokenize = function() {\n          // cache the source's length.\n          input_length = input.length\n          parser_pos = 0;\n          in_html_comment = false\n          tokens = [];\n\n          var next, last;\n          var token_values;\n          var open = null;\n          var open_stack = [];\n          var comments = [];\n\n          while (!(last && last.type === 'TK_EOF')) {\n              token_values = tokenize_next();\n              next = new Token(token_values[1], token_values[0], n_newlines, whitespace_before_token);\n              while(next.type === 'TK_COMMENT' || next.type === 'TK_BLOCK_COMMENT' || next.type === 'TK_UNKNOWN') {\n                  if (next.type === 'TK_BLOCK_COMMENT') {\n                      next.directives = token_values[2];\n                  }\n                  comments.push(next);\n                  token_values = tokenize_next();\n                  next = new Token(token_values[1], token_values[0], n_newlines, whitespace_before_token);\n              }\n\n              if (comments.length) {\n                  next.comments_before = comments;\n                  comments = [];\n              }\n\n              if (next.type === 'TK_START_BLOCK' || next.type === 'TK_START_EXPR') {\n                  next.parent = last;\n                  open_stack.push(open);\n                  open = next;\n              }  else if ((next.type === 'TK_END_BLOCK' || next.type === 'TK_END_EXPR') &&\n                  (open && (\n                      (next.text === ']' && open.text === '[') ||\n                      (next.text === ')' && open.text === '(') ||\n                      (next.text === '}' && open.text === '{')))) {\n                  next.parent = open.parent;\n                  open = open_stack.pop();\n              }\n\n              tokens.push(next);\n              last = next;\n          }\n\n          return tokens;\n      }\n\n      function get_directives (text) {\n          if (!text.match(directives_block_pattern)) {\n              return null;\n          }\n\n          var directives = {};\n          directive_pattern.lastIndex = 0;\n          var directive_match = directive_pattern.exec(text);\n\n          while (directive_match) {\n              directives[directive_match[1]] = directive_match[2];\n              directive_match = directive_pattern.exec(text);\n          }\n\n          return directives;\n      }\n\n      function tokenize_next() {\n          var i, resulting_string;\n          var whitespace_on_this_line = [];\n\n          n_newlines = 0;\n          whitespace_before_token = '';\n\n          if (parser_pos >= input_length) {\n              return ['', 'TK_EOF'];\n          }\n\n          var last_token;\n          if (tokens.length) {\n              last_token = tokens[tokens.length-1];\n          } else {\n              // For the sake of tokenizing we can pretend that there was on open brace to start\n              last_token = new Token('TK_START_BLOCK', '{');\n          }\n\n\n          var c = input.charAt(parser_pos);\n          parser_pos += 1;\n\n          while (in_array(c, whitespace)) {\n\n              if (acorn.newline.test(c)) {\n                  if (!(c === '\\n' && input.charAt(parser_pos-2) === '\\r')) {\n                      n_newlines += 1;\n                      whitespace_on_this_line = [];\n                  }\n              } else {\n                  whitespace_on_this_line.push(c);\n              }\n\n              if (parser_pos >= input_length) {\n                  return ['', 'TK_EOF'];\n              }\n\n              c = input.charAt(parser_pos);\n              parser_pos += 1;\n          }\n\n          if(whitespace_on_this_line.length) {\n              whitespace_before_token = whitespace_on_this_line.join('');\n          }\n\n          if (digit.test(c)) {\n              var allow_decimal = true;\n              var allow_e = true;\n              var local_digit = digit;\n\n              if (c === '0' && parser_pos < input_length && /[Xxo]/.test(input.charAt(parser_pos))) {\n                  // switch to hex/oct number, no decimal or e, just hex/oct digits\n                  allow_decimal = false;\n                  allow_e = false;\n                  c += input.charAt(parser_pos);\n                  parser_pos += 1;\n                  local_digit = /[o]/.test(input.charAt(parser_pos)) ? digit_oct : digit_hex;\n              } else {\n                  // we know this first loop will run.  It keeps the logic simpler.\n                  c = '';\n                  parser_pos -= 1;\n              }\n\n              // Add the digits\n              while (parser_pos < input_length && local_digit.test(input.charAt(parser_pos))) {\n                  c += input.charAt(parser_pos);\n                  parser_pos += 1;\n\n                  if (allow_decimal && parser_pos < input_length && input.charAt(parser_pos) === '.') {\n                      c += input.charAt(parser_pos);\n                      parser_pos += 1;\n                      allow_decimal = false;\n                  }\n\n                  if (allow_e && parser_pos < input_length && /[Ee]/.test(input.charAt(parser_pos))) {\n                      c += input.charAt(parser_pos);\n                      parser_pos += 1;\n\n                      if (parser_pos < input_length && /[+-]/.test(input.charAt(parser_pos))) {\n                          c += input.charAt(parser_pos);\n                          parser_pos += 1;\n                      }\n\n                      allow_e = false;\n                      allow_decimal = false;\n                  }\n              }\n\n              return [c, 'TK_WORD'];\n          }\n\n          if (acorn.isIdentifierStart(input.charCodeAt(parser_pos-1))) {\n              if (parser_pos < input_length) {\n                  while (acorn.isIdentifierChar(input.charCodeAt(parser_pos))) {\n                      c += input.charAt(parser_pos);\n                      parser_pos += 1;\n                      if (parser_pos === input_length) {\n                          break;\n                      }\n                  }\n              }\n\n              if (!(last_token.type === 'TK_DOT' ||\n                      (last_token.type === 'TK_RESERVED' && in_array(last_token.text, ['set', 'get'])))\n                  && in_array(c, reserved_words)) {\n                  if (c === 'in') { // hack for 'in' operator\n                      return [c, 'TK_OPERATOR'];\n                  }\n                  return [c, 'TK_RESERVED'];\n              }\n\n              return [c, 'TK_WORD'];\n          }\n\n          if (c === '(' || c === '[') {\n              return [c, 'TK_START_EXPR'];\n          }\n\n          if (c === ')' || c === ']') {\n              return [c, 'TK_END_EXPR'];\n          }\n\n          if (c === '{') {\n              return [c, 'TK_START_BLOCK'];\n          }\n\n          if (c === '}') {\n              return [c, 'TK_END_BLOCK'];\n          }\n\n          if (c === ';') {\n              return [c, 'TK_SEMICOLON'];\n          }\n\n          if (c === '/') {\n              var comment = '';\n              // peek for comment /* ... */\n              if (input.charAt(parser_pos) === '*') {\n                  parser_pos += 1;\n                  block_comment_pattern.lastIndex = parser_pos;\n                  var comment_match = block_comment_pattern.exec(input);\n                  comment = '/*' + comment_match[0];\n                  parser_pos += comment_match[0].length;\n                  var directives = get_directives(comment);\n                  if (directives && directives['ignore'] === 'start') {\n                      directives_end_ignore_pattern.lastIndex = parser_pos;\n                      comment_match = directives_end_ignore_pattern.exec(input)\n                      comment += comment_match[0];\n                      parser_pos += comment_match[0].length;\n                  }\n                  comment = comment.replace(acorn.lineBreak, '\\n');\n                  return [comment, 'TK_BLOCK_COMMENT', directives];\n              }\n              // peek for comment // ...\n              if (input.charAt(parser_pos) === '/') {\n                  parser_pos += 1;\n                  comment_pattern.lastIndex = parser_pos;\n                  var comment_match = comment_pattern.exec(input);\n                  comment = '//' + comment_match[0];\n                  parser_pos += comment_match[0].length;\n                  return [comment, 'TK_COMMENT'];\n              }\n\n          }\n\n          if (c === '`' || c === \"'\" || c === '\"' || // string\n              (\n                  (c === '/') || // regexp\n                  (opts.e4x && c === \"<\" && input.slice(parser_pos - 1).match(/^<([-a-zA-Z:0-9_.]+|{[^{}]*}|!\\[CDATA\\[[\\s\\S]*?\\]\\])(\\s+[-a-zA-Z:0-9_.]+\\s*=\\s*('[^']*'|\"[^\"]*\"|{.*?}))*\\s*(\\/?)\\s*>/)) // xml\n              ) && ( // regex and xml can only appear in specific locations during parsing\n                  (last_token.type === 'TK_RESERVED' && in_array(last_token.text , ['return', 'case', 'throw', 'else', 'do', 'typeof', 'yield'])) ||\n                  (last_token.type === 'TK_END_EXPR' && last_token.text === ')' &&\n                      last_token.parent && last_token.parent.type === 'TK_RESERVED' && in_array(last_token.parent.text, ['if', 'while', 'for'])) ||\n                  (in_array(last_token.type, ['TK_COMMENT', 'TK_START_EXPR', 'TK_START_BLOCK',\n                      'TK_END_BLOCK', 'TK_OPERATOR', 'TK_EQUALS', 'TK_EOF', 'TK_SEMICOLON', 'TK_COMMA'\n                  ]))\n              )) {\n\n              var sep = c,\n                  esc = false,\n                  has_char_escapes = false;\n\n              resulting_string = c;\n\n              if (sep === '/') {\n                  //\n                  // handle regexp\n                  //\n                  var in_char_class = false;\n                  while (parser_pos < input_length &&\n                          ((esc || in_char_class || input.charAt(parser_pos) !== sep) &&\n                          !acorn.newline.test(input.charAt(parser_pos)))) {\n                      resulting_string += input.charAt(parser_pos);\n                      if (!esc) {\n                          esc = input.charAt(parser_pos) === '\\\\';\n                          if (input.charAt(parser_pos) === '[') {\n                              in_char_class = true;\n                          } else if (input.charAt(parser_pos) === ']') {\n                              in_char_class = false;\n                          }\n                      } else {\n                          esc = false;\n                      }\n                      parser_pos += 1;\n                  }\n              } else if (opts.e4x && sep === '<') {\n                  //\n                  // handle e4x xml literals\n                  //\n                  var xmlRegExp = /<(\\/?)([-a-zA-Z:0-9_.]+|{[^{}]*}|!\\[CDATA\\[[\\s\\S]*?\\]\\])(\\s+[-a-zA-Z:0-9_.]+\\s*=\\s*('[^']*'|\"[^\"]*\"|{.*?}))*\\s*(\\/?)\\s*>/g;\n                  var xmlStr = input.slice(parser_pos - 1);\n                  var match = xmlRegExp.exec(xmlStr);\n                  if (match && match.index === 0) {\n                      var rootTag = match[2];\n                      var depth = 0;\n                      while (match) {\n                          var isEndTag = !! match[1];\n                          var tagName = match[2];\n                          var isSingletonTag = ( !! match[match.length - 1]) || (tagName.slice(0, 8) === \"![CDATA[\");\n                          if (tagName === rootTag && !isSingletonTag) {\n                              if (isEndTag) {\n                                  --depth;\n                              } else {\n                                  ++depth;\n                              }\n                          }\n                          if (depth <= 0) {\n                              break;\n                          }\n                          match = xmlRegExp.exec(xmlStr);\n                      }\n                      var xmlLength = match ? match.index + match[0].length : xmlStr.length;\n                      xmlStr = xmlStr.slice(0, xmlLength);\n                      parser_pos += xmlLength - 1;\n                      xmlStr = xmlStr.replace(acorn.lineBreak, '\\n');\n                      return [xmlStr, \"TK_STRING\"];\n                  }\n              } else {\n                  //\n                  // handle string\n                  //\n                  // Template strings can travers lines without escape characters.\n                  // Other strings cannot\n                  while (parser_pos < input_length &&\n                          (esc || (input.charAt(parser_pos) !== sep &&\n                          (sep === '`' || !acorn.newline.test(input.charAt(parser_pos)))))) {\n                      // Handle \\r\\n linebreaks after escapes or in template strings\n                      if ((esc || sep === '`') && acorn.newline.test(input.charAt(parser_pos))) {\n                          if (input.charAt(parser_pos) === '\\r' && input.charAt(parser_pos + 1) === '\\n') {\n                              parser_pos += 1;\n                          }\n                          resulting_string += '\\n';\n                      } else {\n                          resulting_string += input.charAt(parser_pos);\n                      }\n                      if (esc) {\n                          if (input.charAt(parser_pos) === 'x' || input.charAt(parser_pos) === 'u') {\n                              has_char_escapes = true;\n                          }\n                          esc = false;\n                      } else {\n                          esc = input.charAt(parser_pos) === '\\\\';\n                      }\n                      parser_pos += 1;\n                  }\n\n              }\n\n              if (has_char_escapes && opts.unescape_strings) {\n                  resulting_string = unescape_string(resulting_string);\n              }\n\n              if (parser_pos < input_length && input.charAt(parser_pos) === sep) {\n                  resulting_string += sep;\n                  parser_pos += 1;\n\n                  if (sep === '/') {\n                      // regexps may have modifiers /regexp/MOD , so fetch those, too\n                      // Only [gim] are valid, but if the user puts in garbage, do what we can to take it.\n                      while (parser_pos < input_length && acorn.isIdentifierStart(input.charCodeAt(parser_pos))) {\n                          resulting_string += input.charAt(parser_pos);\n                          parser_pos += 1;\n                      }\n                  }\n              }\n              return [resulting_string, 'TK_STRING'];\n          }\n\n          if (c === '#') {\n\n              if (tokens.length === 0 && input.charAt(parser_pos) === '!') {\n                  // shebang\n                  resulting_string = c;\n                  while (parser_pos < input_length && c !== '\\n') {\n                      c = input.charAt(parser_pos);\n                      resulting_string += c;\n                      parser_pos += 1;\n                  }\n                  return [trim(resulting_string) + '\\n', 'TK_UNKNOWN'];\n              }\n\n\n\n              // Spidermonkey-specific sharp variables for circular references\n              // https://developer.mozilla.org/En/Sharp_variables_in_JavaScript\n              // http://mxr.mozilla.org/mozilla-central/source/js/src/jsscan.cpp around line 1935\n              var sharp = '#';\n              if (parser_pos < input_length && digit.test(input.charAt(parser_pos))) {\n                  do {\n                      c = input.charAt(parser_pos);\n                      sharp += c;\n                      parser_pos += 1;\n                  } while (parser_pos < input_length && c !== '#' && c !== '=');\n                  if (c === '#') {\n                      //\n                  } else if (input.charAt(parser_pos) === '[' && input.charAt(parser_pos + 1) === ']') {\n                      sharp += '[]';\n                      parser_pos += 2;\n                  } else if (input.charAt(parser_pos) === '{' && input.charAt(parser_pos + 1) === '}') {\n                      sharp += '{}';\n                      parser_pos += 2;\n                  }\n                  return [sharp, 'TK_WORD'];\n              }\n          }\n\n          if (c === '<' && (input.charAt(parser_pos) === '?' || input.charAt(parser_pos) === '%')) {\n              template_pattern.lastIndex = parser_pos - 1;\n              var template_match = template_pattern.exec(input);\n              if(template_match) {\n                  c = template_match[0];\n                  parser_pos += c.length - 1;\n                  c = c.replace(acorn.lineBreak, '\\n');\n                  return [c, 'TK_STRING'];\n              }\n          }\n\n          if (c === '<' && input.substring(parser_pos - 1, parser_pos + 3) === '<!--') {\n              parser_pos += 3;\n              c = '<!--';\n              while (!acorn.newline.test(input.charAt(parser_pos)) && parser_pos < input_length) {\n                  c += input.charAt(parser_pos);\n                  parser_pos++;\n              }\n              in_html_comment = true;\n              return [c, 'TK_COMMENT'];\n          }\n\n          if (c === '-' && in_html_comment && input.substring(parser_pos - 1, parser_pos + 2) === '-->') {\n              in_html_comment = false;\n              parser_pos += 2;\n              return ['-->', 'TK_COMMENT'];\n          }\n\n          if (c === '.') {\n              return [c, 'TK_DOT'];\n          }\n\n          if (in_array(c, punct)) {\n              while (parser_pos < input_length && in_array(c + input.charAt(parser_pos), punct)) {\n                  c += input.charAt(parser_pos);\n                  parser_pos += 1;\n                  if (parser_pos >= input_length) {\n                      break;\n                  }\n              }\n\n              if (c === ',') {\n                  return [c, 'TK_COMMA'];\n              } else if (c === '=') {\n                  return [c, 'TK_EQUALS'];\n              } else {\n                  return [c, 'TK_OPERATOR'];\n              }\n          }\n\n          return [c, 'TK_UNKNOWN'];\n      }\n\n\n      function unescape_string(s) {\n          var esc = false,\n              out = '',\n              pos = 0,\n              s_hex = '',\n              escaped = 0,\n              c;\n\n          while (esc || pos < s.length) {\n\n              c = s.charAt(pos);\n              pos++;\n\n              if (esc) {\n                  esc = false;\n                  if (c === 'x') {\n                      // simple hex-escape \\x24\n                      s_hex = s.substr(pos, 2);\n                      pos += 2;\n                  } else if (c === 'u') {\n                      // unicode-escape, \\u2134\n                      s_hex = s.substr(pos, 4);\n                      pos += 4;\n                  } else {\n                      // some common escape, e.g \\n\n                      out += '\\\\' + c;\n                      continue;\n                  }\n                  if (!s_hex.match(/^[0123456789abcdefABCDEF]+$/)) {\n                      // some weird escaping, bail out,\n                      // leaving whole string intact\n                      return s;\n                  }\n\n                  escaped = parseInt(s_hex, 16);\n\n                  if (escaped >= 0x00 && escaped < 0x20) {\n                      // leave 0x00...0x1f escaped\n                      if (c === 'x') {\n                          out += '\\\\x' + s_hex;\n                      } else {\n                          out += '\\\\u' + s_hex;\n                      }\n                      continue;\n                  } else if (escaped === 0x22 || escaped === 0x27 || escaped === 0x5c) {\n                      // single-quote, apostrophe, backslash - escape these\n                      out += '\\\\' + String.fromCharCode(escaped);\n                  } else if (c === 'x' && escaped > 0x7e && escaped <= 0xff) {\n                      // we bail out on \\x7f..\\xff,\n                      // leaving whole string escaped,\n                      // as it's probably completely binary\n                      return s;\n                  } else {\n                      out += String.fromCharCode(escaped);\n                  }\n              } else if (c === '\\\\') {\n                  esc = true;\n              } else {\n                  out += c;\n              }\n          }\n          return out;\n      }\n\n  }\n\n  return {\n    run: run\n  }\n\n  /* jshint ignore:end */\n  /* jscs:enable */\n};","import FE from 'FroalaEditor';\n\nObject.assign(FE.DEFAULTS, {\n  codeMirror: window.CodeMirror,\n  codeMirrorOptions: {\n    lineNumbers: true,\n    tabMode: 'indent',\n    indentWithTabs: true,\n    lineWrapping: true,\n    mode: 'text/html',\n    tabSize: 2\n  },\n  codeBeautifierOptions: {\n    end_with_newline: true,\n    indent_inner_html: true,\n    extra_liners: ['p', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'blockquote', 'pre', 'ul', 'ol', 'table', 'dl'],\n    brace_style: 'expand',\n    indent_char: '\\t',\n    indent_size: 1,\n    wrap_line_length: 0\n  },\n  codeViewKeepActiveButtons: ['fullscreen']\n})\n\nFE.PLUGINS.codeView = function (editor) {\n  let $ = editor.$\n\n  var $html_area;\n  var code_mirror;\n\n  /**\n   * Check if code view is enabled.\n   */\n  function isActive () {\n    return editor.$box.hasClass('fr-code-view');\n  }\n\n  function get () {\n    if (code_mirror) {\n      return code_mirror.getValue();\n    }\n    else {\n      return $html_area.val();\n    }\n  }\n\n  function refresh () {\n    if (isActive()) {\n      if (code_mirror) {\n        code_mirror.setSize(null, editor.opts.height ? editor.opts.height : 'auto');\n      }\n\n      if (editor.opts.heightMin || editor.opts.height) {\n        editor.$box.find('.CodeMirror-scroll, .CodeMirror-gutters').css('min-height', editor.opts.heightMin || editor.opts.height);\n      }\n      else {\n        editor.$box.find('.CodeMirror-scroll, .CodeMirror-gutters').css('min-height', '');\n      }\n    }\n  }\n\n  /**\n   * Get back to edit mode.\n   */\n  function _showText ($btn) {\n    var html = get();\n\n    // Code mirror enabled.\n    editor.html.set(html);\n\n    // Blur the element.\n    editor.$el.blur();\n\n    // Toolbar no longer disabled.\n    editor.$tb.find(' > .fr-command').not($btn).removeClass('fr-disabled').attr('aria-disabled', false);\n    $btn.removeClass('fr-active').attr('aria-pressed', false);\n\n    editor.selection.setAtStart(editor.el);\n    editor.selection.restore();\n    editor.placeholder.refresh();\n\n    editor.undo.saveStep();\n  }\n\n  var _can_focus = false;\n\n  function _blur () {\n    if (isActive()) {\n      editor.events.trigger('blur')\n    }\n  }\n\n  function _focus () {\n    if (isActive() && _can_focus) {\n      editor.events.trigger('focus')\n    }\n  }\n\n  /**\n   * Get to code mode.\n   */\n  function _showHTML ($btn) {\n    if (!$html_area) {\n      _initArea();\n\n      // Enable code mirror.\n      if (!code_mirror && editor.opts.codeMirror) {\n        code_mirror = editor.opts.codeMirror.fromTextArea($html_area.get(0), editor.opts.codeMirrorOptions);\n\n        code_mirror.on('blur', _blur);\n        code_mirror.on('focus', _focus);\n      }\n      else {\n        editor.events.$on($html_area, 'keydown keyup change input', function () {\n          if (!editor.opts.height) {\n            this.rows = 1;\n\n            // Textarea has no content anymore.\n            if (this.value.length === 0) {\n              this.style.height = 'auto';\n            }\n\n            else {\n              this.style.height = this.scrollHeight + 'px';\n            }\n          }\n          else {\n            this.removeAttribute('rows')\n          }\n        });\n\n        editor.events.$on($html_area, 'blur', _blur);\n        editor.events.$on($html_area, 'focus', _focus);\n      }\n    }\n\n    editor.undo.saveStep();\n\n    // Clean white tags but ignore selection.\n    editor.html.cleanEmptyTags();\n    editor.html.cleanWhiteTags(true);\n\n    // Blur the element.\n    if (editor.core.hasFocus()) {\n      if (!editor.core.isEmpty()) {\n        editor.selection.save();\n        editor.$el.find('.fr-marker[data-type=\"true\"]').first().replaceWith('<span class=\"fr-tmp fr-sm\">F</span>');\n        editor.$el.find('.fr-marker[data-type=\"false\"]').first().replaceWith('<span class=\"fr-tmp fr-em\">F</span>');\n      }\n    }\n\n    // Get HTML.\n    var html = editor.html.get(false, true);\n    editor.$el.find('span.fr-tmp').remove();\n\n    editor.$box.toggleClass('fr-code-view', true);\n\n    var was_focused = false;\n\n    if (editor.core.hasFocus()) {\n      was_focused = true;\n      editor.events.disableBlur();\n      editor.$el.blur();\n    }\n\n    html = html.replace(/<span class=\"fr-tmp fr-sm\">F<\\/span>/, 'FROALA-SM');\n    html = html.replace(/<span class=\"fr-tmp fr-em\">F<\\/span>/, 'FROALA-EM');\n\n    // Beautify HTML.\n    if (editor.codeBeautifier) {\n      html = editor.codeBeautifier.run(html, editor.opts.codeBeautifierOptions);\n    }\n\n    var s_index;\n    var e_index;\n\n    // Code mirror is enabled.\n    if (code_mirror) {\n      s_index = html.indexOf('FROALA-SM');\n      e_index = html.indexOf('FROALA-EM');\n\n      if (s_index > e_index) {\n        s_index = e_index;\n      }\n      else {\n        e_index = e_index - 9;\n      }\n\n      html = html.replace(/FROALA-SM/g, '').replace(/FROALA-EM/g, '')\n      var s_line = html.substring(0, s_index).length - html.substring(0, s_index).replace(/\\n/g, '').length;\n      var e_line = html.substring(0, e_index).length - html.substring(0, e_index).replace(/\\n/g, '').length;\n\n      s_index = html.substring(0, s_index).length - html.substring(0, html.substring(0, s_index).lastIndexOf('\\n') + 1).length;\n      e_index = html.substring(0, e_index).length - html.substring(0, html.substring(0, e_index).lastIndexOf('\\n')  + 1).length;\n\n      code_mirror.setSize(null, editor.opts.height ? editor.opts.height : 'auto');\n\n      if (editor.opts.heightMin) editor.$box.find('.CodeMirror-scroll').css('min-height', editor.opts.heightMin);\n      code_mirror.setValue(html);\n      _can_focus = !was_focused;\n      code_mirror.focus();\n      _can_focus = true;\n      code_mirror.setSelection({ line: s_line, ch: s_index }, { line: e_line, ch: e_index })\n      code_mirror.refresh();\n      code_mirror.clearHistory();\n    }\n\n    // No code mirror.\n    else {\n      s_index = html.indexOf('FROALA-SM');\n      e_index = html.indexOf('FROALA-EM') - 9;\n\n      if (editor.opts.heightMin) {\n        $html_area.css('min-height', editor.opts.heightMin);\n      }\n\n      if (editor.opts.height) {\n        $html_area.css('height', editor.opts.height);\n      }\n\n      if (editor.opts.heightMax) {\n        $html_area.css('max-height', editor.opts.height || editor.opts.heightMax);\n      }\n\n      $html_area.val(html.replace(/FROALA-SM/g, '').replace(/FROALA-EM/g, '')).trigger('change');\n\n      var scroll_top = $(editor.o_doc).scrollTop();\n      _can_focus = !was_focused;\n      $html_area.focus();\n      _can_focus = true;\n      $html_area.get(0).setSelectionRange(s_index, e_index);\n      $(editor.o_doc).scrollTop(scroll_top);\n    }\n\n    // Disable buttons.\n    editor.$tb.find(' > .fr-command').not($btn).filter(function () {\n      return editor.opts.codeViewKeepActiveButtons.indexOf($(this).data('cmd')) < 0;\n    }).addClass('fr-disabled').attr('aria-disabled', true);\n    $btn.addClass('fr-active').attr('aria-pressed', true);\n\n    if (!editor.helpers.isMobile() && editor.opts.toolbarInline) {\n      editor.toolbar.hide();\n    }\n  }\n\n  /**\n   * Toggle the code view.\n   */\n  function toggle (val) {\n    if (typeof val == 'undefined') val = !isActive();\n\n    var $btn = editor.$tb.find('.fr-command[data-cmd=\"html\"]');\n\n    if (!val) {\n      editor.$box.toggleClass('fr-code-view', false);\n      _showText($btn);\n    }\n    else {\n      editor.popups.hideAll();\n      _showHTML($btn);\n    }\n  }\n\n  /**\n   * Destroy.\n   */\n  function _destroy () {\n    if (isActive()) {\n      toggle(false);\n    }\n\n    if (code_mirror) code_mirror.toTextArea();\n    $html_area.val('').removeData().remove();\n    $html_area = null;\n\n    if ($back_button) {\n      $back_button.remove();\n      $back_button = null;\n    }\n  }\n\n  function _initArea () {\n\n    // Add the coding textarea to the wrapper.\n    $html_area = $('<textarea class=\"fr-code\" tabIndex=\"-1\">');\n    editor.$wp.append($html_area);\n\n    $html_area.attr('dir', editor.opts.direction);\n\n    // Exit code view button for inline toolbar.\n    if (!editor.$box.hasClass('fr-basic')) {\n      $back_button = $('<a data-cmd=\"html\" title=\"Code View\" class=\"fr-command fr-btn html-switch' + (editor.helpers.isMobile() ? '' : ' fr-desktop') + '\" role=\"button\" tabIndex=\"-1\"><i class=\"fa fa-code\"></i></button>');\n      editor.$box.append($back_button);\n\n      editor.events.bindClick(editor.$box, 'a.html-switch', function () {\n        toggle(false);\n      });\n    }\n\n    var cancel = function () {\n      return !isActive();\n    }\n\n    // Disable refresh of the buttons while enabled.\n    editor.events.on('buttons.refresh', cancel);\n    editor.events.on('copy', cancel, true);\n    editor.events.on('cut', cancel, true);\n    editor.events.on('paste', cancel, true);\n\n    editor.events.on('destroy', _destroy, true);\n\n    editor.events.on('html.set', function () {\n      if (isActive()) toggle(true);\n    });\n\n    editor.events.on('codeView.update', refresh);\n\n    editor.events.on('form.submit', function () {\n      if (isActive()) {\n\n        // Code mirror enabled.\n        editor.html.set(get());\n\n        editor.events.trigger('contentChanged', [], true);\n      }\n    }, true);\n  }\n\n  /**\n   * Initialize.\n   */\n  var $back_button;\n\n  function _init () {\n    if (!editor.$wp) return false;\n  }\n\n  return {\n    _init: _init,\n    toggle: toggle,\n    isActive: isActive,\n    get: get\n  }\n};\n\nFE.RegisterCommand('html', {\n  title: 'Code View',\n  undo: false,\n  focus: false,\n  forcedRefresh: true,\n  toggle: true,\n  callback: function () {\n    this.codeView.toggle();\n  },\n  plugin: 'codeView'\n})\n\nFE.DefineIcon('html', {\n  NAME: 'code'\n});","import FE from 'FroalaEditor';\n\nObject.assign(FE.POPUP_TEMPLATES, {\n  'colors.picker': '[_BUTTONS_][_TEXT_COLORS_][_BACKGROUND_COLORS_][_CUSTOM_COLOR_]'\n})\n\n// Extend defaults.\nObject.assign(FE.DEFAULTS, {\n  colorsText: [\n    '#61BD6D', '#1ABC9C', '#54ACD2', '#2C82C9', '#9365B8', '#475577', '#CCCCCC',\n    '#41A85F', '#00A885', '#3D8EB9', '#2969B0', '#553982', '#28324E', '#000000',\n    '#F7DA64', '#FBA026', '#EB6B56', '#E25041', '#A38F84', '#EFEFEF', '#FFFFFF',\n    '#FAC51C', '#F37934', '#D14841', '#B8312F', '#7C706B', '#D1D5D8', 'REMOVE'\n  ],\n  colorsBackground: [\n    '#61BD6D', '#1ABC9C', '#54ACD2', '#2C82C9', '#9365B8', '#475577', '#CCCCCC',\n    '#41A85F', '#00A885', '#3D8EB9', '#2969B0', '#553982', '#28324E', '#000000',\n    '#F7DA64', '#FBA026', '#EB6B56', '#E25041', '#A38F84', '#EFEFEF', '#FFFFFF',\n    '#FAC51C', '#F37934', '#D14841', '#B8312F', '#7C706B', '#D1D5D8', 'REMOVE'\n  ],\n  colorsStep: 7,\n  colorsHEXInput: true,\n  colorsDefaultTab: 'text',\n  colorsButtons: ['colorsBack', '|', '-']\n});\n\nFE.PLUGINS.colors = function (editor) {\n  let $ = editor.$;\n\n  /*\n   * Show the colors popup.\n   */\n  function _showColorsPopup () {\n    var $btn = editor.$tb.find('.fr-command[data-cmd=\"color\"]');\n\n    var $popup = editor.popups.get('colors.picker');\n\n    if (!$popup) $popup = _initColorsPopup();\n\n    if (!$popup.hasClass('fr-active')) {\n\n      // Colors popup\n      editor.popups.setContainer('colors.picker', editor.$tb);\n\n      // Refresh selected color.\n      _refreshColor($popup.find('.fr-selected-tab').attr('data-param1'));\n\n      // Colors popup left and top position.\n      if ($btn.isVisible()) {\n        var left = $btn.offset().left + $btn.outerWidth() / 2;\n        var top = $btn.offset().top + (editor.opts.toolbarBottom ? 10 : $btn.outerHeight() - 10);\n        editor.popups.show('colors.picker', left, top, $btn.outerHeight());\n      }\n\n      else {\n        editor.position.forSelection($popup);\n        editor.popups.show('colors.picker');\n      }\n    }\n  }\n\n  /*\n   * Hide colors popup.\n   */\n  function _hideColorsPopup () {\n\n    // Hide popup.\n    editor.popups.hide('colors.picker');\n  }\n\n  /**\n   * Init the colors popup.\n   */\n  function _initColorsPopup () {\n    var colors_buttons = '<div class=\"fr-buttons fr-colors-buttons\">';\n\n    if (editor.opts.toolbarInline) {\n\n      // Colors buttons.\n      if (editor.opts.colorsButtons.length > 0) {\n        colors_buttons += editor.button.buildList(editor.opts.colorsButtons)\n      }\n    }\n\n    colors_buttons += _colorsTabsHTML() + '</div>';\n\n    // Custom HEX.\n    var custom_color = '';\n\n    if (editor.opts.colorsHEXInput) {\n      custom_color = '<div class=\"fr-color-hex-layer fr-active fr-layer\" id=\"fr-color-hex-layer-' + editor.id + '\"><div class=\"fr-input-line\"><input maxlength=\"7\" id=\"fr-color-hex-layer-text-' + editor.id + '\" type=\"text\" placeholder=\"' + editor.language.translate('HEX Color') + '\" tabIndex=\"1\" aria-required=\"true\"></div><div class=\"fr-action-buttons\"><button type=\"button\" class=\"fr-command fr-submit\" data-cmd=\"customColor\" tabIndex=\"2\" role=\"button\">' + editor.language.translate('OK') + '</button></div></div>';\n    }\n\n    var template = {\n      buttons: colors_buttons,\n      text_colors: _colorPickerHTML('text'),\n      background_colors: _colorPickerHTML('background'),\n      custom_color: custom_color\n    };\n\n    // Create popup.\n    var $popup = editor.popups.create('colors.picker', template);\n\n    _addAccessibility($popup);\n\n    return $popup;\n  }\n\n  /*\n   * HTML for the color picker text and background tabs.\n   */\n  function _colorsTabsHTML () {\n    var tabs_html = '<div class=\"fr-colors-tabs fr-group\">';\n\n    // Text tab.\n    tabs_html += '<span class=\"fr-colors-tab ' + (editor.opts.colorsDefaultTab == 'background' ? '' : 'fr-selected-tab ') + 'fr-command\" tabIndex=\"-1\" role=\"button\" aria-pressed=\"' + (editor.opts.colorsDefaultTab == 'background' ? false : true) + '\" data-param1=\"text\" data-cmd=\"colorChangeSet\" title=\"' + editor.language.translate('Text') + '\">' + editor.language.translate('Text') + '</span>';\n\n    // Background tab.\n    tabs_html += '<span class=\"fr-colors-tab ' + (editor.opts.colorsDefaultTab == 'background' ? 'fr-selected-tab ' : '') + 'fr-command\" tabIndex=\"-1\" role=\"button\" aria-pressed=\"' + (editor.opts.colorsDefaultTab == 'background' ? true : false) + '\" data-param1=\"background\" data-cmd=\"colorChangeSet\" title=\"' + editor.language.translate('Background') + '\">' + editor.language.translate('Background') + '</span>';\n\n    return tabs_html + '</div>';\n  }\n\n  /*\n   * HTML for the color picker colors.\n   */\n  function _colorPickerHTML (tab) {\n\n    // Get colors according to tab name.\n    var colors = (tab == 'text' ? editor.opts.colorsText : editor.opts.colorsBackground);\n\n    // Create colors html.\n    var colors_html = '<div class=\"fr-color-set fr-' + tab + '-color' + ((editor.opts.colorsDefaultTab == tab || (editor.opts.colorsDefaultTab != 'text' && editor.opts.colorsDefaultTab != 'background' && tab == 'text')) ? ' fr-selected-set' : '') + '\">';\n\n    // Add colors.\n    for (var i = 0; i < colors.length; i++) {\n      if (i !== 0 && i % editor.opts.colorsStep === 0) {\n        colors_html += '<br>';\n      }\n\n      if (colors[i] != 'REMOVE') {\n        colors_html += '<span class=\"fr-command fr-select-color\" style=\"background: ' + colors[i] + ';\" tabIndex=\"-1\" aria-selected=\"false\" role=\"button\" data-cmd=\"' + tab + 'Color\" data-param1=\"' + colors[i] + '\"><span class=\"fr-sr-only\">' + editor.language.translate('Color') + ' ' + colors[i] + '&nbsp;&nbsp;&nbsp;</span></span>';\n      }\n\n      else {\n        colors_html += '<span class=\"fr-command fr-select-color\" data-cmd=\"' + tab + 'Color\" tabIndex=\"-1\" role=\"button\" data-param1=\"REMOVE\" title=\"' + editor.language.translate('Clear Formatting') + '\">' + editor.icon.create('remove') + '<span class=\"fr-sr-only\">' + editor.language.translate('Clear Formatting') + '</span>' +  '</span>';\n      }\n    }\n\n    return colors_html + '</div>';\n  }\n\n  /*\n   * Register keyboard events.\n   */\n  function _addAccessibility ($popup) {\n\n    // Register popup event.\n    editor.events.on('popup.tab', function (e) {\n      var $focused_item = $(e.currentTarget);\n\n      // Skip if popup is not visible or focus is elsewere.\n      if (!editor.popups.isVisible('colors.picker') || !$focused_item.is('span')) {\n        return true;\n      }\n      var key_code = e.which;\n      var status = true;\n\n      // Tabbing.\n      if (FE.KEYCODE.TAB == key_code) {\n        var $tb = $popup.find('.fr-buttons');\n\n        // Focus back the popup's toolbar if exists.\n        status = !editor.accessibility.focusToolbar($tb, (e.shiftKey ? true : false));\n      }\n\n      // Arrows.\n      else if (FE.KEYCODE.ARROW_UP == key_code || FE.KEYCODE.ARROW_DOWN == key_code || FE.KEYCODE.ARROW_LEFT == key_code || FE.KEYCODE.ARROW_RIGHT == key_code) {\n        if ($focused_item.is('span.fr-select-color')) {\n\n          // Get all current colors.\n          var $colors = $focused_item.parent().find('span.fr-select-color');\n\n          // Get focused item position.\n          var index = $colors.index($focused_item);\n\n          // Get color matrix dimensions.\n          var columns = editor.opts.colorsStep;\n          var lines = Math.floor($colors.length / columns);\n\n          // Get focused item coordinates.\n          var column = index % columns;\n          var line = Math.floor(index / columns);\n\n          var nextIndex = line * columns + column;\n          var dimension = lines * columns;\n\n          // Calculate next index. Go to the other opposite site of the matrix if there is no next adjacent element.\n          // Up/Down: Traverse matrix lines.\n          // Left/Right: Traverse the matrix as it is a vector.\n          if (FE.KEYCODE.ARROW_UP == key_code) {\n            nextIndex = (((nextIndex - columns) % dimension) + dimension) % dimension; // Javascript negative modulo bug.\n          }\n          else if (FE.KEYCODE.ARROW_DOWN == key_code) {\n            nextIndex = (nextIndex + columns) % dimension;\n          }\n          else if (FE.KEYCODE.ARROW_LEFT == key_code) {\n            nextIndex = (((nextIndex - 1) % dimension) + dimension) % dimension; // Javascript negative modulo bug.\n          }\n          else if (FE.KEYCODE.ARROW_RIGHT == key_code) {\n            nextIndex = (nextIndex + 1) % dimension;\n          }\n\n          // Get the next element based on the new index.\n          var $el = $($colors.get(nextIndex));\n\n          // Focus.\n          editor.events.disableBlur();\n          $el.focus();\n\n          status = false;\n        }\n      }\n\n      // ENTER or SPACE.\n      else if (FE.KEYCODE.ENTER == key_code) {\n\n        editor.button.exec($focused_item);\n        status = false;\n      }\n\n      // Prevent propagation.\n      if (status === false) {\n        e.preventDefault();\n        e.stopPropagation();\n      }\n\n      return status;\n    }, true);\n  }\n\n  /*\n   * Show the current selected color.\n   */\n  function _refreshColor (tab) {\n    var $popup = editor.popups.get('colors.picker');\n    var $element = $(editor.selection.element());\n\n    // The color css property.\n    var color_type;\n\n    if (tab == 'background') {\n      color_type = 'background-color';\n    }\n    else {\n      color_type = 'color';\n    }\n\n    var $current_color = $popup.find('.fr-' + tab + '-color .fr-select-color');\n\n    // Remove current color selection.\n    $current_color.find('.fr-selected-color').remove();\n    $current_color.removeClass('fr-active-item');\n    $current_color.not('[data-param1=\"REMOVE\"]').attr('aria-selected', false);\n\n    // Find the selected color.\n    while ($element.get(0) != editor.el) {\n\n      // Transparent or black.\n      if ($element.css(color_type) == 'transparent' || $element.css(color_type) == 'rgba(0, 0, 0, 0)') {\n        $element = $element.parent();\n      }\n\n      // Select the correct color.\n      else {\n        var $select_color = $popup.find('.fr-' + tab + '-color .fr-select-color[data-param1=\"' + editor.helpers.RGBToHex($element.css(color_type)) + '\"]');\n\n        // Add checked icon.\n        $select_color.append('<span class=\"fr-selected-color\" aria-hidden=\"true\">\\uf00c</span>');\n        $select_color.addClass('fr-active-item').attr('aria-selected', true);\n        break;\n      }\n    }\n\n    var $input = $popup.find('.fr-color-hex-layer input');\n\n    if ($input.length) {\n      $input.val(editor.helpers.RGBToHex($element.css(color_type))).trigger('change');\n    }\n  }\n\n  /*\n   * Change the colors' tab.\n   */\n  function _changeSet ($tab, val) {\n\n    // Only on the tab that is not selected yet. On left click only.\n    if (!$tab.hasClass('fr-selected-tab')) {\n\n      // Switch selected tab.\n      $tab.siblings().removeClass('fr-selected-tab').attr('aria-pressed', false);\n      $tab.addClass('fr-selected-tab').attr('aria-pressed', true);\n\n      // Switch the color set.\n      $tab.parents('.fr-popup').find('.fr-color-set').removeClass('fr-selected-set');\n      $tab.parents('.fr-popup').find('.fr-color-set.fr-' + val + '-color').addClass('fr-selected-set');\n\n      // Refresh selected color.\n      _refreshColor(val);\n\n    }\n\n    // Focus popup.\n    editor.accessibility.focusPopup($tab.parents('.fr-popup'));\n  }\n\n  /*\n   * Change background color.\n   */\n  function background (val) {\n\n    // Set background  color.\n    if (val != 'REMOVE') {\n      editor.format.applyStyle('background-color', editor.helpers.HEXtoRGB(val));\n    }\n\n    // Remove background color.\n    else {\n      editor.format.removeStyle('background-color');\n    }\n\n    _hideColorsPopup();\n  }\n\n  /*\n   * Change text color.\n   */\n  function text (val) {\n\n    // Set text color.\n    if (val != 'REMOVE') {\n      editor.format.applyStyle('color', editor.helpers.HEXtoRGB(val));\n    }\n\n    // Remove text color.\n    else {\n      editor.format.removeStyle('color');\n    }\n\n    _hideColorsPopup();\n  }\n\n  /*\n   * Go back to the inline editor.\n   */\n  function back () {\n    editor.popups.hide('colors.picker');\n    editor.toolbar.showInline();\n  }\n\n  function customColor () {\n    var $popup = editor.popups.get('colors.picker');\n\n    var $input = $popup.find('.fr-color-hex-layer input');\n\n    if ($input.length) {\n      var color = $input.val()\n      var tab = $popup.find('.fr-selected-tab').attr('data-param1');\n\n      if (tab == 'background') {\n        background(color);\n      }\n      else {\n        text(color);\n      }\n    }\n  }\n\n  return {\n    showColorsPopup: _showColorsPopup,\n    hideColorsPopup: _hideColorsPopup,\n    changeSet: _changeSet,\n    background: background,\n    customColor: customColor,\n    text: text,\n    back: back\n  }\n}\n\n// Toolbar colors button.\nFE.DefineIcon('colors', { NAME: 'tint' });\nFE.RegisterCommand('color', {\n  title: 'Colors',\n  undo: false,\n  focus: true,\n  refreshOnCallback: false,\n  popup: true,\n  callback: function () {\n    if (!this.popups.isVisible('colors.picker')) {\n      this.colors.showColorsPopup();\n    }\n    else {\n      if (this.$el.find('.fr-marker').length) {\n        this.events.disableBlur();\n        this.selection.restore();\n      }\n      this.popups.hide('colors.picker');\n    }\n  },\n  plugin: 'colors'\n});\n\n// Select text color command.\nFE.RegisterCommand('textColor', {\n  undo: true,\n  callback: function (cmd, val) {\n    this.colors.text(val);\n  }\n});\n\n// Select background color command.\nFE.RegisterCommand('backgroundColor', {\n  undo: true,\n  callback: function (cmd, val) {\n    this.colors.background(val);\n  }\n});\n\nFE.RegisterCommand('colorChangeSet', {\n  undo: false,\n  focus: false,\n  callback: function (cmd, val) {\n    var $tab = this.popups.get('colors.picker').find('.fr-command[data-cmd=\"' + cmd + '\"][data-param1=\"' + val + '\"]');\n    this.colors.changeSet($tab, val);\n  }\n});\n\n// Colors back.\nFE.DefineIcon('colorsBack', { NAME: 'arrow-left' });\nFE.RegisterCommand('colorsBack', {\n  title: 'Back',\n  undo: false,\n  focus: false,\n  back: true,\n  refreshAfterCallback: false,\n  callback: function () {\n    this.colors.back();\n  }\n});\n\nFE.RegisterCommand('customColor', {\n  title: 'OK',\n  undo: true,\n  callback: function () {\n    this.colors.customColor();\n  }\n})\n\nFE.DefineIcon('remove', { NAME: 'eraser' });","import FE from 'FroalaEditor';\n\n// Extend defaults.\nObject.assign(FE.DEFAULTS, {\n  dragInline: true\n});\n\n\nFE.PLUGINS.draggable = function (editor) {\n  var $ = editor.$\n\n  function _dragStart (e) {\n    if (e.originalEvent && e.originalEvent.target && e.originalEvent.target.nodeType == Node.TEXT_NODE) {\n\n      return true;\n    }\n\n    // Image with link.\n    if (e.target && e.target.tagName == 'A' && e.target.childNodes.length == 1 && e.target.childNodes[0].tagName == 'IMG') {\n      e.target = e.target.childNodes[0];\n    }\n\n    if (!$(e.target).hasClass('fr-draggable')) {\n      e.preventDefault();\n\n      return false;\n    }\n\n    // Save in undo step if we cannot do.\n    if (!editor.undo.canDo()) {\n      editor.undo.saveStep();\n    }\n\n    if (editor.opts.dragInline) {\n      editor.$el.attr('contenteditable', true);\n    }\n    else {\n      editor.$el.attr('contenteditable', false);\n    }\n\n    if (editor.opts.toolbarInline) editor.toolbar.hide();\n\n    $(e.target).addClass('fr-dragging');\n\n    if (!editor.browser.msie && !editor.browser.edge) {\n      editor.selection.clear();\n    }\n\n    e.originalEvent.dataTransfer.setData('text', 'Froala');\n  }\n\n  function _tagOK (tag_under) {\n\n    return !(tag_under && (tag_under.tagName == 'HTML' || tag_under.tagName == 'BODY' || editor.node.isElement(tag_under)));\n  }\n\n  function _setHelperSize (top, left, width) {\n    if (editor.opts.iframe) {\n      top += editor.$iframe.offset().top;\n      left += editor.$iframe.offset().left;\n    }\n\n    if ($draggable_helper.offset().top != top) $draggable_helper.css('top', top);\n\n    if ($draggable_helper.offset().left != left) $draggable_helper.css('left', left);\n\n    if ($draggable_helper.width() != width) $draggable_helper.css('width', width);\n  }\n\n  function _positionHelper (e) {\n\n    // The tag under the mouse cursor.\n    var tag_under = editor.doc.elementFromPoint(e.originalEvent.pageX - editor.win.pageXOffset, e.originalEvent.pageY - editor.win.pageYOffset);\n\n    if (!_tagOK(tag_under)) {\n\n      // Look above for the closest tag.\n      var top_offset = 0;\n      var top_tag = tag_under;\n\n      while (!_tagOK(top_tag) && top_tag == tag_under && e.originalEvent.pageY - editor.win.pageYOffset - top_offset > 0) {\n        top_offset++;\n        top_tag = editor.doc.elementFromPoint(e.originalEvent.pageX - editor.win.pageXOffset, e.originalEvent.pageY - editor.win.pageYOffset - top_offset);\n      }\n\n      if (!_tagOK(top_tag) || ($draggable_helper && editor.$el.find(top_tag).length === 0 && top_tag != $draggable_helper.get(0))) { top_tag = null; }\n\n      // Look below for the closest tag.\n      var bottom_offset = 0;\n      var bottom_tag = tag_under;\n\n      while (!_tagOK(bottom_tag) && bottom_tag == tag_under && e.originalEvent.pageY - editor.win.pageYOffset + bottom_offset < $(editor.doc).height()) {\n        bottom_offset++;\n        bottom_tag = editor.doc.elementFromPoint(e.originalEvent.pageX - editor.win.pageXOffset, e.originalEvent.pageY - editor.win.pageYOffset + bottom_offset);\n      }\n\n      if (!_tagOK(bottom_tag) || ($draggable_helper &&  editor.$el.find(bottom_tag).length === 0  && bottom_tag != $draggable_helper.get(0))) { bottom_tag = null; }\n\n      if (bottom_tag == null && top_tag) tag_under = top_tag;\n\n      else if (bottom_tag && top_tag == null) tag_under = bottom_tag;\n\n      else if (bottom_tag && top_tag) {\n        tag_under = (top_offset < bottom_offset ? top_tag : bottom_tag);\n      }\n      else {\n        tag_under = null;\n      }\n    }\n\n    // Stop if tag under is draggable helper.\n    if ($(tag_under).hasClass('fr-drag-helper')) return false;\n\n    // Get block parent.\n    if (tag_under && !editor.node.isBlock(tag_under)) {\n      tag_under = editor.node.blockParent(tag_under);\n    }\n\n    // Normalize TABLE parent.\n    if (tag_under && ['TD', 'TH', 'TR', 'THEAD', 'TBODY'].indexOf(tag_under.tagName) >= 0) {\n      tag_under = $(tag_under).parents('table').get(0);\n    }\n\n    // Normalize LIST parent.\n    if (tag_under && ['LI'].indexOf(tag_under.tagName) >= 0) {\n      tag_under = $(tag_under).parents('UL, OL').get(0);\n    }\n\n    if (tag_under && !$(tag_under).hasClass('fr-drag-helper')) {\n\n      // Init helper.\n      if (!$draggable_helper) {\n        if (!FE.$draggable_helper) FE.$draggable_helper = $('<div class=\"fr-drag-helper\"></div>');\n\n        $draggable_helper = FE.$draggable_helper;\n\n        editor.events.on('shared.destroy', function () {\n          $draggable_helper.html('').removeData().remove();\n          $draggable_helper = null;\n        }, true);\n      }\n\n      var above;\n      var mouse_y = e.originalEvent.pageY;\n\n      if (mouse_y < $(tag_under).offset().top + $(tag_under).outerHeight() / 2) above = true;\n      else above = false;\n\n      var $tag_under = $(tag_under);\n      var margin = 0 ;\n\n      // Should go below and there is no tag below.\n      if (!above && $tag_under.next().length === 0) {\n        if ($draggable_helper.data('fr-position') != 'after' || !$tag_under.is($draggable_helper.data('fr-tag'))) {\n          margin = parseFloat($tag_under.css('margin-bottom')) || 0;\n\n          _setHelperSize(\n            $tag_under.offset().top + $(tag_under).height() + margin / 2  - editor.$box.offset().top,\n            $tag_under.offset().left - editor.win.pageXOffset - editor.$box.offset().left,\n            $tag_under.width()\n          );\n\n          $draggable_helper.data('fr-position', 'after');\n        }\n      }\n      else {\n\n        // Should go below then we take the next tag.\n        if (!above) {\n          $tag_under = $tag_under.next();\n        }\n\n        if ($draggable_helper.data('fr-position') != 'before' || !$tag_under.is($draggable_helper.data('fr-tag'))) {\n          if ($tag_under.prev().length > 0) {\n            margin = parseFloat($tag_under.prev().css('margin-bottom')) || 0;\n          }\n          margin = Math.max(margin, parseFloat($tag_under.css('margin-top')) || 0);\n\n          _setHelperSize(\n            $tag_under.offset().top - margin / 2  - editor.$box.offset().top,\n            $tag_under.offset().left - editor.win.pageXOffset  - editor.$box.offset().left,\n            $tag_under.width()\n          )\n\n          $draggable_helper.data('fr-position', 'before');\n        }\n      }\n\n      $draggable_helper.data('fr-tag', $tag_under);\n\n      $draggable_helper.addClass('fr-visible');\n      $draggable_helper.appendTo(editor.$box);\n    }\n    else if ($draggable_helper && editor.$box.find($draggable_helper).length > 0) {\n      $draggable_helper.removeClass('fr-visible');\n    }\n  }\n\n  function _dragOver (e) {\n    e.originalEvent.dataTransfer.dropEffect = 'move';\n\n    if (!editor.opts.dragInline) {\n      e.preventDefault();\n\n      _positionHelper(e);\n    }\n\n    else if (!_getDraggedEl() && (editor.browser.msie || editor.browser.edge)) {\n      e.preventDefault();\n    }\n  }\n\n  function _dragEnter (e) {\n    e.originalEvent.dataTransfer.dropEffect = 'move';\n\n    if (!editor.opts.dragInline) {\n      e.preventDefault();\n    }\n  }\n\n  function _documentDragEnd (e) {\n    editor.$el.attr('contenteditable', true);\n    var $draggedEl = editor.$el.find('.fr-dragging');\n\n    if ($draggable_helper && $draggable_helper.hasClass('fr-visible') && editor.$box.find($draggable_helper).length) {\n      _drop(e);\n    }\n    else if ($draggedEl.length) {\n      e.preventDefault();\n      e.stopPropagation();\n    }\n\n    if ($draggable_helper && editor.$box.find($draggable_helper).length) {\n      $draggable_helper.removeClass('fr-visible');\n    }\n\n    $draggedEl.removeClass('fr-dragging');\n  }\n\n  function _getDraggedEl () {\n    var $draggedEl = null;\n\n    // Search of the instance we're dragging from.\n    for (var i = 0; i < FE.INSTANCES.length; i++) {\n      $draggedEl = FE.INSTANCES[i].$el.find('.fr-dragging');\n\n      if ($draggedEl.length) {\n        return $draggedEl.get(0);\n      }\n    }\n  }\n\n  function _drop (e) {\n    var $draggedEl;\n    var inst;\n\n    // Inst is the intance we're dragging from.\n    for (var i = 0; i < FE.INSTANCES.length; i++) {\n      $draggedEl = FE.INSTANCES[i].$el.find('.fr-dragging');\n\n      if ($draggedEl.length) {\n        inst = FE.INSTANCES[i];\n        break;\n      }\n    }\n\n    // There is a dragged element.\n    if ($draggedEl.length) {\n\n      // Cancel anything else.\n      e.preventDefault();\n      e.stopPropagation();\n\n      // Look for draggable helper.\n      if ($draggable_helper && $draggable_helper.hasClass('fr-visible') && editor.$box.find($draggable_helper).length) {\n        $draggable_helper.data('fr-tag')[$draggable_helper.data('fr-position')]('<span class=\"fr-marker\"></span>');\n        $draggable_helper.removeClass('fr-visible');\n      }\n      else {\n        var ok = editor.markers.insertAtPoint(e.originalEvent);\n\n        if (ok === false) return false;\n      }\n\n      // Remove dragging class.\n      $draggedEl.removeClass('fr-dragging');\n\n      $draggedEl = editor.events.chainTrigger('element.beforeDrop', $draggedEl);\n\n      if ($draggedEl === false) {\n        return false;\n      }\n\n      // Image with link.\n      var $droppedEl = $draggedEl;\n\n      if ($draggedEl.parent().is('A') && $draggedEl.parent().get(0).childNodes.length == 1) {\n        $droppedEl = $draggedEl.parent();\n      }\n\n      // Replace marker with the dragged element.\n      if (!editor.core.isEmpty()) {\n        var $marker = editor.$el.find('.fr-marker');\n        $marker.replaceWith(FE.MARKERS);\n        editor.selection.restore();\n      }\n      else {\n        editor.events.focus();\n      }\n\n      // Save undo step if the current instance is different than the original one.\n      if (inst != editor && !editor.undo.canDo()) editor.undo.saveStep();\n\n      // Place new elements.\n      if (!editor.core.isEmpty()) {\n        var marker = editor.markers.insert();\n\n        // Make sure we do not have marker inside $droppedEl.\n        if (!$droppedEl.contains(marker)) {\n          $(marker).replaceWith($droppedEl);\n        }\n        else if (!$draggedEl.contains(marker)) {\n          $(marker).replaceWith($draggedEl);\n        }\n\n        $draggedEl.after(FE.MARKERS);\n        editor.selection.restore();\n      }\n      else {\n        editor.$el.html($droppedEl);\n      }\n\n      // Hide all popups.\n      editor.popups.hideAll();\n      editor.selection.save();\n      editor.$el.find(editor.html.emptyBlockTagsQuery()).not('TD, TH, LI, .fr-inner').not(editor.opts.htmlAllowedEmptyTags.join(',')).remove();\n      editor.html.wrap();\n      editor.html.fillEmptyBlocks();\n      editor.selection.restore();\n      editor.undo.saveStep();\n\n      if (editor.opts.iframe) editor.size.syncIframe();\n\n      // Mark changes in the original instance as well.\n      if (inst != editor) {\n        inst.popups.hideAll();\n        inst.$el.find(inst.html.emptyBlockTagsQuery()).not('TD, TH, LI, .fr-inner').remove();\n        inst.html.wrap();\n        inst.html.fillEmptyBlocks();\n        inst.undo.saveStep();\n        inst.events.trigger('element.dropped');\n\n        if (inst.opts.iframe) inst.size.syncIframe();\n      }\n\n      editor.events.trigger('element.dropped', [$droppedEl]);\n\n      // Stop bubbling.\n\n      return false;\n    }\n\n    // Save step when something else is dragged into the editor.\n    else {\n      if ($draggable_helper) $draggable_helper.removeClass('fr-visible');\n\n      if (!editor.undo.canDo()) editor.undo.saveStep();\n\n      setTimeout(function () {\n        editor.undo.saveStep();\n      }, 0);\n    }\n  }\n\n  /**\n   * Do cleanup when the html is taken.\n   */\n  function _cleanOnGet(el) {\n\n    // Remove drag helper.\n    if (el && el.tagName == 'DIV' && editor.node.hasClass(el, 'fr-drag-helper')) {\n      el.parentNode.removeChild(el);\n    }\n\n    // Remove from nested elements too.\n    else if (el && el.nodeType == Node.ELEMENT_NODE) {\n      var els = el.querySelectorAll('div.fr-drag-helper');\n\n      for (var i = 0; i < els.length; i++) {\n        els[i].parentNode.removeChild(els[i]);\n      }\n    }\n  }\n\n  /*\n   * Initialize.\n   */\n  var $draggable_helper;\n\n  function _init () {\n\n    // Force drag inline when ENTER_BR is active.\n    if (editor.opts.enter == FE.ENTER_BR) editor.opts.dragInline = true;\n\n    // Starting to drag.\n    editor.events.on('dragstart', _dragStart, true);\n\n    // Inline dragging is off.\n    editor.events.on('dragover', _dragOver, true);\n    editor.events.on('dragenter', _dragEnter, true);\n\n    // Document drop. Remove moving class.\n    editor.events.on('document.dragend', _documentDragEnd, true);\n    editor.events.on('document.drop', _documentDragEnd, true);\n\n    // Drop.\n    editor.events.on('drop', _drop, true);\n\n    // Clean getting the HTML.\n    editor.events.on('html.processGet', _cleanOnGet)\n  }\n\n  return {\n    _init: _init\n  }\n}","import FE from 'FroalaEditor';\n\nObject.assign(FE.POPUP_TEMPLATES, {\n  emoticons: '[_BUTTONS_][_EMOTICONS_]'\n})\n\n// Extend defaults.\nObject.assign(FE.DEFAULTS, {\n  emoticonsStep: 8,\n  emoticonsSet: [\n    { code: '1f600', desc: 'Grinning face' },\n    { code: '1f601', desc: 'Grinning face with smiling eyes' },\n    { code: '1f602', desc: 'Face with tears of joy' },\n    { code: '1f603', desc: 'Smiling face with open mouth' },\n    { code: '1f604', desc: 'Smiling face with open mouth and smiling eyes' },\n    { code: '1f605', desc: 'Smiling face with open mouth and cold sweat' },\n    { code: '1f606', desc: 'Smiling face with open mouth and tightly-closed eyes' },\n    { code: '1f607', desc: 'Smiling face with halo' },\n\n    { code: '1f608', desc: 'Smiling face with horns' },\n    { code: '1f609', desc: 'Winking face' },\n    { code: '1f60a', desc: 'Smiling face with smiling eyes' },\n    { code: '1f60b', desc: 'Face savoring delicious food' },\n    { code: '1f60c', desc: 'Relieved face' },\n    { code: '1f60d', desc: 'Smiling face with heart-shaped eyes' },\n    { code: '1f60e', desc: 'Smiling face with sunglasses' },\n    { code: '1f60f', desc: 'Smirking face' },\n\n    { code: '1f610', desc: 'Neutral face' },\n    { code: '1f611', desc: 'Expressionless face' },\n    { code: '1f612', desc: 'Unamused face' },\n    { code: '1f613', desc: 'Face with cold sweat' },\n    { code: '1f614', desc: 'Pensive face' },\n    { code: '1f615', desc: 'Confused face' },\n    { code: '1f616', desc: 'Confounded face' },\n    { code: '1f617', desc: 'Kissing face' },\n\n    { code: '1f618', desc: 'Face throwing a kiss' },\n    { code: '1f619', desc: 'Kissing face with smiling eyes' },\n    { code: '1f61a', desc: 'Kissing face with closed eyes' },\n    { code: '1f61b', desc: 'Face with stuck out tongue' },\n    { code: '1f61c', desc: 'Face with stuck out tongue and winking eye' },\n    { code: '1f61d', desc: 'Face with stuck out tongue and tightly-closed eyes' },\n    { code: '1f61e', desc: 'Disappointed face' },\n    { code: '1f61f', desc: 'Worried face' },\n\n    { code: '1f620', desc: 'Angry face' },\n    { code: '1f621', desc: 'Pouting face' },\n    { code: '1f622', desc: 'Crying face' },\n    { code: '1f623', desc: 'Persevering face' },\n    { code: '1f624', desc: 'Face with look of triumph' },\n    { code: '1f625', desc: 'Disappointed but relieved face' },\n    { code: '1f626', desc: 'Frowning face with open mouth' },\n    { code: '1f627', desc: 'Anguished face' },\n\n    { code: '1f628', desc: 'Fearful face' },\n    { code: '1f629', desc: 'Weary face' },\n    { code: '1f62a', desc: 'Sleepy face' },\n    { code: '1f62b', desc: 'Tired face' },\n    { code: '1f62c', desc: 'Grimacing face' },\n    { code: '1f62d', desc: 'Loudly crying face' },\n    { code: '1f62e', desc: 'Face with open mouth' },\n    { code: '1f62f', desc: 'Hushed face' },\n\n    { code: '1f630', desc: 'Face with open mouth and cold sweat' },\n    { code: '1f631', desc: 'Face screaming in fear' },\n    { code: '1f632', desc: 'Astonished face' },\n    { code: '1f633', desc: 'Flushed face' },\n    { code: '1f634', desc: 'Sleeping face' },\n    { code: '1f635', desc: 'Dizzy face' },\n    { code: '1f636', desc: 'Face without mouth' },\n    { code: '1f637', desc: 'Face with medical mask' }\n  ],\n  emoticonsButtons: ['emoticonsBack', '|'],\n  emoticonsUseImage: true\n});\n\nFE.PLUGINS.emoticons = function (editor) {\n  let $ = editor.$\n\n  /*\n   * Show the emoticons popup.\n   */\n  function _showEmoticonsPopup () {\n    var $btn = editor.$tb.find('.fr-command[data-cmd=\"emoticons\"]');\n\n    var $popup = editor.popups.get('emoticons');\n\n    if (!$popup) $popup = _initEmoticonsPopup();\n\n    if (!$popup.hasClass('fr-active')) {\n\n      // Emoticons popup.\n      editor.popups.refresh('emoticons');\n      editor.popups.setContainer('emoticons', editor.$tb);\n\n      // Emoticons popup left and top position.\n      var left = $btn.offset().left + $btn.outerWidth() / 2;\n      var top = $btn.offset().top + (editor.opts.toolbarBottom ? 10 : $btn.outerHeight() - 10);\n\n      editor.popups.show('emoticons', left, top, $btn.outerHeight());\n    }\n  }\n\n  /*\n   * Hide emoticons popup.\n   */\n  function _hideEmoticonsPopup () {\n\n    // Hide popup.\n    editor.popups.hide('emoticons');\n  }\n\n  /**\n   * Init the emoticons popup.\n   */\n  function _initEmoticonsPopup () {\n    var emoticons_buttons = '';\n\n    if (editor.opts.toolbarInline) {\n\n      // Emoticons buttons.\n      if (editor.opts.emoticonsButtons.length > 0) {\n        emoticons_buttons = '<div class=\"fr-buttons fr-emoticons-buttons\">' + editor.button.buildList(editor.opts.emoticonsButtons) + '</div>';\n      }\n    }\n\n    var template = {\n      buttons: emoticons_buttons,\n      emoticons: _emoticonsHTML()\n    };\n\n    // Create popup.\n    var $popup = editor.popups.create('emoticons', template);\n\n    // Assing tooltips to buttons.\n    editor.tooltip.bind($popup, '.fr-emoticon');\n\n    _addAccessibility($popup);\n\n    return $popup;\n  }\n\n  function _inEmoticon () {\n    if (!editor.selection.isCollapsed()) return false;\n\n    var s_el = editor.selection.element();\n    var e_el = editor.selection.endElement();\n\n    if (s_el && editor.node.hasClass(s_el, 'fr-emoticon')) return s_el;\n\n    if (e_el && editor.node.hasClass(e_el, 'fr-emoticon')) return e_el;\n\n    var range = editor.selection.ranges(0);\n    var container = range.startContainer;\n\n    if (container.nodeType == Node.ELEMENT_NODE) {\n\n      if (container.childNodes.length > 0 && range.startOffset > 0) {\n        var node = container.childNodes[range.startOffset - 1];\n\n        if (editor.node.hasClass(node, 'fr-emoticon')) {\n\n          return node;\n        }\n      }\n    }\n\n    return false;\n  }\n\n  /*\n   * HTML for the emoticons popup.\n   */\n  function _emoticonsHTML () {\n\n    // Create emoticons html.\n    var emoticons_html = '<div style=\"text-align: center\">';\n\n    // Add emoticons.\n    for (var i = 0; i < editor.opts.emoticonsSet.length; i++) {\n      if (i !== 0 && i % editor.opts.emoticonsStep === 0) {\n        emoticons_html += '<br>';\n      }\n\n      emoticons_html += '<span class=\"fr-command fr-emoticon\" tabIndex=\"-1\" data-cmd=\"insertEmoticon\" title=\"' + editor.language.translate(editor.opts.emoticonsSet[i].desc) + '\" role=\"button\" data-param1=\"' + editor.opts.emoticonsSet[i].code + '\">' + (editor.opts.emoticonsUseImage ? '<img src=\"' + 'https://cdnjs.cloudflare.com/ajax/libs/emojione/2.0.1/assets/svg/' + editor.opts.emoticonsSet[i].code + '.svg' + '\"/>' : '&#x' + editor.opts.emoticonsSet[i].code + ';') + '<span class=\"fr-sr-only\">' + editor.language.translate(editor.opts.emoticonsSet[i].desc) + '&nbsp;&nbsp;&nbsp;</span></span>';\n    }\n\n    if (editor.opts.emoticonsUseImage) emoticons_html += '<p style=\"font-size: 12px; text-align: center; padding: 0 5px;\">Emoji free by <a class=\"fr-link\" tabIndex=\"-1\" href=\"http://emojione.com/\" target=\"_blank\" rel=\"nofollow\" role=\"link\" aria-label=\"Open Emoji One website.\">Emoji One</a></p>';\n    emoticons_html += '</div>';\n\n    return emoticons_html;\n  }\n\n  /*\n   * Register keyboard events.\n   */\n  function _addAccessibility ($popup) {\n\n    // Register popup event.\n    editor.events.on('popup.tab', function (e) {\n      var $focused_item = $(e.currentTarget);\n\n      // Skip if popup is not visible or focus is elsewere.\n      if (!editor.popups.isVisible('emoticons') || !$focused_item.is('span, a')) {\n        return true;\n      }\n\n      var key_code = e.which;\n      var status;\n      var index;\n      var $el;\n\n      // Tabbing.\n      if (FE.KEYCODE.TAB == key_code) {\n\n        // Extremities reached.\n        if (($focused_item.is('span.fr-emoticon') && e.shiftKey) || ($focused_item.is('a') && !e.shiftKey)) {\n          var $tb = $popup.find('.fr-buttons');\n\n          // Focus back the popup's toolbar if exists.\n          status = !editor.accessibility.focusToolbar($tb, (e.shiftKey ? true : false));\n        }\n\n        if (status !== false) {\n\n          // Build elements that should be focused next.\n          var $tabElements = $popup.find('span.fr-emoticon:focus:first, span.fr-emoticon:visible:first, a');\n\n          if ($focused_item.is('span.fr-emoticon')) {\n            $tabElements = $tabElements.not('span.fr-emoticon:not(:focus)');\n          }\n\n          // Get focused item position.\n          index = $tabElements.index($focused_item);\n\n          // Backwards.\n          if (e.shiftKey) {\n            index = (((index - 1) % $tabElements.length) + $tabElements.length) % $tabElements.length;\n\n            // Javascript negative modulo bug.\n            // Forward.\n          }\n          else {\n            index = (index + 1) % $tabElements.length;\n          }\n\n          // Find next element to focus.\n          $el = $tabElements.get(index);\n\n          editor.events.disableBlur();\n          $el.focus();\n          status = false;\n        }\n      }\n\n      // Arrows.\n      else if (FE.KEYCODE.ARROW_UP == key_code || FE.KEYCODE.ARROW_DOWN == key_code || FE.KEYCODE.ARROW_LEFT == key_code || FE.KEYCODE.ARROW_RIGHT == key_code) {\n        if ($focused_item.is('span.fr-emoticon')) {\n\n          // Get all current emoticons.\n          var $emoticons = $focused_item.parent().find('span.fr-emoticon');\n\n          // Get focused item position.\n          index = $emoticons.index($focused_item);\n\n          // Get emoticons matrix dimensions.\n          var columns = editor.opts.emoticonsStep;\n          var lines = Math.floor($emoticons.length / columns);\n\n          // Get focused item coordinates.\n          var column = index % columns;\n          var line = Math.floor(index / columns);\n\n          var nextIndex = line * columns + column;\n          var dimension = lines * columns;\n\n          // Calculate next index. Go to the other opposite site of the matrix if there is no next adjacent element.\n          // Up/Down: Traverse matrix lines.\n          // Left/Right: Traverse the matrix as it is a vector.\n          if (FE.KEYCODE.ARROW_UP == key_code) {\n            nextIndex = (((nextIndex - columns) % dimension) + dimension) % dimension; // Javascript negative modulo bug.\n          }\n          else if (FE.KEYCODE.ARROW_DOWN == key_code) {\n            nextIndex = (nextIndex + columns) % dimension;\n          }\n          else if (FE.KEYCODE.ARROW_LEFT == key_code) {\n            nextIndex = (((nextIndex - 1) % dimension) + dimension) % dimension; // Javascript negative modulo bug.\n          }\n          else if (FE.KEYCODE.ARROW_RIGHT == key_code) {\n            nextIndex = (nextIndex + 1) % dimension;\n          }\n\n          // Get the next element based on the new index.\n          $el = $($emoticons.get(nextIndex));\n\n          // Focus.\n          editor.events.disableBlur();\n          $el.focus();\n\n          status = false;\n        }\n      }\n\n      // ENTER or SPACE.\n      else if (FE.KEYCODE.ENTER == key_code) {\n        if ($focused_item.is('a')) {\n          $focused_item[0].click();\n        }\n        else {\n          editor.button.exec($focused_item);\n        }\n        status = false;\n      }\n\n      // Prevent propagation.\n      if (status === false) {\n        e.preventDefault();\n        e.stopPropagation();\n      }\n\n      return status;\n    }, true);\n  }\n\n  /*\n   * Insert emoticon.\n   */\n  function insert (emoticon, img) {\n\n    // Insert emoticon.\n    var el = _inEmoticon();\n    var range = editor.selection.ranges(0);\n\n    if (!el) {\n      editor.html.insert('<span class=\"fr-emoticon fr-deletable' + (img ? ' fr-emoticon-img' : '') + '\"' + (img ? ' style=\"background: url(' + img + ');\"' : '') + '>' + (img ? '&nbsp;' : emoticon) + '</span>' + '&nbsp;', true);\n\n    }\n    else {\n\n      if (range.startOffset === 0 && editor.selection.element() === el) {\n        $(el).before(FE.MARKERS + FE.INVISIBLE_SPACE);\n      }\n      else if (range.startOffset > 0 && editor.selection.element() === el && range.commonAncestorContainer.parentNode.classList.contains('fr-emoticon')) {\n\n        // Inside emoticon move out side of it.\n        $(el).after(FE.INVISIBLE_SPACE + FE.MARKERS);\n      }\n      editor.selection.restore();\n      editor.html.insert('<span class=\"fr-emoticon fr-deletable' + (img ? ' fr-emoticon-img' : '') + '\"' + (img ? ' style=\"background: url(' + img + ');\"' : '') + '>' + (img ? '&nbsp;' : emoticon) + '</span>' + '&nbsp;' + FE.MARKERS, true);\n    }\n  }\n\n  /*\n   * Go back to the inline editor.\n   */\n  function back () {\n    editor.popups.hide('emoticons');\n    editor.toolbar.showInline();\n  }\n\n  /*\n   * Init emoticons.\n   */\n  function _init () {\n    var setDeletable = function () {\n      var emtcs = editor.el.querySelectorAll('.fr-emoticon:not(.fr-deletable)');\n\n      for (var i = 0; i < emtcs.length; i++) {\n        emtcs[i].className += ' fr-deletable';\n      }\n    }\n    setDeletable();\n\n    editor.events.on('html.set', setDeletable);\n\n    editor.events.on('keydown', function (e) {\n      if (editor.keys.isCharacter(e.which) && editor.selection.inEditor()) {\n        var range = editor.selection.ranges(0);\n        var el = _inEmoticon();\n\n        if (editor.node.hasClass(el, 'fr-emoticon-img')) {\n\n          if (el) {\n\n            if (range.startOffset === 0 && editor.selection.element() === el) {\n              $(el).before(FE.MARKERS + FE.INVISIBLE_SPACE);\n            }\n            else {\n              $(el).after(FE.INVISIBLE_SPACE + FE.MARKERS);\n            }\n            editor.selection.restore();\n          }\n        }\n      }\n    });\n\n    editor.events.on('keyup', function (e) {\n      var emtcs = editor.el.querySelectorAll('.fr-emoticon');\n\n      for (var i = 0; i < emtcs.length; i++) {\n        if (typeof emtcs[i].textContent != 'undefined' && emtcs[i].textContent.replace(/\\u200B/gi, '').length === 0) {\n          $(emtcs[i]).remove();\n        }\n      }\n\n      if (!(e.which >= FE.KEYCODE.ARROW_LEFT && e.which <= FE.KEYCODE.ARROW_DOWN)) {\n        var el = _inEmoticon();\n\n        if (editor.node.hasClass(el, 'fr-emoticon-img')) {\n          $(el).append(FE.MARKERS);\n          editor.selection.restore();\n        }\n      }\n    });\n  }\n\n  return {\n    _init: _init,\n    insert: insert,\n    showEmoticonsPopup: _showEmoticonsPopup,\n    hideEmoticonsPopup: _hideEmoticonsPopup,\n    back: back\n  }\n}\n\n// Toolbar emoticons button.\nFE.DefineIcon('emoticons', {\n  NAME: 'smile-o',\n  FA5NAME: 'smile'\n});\nFE.RegisterCommand('emoticons', {\n  title: 'Emoticons',\n  undo: false,\n  focus: true,\n  refreshOnCallback: false,\n  popup: true,\n  callback: function () {\n    if (!this.popups.isVisible('emoticons')) {\n      this.emoticons.showEmoticonsPopup();\n    }\n    else {\n      if (this.$el.find('.fr-marker').length) {\n        this.events.disableBlur();\n        this.selection.restore();\n      }\n      this.popups.hide('emoticons');\n    }\n  },\n  plugin: 'emoticons'\n});\n\n// Insert emoticon command.\nFE.RegisterCommand('insertEmoticon', {\n  callback: function (cmd, code) {\n\n    // Insert emoticon.\n    this.emoticons.insert('&#x' + code + ';', this.opts.emoticonsUseImage ? 'https://cdnjs.cloudflare.com/ajax/libs/emojione/2.0.1/assets/svg/' + code + '.svg' : null);\n\n    // Hide emoticons popup.\n    this.emoticons.hideEmoticonsPopup();\n  }\n});\n\n// Emoticons back.\nFE.DefineIcon('emoticonsBack', { NAME: 'arrow-left' });\nFE.RegisterCommand('emoticonsBack', {\n  title: 'Back',\n  undo: false,\n  focus: false,\n  back: true,\n  refreshAfterCallback: false,\n  callback: function () {\n    this.emoticons.back();\n  }\n});\n","import FE from 'FroalaEditor';\n\n// Extend defaults.\nObject.assign(FE.DEFAULTS, {\n  entities: '&quot;&#39;&iexcl;&cent;&pound;&curren;&yen;&brvbar;&sect;&uml;&copy;&ordf;&laquo;&not;&shy;&reg;&macr;&deg;&plusmn;&sup2;&sup3;&acute;&micro;&para;&middot;&cedil;&sup1;&ordm;&raquo;&frac14;&frac12;&frac34;&iquest;&Agrave;&Aacute;&Acirc;&Atilde;&Auml;&Aring;&AElig;&Ccedil;&Egrave;&Eacute;&Ecirc;&Euml;&Igrave;&Iacute;&Icirc;&Iuml;&ETH;&Ntilde;&Ograve;&Oacute;&Ocirc;&Otilde;&Ouml;&times;&Oslash;&Ugrave;&Uacute;&Ucirc;&Uuml;&Yacute;&THORN;&szlig;&agrave;&aacute;&acirc;&atilde;&auml;&aring;&aelig;&ccedil;&egrave;&eacute;&ecirc;&euml;&igrave;&iacute;&icirc;&iuml;&eth;&ntilde;&ograve;&oacute;&ocirc;&otilde;&ouml;&divide;&oslash;&ugrave;&uacute;&ucirc;&uuml;&yacute;&thorn;&yuml;&OElig;&oelig;&Scaron;&scaron;&Yuml;&fnof;&circ;&tilde;&Alpha;&Beta;&Gamma;&Delta;&Epsilon;&Zeta;&Eta;&Theta;&Iota;&Kappa;&Lambda;&Mu;&Nu;&Xi;&Omicron;&Pi;&Rho;&Sigma;&Tau;&Upsilon;&Phi;&Chi;&Psi;&Omega;&alpha;&beta;&gamma;&delta;&epsilon;&zeta;&eta;&theta;&iota;&kappa;&lambda;&mu;&nu;&xi;&omicron;&pi;&rho;&sigmaf;&sigma;&tau;&upsilon;&phi;&chi;&psi;&omega;&thetasym;&upsih;&piv;&ensp;&emsp;&thinsp;&zwnj;&zwj;&lrm;&rlm;&ndash;&mdash;&lsquo;&rsquo;&sbquo;&ldquo;&rdquo;&bdquo;&dagger;&Dagger;&bull;&hellip;&permil;&prime;&Prime;&lsaquo;&rsaquo;&oline;&frasl;&euro;&image;&weierp;&real;&trade;&alefsym;&larr;&uarr;&rarr;&darr;&harr;&crarr;&lArr;&uArr;&rArr;&dArr;&hArr;&forall;&part;&exist;&empty;&nabla;&isin;&notin;&ni;&prod;&sum;&minus;&lowast;&radic;&prop;&infin;&ang;&and;&or;&cap;&cup;&int;&there4;&sim;&cong;&asymp;&ne;&equiv;&le;&ge;&sub;&sup;&nsub;&sube;&supe;&oplus;&otimes;&perp;&sdot;&lceil;&rceil;&lfloor;&rfloor;&lang;&rang;&loz;&spades;&clubs;&hearts;&diams;'\n});\n\n\nFE.PLUGINS.entities = function (editor) {\n  let $ = editor.$\n\n  var _reg_exp;\n  var _map;\n\n  // if &, then index should be 0\n  function _process (el) {\n    var text = el.textContent;\n\n    if (text.match(_reg_exp)) {\n      var new_text = '';\n\n      for (var j = 0; j < text.length; j++) {\n        if (_map[text[j]]) new_text += _map[text[j]];\n        else new_text += text[j];\n      }\n\n      el.textContent = new_text;\n    }\n  }\n\n  function _encode (el) {\n    if (el && ['STYLE', 'SCRIPT', 'svg', 'IFRAME'].indexOf(el.tagName) >= 0) return true;\n\n    var contents = editor.node.contents(el);\n\n    // Process contents.\n    for (var i = 0; i < contents.length; i++) {\n      if (contents[i].nodeType == Node.TEXT_NODE) {\n        _process(contents[i]);\n      }\n      else {\n        _encode(contents[i]);\n      }\n    }\n\n    // Process node itself.\n    if (el.nodeType == Node.TEXT_NODE) _process(el);\n  }\n\n  /**\n   * Encode entities.\n   */\n  function _encodeEntities (html) {\n    if (html.length === 0) return '';\n\n    var x = editor.clean.exec(html, _encode).replace(/\\&amp;/g, '&');\n\n    return x;\n  }\n\n  /*\n   * Initialize.\n   */\n  function _init () {\n    if (!editor.opts.htmlSimpleAmpersand) {\n      editor.opts.entities = editor.opts.entities + '&amp;';\n    }\n\n    // Do escape.\n    var entities_text = $('<div>').html(editor.opts.entities).text();\n    var entities_array = editor.opts.entities.split(';');\n    _map = {};\n    _reg_exp = '';\n\n    for (var i = 0; i < entities_text.length; i++) {\n      var chr = entities_text.charAt(i);\n      _map[chr] = entities_array[i] + ';';\n      _reg_exp += '\\\\' + chr + (i < entities_text.length - 1 ? '|' : '');\n    }\n    _reg_exp = new RegExp('(' + _reg_exp + ')', 'g');\n\n    editor.events.on('html.get', _encodeEntities, true);\n  }\n\n  return {\n    _init: _init\n  }\n}\n","import FE from 'FroalaEditor';\n\nObject.assign(FE.POPUP_TEMPLATES, {\n  'file.insert': '[_BUTTONS_][_UPLOAD_LAYER_][_PROGRESS_BAR_]'\n})\n\n// Extend defaults.\nObject.assign(FE.DEFAULTS, {\n  fileUpload: true,\n  fileUploadURL: 'https://i.froala.com/upload',\n  fileUploadParam: 'file',\n  fileUploadParams: {},\n  fileUploadToS3: false,\n  fileUploadMethod: 'POST',\n  fileMaxSize: 10 * 1024 * 1024,\n  fileAllowedTypes: ['*'],\n  fileInsertButtons: ['fileBack', '|'],\n  fileUseSelectedText: false\n});\n\n\nFE.PLUGINS.file = function (editor) {\n  let $ = editor.$\n\n  var BAD_LINK = 1;\n  var MISSING_LINK = 2;\n  var ERROR_DURING_UPLOAD = 3;\n  var BAD_RESPONSE = 4;\n  var MAX_SIZE_EXCEEDED = 5;\n  var BAD_FILE_TYPE = 6;\n  var NO_CORS_IE = 7;\n\n  var error_messages = {};\n  error_messages[BAD_LINK] = 'File cannot be loaded from the passed link.';\n  error_messages[MISSING_LINK] = 'No link in upload response.';\n  error_messages[ERROR_DURING_UPLOAD] = 'Error during file upload.';\n  error_messages[BAD_RESPONSE] = 'Parsing response failed.';\n  error_messages[MAX_SIZE_EXCEEDED] = 'File is too large.';\n  error_messages[BAD_FILE_TYPE] = 'File file type is invalid.';\n  error_messages[NO_CORS_IE] = 'Files can be uploaded only to same domain in IE 8 and IE 9.';\n\n  function showInsertPopup () {\n    var $btn = editor.$tb.find('.fr-command[data-cmd=\"insertFile\"]');\n\n    var $popup = editor.popups.get('file.insert');\n\n    if (!$popup) $popup = _initInsertPopup();\n\n    hideProgressBar();\n\n    if (!$popup.hasClass('fr-active')) {\n      editor.popups.refresh('file.insert');\n      editor.popups.setContainer('file.insert', editor.$tb);\n\n      if ($btn.isVisible()) {\n        var left = $btn.offset().left + $btn.outerWidth() / 2;\n        var top = $btn.offset().top + (editor.opts.toolbarBottom ? 10 : $btn.outerHeight() - 10);\n        editor.popups.show('file.insert', left, top, $btn.outerHeight());\n      }\n      else {\n        editor.position.forSelection($popup);\n        editor.popups.show('file.insert');\n      }\n    }\n  }\n\n  /**\n   * Show progress bar.\n   */\n  function showProgressBar () {\n    var $popup = editor.popups.get('file.insert');\n\n    if (!$popup) $popup = _initInsertPopup();\n\n    $popup.find('.fr-layer.fr-active').removeClass('fr-active').addClass('fr-pactive');\n    $popup.find('.fr-file-progress-bar-layer').addClass('fr-active');\n    $popup.find('.fr-buttons').hide();\n\n    _setProgressMessage(editor.language.translate('Uploading'), 0);\n  }\n\n  /**\n   * Hide progress bar.\n   */\n  function hideProgressBar (dismiss) {\n    var $popup = editor.popups.get('file.insert');\n\n    if ($popup) {\n      $popup.find('.fr-layer.fr-pactive').addClass('fr-active').removeClass('fr-pactive');\n      $popup.find('.fr-file-progress-bar-layer').removeClass('fr-active');\n      $popup.find('.fr-buttons').show();\n\n      if (dismiss) {\n        editor.events.focus();\n        editor.popups.hide('file.insert');\n      }\n    }\n  }\n\n  /**\n   * Set a progress message.\n   */\n  function _setProgressMessage (message, progress) {\n    var $popup = editor.popups.get('file.insert');\n\n    if ($popup) {\n      var $layer = $popup.find('.fr-file-progress-bar-layer');\n      $layer.find('h3').text(message + (progress ? ' ' + progress + '%' : ''));\n\n      $layer.removeClass('fr-error');\n\n      if (progress) {\n        $layer.find('div').removeClass('fr-indeterminate');\n        $layer.find('div > span').css('width', progress + '%');\n      }\n      else {\n        $layer.find('div').addClass('fr-indeterminate');\n      }\n    }\n  }\n\n  /**\n   * Show error message to the user.\n   */\n  function _showErrorMessage (message) {\n    showProgressBar();\n    var $popup = editor.popups.get('file.insert');\n    var $layer = $popup.find('.fr-file-progress-bar-layer');\n    $layer.addClass('fr-error');\n    var $message_header = $layer.find('h3');\n    $message_header.text(message);\n    editor.events.disableBlur();\n    $message_header.focus();\n  }\n\n  /**\n   * Insert the uploaded file.\n   */\n  function insert (link, text, response) {\n    editor.edit.on();\n\n    // Focus in the editor.\n    editor.events.focus(true);\n    editor.selection.restore();\n\n    if (editor.opts.fileUseSelectedText && editor.selection.text().length) {\n      text = editor.selection.text();\n    }\n\n    // Insert the link.\n    editor.html.insert('<a href=\"' + link + '\" target=\"_blank\" id=\"fr-inserted-file\" class=\"fr-file\">' + text + '</a>');\n\n    // Get the file.\n    var $file = editor.$el.find('#fr-inserted-file');\n\n    $file.removeAttr('id');\n\n    editor.popups.hide('file.insert');\n\n    editor.undo.saveStep();\n\n    _syncFiles();\n\n    editor.events.trigger('file.inserted', [$file, response]);\n  }\n\n  /**\n   * Parse file response.\n   */\n  function _parseResponse (response) {\n    try {\n      if (editor.events.trigger('file.uploaded', [response], true) === false) {\n        editor.edit.on();\n\n        return false;\n      }\n\n      var resp = JSON.parse(response);\n\n      if (resp.link) {\n\n        return resp;\n      }\n      else {\n\n        // No link in upload request.\n        _throwError(MISSING_LINK, response);\n\n        return false;\n      }\n    }\n    catch (ex) {\n\n      // Bad response.\n      _throwError(BAD_RESPONSE, response);\n\n      return false;\n    }\n  }\n\n  /**\n   * Parse file response.\n   */\n  function _parseXMLResponse (response) {\n    try {\n      var link = $(response).find('Location').text();\n      var key = $(response).find('Key').text();\n\n      if (editor.events.trigger('file.uploadedToS3', [link, key, response], true) === false) {\n        editor.edit.on();\n\n        return false;\n      }\n\n      return link;\n    }\n    catch (ex) {\n\n      // Bad response.\n      _throwError(BAD_RESPONSE, response);\n\n      return false;\n    }\n  }\n\n  /**\n   * File was uploaded to the server and we have a response.\n   */\n  function _fileUploaded (text) {\n    var status = this.status;\n    var response = this.response;\n    var responseXML = this.responseXML;\n    var responseText = this.responseText;\n\n    try {\n      if (editor.opts.fileUploadToS3) {\n        if (status == 201) {\n          var link = _parseXMLResponse(responseXML);\n\n          if (link) {\n            insert(link, text, response || responseXML);\n          }\n        }\n        else {\n          _throwError(BAD_RESPONSE, response || responseXML);\n        }\n      }\n      else {\n        if (status >= 200 && status < 300) {\n          var resp = _parseResponse(responseText);\n\n          if (resp) {\n            insert(resp.link, text, response || responseText);\n          }\n        }\n        else {\n          _throwError(ERROR_DURING_UPLOAD, response || responseText);\n        }\n      }\n    }\n    catch (ex) {\n\n      // Bad response.\n      _throwError(BAD_RESPONSE, response || responseText);\n    }\n  }\n\n  /**\n   * File upload error.\n   */\n  function _fileUploadError () {\n    _throwError(BAD_RESPONSE, this.response || this.responseText || this.responseXML);\n  }\n\n  /**\n   * File upload progress.\n   */\n  function _fileUploadProgress (e) {\n    if (e.lengthComputable) {\n      var complete = (e.loaded / e.total * 100 | 0);\n      _setProgressMessage(editor.language.translate('Uploading'), complete);\n    }\n  }\n\n  /**\n   * Throw an file error.\n   */\n  function _throwError (code, response) {\n    editor.edit.on();\n    _showErrorMessage(editor.language.translate('Something went wrong. Please try again.'));\n\n    editor.events.trigger('file.error', [{\n      code: code,\n      message: error_messages[code]\n    }, response]);\n  }\n\n  /**\n   * File upload aborted.\n   */\n  function _fileUploadAborted () {\n    editor.edit.on();\n    hideProgressBar(true);\n  }\n\n  function upload (files) {\n\n    // Make sure we have what to upload.\n    if (typeof files != 'undefined' && files.length > 0) {\n\n      // Check if we should cancel the file upload.\n      if (editor.events.trigger('file.beforeUpload', [files]) === false) {\n\n        return false;\n      }\n\n\n      var file = files[0];\n\n      // Check file max size.\n      if (file.size > editor.opts.fileMaxSize) {\n        _throwError(MAX_SIZE_EXCEEDED);\n\n        return false;\n      }\n\n      // Check file types.\n      if (editor.opts.fileAllowedTypes.indexOf('*') < 0 && editor.opts.fileAllowedTypes.indexOf(file.type.replace(/file\\//g,'')) < 0) {\n        _throwError(BAD_FILE_TYPE);\n\n        return false;\n      }\n\n      // Create form Data.\n      var form_data;\n\n      if (editor.drag_support.formdata) {\n        form_data = editor.drag_support.formdata ? new FormData() : null;\n      }\n\n      // Prepare form data for request.\n      if (form_data) {\n        var key;\n\n        // Upload to S3.\n        if (editor.opts.fileUploadToS3 !== false) {\n          form_data.append('key', editor.opts.fileUploadToS3.keyStart + (new Date()).getTime() + '-' + (file.name || 'untitled'));\n          form_data.append('success_action_status', '201');\n          form_data.append('X-Requested-With', 'xhr');\n          form_data.append('Content-Type', file.type);\n\n          for (key in editor.opts.fileUploadToS3.params) {\n            if (Object.prototype.hasOwnProperty.call(editor.opts.fileUploadToS3.params, key)) {\n              form_data.append(key, editor.opts.fileUploadToS3.params[key]);\n            }\n          }\n        }\n\n        // Add upload params.\n        for (key in editor.opts.fileUploadParams) {\n          if (Object.prototype.hasOwnProperty.call(editor.opts.fileUploadParams, key)) {\n            form_data.append(key, editor.opts.fileUploadParams[key]);\n          }\n        }\n\n        // Set the file in the request.\n        form_data.append(editor.opts.fileUploadParam, file);\n\n        // Create XHR request.\n        var url = editor.opts.fileUploadURL;\n\n        if (editor.opts.fileUploadToS3) {\n          if (editor.opts.fileUploadToS3.uploadURL) {\n            url = editor.opts.fileUploadToS3.uploadURL;\n          }\n          else {\n            url = 'https://' + editor.opts.fileUploadToS3.region + '.amazonaws.com/' + editor.opts.fileUploadToS3.bucket;\n          }\n        }\n        var xhr = editor.core.getXHR(url, editor.opts.fileUploadMethod);\n\n        // Set upload events.\n        xhr.onload = function () {\n          _fileUploaded.call(xhr, file.name);\n        };\n        xhr.onerror = _fileUploadError;\n        xhr.upload.onprogress = _fileUploadProgress;\n        xhr.onabort = _fileUploadAborted;\n\n        showProgressBar();\n\n        // editor.edit.off();\n\n        var $popup = editor.popups.get('file.insert');\n\n        if ($popup) {\n          $popup.off('abortUpload').on('abortUpload', function () {\n            if (xhr.readyState != 4) {\n              xhr.abort();\n            }\n          })\n        }\n\n        // Send data.\n        xhr.send(form_data);\n      }\n    }\n  }\n\n  function _bindInsertEvents ($popup) {\n\n    // Drag over the dropable area.\n    editor.events.$on($popup, 'dragover dragenter', '.fr-file-upload-layer', function () {\n      $(this).addClass('fr-drop');\n\n      return false;\n    }, true);\n\n    // Drag end.\n    editor.events.$on($popup, 'dragleave dragend', '.fr-file-upload-layer', function () {\n      $(this).removeClass('fr-drop');\n\n      return false;\n    }, true);\n\n    // Drop.\n    editor.events.$on($popup, 'drop', '.fr-file-upload-layer', function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n\n      $(this).removeClass('fr-drop');\n\n      var dt = e.originalEvent.dataTransfer;\n\n      if (dt && dt.files) {\n        var inst = $popup.data('instance') || editor;\n        inst.file.upload(dt.files);\n      }\n    }, true);\n\n    if (editor.helpers.isIOS()) {\n      editor.events.$on($popup, 'touchstart', '.fr-file-upload-layer input[type=\"file\"]', function () {\n        $(this).trigger('click');\n      });\n    }\n\n    editor.events.$on($popup, 'change', '.fr-file-upload-layer input[type=\"file\"]', function () {\n      if (this.files) {\n        var inst = $popup.data('instance') || editor;\n        inst.file.upload(this.files);\n      }\n\n      // Else IE 9 case.\n\n      // Chrome fix.\n      $(this).val('');\n    }, true);\n  }\n\n  function _hideInsertPopup () {\n    hideProgressBar();\n  }\n\n  function _initInsertPopup (delayed) {\n    if (delayed) {\n      editor.popups.onHide('file.insert', _hideInsertPopup);\n\n      return true;\n    }\n\n    // Image buttons.\n    var file_buttons = '';\n\n    if (!editor.opts.fileUpload) {\n      editor.opts.fileInsertButtons.splice(editor.opts.fileInsertButtons.indexOf('fileUpload'), 1);\n    }\n\n    file_buttons = '<div class=\"fr-buttons\">' + editor.button.buildList(editor.opts.fileInsertButtons) + '</div>';\n\n    // File upload layer.\n    var upload_layer = '';\n\n    if (editor.opts.fileUpload) {\n      upload_layer = '<div class=\"fr-file-upload-layer fr-layer fr-active\" id=\"fr-file-upload-layer-' + editor.id + '\"><strong>' + editor.language.translate('Drop file') + '</strong><br>(' + editor.language.translate('or click') + ')<div class=\"fr-form\"><input type=\"file\" name=\"' + editor.opts.fileUploadParam + '\" accept=\"/*\" tabIndex=\"-1\" aria-labelledby=\"fr-file-upload-layer-' + editor.id + '\" role=\"button\"></div></div>'\n    }\n\n\n    // Progress bar.\n    var progress_bar_layer = '<div class=\"fr-file-progress-bar-layer fr-layer\"><h3 tabIndex=\"-1\" class=\"fr-message\">Uploading</h3><div class=\"fr-loader\"><span class=\"fr-progress\"></span></div><div class=\"fr-action-buttons\"><button type=\"button\" class=\"fr-command fr-dismiss\" data-cmd=\"fileDismissError\" tabIndex=\"2\" role=\"button\">OK</button></div></div>';\n\n    var template = {\n      buttons: file_buttons,\n      upload_layer: upload_layer,\n      progress_bar: progress_bar_layer\n    };\n\n    // Set the template in the popup.\n    var $popup = editor.popups.create('file.insert', template);\n\n    _bindInsertEvents($popup);\n\n    return $popup;\n  }\n\n  function _onRemove (link) {\n    if (editor.node.hasClass(link, 'fr-file')) {\n\n      return;\n    }\n  }\n\n  function _drop (e) {\n\n    // Check if we are dropping files.\n    var dt = e.originalEvent.dataTransfer;\n\n    if (dt && dt.files && dt.files.length) {\n      var file = dt.files[0];\n\n      if (file && typeof file.type != 'undefined') {\n\n        // Dropped file is an file that we allow.\n        if (file.type.indexOf('image') < 0) {\n          if (!editor.opts.fileUpload) {\n            e.preventDefault();\n            e.stopPropagation();\n\n            return false;\n          }\n\n\n          editor.markers.remove();\n          editor.markers.insertAtPoint(e.originalEvent);\n          editor.$el.find('.fr-marker').replaceWith(FE.MARKERS);\n\n          // Hide popups.\n          editor.popups.hideAll();\n\n          // Show the file insert popup.\n          var $popup = editor.popups.get('file.insert');\n\n          if (!$popup) $popup = _initInsertPopup();\n          editor.popups.setContainer('file.insert', editor.$sc);\n          editor.popups.show('file.insert', e.originalEvent.pageX, e.originalEvent.pageY);\n          showProgressBar();\n\n          // Upload files.\n          upload(dt.files);\n\n          // Cancel anything else.\n          e.preventDefault();\n          e.stopPropagation();\n\n          return false;\n        }\n      }\n      else if (file.type.indexOf('image') < 0) {\n        e.preventDefault();\n        e.stopPropagation();\n      }\n    }\n  }\n\n  function _initEvents() {\n\n    // Drop inside the editor.\n    editor.events.on('drop', _drop);\n\n    editor.events.$on(editor.$win, 'keydown', function (e) {\n      var key_code = e.which;\n      var $popup = editor.popups.get('file.insert');\n\n      if ($popup && key_code == FE.KEYCODE.ESC) {\n        $popup.trigger('abortUpload');\n      }\n    });\n\n    editor.events.on('destroy', function () {\n      var $popup = editor.popups.get('file.insert');\n\n      if ($popup) {\n        $popup.trigger('abortUpload');\n      }\n    });\n  }\n\n  function back () {\n    editor.events.disableBlur();\n    editor.selection.restore();\n    editor.events.enableBlur();\n\n    editor.popups.hide('file.insert');\n    editor.toolbar.showInline();\n  }\n\n  var files;\n\n  function _syncFiles () {\n\n    // Get current files.\n    var c_files = Array.prototype.slice.call(editor.el.querySelectorAll('a.fr-file'));\n\n    // Current files src.\n    var file_srcs = [];\n    var i;\n\n    for (i = 0; i < c_files.length; i++) {\n      file_srcs.push(c_files[i].getAttribute('href'));\n    }\n\n    // Loop previous files and check their src.\n    if (files) {\n      for (i = 0; i < files.length; i++) {\n        if (file_srcs.indexOf(files[i].getAttribute('href')) < 0) {\n          editor.events.trigger('file.unlink', [files[i]]);\n        }\n      }\n    }\n\n    // Current files are the old ones.\n    files = c_files;\n  }\n\n  /*\n   * Initialize.\n   */\n  function _init () {\n    _initEvents();\n\n    editor.events.on('link.beforeRemove', _onRemove);\n\n    if (editor.$wp) {\n      _syncFiles();\n      editor.events.on('contentChanged', _syncFiles);\n    }\n\n    _initInsertPopup(true);\n  }\n\n  return {\n    _init: _init,\n    showInsertPopup: showInsertPopup,\n    upload: upload,\n    insert: insert,\n    back: back,\n    hideProgressBar: hideProgressBar\n  }\n}\n\n// Insert file button.\nFE.DefineIcon('insertFile', {\n  NAME: 'file-o',\n  FA5NAME: 'file'\n});\nFE.RegisterCommand('insertFile', {\n  title: 'Upload File',\n  undo: false,\n  focus: true,\n  refreshAfterCallback: false,\n  popup: true,\n  callback: function () {\n    if (!this.popups.isVisible('file.insert')) {\n      this.file.showInsertPopup();\n    }\n    else {\n      if (this.$el.find('.fr-marker').length) {\n        this.events.disableBlur();\n        this.selection.restore();\n      }\n      this.popups.hide('file.insert');\n    }\n  },\n  plugin: 'file'\n});\n\nFE.DefineIcon('fileBack', { NAME: 'arrow-left' });\nFE.RegisterCommand('fileBack', {\n  title: 'Back',\n  undo: false,\n  focus: false,\n  back: true,\n  refreshAfterCallback: false,\n  callback: function () {\n    this.file.back();\n  },\n  refresh: function ($btn) {\n    if (!this.opts.toolbarInline) {\n      $btn.addClass('fr-hidden');\n      $btn.next('.fr-separator').addClass('fr-hidden');\n    }\n    else {\n      $btn.removeClass('fr-hidden');\n      $btn.next('.fr-separator').removeClass('fr-hidden');\n    }\n  }\n});\n\nFE.RegisterCommand('fileDismissError', {\n  title: 'OK',\n  callback: function () {\n    this.file.hideProgressBar(true);\n  }\n})","import FE from 'FroalaEditor';\n\nObject.assign(FE.DEFAULTS, {\n  fontFamily: {\n    'Arial,Helvetica,sans-serif': 'Arial',\n    'Georgia,serif': 'Georgia',\n    'Impact,Charcoal,sans-serif': 'Impact',\n    'Tahoma,Geneva,sans-serif': 'Tahoma',\n    'Times New Roman,Times,serif,-webkit-standard': 'Times New Roman',\n    'Verdana,Geneva,sans-serif': 'Verdana'\n  },\n  fontFamilySelection: false,\n  fontFamilyDefaultSelection: 'Font Family'\n})\n\nFE.PLUGINS.fontFamily = function (editor) {\n  let $ = editor.$\n\n  function apply (val) {\n    editor.format.applyStyle('font-family', val);\n  }\n\n  function refreshOnShow($btn, $dropdown) {\n    $dropdown.find('.fr-command.fr-active').removeClass('fr-active').attr('aria-selected', false);\n    $dropdown.find('.fr-command[data-param1=\"' + _getSelection() + '\"]').addClass('fr-active').attr('aria-selected', true);\n\n    var $list = $dropdown.find('.fr-dropdown-list');\n    var $active = $dropdown.find('.fr-active').parent();\n\n    if ($active.length) {\n      $list.parent().scrollTop($active.offset().top - $list.offset().top - ($list.parent().outerHeight() / 2 - $active.outerHeight() / 2));\n    }\n    else {\n      $list.parent().scrollTop(0);\n    }\n  }\n\n  function _getArray (val) {\n    var font_array = val.replace(/(sans-serif|serif|monospace|cursive|fantasy)/gi, '').replace(/\"|'| /g, '').split(',');\n\n    for (var i = font_array.length - 1; i >= 0; i--) {\n      var txt = font_array[i];\n\n      if (txt.length === 0) {\n        font_array.splice(i, 1);\n      }\n    }\n\n    return font_array;\n  }\n\n  /**\n   * Return first match position.\n   */\n  function _matches (array1, array2) {\n    for (var i = 0; i < array1.length; i++) {\n      for (var j = 0; j < array2.length; j++) {\n        if (array1[i].toLowerCase() == array2[j].toLowerCase()) {\n          return [i, j];\n        }\n      }\n    }\n\n    return null;\n  }\n\n  function _getSelection () {\n    var val = $(editor.selection.element()).css('font-family');\n    var font_array = _getArray(val);\n\n    var font_matches = [];\n\n    for (var key in editor.opts.fontFamily) {\n      if (Object.prototype.hasOwnProperty.call(editor.opts.fontFamily, key)) {\n        var c_font_array = _getArray(key);\n\n        var match = _matches(font_array, c_font_array);\n\n        if (match) {\n          font_matches.push([key, match]);\n        }\n      }\n    }\n\n    if (font_matches.length === 0) return null;\n\n    // Sort matches by their position.\n    // Times,Arial should be detected as being Times, not Arial.\n    font_matches.sort(function (a, b) {\n      var f_diff = a[1][0] - b[1][0];\n\n      if (f_diff === 0) {\n        return a[1][1] - b[1][1];\n      }\n      else {\n        return f_diff;\n      }\n    });\n\n    return font_matches[0][0];\n  }\n\n  function refresh ($btn) {\n    if (editor.opts.fontFamilySelection) {\n      var val = $(editor.selection.element()).css('font-family').replace(/(sans-serif|serif|monospace|cursive|fantasy)/gi, '').replace(/\"|'|/g, '').split(',');\n\n      $btn.find('> span').text(editor.opts.fontFamily[_getSelection()] || val[0] || editor.language.translate(editor.opts.fontFamilyDefaultSelection));\n    }\n  }\n\n  return {\n    apply: apply,\n    refreshOnShow: refreshOnShow,\n    refresh: refresh\n  }\n}\n\n// Register the font size command.\nFE.RegisterCommand('fontFamily', {\n  type: 'dropdown',\n  displaySelection: function (editor) {\n    return editor.opts.fontFamilySelection;\n  },\n  defaultSelection: function (editor) {\n    return editor.opts.fontFamilyDefaultSelection;\n  },\n  displaySelectionWidth: 120,\n  html: function () {\n    var c = '<ul class=\"fr-dropdown-list\" role=\"presentation\">';\n    var options = this.opts.fontFamily;\n\n    for (var val in options) {\n      if (Object.prototype.hasOwnProperty.call(options, val)) {\n        c += '<li role=\"presentation\"><a class=\"fr-command\" tabIndex=\"-1\" role=\"option\" data-cmd=\"fontFamily\" data-param1=\"' + val + '\" style=\"font-family: ' + val + '\" title=\"' + options[val] + '\">' + options[val] + '</a></li>';\n      }\n    }\n    c += '</ul>';\n\n    return c;\n  },\n  title: 'Font Family',\n  callback: function (cmd, val) {\n    this.fontFamily.apply(val);\n  },\n  refresh: function ($btn) {\n    this.fontFamily.refresh($btn);\n  },\n  refreshOnShow: function ($btn, $dropdown) {\n    this.fontFamily.refreshOnShow($btn, $dropdown);\n  },\n  plugin: 'fontFamily'\n})\n\n// Add the font size icon.\nFE.DefineIcon('fontFamily', {\n  NAME: 'font'\n});\n","import FE from 'FroalaEditor';\n\nObject.assign(FE.DEFAULTS, {\n  fontSize: ['8', '9', '10', '11', '12', '14', '18', '24', '30', '36', '48', '60', '72', '96'],\n  fontSizeSelection: false,\n  fontSizeDefaultSelection: '12',\n  fontSizeUnit: 'px'\n});\n\nFE.PLUGINS.fontSize = function (editor) {\n  let $ = editor.$;\n\n  function apply (val) {\n    editor.format.applyStyle('font-size', val);\n  }\n\n  function refreshOnShow($btn, $dropdown) {\n    var val = $(editor.selection.element()).css('font-size');\n    $dropdown.find('.fr-command.fr-active').removeClass('fr-active').attr('aria-selected', false);\n    $dropdown.find('.fr-command[data-param1=\"' + val + '\"]').addClass('fr-active').attr('aria-selected', true);\n\n    var $list = $dropdown.find('.fr-dropdown-list');\n    var $active = $dropdown.find('.fr-active').parent();\n\n    if ($active.length) {\n      $list.parent().scrollTop($active.offset().top - $list.offset().top - ($list.parent().outerHeight() / 2 - $active.outerHeight() / 2));\n    }\n    else {\n      $list.parent().scrollTop(0);\n    }\n  }\n\n  function refresh ($btn) {\n    if (editor.opts.fontSizeSelection) {\n      var val = editor.helpers.getPX($(editor.selection.element()).css('font-size'));\n      $btn.find('> span').text(val);\n    }\n  }\n\n  return {\n    apply: apply,\n    refreshOnShow: refreshOnShow,\n    refresh: refresh\n  }\n}\n\n// Register the font size command.\nFE.RegisterCommand('fontSize', {\n  type: 'dropdown',\n  title: 'Font Size',\n  displaySelection: function (editor) {\n    return editor.opts.fontSizeSelection;\n  },\n  displaySelectionWidth: 30,\n  defaultSelection: function (editor) {\n    return editor.opts.fontSizeDefaultSelection;\n  },\n  html: function () {\n    var c = '<ul class=\"fr-dropdown-list\" role=\"presentation\">';\n    var options =  this.opts.fontSize;\n\n    for (var i = 0; i < options.length; i++) {\n      var val = options[i];\n      c += '<li role=\"presentation\"><a class=\"fr-command\" tabIndex=\"-1\" role=\"option\" data-cmd=\"fontSize\" data-param1=\"' + val + this.opts.fontSizeUnit + '\" title=\"' + val + '\">' + val + '</a></li>';\n    }\n    c += '</ul>';\n\n    return c;\n  },\n  callback: function (cmd, val) {\n    this.fontSize.apply(val);\n  },\n  refresh: function ($btn) {\n    this.fontSize.refresh($btn);\n  },\n  refreshOnShow: function ($btn, $dropdown) {\n    this.fontSize.refreshOnShow($btn, $dropdown);\n  },\n  plugin: 'fontSize'\n})\n\n// Add the font size icon.\nFE.DefineIcon('fontSize', {\n  NAME: 'text-height'\n});\n","import FE from 'FroalaEditor';\n\nObject.assign(FE.POPUP_TEMPLATES, {\n  'forms.edit': '[_BUTTONS_]',\n  'forms.update': '[_BUTTONS_][_TEXT_LAYER_]'\n})\n\nObject.assign(FE.DEFAULTS, {\n  formEditButtons: ['inputStyle', 'inputEdit'],\n  formStyles: {\n    'fr-rounded': 'Rounded',\n    'fr-large': 'Large'\n  },\n  formMultipleStyles: true,\n  formUpdateButtons: ['inputBack', '|']\n})\n\nFE.PLUGINS.forms = function (editor) {\n  var current_input;\n\n  /**\n   * Input mousedown.\n   */\n  function _inputMouseDown (e) {\n    e.preventDefault();\n    editor.selection.clear();\n    $(this).data('mousedown', true);\n  }\n\n  /**\n   * Mouseup on the input.\n   */\n  function _inputMouseUp (e) {\n\n    // Mousedown was made.\n    if ($(this).data('mousedown')) {\n      e.stopPropagation();\n      $(this).removeData('mousedown');\n\n      current_input = this;\n\n      showEditPopup(this);\n    }\n\n    e.preventDefault();\n  }\n\n  /**\n   * Cancel if mousedown was made on any input.\n   */\n  function _cancelSelection () {\n    editor.$el.find('input, textarea, button').removeData('mousedown');\n  }\n\n  /**\n   * Touch move.\n   */\n  function _inputTouchMove () {\n    $(this).removeData('mousedown');\n  }\n\n  /**\n   * Assign the input events.\n   */\n  function _bindEvents () {\n    editor.events.$on(editor.$el, editor._mousedown, 'input, textarea, button', _inputMouseDown);\n    editor.events.$on(editor.$el, editor._mouseup, 'input, textarea, button', _inputMouseUp);\n    editor.events.$on(editor.$el, 'touchmove', 'input, textarea, button', _inputTouchMove);\n    editor.events.$on(editor.$el, editor._mouseup, _cancelSelection);\n    editor.events.$on(editor.$win, editor._mouseup, _cancelSelection);\n\n    _initUpdatePopup(true);\n  }\n\n  /**\n   * Get the current button.\n   */\n  function getInput () {\n    if (current_input) return current_input;\n\n    return null;\n  }\n\n  /**\n   * Init the edit button popup.\n   */\n  function _initEditPopup () {\n\n    // Button edit buttons.\n    var buttons = '';\n\n    if (editor.opts.formEditButtons.length > 0) {\n      buttons = '<div class=\"fr-buttons\">' + editor.button.buildList(editor.opts.formEditButtons) + '</div>';\n    }\n\n    var template = {\n      buttons: buttons\n    };\n\n    // Set the template in the popup.\n    var $popup = editor.popups.create('forms.edit', template);\n\n    if (editor.$wp) {\n      editor.events.$on(editor.$wp, 'scroll.link-edit', function () {\n        if (getInput() && editor.popups.isVisible('forms.edit')) {\n          showEditPopup(getInput());\n        }\n      });\n    }\n\n    return $popup;\n  }\n\n  /**\n   * Show the edit button popup.\n   */\n  function showEditPopup (input) {\n    var $popup = editor.popups.get('forms.edit');\n\n    if (!$popup) $popup = _initEditPopup();\n\n    current_input = input;\n    var $input = $(input);\n\n    editor.popups.refresh('forms.edit');\n\n    editor.popups.setContainer('forms.edit', editor.$sc);\n    var left = $input.offset().left + $input.outerWidth() / 2;\n    var top = $input.offset().top + $input.outerHeight();\n\n    editor.popups.show('forms.edit', left, top, $input.outerHeight());\n  }\n\n  /**\n   * Refresh update button popup callback.\n   */\n  function _refreshUpdateCallback () {\n    var $popup = editor.popups.get('forms.update');\n\n    var input = getInput();\n\n    if (input) {\n      var $input = $(input);\n\n      if ($input.is('button')) {\n        $popup.find('input[type=\"text\"][name=\"text\"]').val($input.text());\n      }\n      else {\n        $popup.find('input[type=\"text\"][name=\"text\"]').val($input.attr('placeholder'));\n      }\n    }\n\n    $popup.find('input[type=\"text\"][name=\"text\"]').trigger('change');\n  }\n\n  /**\n   * Hide update button popup callback.\n   */\n  function _hideUpdateCallback () {\n    current_input = null;\n  }\n\n  /**\n   * Init update button popup.\n   */\n  function _initUpdatePopup (delayed) {\n    if (delayed) {\n      editor.popups.onRefresh('forms.update', _refreshUpdateCallback);\n      editor.popups.onHide('forms.update', _hideUpdateCallback);\n\n      return true;\n    }\n\n    // Button update buttons.\n    var buttons = '';\n\n    if (editor.opts.formUpdateButtons.length >= 1) {\n      buttons = '<div class=\"fr-buttons\">' + editor.button.buildList(editor.opts.formUpdateButtons) + '</div>';\n    }\n\n    var text_layer = '';\n    var tab_idx = 0;\n    text_layer = '<div class=\"fr-forms-text-layer fr-layer fr-active\">';\n    text_layer += '<div class=\"fr-input-line\"><input name=\"text\" type=\"text\" placeholder=\"Text\" tabIndex=\"' + (++tab_idx) + '\"></div>';\n\n    text_layer += '<div class=\"fr-action-buttons\"><button class=\"fr-command fr-submit\" data-cmd=\"updateInput\" href=\"#\" tabIndex=\"' + (++tab_idx) + '\" type=\"button\">' + editor.language.translate('Update') + '</button></div></div>'\n\n    var template = {\n      buttons: buttons,\n      text_layer: text_layer\n    }\n\n    // Set the template in the popup.\n    var $popup = editor.popups.create('forms.update', template);\n\n    return $popup;\n  }\n\n  /**\n   * Show the button update popup.\n   */\n  function showUpdatePopup () {\n    var input = getInput();\n\n    if (input) {\n      var $input = $(input);\n\n      var $popup = editor.popups.get('forms.update');\n\n      if (!$popup) $popup = _initUpdatePopup();\n\n      if (!editor.popups.isVisible('forms.update')) {\n        editor.popups.refresh('forms.update');\n      }\n\n      editor.popups.setContainer('forms.update', editor.$sc);\n      var left = $input.offset().left + $input.outerWidth() / 2;\n      var top = $input.offset().top + $input.outerHeight();\n\n      editor.popups.show('forms.update', left, top, $input.outerHeight());\n    }\n  }\n\n  /**\n   * Apply specific style.\n   */\n  function applyStyle (val, formStyles, multipleStyles) {\n    if (typeof formStyles == 'undefined') formStyles = editor.opts.formStyles;\n\n    if (typeof multipleStyles == 'undefined') multipleStyles = editor.opts.formMultipleStyles;\n\n    var input = getInput();\n\n    if (!input) return false;\n\n    // Remove multiple styles.\n    if (!multipleStyles) {\n      var styles = Object.keys(formStyles);\n      styles.splice(styles.indexOf(val), 1);\n      $(input).removeClass(styles.join(' '));\n    }\n\n    $(input).toggleClass(val);\n  }\n\n  /**\n   * Back button in update button popup.\n   */\n  function back () {\n    editor.events.disableBlur();\n    editor.selection.restore();\n    editor.events.enableBlur();\n\n    var input = getInput();\n\n    if (input && editor.$wp) {\n      if (input.tagName == 'BUTTON') editor.selection.restore();\n      showEditPopup(input);\n    }\n  }\n\n  /**\n   * Hit the update button in the input popup.\n   */\n  function updateInput () {\n    var $popup = editor.popups.get('forms.update');\n\n    var input = getInput();\n\n    if (input) {\n      var $input = $(input);\n      var val = $popup.find('input[type=\"text\"][name=\"text\"]').val() || '';\n\n      if (val.length) {\n        if ($input.is('button')) {\n          $input.text(val);\n        }\n        else {\n          $input.attr('placeholder', val);\n        }\n      }\n\n      editor.popups.hide('forms.update');\n      showEditPopup(input);\n    }\n  }\n\n  /**\n   * Initialize.\n   */\n  function _init () {\n\n    // Bind input events.\n    _bindEvents();\n\n    // Prevent form submit.\n    editor.events.$on(editor.$el, 'submit', 'form', function (e) {\n      e.preventDefault();\n\n      return false;\n    })\n  }\n\n  return {\n    _init: _init,\n    updateInput: updateInput,\n    getInput: getInput,\n    applyStyle: applyStyle,\n    showUpdatePopup: showUpdatePopup,\n    showEditPopup: showEditPopup,\n    back: back\n  }\n}\n\n// Register command to update input.\nFE.RegisterCommand('updateInput', {\n  undo: false,\n  focus: false,\n  title: 'Update',\n  callback: function () {\n    this.forms.updateInput();\n  }\n});\n\n// Link styles.\nFE.DefineIcon('inputStyle', { NAME: 'magic' })\nFE.RegisterCommand('inputStyle', {\n  title: 'Style',\n  type: 'dropdown',\n  html: function () {\n    var c = '<ul class=\"fr-dropdown-list\">';\n    var options =  this.opts.formStyles;\n\n    for (var cls in options) {\n      if (Object.prototype.hasOwnProperty.call(options, cls)) {\n        c += '<li><a class=\"fr-command\" tabIndex=\"-1\" data-cmd=\"inputStyle\" data-param1=\"' + cls + '\">' + this.language.translate(options[cls]) + '</a></li>';\n      }\n    }\n    c += '</ul>';\n\n    return c;\n  },\n  callback: function (cmd, val) {\n    var input = this.forms.getInput();\n\n    if (input) {\n      this.forms.applyStyle(val);\n      this.forms.showEditPopup(input);\n    }\n  },\n  refreshOnShow: function ($btn, $dropdown) {\n    var input = this.forms.getInput();\n\n    if (input) {\n      var $input = $(input);\n\n      $dropdown.find('.fr-command').each (function () {\n        var cls = $(this).data('param1');\n        $(this).toggleClass('fr-active', $input.hasClass(cls));\n      })\n    }\n  }\n});\n\nFE.DefineIcon('inputEdit', { NAME: 'edit' });\nFE.RegisterCommand('inputEdit', {\n  title: 'Edit Button',\n  undo: false,\n  refreshAfterCallback: false,\n  callback: function () {\n    this.forms.showUpdatePopup();\n  }\n})\n\nFE.DefineIcon('inputBack', { NAME: 'arrow-left' });\nFE.RegisterCommand('inputBack', {\n  title: 'Back',\n  undo: false,\n  focus: false,\n  back: true,\n  refreshAfterCallback: false,\n  callback: function () {\n    this.forms.back();\n  }\n});\n\n// Register command to update button.\nFE.RegisterCommand('updateInput', {\n  undo: false,\n  focus: false,\n  title: 'Update',\n  callback: function () {\n    this.forms.updateInput();\n  }\n});","import FE from 'FroalaEditor';\n\nFE.PLUGINS.fullscreen = function (editor) {\n  let $ = editor.$\n\n  var old_scroll;\n\n  /**\n   * Check if fullscreen mode is active.\n   */\n  function isActive () {\n    return editor.$box.hasClass('fr-fullscreen');\n  }\n\n  /**\n   * Turn fullscreen on.\n   */\n  var height;\n  var max_height;\n  var z_index;\n\n  function _on () {\n    if (editor.helpers.isIOS() && editor.core.hasFocus()) {\n      editor.$el.blur();\n\n      setTimeout(toggle, 250);\n\n      return false;\n    }\n\n    old_scroll = editor.helpers.scrollTop();\n    editor.$box.toggleClass('fr-fullscreen');\n    $('body').first().toggleClass('fr-fullscreen');\n\n    if (editor.helpers.isMobile()) {\n      editor.$tb.data('parent', editor.$tb.parent());\n      editor.$box.prepend(editor.$tb);\n\n      if (editor.$tb.data('sticky-dummy')) {\n        editor.$tb.after(editor.$tb.data('sticky-dummy'));\n      }\n    }\n\n    height = editor.opts.height;\n    max_height = editor.opts.heightMax;\n    z_index = editor.opts.zIndex;\n\n    editor.position.refresh()\n\n    editor.opts.height = editor.o_win.innerHeight - (editor.opts.toolbarInline ? 0 : editor.$tb.outerHeight());\n    editor.opts.zIndex = 2147483641;\n    editor.opts.heightMax = null;\n    editor.size.refresh();\n\n    if (editor.opts.toolbarInline) editor.toolbar.showInline();\n\n    var $parent_node = editor.$box.parent();\n\n    while (!$parent_node.is('body')) {\n      $parent_node\n        .data('z-index', $parent_node.css('z-index'))\n        .data('overflow', $parent_node.css('overflow'))\n        .css('z-index', '2147483640')\n        .css('overflow', 'visible');\n      $parent_node = $parent_node.parent();\n    }\n\n    if (editor.opts.toolbarContainer) {\n      editor.$box.prepend(editor.$tb);\n    }\n\n    editor.events.trigger('charCounter.update');\n    editor.events.trigger('codeView.update');\n    editor.$win.trigger('scroll');\n  }\n\n  /**\n   * Turn fullscreen off.\n   */\n  function _off () {\n    if (editor.helpers.isIOS() && editor.core.hasFocus()) {\n      editor.$el.blur();\n\n      setTimeout(toggle, 250);\n\n      return false;\n    }\n\n    editor.$box.toggleClass('fr-fullscreen');\n    $('body').first().toggleClass('fr-fullscreen');\n\n    if (editor.$tb.data('parent')) {\n      editor.$tb.data('parent').prepend(editor.$tb);\n    }\n\n    if (editor.$tb.data('sticky-dummy')) {\n      editor.$tb.after(editor.$tb.data('sticky-dummy'));\n    }\n\n    editor.opts.height = height;\n    editor.opts.heightMax = max_height;\n    editor.opts.zIndex = z_index;\n    editor.size.refresh();\n\n    $(editor.o_win).scrollTop(old_scroll)\n\n    if (editor.opts.toolbarInline) editor.toolbar.showInline();\n\n    editor.events.trigger('charCounter.update');\n\n    if (editor.opts.toolbarSticky) {\n      if (editor.opts.toolbarStickyOffset) {\n        if (editor.opts.toolbarBottom) {\n          editor.$tb\n            .css('bottom', editor.opts.toolbarStickyOffset)\n            .data('bottom', editor.opts.toolbarStickyOffset);\n        }\n        else {\n          editor.$tb\n            .css('top', editor.opts.toolbarStickyOffset)\n            .data('top', editor.opts.toolbarStickyOffset);\n        }\n      }\n    }\n\n    var $parent_node = editor.$box.parent();\n\n    while (!$parent_node.is('body')) {\n      if ($parent_node.data('z-index')) {\n        $parent_node.css('z-index', '');\n\n        if ($parent_node.css('z-index') != $parent_node.data('z-index')) {\n          $parent_node.css('z-index', $parent_node.data('z-index'));\n        }\n        $parent_node.removeData('z-index');\n      }\n\n      if ($parent_node.data('overflow')) {\n        $parent_node.css('overflow', '');\n\n        if ($parent_node.css('overflow') != $parent_node.data('overflow')) {\n          $parent_node.css('overflow', $parent_node.data('overflow'));\n        }\n        $parent_node.removeData('overflow');\n      }\n      else {\n        $parent_node.css('overflow', '');\n        $parent_node.removeData('overflow');\n      }\n\n      $parent_node = $parent_node.parent();\n    }\n\n    if (editor.opts.toolbarContainer) {\n      $(editor.opts.toolbarContainer).append(editor.$tb);\n    }\n\n    $(editor.o_win).trigger('scroll');\n    editor.events.trigger('codeView.update');\n  }\n\n  /**\n   * Exec fullscreen.\n   */\n  function toggle () {\n    if (!isActive()) {\n      _on();\n    }\n    else {\n      _off();\n    }\n\n    refresh(editor.$tb.find('.fr-command[data-cmd=\"fullscreen\"]'));\n  }\n\n  function refresh ($btn) {\n    var active = isActive();\n\n    $btn.toggleClass('fr-active', active).attr('aria-pressed', active);\n    $btn.find('> *:not(.fr-sr-only)').replaceWith(!active ? editor.icon.create('fullscreen') : editor.icon.create('fullscreenCompress'));\n  }\n\n  function _init () {\n    if (!editor.$wp) return false;\n\n    editor.events.$on($(editor.o_win), 'resize', function () {\n      if (isActive()) {\n        _off();\n        _on();\n      }\n    });\n\n    editor.events.on('toolbar.hide', function () {\n      if (isActive() && editor.helpers.isMobile()) return false;\n    })\n\n    editor.events.on('position.refresh', function () {\n      if (editor.helpers.isIOS()) {\n        return !isActive();\n      }\n    })\n\n    editor.events.on('destroy', function () {\n\n      // Exit full screen.\n      if (isActive()) {\n        _off();\n      }\n    }, true);\n  }\n\n  return {\n    _init: _init,\n    toggle: toggle,\n    refresh: refresh,\n    isActive: isActive\n  }\n}\n\n// Register the font size command.\nFE.RegisterCommand('fullscreen', {\n  title: 'Fullscreen',\n  undo: false,\n  focus: false,\n  accessibilityFocus: true,\n  forcedRefresh: true,\n  toggle: true,\n  callback: function () {\n    this.fullscreen.toggle();\n  },\n  refresh: function ($btn) {\n    this.fullscreen.refresh($btn);\n  },\n  plugin: 'fullscreen'\n})\n\n// Add the font size icon.\nFE.DefineIcon('fullscreen', {\n  NAME: 'expand'\n});\nFE.DefineIcon('fullscreenCompress', {\n  NAME: 'compress'\n});\n","import FE from 'FroalaEditor';\n\n// Extend defaults.\nObject.assign(FE.DEFAULTS, {\n  helpSets: [\n    {\n      title: 'Inline Editor',\n      commands: [\n        { val: 'OSkeyE',  desc: 'Show the editor' }\n      ]\n    },\n    {\n      title: 'Common actions',\n      commands: [\n        { val: 'OSkeyC',  desc: 'Copy' },\n        { val: 'OSkeyX',  desc: 'Cut' },\n        { val: 'OSkeyV',  desc: 'Paste' },\n        { val: 'OSkeyZ',  desc: 'Undo' },\n        { val: 'OSkeyShift+Z',  desc: 'Redo' },\n        { val: 'OSkeyK',  desc: 'Insert Link' },\n        { val: 'OSkeyP',  desc: 'Insert Image' }\n      ]\n    },\n    {\n      title: 'Basic Formatting',\n      commands: [\n        { val: 'OSkeyA',  desc: 'Select All' },\n        { val: 'OSkeyB',  desc: 'Bold' },\n        { val: 'OSkeyI',  desc: 'Italic' },\n        { val: 'OSkeyU',  desc: 'Underline' },\n        { val: 'OSkeyS',  desc: 'Strikethrough' },\n        { val: 'OSkey]',  desc: 'Increase Indent' },\n        { val: 'OSkey[',  desc: 'Decrease Indent' }\n      ]\n    },\n    {\n      title: 'Quote',\n      commands: [\n        { val: 'OSkey\\'',  desc: 'Increase quote level' },\n        { val: 'OSkeyShift+\\'',  desc: 'Decrease quote level' }\n      ]\n    },\n    {\n      title: 'Image / Video',\n      commands: [\n        { val: 'OSkey+',  desc: 'Resize larger' },\n        { val: 'OSkey-',  desc: 'Resize smaller' }\n      ]\n    },\n    {\n      title: 'Table',\n      commands: [\n        { val: 'Alt+Space',  desc: 'Select table cell' },\n        { val: 'Shift+Left/Right arrow',  desc: 'Extend selection one cell' },\n        { val: 'Shift+Up/Down arrow',  desc: 'Extend selection one row' }\n      ]\n    },\n    {\n      title: 'Navigation',\n      commands: [\n        { val: 'OSkey/',  desc: 'Shortcuts' },\n        { val: 'Alt+F10',  desc: 'Focus popup / toolbar' },\n        { val: 'Esc',  desc: 'Return focus to previous position' }\n      ]\n    }\n  ]\n});\n\nFE.PLUGINS.help = function (editor) {\n  let $ = editor.$\n\n  var $modal;\n  var modal_id = 'help';\n\n  var $head;\n  var $body;\n\n  /*\n   * Init Help.\n   */\n  function _init () {\n\n  }\n\n  /*\n   * Build html body.\n   */\n  function _buildBody () {\n\n    // Begin body.\n    var body = '<div class=\"fr-help-modal\">';\n\n    for (var i = 0; i < editor.opts.helpSets.length; i++) {\n      var set = editor.opts.helpSets[i];\n\n      // Set shortcuts table.\n      // Begin Table.\n      var group = '<table>';\n\n      // Set title.\n      group += '<thead><tr><th>' + editor.language.translate(set.title) + '</th></tr></thead>';\n      group += '<tbody>';\n\n      // Build commands table.\n      for (var j = 0; j < set.commands.length; j++) {\n        var command = set.commands[j];\n        group += '<tr>';\n\n        group += '<td>' + editor.language.translate(command.desc) + '</td>';\n        group += '<td>' + command.val.replace('OSkey', editor.helpers.isMac() ? '&#8984;' : 'Ctrl+') + '</td>';\n\n        group += '</tr>';\n      }\n\n      // End table.\n      group += '</tbody></table>';\n\n      // Append group to body.\n      body += group;\n    }\n\n    // End body.\n    body += '</div>';\n\n    return body;\n  }\n\n  /*\n   * Show help.\n   */\n  function show () {\n    if (!$modal) {\n      var head = '<h4>' + editor.language.translate('Shortcuts') + '</h4>';\n      var body = _buildBody();\n\n      var modalHash = editor.modals.create(modal_id, head, body);\n      $modal = modalHash.$modal;\n      $head = modalHash.$head;\n      $body = modalHash.$body;\n\n      // Resize help modal on window resize.\n      editor.events.$on($(editor.o_win), 'resize', function () {\n        editor.modals.resize(modal_id);\n      })\n    }\n\n    // Show modal.\n    editor.modals.show(modal_id);\n\n    // Modal may not fit window size.\n    editor.modals.resize(modal_id);\n  }\n\n  /*\n   * Hide help.\n   */\n  function hide () {\n    editor.modals.hide(modal_id);\n  }\n\n  return {\n    _init: _init,\n    show: show,\n    hide: hide\n  };\n};\n\nFE.DefineIcon('help', { NAME: 'question' })\n\nFE.RegisterShortcut(FE.KEYCODE.SLASH, 'help', null, '/');\n\nFE.RegisterCommand('help', {\n  title: 'Help',\n  icon: 'help',\n  undo: false,\n  focus: false,\n  modal: true,\n  callback: function () {\n    this.help.show();\n  },\n  plugin: 'help',\n  showOnMobile: false\n});","import FE from 'FroalaEditor';\n\nObject.assign(FE.POPUP_TEMPLATES, {\n  'image.insert': '[_BUTTONS_][_UPLOAD_LAYER_][_BY_URL_LAYER_][_PROGRESS_BAR_]',\n  'image.edit': '[_BUTTONS_]',\n  'image.alt': '[_BUTTONS_][_ALT_LAYER_]',\n  'image.size': '[_BUTTONS_][_SIZE_LAYER_]'\n})\n\nObject.assign(FE.DEFAULTS, {\n  imageInsertButtons: ['imageBack', '|', 'imageUpload', 'imageByURL'],\n  imageEditButtons: ['imageReplace', 'imageAlign', 'imageCaption', 'imageRemove', '|', 'imageLink', 'linkOpen', 'linkEdit', 'linkRemove', '-', 'imageDisplay', 'imageStyle', 'imageAlt', 'imageSize'],\n  imageAltButtons: ['imageBack', '|'],\n  imageSizeButtons: ['imageBack', '|'],\n  imageUpload: true,\n  imageUploadURL: 'https://i.froala.com/upload',\n  imageCORSProxy: 'https://cors-anywhere.froala.com',\n  imageUploadRemoteUrls: true,\n  imageUploadParam: 'file',\n  imageUploadParams: {},\n  imageUploadToS3: false,\n  imageUploadMethod: 'POST',\n  imageMaxSize: 10 * 1024 * 1024,\n  imageAllowedTypes: ['jpeg', 'jpg', 'png', 'gif'],\n  imageResize: true,\n  imageResizeWithPercent: false,\n  imageRoundPercent: false,\n  imageDefaultWidth: 300,\n  imageDefaultAlign: 'center',\n  imageDefaultDisplay: 'block',\n  imageSplitHTML: false,\n  imageStyles: {\n    'fr-rounded': 'Rounded',\n    'fr-bordered': 'Bordered',\n    'fr-shadow': 'Shadow'\n  },\n  imageMove: true,\n  imageMultipleStyles: true,\n  imageTextNear: true,\n  imagePaste: true,\n  imagePasteProcess: false,\n  imageMinWidth: 16,\n  imageOutputSize: false,\n  imageDefaultMargin: 5\n});\n\nFE.PLUGINS.image = function (editor) {\n  let $ = editor.$\n\n  var $current_image;\n  var $image_resizer;\n  var $handler;\n  var $overlay;\n  var mousedown = false;\n\n  var BAD_LINK = 1;\n  var MISSING_LINK = 2;\n  var ERROR_DURING_UPLOAD = 3;\n  var BAD_RESPONSE = 4;\n  var MAX_SIZE_EXCEEDED = 5;\n  var BAD_FILE_TYPE = 6;\n  var NO_CORS_IE = 7;\n  var CORRUPTED_IMAGE = 8;\n\n  var error_messages = {};\n  error_messages[BAD_LINK] = 'Image cannot be loaded from the passed link.',\n    error_messages[MISSING_LINK] = 'No link in upload response.',\n    error_messages[ERROR_DURING_UPLOAD] = 'Error during file upload.',\n    error_messages[BAD_RESPONSE] = 'Parsing response failed.',\n    error_messages[MAX_SIZE_EXCEEDED] = 'File is too large.',\n    error_messages[BAD_FILE_TYPE] = 'Image file type is invalid.',\n    error_messages[NO_CORS_IE] = 'Files can be uploaded only to same domain in IE 8 and IE 9.'\n  error_messages[CORRUPTED_IMAGE] = 'Image file is corrupted.'\n\n  /**\n   * Refresh the image insert popup.\n   */\n\n  function _refreshInsertPopup() {\n    var $popup = editor.popups.get('image.insert');\n\n    var $url_input = $popup.find('.fr-image-by-url-layer input');\n    $url_input.val('');\n\n    if ($current_image) {\n      $url_input.val($current_image.attr('src'));\n    }\n\n    $url_input.trigger('change');\n  }\n\n  /**\n   * Show the image upload popup.\n   */\n\n  function showInsertPopup() {\n    var $btn = editor.$tb.find('.fr-command[data-cmd=\"insertImage\"]');\n\n    var $popup = editor.popups.get('image.insert');\n\n    if (!$popup) $popup = _initInsertPopup();\n    hideProgressBar();\n\n    if (!$popup.hasClass('fr-active')) {\n      editor.popups.refresh('image.insert');\n      editor.popups.setContainer('image.insert', editor.$tb);\n\n      if ($btn.isVisible()) {\n        var left = $btn.offset().left + $btn.outerWidth() / 2;\n        var top = $btn.offset().top + (editor.opts.toolbarBottom ? 10 : $btn.outerHeight() - 10);\n        editor.popups.show('image.insert', left, top, $btn.outerHeight());\n      }\n      else {\n        editor.position.forSelection($popup);\n        editor.popups.show('image.insert');\n      }\n    }\n  }\n\n  /**\n   * Show the image edit popup.\n   */\n\n  function _showEditPopup() {\n    var $popup = editor.popups.get('image.edit');\n\n    if (!$popup) $popup = _initEditPopup();\n\n    if ($popup) {\n      var $el = getEl();\n\n      if (hasCaption()) {\n        $el = $el.find('.fr-img-wrap');\n      }\n\n      editor.popups.setContainer('image.edit', editor.$sc);\n      editor.popups.refresh('image.edit');\n      var left = $el.offset().left + $el.outerWidth() / 2;\n      var top = $el.offset().top + $el.outerHeight();\n\n      editor.popups.show('image.edit', left, top, $el.outerHeight());\n    }\n  }\n\n  /**\n   * Hide image upload popup.\n   */\n\n  function _hideInsertPopup() {\n    hideProgressBar();\n  }\n\n  /**\n   * Convert style to classes.\n   */\n  function _convertStyleToClasses($img) {\n    if ($img.parents('.fr-img-caption').length > 0) {\n      $img = $img.parents('.fr-img-caption').first();\n    }\n\n    if (!$img.hasClass('fr-dii') && !$img.hasClass('fr-dib')) {\n      $img.addClass('fr-fi' + getAlign($img)[0]);\n      $img.addClass('fr-di' + getDisplay($img)[0]);\n\n      // Reset inline style.\n      $img.css('margin', '');\n      $img.css('float', '');\n      $img.css('display', '');\n      $img.css('z-index', '');\n      $img.css('position', '');\n      $img.css('overflow', '');\n      $img.css('vertical-align', '');\n    }\n  }\n\n  /**\n   * Convert classes to style.\n   */\n  function _convertClassesToStyle($img) {\n    if ($img.parents('.fr-img-caption').length > 0) {\n      $img = $img.parents('.fr-img-caption').first();\n    }\n\n    var d = $img.hasClass('fr-dib') ? 'block' : $img.hasClass('fr-dii') ? 'inline' : null;\n    var a = $img.hasClass('fr-fil') ? 'left' : $img.hasClass('fr-fir') ? 'right' : getAlign($img);\n\n    _setStyle($img, d, a);\n\n    $img.removeClass('fr-dib fr-dii fr-fir fr-fil');\n  }\n\n  /**\n   * Refresh the image list.\n   */\n  function _refreshImageList() {\n    var images = editor.el.tagName == 'IMG' ? [editor.el] : editor.el.querySelectorAll('img');\n\n    for (var i = 0; i < images.length; i++) {\n      var $img = $(images[i]);\n\n      if (!editor.opts.htmlUntouched && editor.opts.useClasses) {\n        if (editor.opts.imageDefaultAlign || editor.opts.imageDefaultDisplay) {\n          _convertStyleToClasses($img);\n        }\n\n        // Do not allow text near image.\n        if (!editor.opts.imageTextNear) {\n          if ($img.parents('.fr-img-caption').length > 0) {\n            $img.parents('.fr-img-caption').first().removeClass('fr-dii').addClass('fr-dib');\n          }\n          else {\n            $img.removeClass('fr-dii').addClass('fr-dib');\n          }\n        }\n      }\n      else if (!editor.opts.htmlUntouched && !editor.opts.useClasses) {\n        if (editor.opts.imageDefaultAlign || editor.opts.imageDefaultDisplay) {\n          _convertClassesToStyle($img);\n        }\n      }\n\n      if (editor.opts.iframe) {\n        $img.on('load', editor.size.syncIframe);\n      }\n    }\n  }\n\n  /**\n   * Keep images in sync when content changed.\n   */\n  var images;\n\n  function _syncImages(loaded) {\n\n    if (typeof loaded === 'undefined') loaded = true;\n\n    // Get current images.\n    var c_images = Array.prototype.slice.call(editor.el.querySelectorAll('img'));\n\n    // Current images src.\n    var image_srcs = [];\n    var i;\n\n    for (i = 0; i < c_images.length; i++) {\n      image_srcs.push(c_images[i].getAttribute('src'));\n\n      $(c_images[i]).toggleClass('fr-draggable', editor.opts.imageMove);\n\n      if (c_images[i].getAttribute('class') === '') c_images[i].removeAttribute('class');\n\n      if (c_images[i].getAttribute('style') === '') c_images[i].removeAttribute('style');\n\n      if (c_images[i].parentNode && c_images[i].parentNode.parentNode && editor.node.hasClass(c_images[i].parentNode.parentNode, 'fr-img-caption')) {\n        var p_node = c_images[i].parentNode.parentNode;\n\n        if (!editor.browser.mozilla) {\n          p_node.setAttribute('contenteditable', false);\n        }\n\n        p_node.setAttribute('draggable', false);\n        p_node.classList.add('fr-draggable');\n\n        var n_node = c_images[i].nextSibling;\n\n        if (n_node) {\n          n_node.setAttribute('contenteditable', true);\n        }\n      }\n    }\n\n    // Loop previous images and check their src.\n    if (images) {\n      for (i = 0; i < images.length; i++) {\n        if (image_srcs.indexOf(images[i].getAttribute('src')) < 0) {\n          editor.events.trigger('image.removed', [$(images[i])]);\n        }\n      }\n    }\n\n    // Loop new images and see which were not int the old ones.\n    if (images && loaded) {\n      var old_images_srcs = [];\n\n      for (i = 0; i < images.length; i++) {\n        old_images_srcs.push(images[i].getAttribute('src'));\n      }\n\n      for (i = 0; i < c_images.length; i++) {\n        if (old_images_srcs.indexOf(c_images[i].getAttribute('src')) < 0) {\n          editor.events.trigger('image.loaded', [$(c_images[i])]);\n        }\n      }\n    }\n\n    // Current images are the old ones.\n    images = c_images;\n  }\n\n  /**\n   * Reposition resizer.\n   */\n\n  function _repositionResizer() {\n    if (!$image_resizer) _initImageResizer();\n\n    if (!$current_image) return false;\n\n    var $container = editor.$wp || editor.$sc;\n\n    $container.append($image_resizer);\n    $image_resizer.data('instance', editor);\n\n    var wrap_correction_top = $container.scrollTop() - (($container.css('position') != 'static' ? $container.offset().top : 0));\n    var wrap_correction_left = $container.scrollLeft() - (($container.css('position') != 'static' ? $container.offset().left : 0));\n\n    wrap_correction_left -= editor.helpers.getPX($container.css('border-left-width'));\n    wrap_correction_top -= editor.helpers.getPX($container.css('border-top-width'));\n\n    if (editor.$el.is('img') && editor.$sc.is('body')) {\n      wrap_correction_top = 0;\n      wrap_correction_left = 0;\n    }\n\n    var $el = getEl();\n\n    if (hasCaption()) {\n      $el = $el.find('.fr-img-wrap');\n    }\n\n    $image_resizer\n      .css('top', (editor.opts.iframe ? $el.offset().top : $el.offset().top + wrap_correction_top) - 1)\n      .css('left', (editor.opts.iframe ? $el.offset().left : $el.offset().left + wrap_correction_left) - 1)\n      .css('width', $el.get(0).getBoundingClientRect().width)\n      .css('height', $el.get(0).getBoundingClientRect().height)\n      .addClass('fr-active');\n  }\n\n  /**\n   * Create resize handler.\n   */\n\n  function _getHandler(pos) {\n\n    return '<div class=\"fr-handler fr-h' + pos + '\"></div>';\n  }\n\n  /**\n   * Set the image with\n   */\n  function _setWidth(width) {\n    if (hasCaption()) {\n      $current_image.parents('.fr-img-caption').css('width', width);\n    }\n    else {\n      $current_image.css('width', width);\n    }\n  }\n\n  /**\n   * Mouse down to start resize.\n   */\n  function _handlerMousedown(e) {\n    // Check if resizer belongs to current instance.\n    if (!editor.core.sameInstance($image_resizer)) return true;\n\n    e.preventDefault();\n    e.stopPropagation();\n\n    if (editor.$el.find('img.fr-error').left) return false;\n\n    if (!editor.undo.canDo()) editor.undo.saveStep();\n\n    // Get offset.\n    var start_x = e.pageX || e.originalEvent.touches[0].pageX;\n\n    // Only on mousedown. This function could be called from keydown on accessibility.\n    if (e.type == 'mousedown') {\n      // See if the entire editor is inside iframe to adjust starting offset.\n      var oel = editor.$oel.get(0);\n      var doc = oel.ownerDocument;\n      var win = doc.defaultView || doc.parentWindow;\n      var editor_inside_iframe = false;\n\n      try {\n        editor_inside_iframe = (win.location != win.parent.location && !(win.$ && win.FE));\n      }\n      catch (ex) {}\n\n      if (editor_inside_iframe && win.frameElement) {\n        start_x += editor.helpers.getPX($(win.frameElement).offset().left) + win.frameElement.clientLeft;\n      }\n    }\n\n    $handler = $(this);\n    $handler.data('start-x', start_x);\n    $handler.data('start-width', $current_image.width());\n    $handler.data('start-height', $current_image.height());\n\n    // Set current width.\n    var width = $current_image.width();\n\n    // Update width value if resizing with percent.\n    if (editor.opts.imageResizeWithPercent) {\n      var p_node = $current_image.parentsUntil(editor.$el, editor.html.blockTagsQuery()).get(0) || editor.el;\n      width = (width / $(p_node).outerWidth() * 100).toFixed(2) + '%';\n    }\n\n    // Set the image width.\n    _setWidth(width);\n\n    $overlay.show();\n\n    editor.popups.hideAll();\n\n    _unmarkExit();\n  }\n\n  /**\n   * Do resize.\n   */\n  function _handlerMousemove(e) {\n    // Check if resizer belongs to current instance.\n    if (!editor.core.sameInstance($image_resizer)) return true;\n    var real_image_size;\n\n    if ($handler && $current_image) {\n      e.preventDefault()\n\n      if (editor.$el.find('img.fr-error').left) return false;\n\n      var c_x = e.pageX || (e.originalEvent.touches ? e.originalEvent.touches[0].pageX : null);\n\n      if (!c_x) return false;\n\n      var s_x = $handler.data('start-x');\n      var diff_x = c_x - s_x;\n      var width = $handler.data('start-width');\n\n      if ($handler.hasClass('fr-hnw') || $handler.hasClass('fr-hsw')) {\n        diff_x = 0 - diff_x;\n      }\n\n      if (editor.opts.imageResizeWithPercent) {\n        var p_node = $current_image.parentsUntil(editor.$el, editor.html.blockTagsQuery()).get(0) || editor.el;\n        width = ((width + diff_x) / $(p_node).outerWidth() * 100).toFixed(2);\n\n        if (editor.opts.imageRoundPercent) width = Math.round(width);\n\n        // Set the image width.\n        _setWidth(width + '%')\n\n        // Get the real image width after resize.\n        if (hasCaption()) {\n          real_image_size = (editor.helpers.getPX($current_image.parents('.fr-img-caption').css('width')) / $(p_node).outerWidth() * 100).toFixed(2);\n        }\n        else {\n          real_image_size = (editor.helpers.getPX($current_image.css('width')) / $(p_node).outerWidth() * 100).toFixed(2);\n        }\n\n        // If the width is not contained within editor use the real image size.\n        if (real_image_size !== width && !editor.opts.imageRoundPercent) {\n          _setWidth(real_image_size + '%')\n        }\n\n        $current_image.css('height', '').removeAttr('height');\n      }\n\n      else {\n        if (width + diff_x >= editor.opts.imageMinWidth) {\n          // Set width for image parent node as well.\n          _setWidth(width + diff_x)\n\n          // Get the real image width after resize.\n          if (hasCaption()) {\n            real_image_size = editor.helpers.getPX($current_image.parents('.fr-img-caption').css('width'));\n          }\n          else {\n            real_image_size = editor.helpers.getPX($current_image.css('width'));\n          }\n        }\n\n        // If the width is not contained within editor use the real image size.\n        if (real_image_size !== width + diff_x) {\n          _setWidth(real_image_size)\n        }\n\n        // https://github.com/froala/wysiwyg-editor/issues/1963.\n        if (($current_image.attr('style') || '').match(/(^height:)|(; *height:)/) || $current_image.attr('height')) {\n          $current_image.css('height', $handler.data('start-height') * $current_image.width() / $handler.data('start-width'));\n          $current_image.removeAttr('height');\n        }\n      }\n\n      _repositionResizer();\n\n      editor.events.trigger('image.resize', [get()]);\n    }\n  }\n\n  /**\n   * Stop resize.\n   */\n\n  function _handlerMouseup(e) {\n\n    // Check if resizer belongs to current instance.\n    if (!editor.core.sameInstance($image_resizer)) return true;\n\n    if ($handler && $current_image) {\n      if (e) e.stopPropagation();\n\n      if (editor.$el.find('img.fr-error').left) return false;\n\n      $handler = null;\n      $overlay.hide();\n      _repositionResizer();\n      _showEditPopup();\n\n      editor.undo.saveStep();\n\n      editor.events.trigger('image.resizeEnd', [get()]);\n    }\n  }\n\n  /**\n   * Throw an image error.\n   */\n\n  function _throwError(code, response, $img) {\n    editor.edit.on();\n\n    if ($current_image) $current_image.addClass('fr-error');\n    _showErrorMessage(editor.language.translate('Something went wrong. Please try again.'));\n\n    // Remove image if it exists.\n    if (!$current_image && $img) remove($img);\n\n    editor.events.trigger('image.error', [{\n        code: code,\n        message: error_messages[code]\n      },\n      response,\n      $img\n    ]);\n  }\n\n  /**\n   * Init the image edit popup.\n   */\n\n  function _initEditPopup(delayed) {\n    if (delayed) {\n      if (editor.$wp) {\n        editor.events.$on(editor.$wp, 'scroll', function () {\n          if ($current_image && editor.popups.isVisible('image.edit')) {\n            editor.events.disableBlur();\n            _editImg($current_image);\n          }\n        });\n      }\n\n      return true;\n    }\n\n    // Image buttons.\n    var image_buttons = '';\n\n    if (editor.opts.imageEditButtons.length > 0) {\n      image_buttons += '<div class=\"fr-buttons\">';\n      image_buttons += editor.button.buildList(editor.opts.imageEditButtons);\n      image_buttons += '</div>';\n\n      var template = {\n        buttons: image_buttons\n      };\n\n      var $popup = editor.popups.create('image.edit', template);\n\n      return $popup;\n    }\n\n    return false;\n  }\n\n  /**\n   * Show progress bar.\n   */\n\n  function showProgressBar(no_message) {\n    var $popup = editor.popups.get('image.insert');\n\n    if (!$popup) $popup = _initInsertPopup();\n\n    $popup.find('.fr-layer.fr-active').removeClass('fr-active').addClass('fr-pactive');\n    $popup.find('.fr-image-progress-bar-layer').addClass('fr-active');\n    $popup.find('.fr-buttons').hide();\n\n    if ($current_image) {\n      var $el = getEl();\n\n      editor.popups.setContainer('image.insert', editor.$sc);\n      var left = $el.offset().left + $el.width() / 2;\n      var top = $el.offset().top + $el.height();\n\n      editor.popups.show('image.insert', left, top, $el.outerHeight());\n    }\n\n    if (typeof no_message == 'undefined') {\n      _setProgressMessage(editor.language.translate('Uploading'), 0);\n    }\n  }\n\n  /**\n   * Hide progress bar.\n   */\n  function hideProgressBar(dismiss) {\n    var $popup = editor.popups.get('image.insert');\n\n    if ($popup) {\n      $popup.find('.fr-layer.fr-pactive').addClass('fr-active').removeClass('fr-pactive');\n      $popup.find('.fr-image-progress-bar-layer').removeClass('fr-active');\n      $popup.find('.fr-buttons').show();\n\n      // Dismiss error message.\n      if (dismiss || editor.$el.find('img.fr-error').length) {\n        editor.events.focus();\n\n        if (editor.$el.find('img.fr-error').length) {\n          editor.$el.find('img.fr-error').remove();\n          editor.undo.saveStep();\n          editor.undo.run();\n          editor.undo.dropRedo();\n        }\n\n        if (!editor.$wp && $current_image) {\n          var $img = $current_image;\n          _exitEdit(true);\n          editor.selection.setAfter($img.get(0));\n          editor.selection.restore();\n        }\n        editor.popups.hide('image.insert');\n      }\n    }\n  }\n\n  /**\n   * Set a progress message.\n   */\n\n  function _setProgressMessage(message, progress) {\n    var $popup = editor.popups.get('image.insert');\n\n    if ($popup) {\n      var $layer = $popup.find('.fr-image-progress-bar-layer');\n      $layer.find('h3').text(message + (progress ? ' ' + progress + '%' : ''));\n\n      $layer.removeClass('fr-error');\n\n      if (progress) {\n        $layer.find('div').removeClass('fr-indeterminate');\n        $layer.find('div > span').css('width', progress + '%');\n      }\n      else {\n        $layer.find('div').addClass('fr-indeterminate');\n      }\n    }\n  }\n\n  /**\n   * Show error message to the user.\n   */\n\n  function _showErrorMessage(message) {\n    showProgressBar();\n    var $popup = editor.popups.get('image.insert');\n    var $layer = $popup.find('.fr-image-progress-bar-layer');\n    $layer.addClass('fr-error');\n    var $message_header = $layer.find('h3');\n    $message_header.text(message);\n    editor.events.disableBlur();\n    $message_header.focus();\n  }\n\n  /**\n   * Insert image using URL callback.\n   */\n\n  function insertByURL() {\n    var $popup = editor.popups.get('image.insert');\n    var $input = $popup.find('.fr-image-by-url-layer input');\n\n    if ($input.val().length > 0) {\n      showProgressBar();\n      _setProgressMessage(editor.language.translate('Loading image'));\n\n      var img_url = $input.val();\n\n      // Upload images if we should upload them.\n      if (editor.opts.imageUploadRemoteUrls && editor.opts.imageCORSProxy && editor.opts.imageUpload) {\n        var xhr = new XMLHttpRequest();\n        xhr.onload = function () {\n\n          if (this.status == 200) {\n\n            upload([new Blob([this.response], {\n              type: this.response.type || 'image/png'\n            })], $current_image);\n          }\n          else {\n            _throwError(BAD_LINK);\n          }\n        };\n\n        // If image couldn't be uploaded, insert as it is.\n        xhr.onerror = function () {\n          insert(img_url, true, [], $current_image);\n        }\n\n        xhr.open('GET', editor.opts.imageCORSProxy + '/' + img_url, true);\n        xhr.responseType = 'blob';\n\n        xhr.send();\n      }\n\n      else {\n        insert(img_url, true, [], $current_image);\n      }\n\n      $input.val('');\n      $input.blur();\n    }\n  }\n\n  function _editImg($img) {\n    _edit.call($img.get(0));\n  }\n\n  function _loadedCallback() {\n    var $img = $(this);\n\n    editor.popups.hide('image.insert');\n\n    $img.removeClass('fr-uploading');\n\n    // Select the image.\n    if ($img.next().is('br')) {\n      $img.next().remove();\n    }\n\n    _editImg($img);\n\n    editor.events.trigger('image.loaded', [$img]);\n  }\n\n  /**\n   * Insert image into the editor.\n   */\n\n  function insert(link, sanitize, data, $existing_img, response) {\n    editor.edit.off();\n    _setProgressMessage(editor.language.translate('Loading image'));\n\n    if (sanitize) link = editor.helpers.sanitizeURL(link);\n\n    var image = new Image();\n\n    image.onload = function () {\n      var $img;\n      var attr;\n\n      if ($existing_img) {\n        if (!editor.undo.canDo() && !$existing_img.hasClass('fr-uploading')) editor.undo.saveStep();\n\n        var old_src = $existing_img.data('fr-old-src');\n\n        if ($existing_img.data('fr-image-pasted')) {\n          old_src = null;\n        }\n\n        if (editor.$wp) {\n\n          // Clone existing image.\n          $img = $existing_img.clone()\n            .removeData('fr-old-src')\n            .removeClass('fr-uploading')\n            .removeAttr('data-fr-image-pasted');\n\n          // Remove load event.\n          $img.off('load');\n\n          // Set new SRC.\n          if (old_src) $existing_img.attr('src', old_src);\n\n          // Replace existing image with its clone.\n          $existing_img.replaceWith($img);\n\n        }\n        else {\n          $img = $existing_img;\n        }\n\n        // Remove old data.\n        var atts = $img.get(0).attributes;\n\n        for (var i = 0; i < atts.length; i++) {\n          var att = atts[i];\n\n          if (att.nodeName.indexOf('data-') === 0) {\n            $img.removeAttr(att.nodeName);\n          }\n        }\n\n        // Set new data.\n        if (typeof data != 'undefined') {\n          for (attr in data) {\n            if (Object.prototype.hasOwnProperty.call(data, attr)) {\n              if (attr != 'link') {\n                $img.attr('data-' + attr, data[attr]);\n              }\n            }\n          }\n        }\n\n        $img.on('load', _loadedCallback);\n        $img.attr('src', link);\n        editor.edit.on();\n        _syncImages(false);\n        editor.undo.saveStep();\n\n        // Cursor will not appear if we don't make blur.\n        editor.events.disableBlur();\n        editor.$el.blur();\n        editor.events.trigger(old_src ? 'image.replaced' : 'image.inserted', [$img, response]);\n      }\n      else {\n        $img = _addImage(link, data, _loadedCallback);\n        _syncImages(false);\n        editor.undo.saveStep();\n\n        // Cursor will not appear if we don't make blur.\n        editor.$el.blur();\n        editor.events.trigger('image.inserted', [$img, response]);\n      }\n    }\n\n    image.onerror = function () {\n      _throwError(BAD_LINK);\n    }\n\n    showProgressBar(editor.language.translate('Loading image'));\n\n    image.src = link;\n  }\n\n  /**\n   * Parse image response.\n   */\n\n  function _parseResponse(response) {\n    try {\n      if (editor.events.trigger('image.uploaded', [response], true) === false) {\n        editor.edit.on();\n\n        return false;\n      }\n      var resp = JSON.parse(response);\n\n      if (resp.link) {\n\n        return resp;\n      }\n      else {\n\n        // No link in upload request.\n        _throwError(MISSING_LINK, response);\n\n        return false;\n      }\n    }\n    catch (ex) {\n\n      // Bad response.\n      _throwError(BAD_RESPONSE, response);\n\n      return false;\n    }\n  }\n\n  /**\n   * Parse image response.\n   */\n\n  function _parseXMLResponse(response) {\n    try {\n      var link = $(response).find('Location').text();\n      var key = $(response).find('Key').text();\n\n      if (editor.events.trigger('image.uploadedToS3', [link, key, response], true) === false) {\n        editor.edit.on();\n\n        return false;\n      }\n\n      return link;\n    }\n    catch (ex) {\n\n      // Bad response.\n      _throwError(BAD_RESPONSE, response);\n\n      return false;\n    }\n  }\n\n  /**\n   * Image was uploaded to the server and we have a response.\n   */\n\n  function _imageUploaded($img) {\n    _setProgressMessage(editor.language.translate('Loading image'));\n    var status = this.status;\n    var response = this.response;\n    var responseXML = this.responseXML;\n    var responseText = this.responseText;\n\n    try {\n      if (editor.opts.imageUploadToS3) {\n        if (status == 201) {\n          var link = _parseXMLResponse(responseXML);\n\n          if (link) {\n            insert(link, false, [], $img, response || responseXML);\n          }\n        }\n        else {\n          _throwError(BAD_RESPONSE, response || responseXML, $img);\n        }\n      }\n      else {\n        if (status >= 200 && status < 300) {\n          var resp = _parseResponse(responseText);\n\n          if (resp) {\n            insert(resp.link, false, resp, $img, response || responseText);\n          }\n        }\n        else {\n          _throwError(ERROR_DURING_UPLOAD, response || responseText, $img);\n        }\n      }\n    }\n    catch (ex) {\n\n      // Bad response.\n      _throwError(BAD_RESPONSE, response || responseText, $img);\n    }\n  }\n\n  /**\n   * Image upload error.\n   */\n\n  function _imageUploadError() {\n    _throwError(BAD_RESPONSE, this.response || this.responseText || this.responseXML);\n  }\n\n  /**\n   * Image upload progress.\n   */\n\n  function _imageUploadProgress(e) {\n    if (e.lengthComputable) {\n      var complete = (e.loaded / e.total * 100 | 0);\n      _setProgressMessage(editor.language.translate('Uploading'), complete);\n    }\n  }\n\n  function _addImage(link, data, loadCallback) {\n\n    // Build image data string.\n    var data_str = '';\n    var attr;\n\n    if (data && typeof data != 'undefined') {\n      for (attr in data) {\n        if (Object.prototype.hasOwnProperty.call(data, attr)) {\n          if (attr != 'link') {\n            data_str += ' data-' + attr + '=\"' + data[attr] + '\"';\n          }\n        }\n      }\n    }\n\n    var width = editor.opts.imageDefaultWidth;\n\n    if (width && width != 'auto') {\n      width = width + (editor.opts.imageResizeWithPercent ? '%' : 'px');\n    }\n\n    // Create image object and set the load event.\n    var $img = $('<img src=\"' + link + '\"' + data_str + (width ? ' style=\"width: ' + width + ';\"' : '') + '>');\n    _setStyle($img, editor.opts.imageDefaultDisplay, editor.opts.imageDefaultAlign);\n\n    $img.on('load', loadCallback);\n    $img.on('error', function () {\n      $(this).addClass('fr-error');\n      _throwError(CORRUPTED_IMAGE);\n    })\n\n    // Make sure we have focus.\n    // Call the event.\n    editor.edit.on();\n    editor.events.focus(true);\n    editor.selection.restore();\n    editor.undo.saveStep();\n\n    // Insert marker and then replace it with the image.\n    if (editor.opts.imageSplitHTML) {\n      editor.markers.split();\n    }\n    else {\n      editor.markers.insert();\n    }\n\n    editor.html.wrap();\n    var $marker = editor.$el.find('.fr-marker');\n\n    if ($marker.length) {\n\n      // Do not insert image in HR.\n      if ($marker.parent().is('hr')) {\n        $marker.parent().after($marker);\n      }\n\n      // Do not insert image inside emoticon.\n      if (editor.node.isLastSibling($marker) && $marker.parent().hasClass('fr-deletable')) {\n\n        $marker.insertAfter($marker.parent());\n      }\n\n      $marker.replaceWith($img);\n    }\n    else {\n      editor.$el.append($img);\n    }\n\n    editor.selection.clear();\n\n    return $img;\n  }\n\n  /**\n   * Image upload aborted.\n   */\n  function _imageUploadAborted() {\n    editor.edit.on();\n    hideProgressBar(true);\n  }\n\n  /**\n   * Start the uploading process.\n   */\n  function _startUpload(xhr, form_data, image, $image_placeholder) {\n    function _sendRequest() {\n      var $img = $(this);\n      $img.off('load');\n      $img.addClass('fr-uploading');\n\n      if ($img.next().is('br')) {\n        $img.next().remove();\n      }\n\n      editor.placeholder.refresh();\n\n      // Select the image.\n      _editImg($img);\n      _repositionResizer();\n      showProgressBar();\n      editor.edit.off();\n\n      // Set upload events.\n      xhr.onload = function () {\n        _imageUploaded.call(xhr, $img);\n      };\n      xhr.onerror = _imageUploadError;\n      xhr.upload.onprogress = _imageUploadProgress;\n      xhr.onabort = _imageUploadAborted;\n\n      // Set abort event.\n      $img.off('abortUpload').on('abortUpload', function () {\n        if (xhr.readyState != 4) {\n          xhr.abort();\n        }\n      });\n\n      // Send data.\n      xhr.send(form_data);\n    }\n\n    var reader = new FileReader();\n    var $img;\n\n    reader.addEventListener('load', function () {\n      var link = reader.result;\n\n      if (reader.result.indexOf('svg+xml') < 0) {\n\n        // Convert image to local blob.\n        var binary = atob(reader.result.split(',')[1]);\n        var array = [];\n\n        for (var i = 0; i < binary.length; i++) {\n          array.push(binary.charCodeAt(i));\n        }\n\n        // Get local image link.\n        link = window.URL.createObjectURL(new Blob([new Uint8Array(array)], {\n          type: 'image/jpeg'\n        }));\n      }\n\n      // No image.\n      if (!$image_placeholder) {\n        $img = _addImage(link, null, _sendRequest);\n      }\n      else {\n        $image_placeholder.on('load', _sendRequest);\n        $image_placeholder.on('error', function () {\n          $image_placeholder.off('load');\n          $image_placeholder.attr('src', $image_placeholder.data('fr-old-src'));\n          _throwError(CORRUPTED_IMAGE);\n        })\n        editor.edit.on();\n        editor.undo.saveStep();\n        $image_placeholder.data('fr-old-src', $image_placeholder.attr('src'));\n        $image_placeholder.attr('src', link);\n      }\n    }, false);\n\n    reader.readAsDataURL(image);\n  }\n\n  /**\n   * Do image upload.\n   */\n\n  function upload(images, $image_placeholder) {\n\n    // Make sure we have what to upload.\n    if (typeof images != 'undefined' && images.length > 0) {\n\n      // Check if we should cancel the image upload.\n      if (editor.events.trigger('image.beforeUpload', [images, $image_placeholder]) === false) {\n\n        return false;\n      }\n      var image = images[0];\n\n      // Check if there is image name set.\n      if (!image.name) {\n        image.name = (new Date()).getTime() + '.' + (image.type || 'image/jpeg').replace(/image\\//g, '')\n      }\n\n      // Check image max size.\n      if (image.size > editor.opts.imageMaxSize) {\n        _throwError(MAX_SIZE_EXCEEDED);\n\n        return false;\n      }\n\n      // Check image types.\n      if (editor.opts.imageAllowedTypes.indexOf(image.type.replace(/image\\//g, '')) < 0) {\n        _throwError(BAD_FILE_TYPE);\n\n        return false;\n      }\n\n      // Create form Data.\n      var form_data;\n\n      if (editor.drag_support.formdata) {\n        form_data = editor.drag_support.formdata ? new FormData() : null;\n      }\n\n      // Prepare form data for request.\n      if (form_data) {\n        var key;\n\n        // Upload to S3.\n        if (editor.opts.imageUploadToS3 !== false) {\n          form_data.append('key', editor.opts.imageUploadToS3.keyStart + (new Date()).getTime() + '-' + (image.name || 'untitled'));\n          form_data.append('success_action_status', '201');\n          form_data.append('X-Requested-With', 'xhr');\n          form_data.append('Content-Type', image.type);\n\n          for (key in editor.opts.imageUploadToS3.params) {\n            if (Object.prototype.hasOwnProperty.call(editor.opts.imageUploadToS3.params, key)) {\n              form_data.append(key, editor.opts.imageUploadToS3.params[key]);\n            }\n          }\n        }\n\n        // Add upload params.\n        for (key in editor.opts.imageUploadParams) {\n          if (Object.prototype.hasOwnProperty.call(editor.opts.imageUploadParams, key)) {\n            form_data.append(key, editor.opts.imageUploadParams[key]);\n          }\n        }\n\n        // Set the image in the request.\n        form_data.append(editor.opts.imageUploadParam, image, image.name);\n\n        // Create XHR request.\n        var url = editor.opts.imageUploadURL;\n\n        if (editor.opts.imageUploadToS3) {\n          if (editor.opts.imageUploadToS3.uploadURL) {\n            url = editor.opts.imageUploadToS3.uploadURL;\n          }\n          else {\n            url = 'https://' + editor.opts.imageUploadToS3.region + '.amazonaws.com/' + editor.opts.imageUploadToS3.bucket;\n          }\n        }\n        var xhr = editor.core.getXHR(url, editor.opts.imageUploadMethod);\n        _startUpload(xhr, form_data, image, $image_placeholder || $current_image);\n      }\n    }\n  }\n\n  /**\n   * Image drop inside the upload zone.\n   */\n\n  function _bindInsertEvents($popup) {\n\n    // Drag over the dropable area.\n    editor.events.$on($popup, 'dragover dragenter', '.fr-image-upload-layer', function () {\n      $(this).addClass('fr-drop');\n\n      return false;\n    }, true);\n\n    // Drag end.\n    editor.events.$on($popup, 'dragleave dragend', '.fr-image-upload-layer', function () {\n      $(this).removeClass('fr-drop');\n\n      return false;\n    }, true);\n\n    // Drop.\n    editor.events.$on($popup, 'drop', '.fr-image-upload-layer', function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      $(this).removeClass('fr-drop');\n      var dt = e.originalEvent.dataTransfer;\n\n      if (dt && dt.files) {\n        var inst = $popup.data('instance') || editor;\n        inst.events.disableBlur();\n        inst.image.upload(dt.files);\n        inst.events.enableBlur();\n      }\n    }, true);\n\n    if (editor.helpers.isIOS()) {\n      editor.events.$on($popup, 'touchstart', '.fr-image-upload-layer input[type=\"file\"]', function () {\n        $(this).trigger('click');\n      }, true);\n    }\n\n    editor.events.$on($popup, 'change', '.fr-image-upload-layer input[type=\"file\"]', function () {\n      if (this.files) {\n        var inst = $popup.data('instance') || editor;\n\n        inst.events.disableBlur();\n        $popup.find('input:focus').blur();\n        inst.events.enableBlur();\n\n        inst.image.upload(this.files, $current_image);\n      }\n\n      // Else IE 9 case.\n      // Chrome fix.\n      $(this).val('');\n    }, true);\n  }\n\n  function _beforeElementDrop($el) {\n    if ($el.is('img') && $el.parents('.fr-img-caption').length > 0) {\n      return $el.parents('.fr-img-caption');\n    }\n  }\n\n  function _drop(e) {\n\n    // Check if we are dropping files.\n    var dt = e.originalEvent.dataTransfer;\n\n    if (dt && dt.files && dt.files.length) {\n      var img = dt.files[0];\n\n      if (img && img.type && img.type.indexOf('image') !== -1 && editor.opts.imageAllowedTypes.indexOf(img.type.replace(/image\\//g, '')) >= 0) {\n        if (!editor.opts.imageUpload) {\n          e.preventDefault();\n          e.stopPropagation();\n\n          return false;\n        }\n\n        editor.markers.remove();\n        editor.markers.insertAtPoint(e.originalEvent);\n\n        editor.$el.find('.fr-marker').replaceWith(FE.MARKERS);\n\n        if (editor.$el.find('.fr-marker').length === 0) {\n          editor.selection.setAtEnd(editor.el);\n        }\n\n        // Hide popups.\n        editor.popups.hideAll();\n\n        // Show the image insert popup.\n        var $popup = editor.popups.get('image.insert');\n\n        if (!$popup) $popup = _initInsertPopup();\n        editor.popups.setContainer('image.insert', editor.$sc);\n\n        var left = e.originalEvent.pageX;\n        var top = e.originalEvent.pageY;\n\n        if (editor.opts.iframe) {\n          top += editor.$iframe.offset().top;\n          left += editor.$iframe.offset().left;\n        }\n\n        editor.popups.show('image.insert', left, top);\n        showProgressBar();\n\n        // Dropped file is an image that we allow.\n        if (editor.opts.imageAllowedTypes.indexOf(img.type.replace(/image\\//g, '')) >= 0) {\n\n          // Image might be selected.\n          _exitEdit(true);\n\n          // Upload images.\n          upload(dt.files);\n        }\n        else {\n          _throwError(BAD_FILE_TYPE);\n        }\n\n        // Cancel anything else.\n        e.preventDefault();\n        e.stopPropagation();\n\n        return false;\n      }\n    }\n  }\n\n  function _initEvents() {\n\n    // Mouse down on image. It might start move.\n    editor.events.$on(editor.$el, editor._mousedown, editor.el.tagName == 'IMG' ? null : 'img:not([contenteditable=\"false\"])', function (e) {\n      if ($(this).parents('[contenteditable]:not(.fr-element):not(.fr-img-caption):not(body)').first().attr('contenteditable') == 'false') return true;\n\n      if (!editor.helpers.isMobile()) editor.selection.clear();\n\n      mousedown = true;\n\n      if (editor.popups.areVisible()) editor.events.disableBlur();\n\n      // Prevent the image resizing.\n      if (editor.browser.msie) {\n        editor.events.disableBlur();\n        editor.$el.attr('contenteditable', false);\n      }\n\n      if (!editor.draggable && e.type != 'touchstart') e.preventDefault();\n\n      e.stopPropagation();\n    });\n\n    // Mouse up on an image prevent move.\n    editor.events.$on(editor.$el, editor._mouseup, editor.el.tagName == 'IMG' ? null : 'img:not([contenteditable=\"false\"])', function (e) {\n      if ($(this).parents('[contenteditable]:not(.fr-element):not(.fr-img-caption):not(body)').first().attr('contenteditable') == 'false') return true;\n\n      if (mousedown) {\n        mousedown = false;\n\n        // Remove moving class.\n        e.stopPropagation();\n\n        if (editor.browser.msie) {\n          editor.$el.attr('contenteditable', true);\n          editor.events.enableBlur();\n        }\n      }\n    });\n\n    // Show image popup when it was selected.\n    editor.events.on('keyup', function (e) {\n      if (e.shiftKey && editor.selection.text().replace(/\\n/g, '') === '' && editor.keys.isArrow(e.which)) {\n        var s_el = editor.selection.element();\n        var e_el = editor.selection.endElement();\n\n        if (s_el && s_el.tagName == 'IMG') {\n          _editImg($(s_el));\n        }\n        else if (e_el && e_el.tagName == 'IMG') {\n          _editImg($(e_el));\n        }\n      }\n    }, true);\n\n    // Drop inside the editor.\n    editor.events.on('drop', _drop);\n    editor.events.on('element.beforeDrop', _beforeElementDrop);\n\n    editor.events.on('mousedown window.mousedown', _markExit);\n    editor.events.on('window.touchmove', _unmarkExit);\n\n    editor.events.on('mouseup window.mouseup', function () {\n      if ($current_image) {\n        _exitEdit();\n\n        return false;\n      }\n\n      _unmarkExit();\n    });\n    editor.events.on('commands.mousedown', function ($btn) {\n      if ($btn.parents('.fr-toolbar').length > 0) {\n        _exitEdit();\n      }\n    });\n\n    editor.events.on('blur image.hideResizer commands.undo commands.redo element.dropped', function () {\n      mousedown = false;\n      _exitEdit(true);\n    });\n\n    editor.events.on('modals.hide', function () {\n      if ($current_image) {\n        _selectImage();\n        editor.selection.clear();\n      }\n    });\n  }\n\n  /**\n   * Init the image upload popup.\n   */\n\n  function _initInsertPopup(delayed) {\n    if (delayed) {\n      editor.popups.onRefresh('image.insert', _refreshInsertPopup);\n      editor.popups.onHide('image.insert', _hideInsertPopup);\n\n      return true;\n    }\n\n    var active;\n\n    // Image buttons.\n    var image_buttons = '';\n\n    if (!editor.opts.imageUpload) {\n      editor.opts.imageInsertButtons.splice(editor.opts.imageInsertButtons.indexOf('imageUpload'), 1);\n    }\n\n    if (editor.opts.imageInsertButtons.length > 1) {\n      image_buttons = '<div class=\"fr-buttons\">' + editor.button.buildList(editor.opts.imageInsertButtons) + '</div>';\n    }\n\n    var uploadIndex = editor.opts.imageInsertButtons.indexOf('imageUpload');\n    var urlIndex = editor.opts.imageInsertButtons.indexOf('imageByURL');\n\n    // Image upload layer.\n    var upload_layer = '';\n\n    if (uploadIndex >= 0) {\n      active = ' fr-active';\n\n      if (urlIndex >= 0 && uploadIndex > urlIndex) {\n        active = '';\n      }\n\n      upload_layer = '<div class=\"fr-image-upload-layer' + active + ' fr-layer\" id=\"fr-image-upload-layer-' + editor.id + '\"><strong>' + editor.language.translate('Drop image') + '</strong><br>(' + editor.language.translate('or click') + ')<div class=\"fr-form\"><input type=\"file\" accept=\"image/' + editor.opts.imageAllowedTypes.join(', image/').toLowerCase() + '\" tabIndex=\"-1\" aria-labelledby=\"fr-image-upload-layer-' + editor.id + '\" role=\"button\"></div></div>'\n    }\n\n    // Image by url layer.\n    var by_url_layer = '';\n\n    if (urlIndex >= 0) {\n      active = ' fr-active';\n\n      if (uploadIndex >= 0 && urlIndex > uploadIndex) {\n        active = '';\n      }\n\n      by_url_layer = '<div class=\"fr-image-by-url-layer' + active + ' fr-layer\" id=\"fr-image-by-url-layer-' + editor.id + '\"><div class=\"fr-input-line\"><input id=\"fr-image-by-url-layer-text-' + editor.id + '\" type=\"text\" placeholder=\"http://\" tabIndex=\"1\" aria-required=\"true\"></div><div class=\"fr-action-buttons\"><button type=\"button\" class=\"fr-command fr-submit\" data-cmd=\"imageInsertByURL\" tabIndex=\"2\" role=\"button\">' + editor.language.translate('Insert') + '</button></div></div>'\n    }\n\n    // Progress bar.\n    var progress_bar_layer = '<div class=\"fr-image-progress-bar-layer fr-layer\"><h3 tabIndex=\"-1\" class=\"fr-message\">Uploading</h3><div class=\"fr-loader\"><span class=\"fr-progress\"></span></div><div class=\"fr-action-buttons\"><button type=\"button\" class=\"fr-command fr-dismiss\" data-cmd=\"imageDismissError\" tabIndex=\"2\" role=\"button\">OK</button></div></div>';\n\n    var template = {\n      buttons: image_buttons,\n      upload_layer: upload_layer,\n      by_url_layer: by_url_layer,\n      progress_bar: progress_bar_layer\n    }\n\n    // Set the template in the popup.\n    var $popup = editor.popups.create('image.insert', template);\n\n    if (editor.$wp) {\n      editor.events.$on(editor.$wp, 'scroll', function () {\n        if ($current_image && editor.popups.isVisible('image.insert')) {\n          replace();\n        }\n      });\n    }\n\n    _bindInsertEvents($popup);\n\n    return $popup;\n  }\n\n  /**\n   * Refresh the ALT popup.\n   */\n\n  function _refreshAltPopup() {\n    if ($current_image) {\n      var $popup = editor.popups.get('image.alt');\n      $popup.find('input').val($current_image.attr('alt') || '').trigger('change');\n    }\n  }\n\n  /**\n   * Show the ALT popup.\n   */\n\n  function showAltPopup() {\n    var $popup = editor.popups.get('image.alt');\n\n    if (!$popup) $popup = _initAltPopup();\n    hideProgressBar();\n    editor.popups.refresh('image.alt');\n    editor.popups.setContainer('image.alt', editor.$sc);\n\n    var $el = getEl();\n\n    if (hasCaption()) {\n      $el = $el.find('.fr-img-wrap');\n    }\n\n    var left = $el.offset().left + $el.outerWidth() / 2;\n    var top = $el.offset().top + $el.outerHeight();\n\n    editor.popups.show('image.alt', left, top, $el.outerHeight());\n  }\n\n  /**\n   * Init the image upload popup.\n   */\n\n  function _initAltPopup(delayed) {\n    if (delayed) {\n      editor.popups.onRefresh('image.alt', _refreshAltPopup);\n\n      return true;\n    }\n\n    // Image buttons.\n    var image_buttons = '';\n    image_buttons = '<div class=\"fr-buttons\">' + editor.button.buildList(editor.opts.imageAltButtons) + '</div>';\n\n    // Image by url layer.\n    var alt_layer = '';\n    alt_layer = '<div class=\"fr-image-alt-layer fr-layer fr-active\" id=\"fr-image-alt-layer-' + editor.id + '\"><div class=\"fr-input-line\"><input id=\"fr-image-alt-layer-text-' + editor.id + '\" type=\"text\" placeholder=\"' + editor.language.translate('Alternate Text') + '\" tabIndex=\"1\"></div><div class=\"fr-action-buttons\"><button type=\"button\" class=\"fr-command fr-submit\" data-cmd=\"imageSetAlt\" tabIndex=\"2\" role=\"button\">' + editor.language.translate('Update') + '</button></div></div>'\n\n    var template = {\n      buttons: image_buttons,\n      alt_layer: alt_layer\n    }\n\n    // Set the template in the popup.\n    var $popup = editor.popups.create('image.alt', template);\n\n    if (editor.$wp) {\n      editor.events.$on(editor.$wp, 'scroll.image-alt', function () {\n        if ($current_image && editor.popups.isVisible('image.alt')) {\n          showAltPopup();\n        }\n      });\n    }\n\n    return $popup;\n  }\n\n  /**\n   * Set ALT based on the values from the popup.\n   */\n\n  function setAlt(alt) {\n    if ($current_image) {\n      var $popup = editor.popups.get('image.alt');\n      $current_image.attr('alt', alt || $popup.find('input').val() || '');\n      $popup.find('input:focus').blur();\n      _editImg($current_image);\n    }\n  }\n\n  /**\n   * Refresh the size popup.\n   */\n\n  function _refreshSizePopup() {\n    if ($current_image) {\n      var $popup = editor.popups.get('image.size');\n      $popup.find('input[name=\"width\"]').val($current_image.get(0).style.width).trigger('change');\n      $popup.find('input[name=\"height\"]').val($current_image.get(0).style.height).trigger('change');\n    }\n  }\n\n  /**\n   * Show the size popup.\n   */\n\n  function showSizePopup() {\n    var $popup = editor.popups.get('image.size');\n\n    if (!$popup) $popup = _initSizePopup();\n    hideProgressBar();\n    editor.popups.refresh('image.size');\n    editor.popups.setContainer('image.size', editor.$sc);\n\n    var $el = getEl();\n\n    if (hasCaption()) {\n      $el = $el.find('.fr-img-wrap');\n    }\n\n    var left = $el.offset().left + $el.outerWidth() / 2;\n    var top = $el.offset().top + $el.outerHeight();\n\n    editor.popups.show('image.size', left, top, $el.outerHeight());\n  }\n\n  /**\n   * Init the image upload popup.\n   */\n\n  function _initSizePopup(delayed) {\n    if (delayed) {\n      editor.popups.onRefresh('image.size', _refreshSizePopup);\n\n      return true;\n    }\n\n    // Image buttons.\n    var image_buttons = '';\n    image_buttons = '<div class=\"fr-buttons\">' + editor.button.buildList(editor.opts.imageSizeButtons) + '</div>';\n\n    // Size layer.\n    var size_layer = '';\n    size_layer = '<div class=\"fr-image-size-layer fr-layer fr-active\" id=\"fr-image-size-layer-' + editor.id + '\"><div class=\"fr-image-group\"><div class=\"fr-input-line\"><input id=\"fr-image-size-layer-width-' + editor.id + '\" type=\"text\" name=\"width\" placeholder=\"' + editor.language.translate('Width') + '\" tabIndex=\"1\"></div><div class=\"fr-input-line\"><input id=\"fr-image-size-layer-height' + editor.id + '\" type=\"text\" name=\"height\" placeholder=\"' + editor.language.translate('Height') + '\" tabIndex=\"1\"></div></div><div class=\"fr-action-buttons\"><button type=\"button\" class=\"fr-command fr-submit\" data-cmd=\"imageSetSize\" tabIndex=\"2\" role=\"button\">' + editor.language.translate('Update') + '</button></div></div>'\n\n    var template = {\n      buttons: image_buttons,\n      size_layer: size_layer\n    };\n\n    // Set the template in the popup.\n    var $popup = editor.popups.create('image.size', template);\n\n    if (editor.$wp) {\n      editor.events.$on(editor.$wp, 'scroll.image-size', function () {\n        if ($current_image && editor.popups.isVisible('image.size')) {\n          showSizePopup();\n        }\n      });\n    }\n\n    return $popup;\n  }\n\n  /**\n   * Set size based on the current image size.\n   */\n\n  function setSize(width, height) {\n    if ($current_image) {\n      var $popup = editor.popups.get('image.size');\n      width = width || $popup.find('input[name=\"width\"]').val() || '';\n      height = height || $popup.find('input[name=\"height\"]').val() || '';\n      var regex = /^[\\d]+((px)|%)*$/g;\n\n      $current_image.removeAttr('width').removeAttr('height');\n\n      if (width.match(regex)) $current_image.css('width', width);\n      else $current_image.css('width', '');\n\n      if (height.match(regex)) $current_image.css('height', height);\n      else $current_image.css('height', '');\n\n      if (hasCaption()) {\n        $current_image.parent().removeAttr('width').removeAttr('height');\n\n        if (width.match(regex)) $current_image.parent().css('width', width);\n        else $current_image.parent().css('width', '');\n\n        if (height.match(regex)) $current_image.parent().css('height', height);\n        else $current_image.parent().css('height', '');\n      }\n\n      $popup.find('input:focus').blur();\n      _editImg($current_image);\n    }\n  }\n\n  /**\n   * Show the image upload layer.\n   */\n\n  function showLayer(name) {\n    var $popup = editor.popups.get('image.insert');\n\n    var left;\n    var top;\n\n    // Click on the button from the toolbar without image selected.\n    if (!$current_image && !editor.opts.toolbarInline) {\n      var $btn = editor.$tb.find('.fr-command[data-cmd=\"insertImage\"]');\n      left = $btn.offset().left + $btn.outerWidth() / 2;\n      top = $btn.offset().top + (editor.opts.toolbarBottom ? 10 : $btn.outerHeight() - 10);\n    }\n\n    // Image is selected.\n    else if ($current_image) {\n\n      var $el = getEl();\n\n      if (hasCaption()) {\n        $el = $el.find('.fr-img-wrap');\n      }\n\n      // Set the top to the bottom of the image.\n      top = $el.offset().top + $el.outerHeight();\n      left = $el.offset().left + $el.outerWidth() / 2;\n    }\n\n    // Image is selected and we are in inline mode.\n    if (!$current_image && editor.opts.toolbarInline) {\n\n      // Set top to the popup top.\n      top = $popup.offset().top - editor.helpers.getPX($popup.css('margin-top'));\n\n      // If the popup is above apply height correction.\n      if ($popup.hasClass('fr-above')) {\n        top += $popup.outerHeight();\n      }\n    }\n\n    // Show the new layer.\n    $popup.find('.fr-layer').removeClass('fr-active');\n    $popup.find('.fr-' + name + '-layer').addClass('fr-active');\n\n    editor.popups.show('image.insert', left, top, ($current_image ? $current_image.outerHeight() : 0));\n    editor.accessibility.focusPopup($popup);\n  }\n\n  /**\n   * Refresh the upload image button.\n   */\n\n  function refreshUploadButton($btn) {\n    var $popup = editor.popups.get('image.insert');\n\n    if ($popup.find('.fr-image-upload-layer').hasClass('fr-active')) {\n      $btn.addClass('fr-active').attr('aria-pressed', true);\n    }\n  }\n\n  /**\n   * Refresh the insert by url button.\n   */\n\n  function refreshByURLButton($btn) {\n    var $popup = editor.popups.get('image.insert');\n\n    if ($popup.find('.fr-image-by-url-layer').hasClass('fr-active')) {\n      $btn.addClass('fr-active').attr('aria-pressed', true);\n    }\n  }\n\n  function _resizeImage(e, initPageX, direction, step) {\n    e.pageX = initPageX;\n    _handlerMousedown.call(this, e);\n    e.pageX = e.pageX + direction * Math.floor(Math.pow(1.1, step));\n    _handlerMousemove.call(this, e);\n    _handlerMouseup.call(this, e);\n\n    return ++step;\n  }\n\n  /**\n   * Init image resizer.\n   */\n  function _initImageResizer() {\n    var doc;\n\n    // No shared image resizer.\n    if (!editor.shared.$image_resizer) {\n\n      // Create shared image resizer.\n      editor.shared.$image_resizer = $('<div class=\"fr-image-resizer\"></div>');\n      $image_resizer = editor.shared.$image_resizer;\n\n      // Bind mousedown event shared.\n      editor.events.$on($image_resizer, 'mousedown', function (e) {\n        e.stopPropagation();\n      }, true);\n\n      // Image resize is enabled.\n      if (editor.opts.imageResize) {\n        $image_resizer.append(_getHandler('nw') + _getHandler('ne') + _getHandler('sw') + _getHandler('se'));\n\n        // Add image resizer overlay and set it.\n        editor.shared.$img_overlay = $('<div class=\"fr-image-overlay\"></div>');\n        $overlay = editor.shared.$img_overlay;\n        doc = $image_resizer.get(0).ownerDocument;\n        $(doc).find('body').first().append($overlay);\n      }\n    }\n    else {\n      $image_resizer = editor.shared.$image_resizer;\n      $overlay = editor.shared.$img_overlay;\n\n      editor.events.on('destroy', function () {\n        $image_resizer.removeClass('fr-active').appendTo($('body').first());\n      }, true);\n    }\n\n    // Shared destroy.\n    editor.events.on('shared.destroy', function () {\n      $image_resizer.html('').removeData().remove();\n      $image_resizer = null;\n\n      if (editor.opts.imageResize) {\n        $overlay.remove();\n        $overlay = null;\n      }\n    }, true);\n\n    // Window resize. Exit from edit.\n    if (!editor.helpers.isMobile()) {\n      editor.events.$on($(editor.o_win), 'resize', function () {\n        if ($current_image && !$current_image.hasClass('fr-uploading')) {\n          _exitEdit(true);\n        }\n        else if ($current_image) {\n          _repositionResizer();\n          replace();\n          showProgressBar(false);\n        }\n      });\n    }\n\n    // Image resize is enabled.\n    if (editor.opts.imageResize) {\n      doc = $image_resizer.get(0).ownerDocument;\n      editor.events.$on($image_resizer, editor._mousedown, '.fr-handler', _handlerMousedown);\n      editor.events.$on($(doc), editor._mousemove, _handlerMousemove);\n      editor.events.$on($(doc.defaultView || doc.parentWindow), editor._mouseup, _handlerMouseup);\n      editor.events.$on($overlay, 'mouseleave', _handlerMouseup);\n\n      // Accessibility.\n\n      // Used for keys holing.\n      var step = 1;\n      var prevKey = null;\n      var prevTimestamp = 0;\n\n      // Keydown event.\n      editor.events.on('keydown', function (e) {\n        if ($current_image) {\n          var ctrlKey = navigator.userAgent.indexOf('Mac OS X') != -1 ? e.metaKey : e.ctrlKey;\n          var keycode = e.which;\n\n          if (keycode !== prevKey || e.timeStamp - prevTimestamp > 200) {\n            step = 1;\n\n            // Reset step. Known browser issue: Keyup does not trigger when ctrl is pressed.\n          }\n\n          // Increase image size.\n          if ((keycode == FE.KEYCODE.EQUALS || (editor.browser.mozilla && keycode == FE.KEYCODE.FF_EQUALS)) && ctrlKey && !e.altKey) {\n            step = _resizeImage.call(this, e, 1, 1, step);\n          }\n\n          // Decrease image size.\n          else if ((keycode == FE.KEYCODE.HYPHEN || (editor.browser.mozilla && keycode == FE.KEYCODE.FF_HYPHEN)) && ctrlKey && !e.altKey) {\n            step = _resizeImage.call(this, e, 2, -1, step);\n          }\n          else if (!editor.keys.ctrlKey(e) && keycode == FE.KEYCODE.ENTER) {\n            $current_image.before('<br>');\n            _editImg($current_image);\n          }\n\n          // Save key code.\n          prevKey = keycode;\n\n          // Save timestamp.\n          prevTimestamp = e.timeStamp;\n        }\n      }, true);\n\n      // Reset the step on key up event.\n      editor.events.on('keyup', function () {\n        step = 1;\n      });\n    }\n  }\n\n  /**\n   * Remove the current image.\n   */\n  function remove($img) {\n    $img = $img || getEl();\n\n    if ($img) {\n      if (editor.events.trigger('image.beforeRemove', [$img]) !== false) {\n        editor.popups.hideAll();\n        _selectImage();\n        _exitEdit(true);\n\n        if (!editor.undo.canDo()) editor.undo.saveStep();\n\n        if ($img.get(0) == editor.el) {\n          $img.removeAttr('src');\n        }\n        else {\n          if ($img.get(0).parentNode.tagName == 'A') {\n            editor.selection.setBefore($img.get(0).parentNode) || editor.selection.setAfter($img.get(0).parentNode) || $img.parent().after(FE.MARKERS);\n            $($img.get(0).parentNode).remove();\n          }\n          else {\n            editor.selection.setBefore($img.get(0)) || editor.selection.setAfter($img.get(0)) || $img.after(FE.MARKERS);\n            $img.remove();\n          }\n\n          editor.html.fillEmptyBlocks();\n          editor.selection.restore();\n        }\n\n        editor.undo.saveStep();\n      }\n    }\n  }\n\n  function _editorKeydownHandler(e) {\n    var key_code = e.which;\n\n    if ($current_image && (key_code == FE.KEYCODE.BACKSPACE || key_code == FE.KEYCODE.DELETE)) {\n      e.preventDefault();\n      e.stopPropagation();\n      remove();\n\n      return false;\n    }\n\n    else if ($current_image && key_code == FE.KEYCODE.ESC) {\n      var $img = $current_image;\n      _exitEdit(true);\n      editor.selection.setAfter($img.get(0));\n      editor.selection.restore();\n      e.preventDefault();\n\n      return false;\n    }\n\n    // Move cursor if left and right arrows are used.\n    else if ($current_image && (key_code == FE.KEYCODE.ARROW_LEFT || key_code == FE.KEYCODE.ARROW_RIGHT)) {\n      var img = $current_image.get(0);\n      _exitEdit(true);\n\n      if (key_code == FE.KEYCODE.ARROW_LEFT) {\n        editor.selection.setBefore(img);\n      }\n      else {\n        editor.selection.setAfter(img);\n      }\n\n      editor.selection.restore();\n      e.preventDefault();\n\n      return false;\n    }\n\n    else if ($current_image && key_code != FE.KEYCODE.F10 && !editor.keys.isBrowserAction(e)) {\n      e.preventDefault();\n      e.stopPropagation();\n\n      return false;\n    }\n  }\n\n  /**\n   * Do some cleanup on images.\n   */\n  function _cleanOnGet(el) {\n\n    // Tag is image.\n    if (el && el.tagName == 'IMG') {\n\n      // Remove element if it has class fr-uploading or fr-error.\n      if (editor.node.hasClass(el, 'fr-uploading') || editor.node.hasClass(el, 'fr-error')) {\n        el.parentNode.removeChild(el);\n      }\n\n      // Remove class if it is draggable.\n      else if (editor.node.hasClass(el, 'fr-draggable')) {\n        el.classList.remove('fr-draggable');\n      }\n\n      if (el.parentNode && el.parentNode.parentNode && editor.node.hasClass(el.parentNode.parentNode, 'fr-img-caption')) {\n        var p_node = el.parentNode.parentNode;\n        p_node.removeAttribute('contenteditable');\n        p_node.removeAttribute('draggable');\n        p_node.classList.remove('fr-draggable');\n\n        var n_node = el.nextSibling;\n\n        if (n_node) {\n          n_node.removeAttribute('contenteditable');\n        }\n      }\n    }\n\n    // Look for inner nodes that might be in a similar case.\n    else if (el && el.nodeType == Node.ELEMENT_NODE) {\n      var imgs = el.querySelectorAll('img.fr-uploading, img.fr-error, img.fr-draggable');\n\n      for (var i = 0; i < imgs.length; i++) {\n        _cleanOnGet(imgs[i]);\n      }\n    }\n  }\n\n  /**\n   * Initialization.\n   */\n  function _init() {\n    _initEvents();\n\n    // Init on image.\n    if (editor.el.tagName == 'IMG') {\n      editor.$el.addClass('fr-view');\n    }\n\n    editor.events.$on(editor.$el, editor.helpers.isMobile() && !editor.helpers.isWindowsPhone() ? 'touchend' : 'click', editor.el.tagName == 'IMG' ? null : 'img:not([contenteditable=\"false\"])', _edit);\n\n    if (editor.helpers.isMobile()) {\n      editor.events.$on(editor.$el, 'touchstart', editor.el.tagName == 'IMG' ? null : 'img:not([contenteditable=\"false\"])', function () {\n        touchScroll = false;\n      })\n\n      editor.events.$on(editor.$el, 'touchmove', function () {\n        touchScroll = true;\n      });\n    }\n\n    if (editor.$wp) {\n      editor.events.on('window.keydown keydown', _editorKeydownHandler, true)\n\n      editor.events.on('keyup', function (e) {\n        if ($current_image && e.which == FE.KEYCODE.ENTER) {\n\n          return false;\n        }\n      }, true);\n    }\n    else {\n      editor.events.$on(editor.$win, 'keydown', _editorKeydownHandler);\n    }\n\n    // ESC from accessibility.\n    editor.events.on('toolbar.esc', function () {\n      if ($current_image) {\n        if (editor.$wp) {\n          editor.events.disableBlur();\n          editor.events.focus();\n        }\n        else {\n          var $img = $current_image;\n          _exitEdit(true);\n          editor.selection.setAfter($img.get(0));\n          editor.selection.restore();\n        }\n\n        return false;\n      }\n    }, true);\n\n    // focusEditor from accessibility.\n    editor.events.on('toolbar.focusEditor', function () {\n      if ($current_image) {\n\n        return false;\n      }\n    }, true);\n\n    // Copy/cut image.\n    editor.events.on('window.cut window.copy', function (e) {\n      // Do copy only if image.edit popups is visible and not focused.\n      if ($current_image && editor.popups.isVisible('image.edit') && !editor.popups.get('image.edit').find(':focus').length) {\n\n        var $el = getEl();\n\n        if (hasCaption()) {\n          $el.before(FE.START_MARKER);\n          $el.after(FE.END_MARKER);\n          editor.selection.restore();\n          editor.paste.saveCopiedText($el.get(0).outerHTML, $el.text());\n        }\n        else {\n          _selectImage();\n          editor.paste.saveCopiedText($current_image.get(0).outerHTML, $current_image.attr('alt'));\n        }\n\n        if (e.type == 'copy') {\n          setTimeout(function () {\n            _editImg($current_image);\n          });\n        }\n        else {\n          _exitEdit(true);\n          editor.undo.saveStep();\n          setTimeout(function () {\n            editor.undo.saveStep();\n          }, 0);\n        }\n      }\n    }, true);\n\n    // Fix IE copy not working when selection is collapsed.\n    if (editor.browser.msie) {\n      editor.events.on('keydown', function (e) {\n        // Selection is collapsed and we have an image.\n        if (!(editor.selection.isCollapsed() && $current_image)) return true;\n\n        var key_code = e.which;\n\n        // Copy.\n        if (key_code == FE.KEYCODE.C && editor.keys.ctrlKey(e)) {\n          editor.events.trigger('window.copy');\n        }\n\n        // Cut.\n        else if (key_code == FE.KEYCODE.X && editor.keys.ctrlKey(e)) {\n          editor.events.trigger('window.cut');\n        }\n      });\n    }\n\n    // Do not leave page while uploading.\n    editor.events.$on($(editor.o_win), 'keydown', function (e) {\n      var key_code = e.which;\n\n      if ($current_image && key_code == FE.KEYCODE.BACKSPACE) {\n        e.preventDefault();\n\n        return false;\n      }\n    });\n\n    // Check if image is uploading to abort it.\n    editor.events.$on(editor.$win, 'keydown', function (e) {\n      var key_code = e.which;\n\n      if ($current_image && $current_image.hasClass('fr-uploading') && key_code == FE.KEYCODE.ESC) {\n        $current_image.trigger('abortUpload');\n      }\n    });\n\n    editor.events.on('destroy', function () {\n      if ($current_image && $current_image.hasClass('fr-uploading')) {\n        $current_image.trigger('abortUpload');\n      }\n    });\n\n    editor.events.on('paste.before', _clipboardPaste);\n    editor.events.on('paste.beforeCleanup', _clipboardPasteCleanup);\n    editor.events.on('paste.after', _uploadPastedImages);\n    editor.events.on('html.set', _refreshImageList);\n    editor.events.on('html.inserted', _refreshImageList);\n    _refreshImageList();\n\n    editor.events.on('destroy', function () {\n      images = [];\n    })\n\n    // Remove any fr-uploading / fr-error images.\n    editor.events.on('html.processGet', _cleanOnGet);\n\n    if (editor.opts.imageOutputSize) {\n      var imgs;\n\n      editor.events.on('html.beforeGet', function () {\n        imgs = editor.el.querySelectorAll('img')\n        for (var i = 0; i < imgs.length; i++) {\n          var width = imgs[i].style.width || $(imgs[i]).width();\n          var height = imgs[i].style.height || $(imgs[i]).height();\n\n          if (width) imgs[i].setAttribute('width', ('' + width).replace(/px/, ''));\n\n          if (height) imgs[i].setAttribute('height', ('' + height).replace(/px/, ''));\n        }\n      });\n    }\n\n    if (editor.opts.iframe) {\n      editor.events.on('image.loaded', editor.size.syncIframe);\n    }\n\n    if (editor.$wp) {\n      _syncImages();\n      editor.events.on('contentChanged', _syncImages);\n    }\n\n    editor.events.$on($(editor.o_win), 'orientationchange.image', function () {\n      setTimeout(function () {\n        if ($current_image) {\n          _editImg($current_image);\n        }\n      }, 100);\n    });\n\n    _initEditPopup(true);\n    _initInsertPopup(true);\n    _initSizePopup(true);\n    _initAltPopup(true);\n\n    editor.events.on('node.remove', function ($node) {\n      if ($node.get(0).tagName == 'IMG') {\n        remove($node);\n\n        return false;\n      }\n    });\n  }\n\n  function _processPastedImage(img) {\n    if (editor.events.trigger('image.beforePasteUpload', [img]) === false) {\n\n      return false;\n    }\n\n    // Show the progress bar.\n    $current_image = $(img);\n    _repositionResizer();\n    _showEditPopup();\n    replace();\n    showProgressBar();\n\n    // Convert image to blob.\n    var binary = atob($(img).attr('src').split(',')[1]);\n    var array = [];\n\n    for (var i = 0; i < binary.length; i++) {\n      array.push(binary.charCodeAt(i));\n    }\n\n    var upload_img = new Blob([new Uint8Array(array)], {\n      type: $(img).attr('src').split(',')[0].replace(/data\\:/g, '').replace(/;base64/g, '')\n    });\n\n    upload([upload_img], $current_image);\n  }\n\n  function _uploadPastedImages() {\n    if (!editor.opts.imagePaste) {\n      editor.$el.find('img[data-fr-image-pasted]').remove();\n    }\n    else {\n\n      // Safari won't work https://bugs.webkit.org/show_bug.cgi?id=49141\n      editor.$el.find('img[data-fr-image-pasted]').each(function (index, img) {\n        if (editor.opts.imagePasteProcess) {\n          var width = editor.opts.imageDefaultWidth;\n\n          if (width && width != 'auto') {\n            width = width + (editor.opts.imageResizeWithPercent ? '%' : 'px');\n          }\n          $(img)\n            .css('width', width)\n            .removeClass('fr-dii fr-dib fr-fir fr-fil')\n\n          _setStyle($(img), editor.opts.imageDefaultDisplay, editor.opts.imageDefaultAlign);\n        }\n\n        // Data images.\n        if (img.src.indexOf('data:') === 0) {\n          _processPastedImage(img);\n        }\n\n        // New way Safari is pasting images.\n        else if (img.src.indexOf('blob:') === 0 || (img.src.indexOf('http') === 0 && editor.opts.imageUploadRemoteUrls && editor.opts.imageCORSProxy)) {\n          var _img = new Image();\n          _img.crossOrigin = 'Anonymous';\n          _img.onload = function () {\n            // Create canvas.\n            var canvas = editor.o_doc.createElement('CANVAS');\n            var context = canvas.getContext('2d');\n\n            // Set height.\n            canvas.height = this.naturalHeight;\n            canvas.width = this.naturalWidth;\n\n            // Draw image.\n            context.drawImage(this, 0, 0);\n\n            // Update image and process it.\n            img.src = canvas.toDataURL('image/png');\n            _processPastedImage(img);\n          };\n\n          _img.src = (img.src.indexOf('blob:') === 0 ? '' : (editor.opts.imageCORSProxy + '/')) + img.src;\n        }\n\n        // Images without http (Safari ones.).\n        else if (img.src.indexOf('http') !== 0 || img.src.indexOf('https://mail.google.com/mail') === 0) {\n          editor.selection.save();\n          $(img).remove();\n          editor.selection.restore();\n        }\n        else {\n          $(img).removeAttr('data-fr-image-pasted');\n        }\n      });\n    }\n  }\n\n  function _clipboardImageLoaded(e) {\n    var result = e.target.result;\n\n    // Default width.\n    var width = editor.opts.imageDefaultWidth;\n\n    if (width && width != 'auto') {\n      width = width + (editor.opts.imageResizeWithPercent ? '%' : 'px');\n    }\n\n    editor.undo.saveStep();\n\n    editor.html.insert('<img data-fr-image-pasted=\"true\" src=\"' + result + '\"' + (width ? ' style=\"width: ' + width + ';\"' : '') + '>');\n\n    var $img = editor.$el.find('img[data-fr-image-pasted=\"true\"]');\n\n    if ($img) {\n      _setStyle($img, editor.opts.imageDefaultDisplay, editor.opts.imageDefaultAlign);\n    }\n\n    editor.events.trigger('paste.after');\n  }\n\n  function _processsClipboardPaste(file) {\n    var reader = new FileReader();\n    reader.onload = _clipboardImageLoaded;\n    reader.readAsDataURL(file);\n  }\n\n  function _clipboardPaste(e) {\n    if (e && e.clipboardData && e.clipboardData.items) {\n\n      var file = null;\n\n      if (!e.clipboardData.getData('text/html') && !e.clipboardData.getData('text/rtf')) {\n        for (var i = 0; i < e.clipboardData.items.length; i++) {\n          file = e.clipboardData.items[i].getAsFile();\n\n          if (file) {\n            break;\n          }\n        }\n      }\n      else {\n        file = e.clipboardData.items[0].getAsFile();\n      }\n\n      if (file) {\n        _processsClipboardPaste(file);\n\n        return false;\n      }\n    }\n  }\n\n  function _clipboardPasteCleanup(clipboard_html) {\n    clipboard_html = clipboard_html.replace(/<img /gi, '<img data-fr-image-pasted=\"true\" ');\n\n    return clipboard_html;\n  }\n\n  /**\n   * Start edit.\n   */\n  var touchScroll;\n\n  function _edit(e) {\n    if ($(this).parents('[contenteditable]:not(.fr-element):not(.fr-img-caption):not(body)').first().attr('contenteditable') == 'false') return true;\n\n    if (e && e.type == 'touchend' && touchScroll) {\n\n      return true;\n    }\n\n    if (e && editor.edit.isDisabled()) {\n      e.stopPropagation();\n      e.preventDefault();\n\n      return false;\n    }\n\n    // Hide resizer for other instances.\n    for (var i = 0; i < FE.INSTANCES.length; i++) {\n      if (FE.INSTANCES[i] != editor) {\n        FE.INSTANCES[i].events.trigger('image.hideResizer');\n      }\n    }\n\n    editor.toolbar.disable();\n\n    if (e) {\n      e.stopPropagation();\n      e.preventDefault();\n    }\n\n    // Hide keyboard.\n    if (editor.helpers.isMobile()) {\n      editor.events.disableBlur();\n      editor.$el.blur();\n      editor.events.enableBlur();\n    }\n\n    if (editor.opts.iframe) {\n      editor.size.syncIframe();\n    }\n\n    // Store current image.\n    $current_image = $(this);\n\n    // Select image.\n    _selectImage();\n\n    // Reposition resizer.\n    _repositionResizer();\n    _showEditPopup();\n\n    // Clear selection.\n    if (!editor.browser.msie) {\n      editor.selection.clear();\n    }\n\n    // Fix for image remaining selected.\n    if (editor.helpers.isIOS()) {\n      editor.events.disableBlur();\n      editor.$el.blur();\n    }\n\n    // Refresh buttons.\n    editor.button.bulkRefresh();\n    editor.events.trigger('video.hideResizer');\n  }\n\n  /**\n   * Exit edit.\n   */\n\n  function _exitEdit(force_exit) {\n    if ($current_image && (_canExit() || force_exit === true)) {\n      editor.toolbar.enable();\n      $image_resizer.removeClass('fr-active');\n      editor.popups.hide('image.edit');\n      $current_image = null;\n      _unmarkExit();\n\n      $handler = null;\n\n      if ($overlay) {\n        $overlay.hide();\n      }\n    }\n  }\n\n  var img_exit_flag = false;\n\n  function _markExit() {\n    img_exit_flag = true;\n  }\n\n  function _unmarkExit() {\n    img_exit_flag = false;\n  }\n\n  function _canExit() {\n\n    return img_exit_flag;\n  }\n\n  /**\n   * Set style for image.\n   */\n  function _setStyle($img, _display, _align) {\n\n    if (!editor.opts.htmlUntouched && editor.opts.useClasses) {\n      $img.removeClass('fr-fil fr-fir fr-dib fr-dii');\n\n      if (_align) {\n        $img.addClass('fr-fi' + _align[0]);\n      }\n\n      if (_display) {\n        $img.addClass('fr-di' + _display[0]);\n      }\n    }\n    else {\n      if (_display == 'inline') {\n        $img.css({\n          display: 'inline-block',\n          verticalAlign: 'bottom',\n          margin: editor.opts.imageDefaultMargin\n        })\n\n        if (_align == 'center') {\n          $img.css({\n            'float': 'none',\n            marginBottom: '',\n            marginTop: '',\n            maxWidth: 'calc(100% - ' + (2 * editor.opts.imageDefaultMargin) + 'px)',\n            textAlign: 'center'\n          })\n        }\n        else if (_align == 'left') {\n          $img.css({\n            'float': 'left',\n            marginLeft: 0,\n            maxWidth: 'calc(100% - ' + editor.opts.imageDefaultMargin + 'px)',\n            textAlign: 'left'\n          })\n        }\n        else {\n          $img.css({\n            'float': 'right',\n            marginRight: 0,\n            maxWidth: 'calc(100% - ' + editor.opts.imageDefaultMargin + 'px)',\n            textAlign: 'right'\n          })\n        }\n      }\n      else if (_display == 'block') {\n        $img.css({\n          display: 'block',\n          'float': 'none',\n          verticalAlign: 'top',\n          margin: editor.opts.imageDefaultMargin + 'px auto',\n          textAlign: 'center'\n        })\n\n        if (_align == 'left') {\n          $img.css({\n            marginLeft: 0,\n            textAlign: 'left'\n          })\n        }\n        else if (_align == 'right') {\n          $img.css({\n            marginRight: 0,\n            textAlign: 'right'\n          })\n        }\n      }\n    }\n  }\n\n  /**\n   * Align image.\n   */\n  function align(val) {\n    var $el = getEl();\n\n    $el.removeClass('fr-fir fr-fil');\n\n    // Easy case. Use classes.\n    if (!editor.opts.htmlUntouched && editor.opts.useClasses) {\n      if (val == 'left') {\n        $el.addClass('fr-fil');\n      }\n      else if (val == 'right') {\n        $el.addClass('fr-fir');\n      }\n    }\n    else {\n      _setStyle($el, getDisplay(), val);\n    }\n\n    _selectImage();\n    _repositionResizer();\n    _showEditPopup();\n    editor.selection.clear();\n  }\n\n  /**\n   * Get image alignment.\n   */\n  function getAlign($img) {\n    if (typeof $img == 'undefined') $img = getEl();\n\n    if ($img) {\n\n      // Image has left class.\n      if ($img.hasClass('fr-fil')) {\n\n        return 'left';\n      }\n\n      // Image has right class.\n      else if ($img.hasClass('fr-fir')) {\n\n        return 'right';\n      }\n\n      // Image has display class set.\n      else if ($img.hasClass('fr-dib') || $img.hasClass('fr-dii')) {\n\n        return 'center';\n      }\n      else {\n        // Set float to none.\n        var flt = $img.css('float');\n\n        $img.css('float', 'none');\n\n        // Image has display block.\n        if ($img.css('display') == 'block') {\n\n          // Set float to the initial value.\n          $img.css('float', '');\n\n          if ($img.css('float') != flt) $img.css('float', flt);\n\n          // Margin left is 0.\n          // Margin right is auto.\n          if (parseInt($img.css('margin-left'), 10) === 0) {\n\n            return 'left';\n          }\n\n          // Margin left is auto.\n          // Margin right is 0.\n          else if (parseInt($img.css('margin-right'), 10) === 0) {\n\n            return 'right';\n          }\n        }\n\n        // Display inline.\n        else {\n\n          // Set float.\n          $img.css('float', '');\n\n          if ($img.css('float') != flt) $img.css('float', flt);\n\n          // Float left.\n          if ($img.css('float') == 'left') {\n\n            return 'left';\n          }\n\n          // Float right.\n          else if ($img.css('float') == 'right') {\n\n            return 'right';\n          }\n        }\n      }\n    }\n\n    return 'center';\n  }\n\n  /**\n   * Get image display.\n   */\n  function getDisplay($img) {\n    if (typeof $img == 'undefined') $img = getEl();\n\n    // Set float to none.\n    var flt = $img.css('float');\n    $img.css('float', 'none');\n\n    // Image has display block.\n    if ($img.css('display') == 'block') {\n\n      // Set float to the initial value.\n      $img.css('float', '');\n\n      if ($img.css('float') != flt) $img.css('float', flt);\n\n      return 'block';\n    }\n\n    // Display inline.\n    else {\n\n      // Set float.\n      $img.css('float', '');\n\n      if ($img.css('float') != flt) $img.css('float', flt);\n\n      return 'inline';\n    }\n\n    return 'inline';\n  }\n\n  /**\n   * Refresh the align icon.\n   */\n  function refreshAlign($btn) {\n    if ($current_image) {\n      $btn.find('> *').first().replaceWith(editor.icon.create('image-align-' + getAlign()));\n    }\n  }\n\n  /**\n   * Refresh the align option from the dropdown.\n   */\n\n  function refreshAlignOnShow($btn, $dropdown) {\n    if ($current_image) {\n      $dropdown.find('.fr-command[data-param1=\"' + getAlign() + '\"]').addClass('fr-active').attr('aria-selected', true);\n    }\n  }\n\n  /**\n   * Align image.\n   */\n\n  function display(val) {\n    var $el = getEl();\n\n    $el.removeClass('fr-dii fr-dib');\n\n    // Easy case. Use classes.\n    if (!editor.opts.htmlUntouched && editor.opts.useClasses) {\n      if (val == 'inline') {\n        $el.addClass('fr-dii');\n      }\n      else if (val == 'block') {\n        $el.addClass('fr-dib');\n      }\n    }\n    else {\n      _setStyle($el, val, getAlign());\n    }\n\n    _selectImage();\n    _repositionResizer();\n    _showEditPopup();\n    editor.selection.clear();\n  }\n\n  /**\n   * Refresh the image display selected option.\n   */\n\n  function refreshDisplayOnShow($btn, $dropdown) {\n    if ($current_image) {\n      $dropdown.find('.fr-command[data-param1=\"' + getDisplay() + '\"]').addClass('fr-active').attr('aria-selected', true);\n    }\n  }\n\n  /**\n   * Show the replace popup.\n   */\n\n  function replace() {\n    var $popup = editor.popups.get('image.insert');\n\n    if (!$popup) $popup = _initInsertPopup();\n\n    if (!editor.popups.isVisible('image.insert')) {\n      hideProgressBar();\n      editor.popups.refresh('image.insert');\n      editor.popups.setContainer('image.insert', editor.$sc);\n    }\n\n    var $el = getEl();\n\n    if (hasCaption()) {\n      $el = $el.find('.fr-img-wrap');\n    }\n\n    var left = $el.offset().left + $el.outerWidth() / 2;\n    var top = $el.offset().top + $el.outerHeight();\n\n    editor.popups.show('image.insert', left, top, $el.outerHeight(true));\n  }\n\n  /**\n   * Place selection around current image.\n   */\n  function _selectImage() {\n    if ($current_image) {\n      editor.events.disableBlur();\n      editor.selection.clear();\n      var range = editor.doc.createRange();\n      range.selectNode($current_image.get(0));\n\n      // Collapse range in IE.\n      if (editor.browser.msie) range.collapse(true);\n\n      var selection = editor.selection.get();\n      selection.addRange(range);\n      editor.events.enableBlur();\n    }\n  }\n\n  /**\n   * Get back to the image main popup.\n   */\n  function back() {\n    if ($current_image) {\n      editor.events.disableBlur();\n      $('.fr-popup input:focus').blur();\n      _editImg($current_image);\n    }\n    else {\n      editor.events.disableBlur();\n      editor.selection.restore();\n      editor.events.enableBlur();\n\n      editor.popups.hide('image.insert');\n      editor.toolbar.showInline();\n    }\n  }\n\n  /**\n   * Get the current image.\n   */\n\n  function get() {\n\n    return $current_image;\n  }\n\n  function getEl() {\n    return hasCaption() ? $current_image.parents('.fr-img-caption').first() : $current_image;\n  }\n\n  /**\n   * Apply specific style.\n   */\n\n  function applyStyle(val, imageStyles, multipleStyles) {\n    if (typeof imageStyles == 'undefined') imageStyles = editor.opts.imageStyles;\n\n    if (typeof multipleStyles == 'undefined') multipleStyles = editor.opts.imageMultipleStyles;\n\n    if (!$current_image) return false;\n\n    var $img = getEl();\n\n    // Remove multiple styles.\n    if (!multipleStyles) {\n      var styles = Object.keys(imageStyles);\n      styles.splice(styles.indexOf(val), 1);\n      $img.removeClass(styles.join(' '));\n    }\n\n    if (typeof imageStyles[val] == 'object') {\n      $img.removeAttr('style');\n      $img.css(imageStyles[val].style);\n    }\n    else {\n      $img.toggleClass(val);\n    }\n\n    _editImg($current_image);\n  }\n\n  function hasCaption() {\n    if ($current_image) {\n      return $current_image.parents('.fr-img-caption').length > 0;\n    }\n\n    return false;\n  }\n\n  function toggleCaption() {\n    var $el;\n\n    if ($current_image && !hasCaption()) {\n      $el = $current_image;\n\n      // Check if there is a link wrapping the image.\n      if ($current_image.parent().is('a')) {\n        $el = $current_image.parent();\n      }\n\n      $el.wrap('<span ' + (!editor.browser.mozilla ? 'contenteditable=\"false\"' : '') + 'class=\"fr-img-caption ' + $current_image.attr('class') + '\" style=\"' + ($current_image.attr('style') ? $current_image.attr('style') + ' ' : '') + 'width: ' + $current_image.width() + 'px;\" draggable=\"false\"></span>');\n      $el.wrap('<span class=\"fr-img-wrap\"></span>');\n      $el.after('<span class=\"fr-inner\" contenteditable=\"true\">' + FE.START_MARKER + 'Image caption' + FE.END_MARKER + '</span>');\n      $current_image.removeAttr('class').removeAttr('style').removeAttr('width');\n\n      _exitEdit(true);\n\n      editor.selection.restore();\n    }\n    else {\n      $el = getEl();\n      $current_image.insertAfter($el);\n      $current_image\n        .attr('class', $el.attr('class').replace('fr-img-caption', ''))\n        .attr('style', $el.attr('style'));\n      $el.remove();\n\n      _editImg($current_image);\n    }\n  }\n\n  return {\n    _init: _init,\n    showInsertPopup: showInsertPopup,\n    showLayer: showLayer,\n    refreshUploadButton: refreshUploadButton,\n    refreshByURLButton: refreshByURLButton,\n    upload: upload,\n    insertByURL: insertByURL,\n    align: align,\n    refreshAlign: refreshAlign,\n    refreshAlignOnShow: refreshAlignOnShow,\n    display: display,\n    refreshDisplayOnShow: refreshDisplayOnShow,\n    replace: replace,\n    back: back,\n    get: get,\n    getEl: getEl,\n    insert: insert,\n    showProgressBar: showProgressBar,\n    remove: remove,\n    hideProgressBar: hideProgressBar,\n    applyStyle: applyStyle,\n    showAltPopup: showAltPopup,\n    showSizePopup: showSizePopup,\n    setAlt: setAlt,\n    setSize: setSize,\n    toggleCaption: toggleCaption,\n    hasCaption: hasCaption,\n    exitEdit: _exitEdit,\n    edit: _editImg\n  }\n}\n\n// Insert image button.\nFE.DefineIcon('insertImage', {\n  NAME: 'image'\n});\nFE.RegisterShortcut(FE.KEYCODE.P, 'insertImage', null, 'P');\nFE.RegisterCommand('insertImage', {\n  title: 'Insert Image',\n  undo: false,\n  focus: true,\n  refreshAfterCallback: false,\n  popup: true,\n  callback: function () {\n    if (!this.popups.isVisible('image.insert')) {\n      this.image.showInsertPopup();\n    }\n    else {\n      if (this.$el.find('.fr-marker').length) {\n        this.events.disableBlur();\n        this.selection.restore();\n      }\n      this.popups.hide('image.insert');\n    }\n  },\n  plugin: 'image'\n});\n\n// Image upload button inside the insert image popup.\nFE.DefineIcon('imageUpload', {\n  NAME: 'upload'\n});\nFE.RegisterCommand('imageUpload', {\n  title: 'Upload Image',\n  undo: false,\n  focus: false,\n  toggle: true,\n  callback: function () {\n    this.image.showLayer('image-upload');\n  },\n  refresh: function ($btn) {\n    this.image.refreshUploadButton($btn);\n  }\n});\n\n// Image by URL button inside the insert image popup.\nFE.DefineIcon('imageByURL', {\n  NAME: 'link'\n});\nFE.RegisterCommand('imageByURL', {\n  title: 'By URL',\n  undo: false,\n  focus: false,\n  toggle: true,\n  callback: function () {\n    this.image.showLayer('image-by-url');\n  },\n  refresh: function ($btn) {\n    this.image.refreshByURLButton($btn);\n  }\n})\n\n// Insert image button inside the insert by URL layer.\nFE.RegisterCommand('imageInsertByURL', {\n  title: 'Insert Image',\n  undo: true,\n  refreshAfterCallback: false,\n  callback: function () {\n    this.image.insertByURL();\n  },\n  refresh: function ($btn) {\n    var $current_image = this.image.get();\n\n    if (!$current_image) {\n      $btn.text(this.language.translate('Insert'));\n    }\n    else {\n      $btn.text(this.language.translate('Replace'));\n    }\n  }\n})\n\n// Image display.\nFE.DefineIcon('imageDisplay', {\n  NAME: 'star'\n})\nFE.RegisterCommand('imageDisplay', {\n  title: 'Display',\n  type: 'dropdown',\n  options: {\n    inline: 'Inline',\n    block: 'Break Text'\n  },\n  callback: function (cmd, val) {\n    this.image.display(val);\n  },\n  refresh: function ($btn) {\n    if (!this.opts.imageTextNear) $btn.addClass('fr-hidden');\n  },\n  refreshOnShow: function ($btn, $dropdown) {\n    this.image.refreshDisplayOnShow($btn, $dropdown);\n  }\n})\n\n// Image align.\nFE.DefineIcon('image-align', {\n  NAME: 'align-left'\n});\nFE.DefineIcon('image-align-left', {\n  NAME: 'align-left'\n});\nFE.DefineIcon('image-align-right', {\n  NAME: 'align-right'\n});\nFE.DefineIcon('image-align-center', {\n  NAME: 'align-justify'\n});\n\nFE.DefineIcon('imageAlign', {\n  NAME: 'align-justify'\n})\nFE.RegisterCommand('imageAlign', {\n  type: 'dropdown',\n  title: 'Align',\n  options: {\n    left: 'Align Left',\n    center: 'None',\n    right: 'Align Right'\n  },\n  html: function () {\n    var c = '<ul class=\"fr-dropdown-list\" role=\"presentation\">';\n    var options = FE.COMMANDS.imageAlign.options;\n\n    for (var val in options) {\n      if (Object.prototype.hasOwnProperty.call(options, val)) {\n        c += '<li role=\"presentation\"><a class=\"fr-command fr-title\" tabIndex=\"-1\" role=\"option\" data-cmd=\"imageAlign\" data-param1=\"' + val + '\" title=\"' + this.language.translate(options[val]) + '\">' + this.icon.create('image-align-' + val) + '<span class=\"fr-sr-only\">' + this.language.translate(options[val]) + '</span></a></li>';\n      }\n    }\n    c += '</ul>';\n\n    return c;\n  },\n  callback: function (cmd, val) {\n    this.image.align(val);\n  },\n  refresh: function ($btn) {\n    this.image.refreshAlign($btn);\n  },\n  refreshOnShow: function ($btn, $dropdown) {\n    this.image.refreshAlignOnShow($btn, $dropdown);\n  }\n})\n\n// Image replace.\nFE.DefineIcon('imageReplace', {\n  NAME: 'exchange',\n  FA5NAME: 'exchange-alt'\n})\nFE.RegisterCommand('imageReplace', {\n  title: 'Replace',\n  undo: false,\n  focus: false,\n  popup: true,\n  refreshAfterCallback: false,\n  callback: function () {\n    this.image.replace();\n  }\n})\n\n// Image remove.\nFE.DefineIcon('imageRemove', {\n  NAME: 'trash'\n})\nFE.RegisterCommand('imageRemove', {\n  title: 'Remove',\n  callback: function () {\n    this.image.remove();\n  }\n})\n\n// Image back.\nFE.DefineIcon('imageBack', {\n  NAME: 'arrow-left'\n});\nFE.RegisterCommand('imageBack', {\n  title: 'Back',\n  undo: false,\n  focus: false,\n  back: true,\n  callback: function () {\n    this.image.back();\n  },\n  refresh: function ($btn) {\n    var $current_image = this.image.get();\n\n    if (!$current_image && !this.opts.toolbarInline) {\n      $btn.addClass('fr-hidden');\n      $btn.next('.fr-separator').addClass('fr-hidden');\n    }\n    else {\n      $btn.removeClass('fr-hidden');\n      $btn.next('.fr-separator').removeClass('fr-hidden');\n    }\n  }\n});\n\nFE.RegisterCommand('imageDismissError', {\n  title: 'OK',\n  undo: false,\n  callback: function () {\n    this.image.hideProgressBar(true);\n  }\n})\n\n// Image styles.\nFE.DefineIcon('imageStyle', {\n  NAME: 'magic'\n})\nFE.RegisterCommand('imageStyle', {\n  title: 'Style',\n  type: 'dropdown',\n  html: function () {\n    var c = '<ul class=\"fr-dropdown-list\" role=\"presentation\">';\n    var options = this.opts.imageStyles;\n\n    for (var cls in options) {\n      if (Object.prototype.hasOwnProperty.call(options, cls)) {\n        var val = options[cls];\n\n        if (typeof val == 'object') val = val.title;\n\n        c += '<li role=\"presentation\"><a class=\"fr-command\" tabIndex=\"-1\" role=\"option\" data-cmd=\"imageStyle\" data-param1=\"' + cls + '\">' + this.language.translate(val) + '</a></li>';\n      }\n    }\n    c += '</ul>';\n\n    return c;\n  },\n  callback: function (cmd, val) {\n    this.image.applyStyle(val);\n  },\n  refreshOnShow: function ($btn, $dropdown) {\n    var $current_image = this.image.getEl();\n\n    if ($current_image) {\n      $dropdown.find('.fr-command').each(function () {\n        var cls = $(this).data('param1');\n        var active = $current_image.hasClass(cls);\n        $(this).toggleClass('fr-active', active).attr('aria-selected', active);\n      })\n    }\n  }\n})\n\n// Image alt.\nFE.DefineIcon('imageAlt', {\n  NAME: 'info'\n})\nFE.RegisterCommand('imageAlt', {\n  undo: false,\n  focus: false,\n  popup: true,\n  title: 'Alternate Text',\n  callback: function () {\n    this.image.showAltPopup();\n  }\n});\n\nFE.RegisterCommand('imageSetAlt', {\n  undo: true,\n  focus: false,\n  title: 'Update',\n  refreshAfterCallback: false,\n  callback: function () {\n    this.image.setAlt();\n  }\n});\n\n// Image size.\nFE.DefineIcon('imageSize', {\n  NAME: 'arrows-alt'\n})\nFE.RegisterCommand('imageSize', {\n  undo: false,\n  focus: false,\n  popup: true,\n  title: 'Change Size',\n  callback: function () {\n    this.image.showSizePopup();\n  }\n});\n\nFE.RegisterCommand('imageSetSize', {\n  undo: true,\n  focus: false,\n  title: 'Update',\n  refreshAfterCallback: false,\n  callback: function () {\n    this.image.setSize();\n  }\n});\n\nFE.DefineIcon('imageCaption', {\n  NAME: 'commenting',\n  FA5NAME: 'comment-alt'\n})\n\nFE.RegisterCommand('imageCaption', {\n  undo: true,\n  focus: false,\n  title: 'Image Caption',\n  refreshAfterCallback: true,\n  callback: function () {\n    this.image.toggleCaption();\n  },\n  refresh: function ($btn) {\n    if (this.image.get()) {\n      $btn.toggleClass('fr-active', this.image.hasCaption());\n    }\n  }\n})","import FE from 'FroalaEditor';\n\n// Extend defaults.\nObject.assign(FE.DEFAULTS, {\n  imageManagerLoadURL: 'https://i.froala.com/load-files',\n  imageManagerLoadMethod: 'get',\n  imageManagerLoadParams: {},\n  imageManagerPreloader: null,\n  imageManagerDeleteURL: '',\n  imageManagerDeleteMethod: 'post',\n  imageManagerDeleteParams: {},\n  imageManagerPageSize: 12,\n  imageManagerScrollOffset: 20,\n  imageManagerToggleTags: true\n});\n\nFE.PLUGINS.imageManager = function (editor) {\n  let $ = editor.$\n\n  var $modal;\n  var modal_id = 'image_manager';\n\n  var $head;\n  var $body;\n  var $preloader;\n  var $media_files;\n  var $image_tags;\n  var images;\n  var page;\n  var image_count;\n  var loaded_images;\n  var column_number;\n\n  // Load errors.\n  var BAD_LINK = 10;\n  var ERROR_DURING_LOAD = 11;\n  var MISSING_LOAD_URL_OPTION = 12;\n  var LOAD_BAD_RESPONSE = 13;\n  var MISSING_IMG_THUMB = 14;\n  var MISSING_IMG_URL = 15;\n\n  // Delete errors\n  var ERROR_DURING_DELETE = 21;\n  var MISSING_DELETE_URL_OPTION = 22;\n\n  // Error Messages\n  var error_messages = {};\n  error_messages[BAD_LINK] = 'Image cannot be loaded from the passed link.';\n  error_messages[ERROR_DURING_LOAD] = 'Error during load images request.';\n  error_messages[MISSING_LOAD_URL_OPTION] = 'Missing imageManagerLoadURL option.';\n  error_messages[LOAD_BAD_RESPONSE] = 'Parsing load response failed.';\n  error_messages[MISSING_IMG_THUMB] = 'Missing image thumb.';\n  error_messages[MISSING_IMG_URL] = 'Missing image URL.';\n  error_messages[ERROR_DURING_DELETE] = 'Error during delete image request.';\n  error_messages[MISSING_DELETE_URL_OPTION] = 'Missing imageManagerDeleteURL option.';\n\n  /*\n   * Show the image manager.\n   */\n  function show () {\n\n    // Build the image manager.\n    if (!$modal) {\n\n      // Build head.\n      var head = '<div class=\"fr-modal-head-line\"><i class=\"fa fa-bars fr-modal-more fr-not-available\" id=\"fr-modal-more-' + editor.sid + '\" title=\"' + editor.language.translate('Tags') + '\"></i><h4 data-text=\"true\">' + editor.language.translate('Manage Images') + '</h4></div>';\n\n      // Tags\n      head += '<div class=\"fr-modal-tags\" id=\"fr-modal-tags\"></div>';\n\n      // Preloader.\n      var body;\n\n      if (editor.opts.imageManagerPreloader) {\n        body = '<img class=\"fr-preloader\" id=\"fr-preloader\" alt=\"' + editor.language.translate('Loading') + '..\" src=\"' + editor.opts.imageManagerPreloader + '\" style=\"display: none;\">';\n      }\n      else {\n        body = '<span class=\"fr-preloader\" id=\"fr-preloader\" style=\"display: none;\">' + editor.language.translate('Loading') + '</span>';\n      }\n\n      // Image list.\n      body += '<div class=\"fr-image-list\" id=\"fr-image-list\"></div>';\n\n      var modalHash = editor.modals.create(modal_id, head, body);\n      $modal = modalHash.$modal;\n      $head = modalHash.$head;\n      $body = modalHash.$body;\n    }\n\n    // Set the current image (if modal is opened to replace an image).\n    $modal.data('current-image', editor.image.get());\n\n    // Show modal.\n    editor.modals.show(modal_id);\n\n    if (!$preloader) {\n      _delayedInit();\n    }\n\n    // Load images.\n    _loadImages();\n  }\n\n  /*\n   * Hide the image manager.\n   */\n  function hide () {\n\n    // Hide modal.\n    editor.modals.hide(modal_id);\n  }\n\n  /*\n   * Get the number of columns based on window width.\n   */\n  function _columnNumber () {\n    var window_width = $(window).outerWidth();\n\n    // Screen XS.\n    if (window_width < 768) {\n      return 2;\n    }\n\n    // Screen SM and MD.\n    else if (window_width < 1200) {\n      return 3;\n    }\n\n    // Screen LG.\n    else {\n      return 4;\n    }\n  }\n\n  /*\n   * Add the correct number of columns.\n   */\n  function _buildColumns () {\n    $media_files.html('');\n\n    for (var i = 0; i < column_number; i++) {\n      $media_files.append('<div class=\"fr-list-column\"></div>');\n    }\n  }\n\n  /*\n   * Load images from server.\n   */\n  function _loadImages () {\n    $preloader.show();\n    $media_files.find('.fr-list-column').html('');\n\n    // If the images load URL is set.\n    if (editor.opts.imageManagerLoadURL) {\n\n      var xhr = editor.core.getXHR(editor.opts.imageManagerLoadURL, editor.opts.imageManagerLoadMethod)\n\n      var form_data = editor.drag_support.formdata ? new FormData() : null;\n      if (form_data) {\n        for (key in editor.opts.imageManagerLoadParams.params) {\n          if (Object.prototype.hasOwnProperty.call(editor.opts.imageManagerLoadParams.params, key)) {\n            form_data.append(key, editor.opts.imageManagerLoadParams.params[key]);\n          }\n        }\n      }\n\n      xhr.onload = function () {\n        editor.events.trigger('imageManager.imagesLoaded', [JSON.parse(xhr.responseText)]);\n        _processLoadedImages(JSON.parse(xhr.responseText), xhr.response);\n        $preloader.hide();\n      }\n      xhr.onerror = function () {\n        _throwError(ERROR_DURING_LOAD, xhr.response || xhr.responseText);\n      }\n\n      xhr.send(form_data);\n    }\n\n    // Throw missing imageManagerLoadURL option error.\n    else {\n      _throwError(MISSING_LOAD_URL_OPTION);\n    }\n  }\n\n  /*\n   * Process loaded images.\n   */\n  function _processLoadedImages (imgs, response) {\n    try {\n      $media_files.find('.fr-list-column').html('');\n      page = 0;\n      image_count = 0;\n      loaded_images = 0;\n      images = imgs;\n\n      // Load files.\n      _infiniteScroll();\n    }\n\n    // Throw error while parsing the response.\n    catch (ex) {\n      _throwError(LOAD_BAD_RESPONSE, response);\n    }\n  }\n\n  /*\n   * Load more images if necessary.\n   */\n  function _infiniteScroll () {\n\n    // If there aren't enough images in the modal or if the user scrolls down.\n    if (image_count < images.length &&\n      ($media_files.outerHeight() <= $body.outerHeight() + editor.opts.imageManagerScrollOffset ||\n      $body.scrollTop() + editor.opts.imageManagerScrollOffset > $media_files.outerHeight() - $body.outerHeight())) {\n\n      // Increase page number.\n      page++;\n\n      // Load each image on this page.\n      for (var i = editor.opts.imageManagerPageSize * (page - 1); i < Math.min(images.length, editor.opts.imageManagerPageSize * page); i++) {\n        _loadImage(images[i]);\n      }\n    }\n  }\n\n  /*\n   * Load file.\n   */\n  function _loadImage (image) {\n    var img = new Image();\n    var $img_container = $('<div class=\"fr-image-container fr-empty fr-image-' + (loaded_images++) + '\" data-loading=\"' + editor.language.translate('Loading') + '..\" data-deleting=\"' + editor.language.translate('Deleting') + '..\">');\n\n    // After adding image empty container modal might change its height.\n    _resizeModal(false);\n\n    // Image has been loaded.\n    img.onload = function () {\n\n      // Update image container height.\n      $img_container.height(Math.floor($img_container.width() / img.width * img.height));\n\n      // Create image HTML.\n      var $img = $('<img/>');\n\n      // Use image thumb in image manager.\n      if (image.thumb) {\n\n        // Set image src attribute/\n        $img.attr('src', image.thumb);\n      }\n\n      // Image does not have thumb.\n      else {\n\n        // Throw missing image thumb error.\n        _throwError(MISSING_IMG_THUMB, image);\n\n        // Set image URL as src attribute.\n        if (image.url) {\n          $img.attr('src', image.url);\n        }\n\n        // Missing image URL.\n        else {\n\n          // Throw missing image url error.\n          _throwError(MISSING_IMG_URL, image);\n\n          // Don't go further if image does not have a src attribute.\n\n          return false;\n        }\n      }\n\n      // Save image URL.\n      if (image.url) $img.attr('data-url', image.url);\n\n      // Image tags.\n      if (image.tag) {\n\n        // Show tags only if there are any.\n        $head.find('.fr-modal-more.fr-not-available').removeClass('fr-not-available');\n        $head.find('.fr-modal-tags').show();\n\n        // Image has more than one tag.\n        if (image.tag.indexOf(',') >= 0) {\n\n          // Add tags to the image manager tag list.\n          var tags = image.tag.split(',');\n\n          for (var i = 0; i < tags.length; i++) {\n\n            // Remove trailing spaces.\n            tags[i] = tags[i].trim();\n\n            // Add tag.\n            if ($image_tags.find('a[title=\"' + tags[i] + '\"]').length === 0) {\n              $image_tags.append('<a role=\"button\" title=\"' + tags[i] + '\">' + tags[i] + '</a>');\n            }\n          }\n\n          // Set img tag attribute.\n          $img.attr('data-tag', tags.join());\n        }\n\n        // Image has only one tag.\n        else {\n\n          // Add tag to the tag list.\n          if ($image_tags.find('a[title=\"' + image.tag.trim() + '\"]').length === 0) {\n            $image_tags.append('<a role=\"button\" title=\"' + image.tag.trim() + '\">' + image.tag.trim() + '</a>');\n          }\n\n          // Set img tag attribute.\n          $img.attr('data-tag', image.tag.trim());\n        }\n      }\n\n      // Image alt.\n      if (image.name) {\n        $img.attr('alt', image.name);\n      }\n\n      // Set image additional data.\n      for (var key in image) {\n        if (Object.prototype.hasOwnProperty.call(image, key)) {\n          if (key != 'thumb' && key != 'url' && key != 'tag') {\n            $img.attr('data-' + key, image[key]);\n          }\n        }\n      }\n\n      // Add image and insert and delete buttons to the image container.\n      $img_container\n        .append($img)\n        .append($(editor.icon.create('imageManagerDelete')).addClass('fr-delete-img').attr('title', editor.language.translate('Delete')))\n        .append($(editor.icon.create('imageManagerInsert')).addClass('fr-insert-img').attr('title', editor.language.translate('Insert')))\n\n      // Show image only if it has selected tags.\n      $image_tags.find('.fr-selected-tag').each (function (index, tag) {\n        if (!_imageHasTag($img, tag.text)) {\n          $img_container.hide();\n        }\n      });\n\n      // After an image is loaded the modal may need to be resized.\n      $img.on('load', function () {\n\n        // Image container is no longer empty.\n        $img_container.removeClass('fr-empty');\n        $img_container.height('auto');\n\n        // Increase image counter.\n        image_count++;\n\n        // A loded image may break the images order. Reorder them starting with this image.\n        var imgs = _getImages(parseInt($img.parent().attr('class').match(/fr-image-(\\d+)/)[1], 10) + 1);\n\n        // Reorder images.\n        _reorderImages(imgs);\n\n        // Image modal may need resizing.\n        _resizeModal(false);\n\n        // If this was the last image on page then we might need to load more.\n        if (image_count % editor.opts.imageManagerPageSize === 0) {\n          _infiniteScroll();\n        }\n      });\n\n      // Trigger imageLoaded event.\n      editor.events.trigger('imageManager.imageLoaded', [$img]);\n    };\n\n    // Error while loading the image.\n    img.onerror = function () {\n      image_count++;\n      $img_container.remove();\n\n      // Removing an image container may break image order.\n      var imgs = _getImages(parseInt($img_container.attr('class').match(/fr-image-(\\d+)/)[1], 10) + 1);\n\n      // Reorder images.\n      _reorderImages(imgs);\n\n      _throwError(BAD_LINK, image);\n\n      // If this was the last image on page then we might need to load more.\n      if (image_count % editor.opts.imageManagerPageSize === 0) {\n        _infiniteScroll();\n      }\n    };\n\n    // Set the image object's src.\n    img.src = image.thumb || image.url;\n\n    // Add loaded or empty image to the media manager image list on the shortest column.\n    _shortestColumn().append($img_container);\n  }\n\n  /*\n   * Get the shortest image column.\n   */\n  function _shortestColumn () {\n    var $col;\n    var min_height;\n\n    $media_files.find('.fr-list-column').each (function (index, col) {\n      var $column = $(col);\n\n      // Assume that the first column is the shortest.\n      if (index === 0) {\n        min_height = $column.outerHeight();\n        $col = $column;\n      }\n\n      // Check if another column is shorter.\n      else {\n        if ($column.outerHeight() < min_height) {\n          min_height = $column.outerHeight();\n          $col = $column;\n        }\n      }\n    });\n\n    return $col;\n  }\n\n  /*\n   * Get all images from the image manager.\n   */\n  function _getImages (from) {\n    if (from === undefined) from = 0;\n    var get_images = [];\n\n    for (var i = loaded_images - 1; i >= from; i--) {\n      var $image = $media_files.find('.fr-image-' + i);\n\n      if ($image.length) {\n        get_images.push($image);\n\n        // Add images here before deleting them so the on load callback is triggered.\n        $('<div id=\"fr-image-hidden-container\">').append($image);\n        $media_files.find('.fr-image-' + i).remove();\n      }\n    }\n\n    return get_images;\n  }\n\n  /*\n   * Add images back into the image manager.\n   */\n  function _reorderImages (imgs) {\n    for (var i = imgs.length - 1; i >= 0; i--) {\n      _shortestColumn().append(imgs[i]);\n    }\n  }\n\n  /*\n   * Resize the media manager modal if height changes.\n   */\n  function _resizeModal (infinite_scroll) {\n    if (infinite_scroll === undefined) infinite_scroll = true;\n\n    if (!$modal.isVisible()) return true;\n\n    // If width changes, the number of columns may change.\n    var cols = _columnNumber();\n\n    if (cols != column_number) {\n      column_number = cols;\n\n      // Get all images.\n      var imgs = _getImages();\n\n      // Remove current columns and add new ones.\n      _buildColumns();\n\n      // Reorder images.\n      _reorderImages(imgs);\n    }\n\n    editor.modals.resize(modal_id);\n\n    // Load more photos when window is resized if necessary.\n    if (infinite_scroll) {\n      _infiniteScroll();\n    }\n  }\n\n  function _getImageAttrs ($img) {\n    var img_attributes = {};\n    var img_data = $img.data();\n\n    for (var key in img_data) {\n      if (Object.prototype.hasOwnProperty.call(img_data, key)) {\n        if (key != 'url' && key != 'tag') {\n          img_attributes[key] = img_data[key];\n        }\n      }\n    }\n\n    return img_attributes;\n  }\n\n  /*\n   * Insert image into the editor.\n   */\n  function _insertImage (e) {\n\n    // Image to insert.\n    var $img = $(e.currentTarget).siblings('img');\n\n    var inst = $modal.data('instance') || editor;\n    var $current_image = $modal.data('current-image');\n\n    editor.modals.hide(modal_id);\n    inst.image.showProgressBar();\n\n    if (!$current_image) {\n\n      // Make sure we have focus.\n      inst.events.focus(true);\n      inst.selection.restore();\n\n      var rect = inst.position.getBoundingRect();\n\n      var left = rect.left + rect.width / 2 + $(editor.doc).scrollLeft();\n      var top = rect.top + rect.height + $(editor.doc).scrollTop();\n\n      // Show the image insert popup.\n      inst.popups.setContainer('image.insert', editor.$sc);\n      inst.popups.show('image.insert', left, top);\n    }\n    else {\n      $current_image.data('fr-old-src', $current_image.attr('src'));\n      $current_image.trigger('click');\n    }\n\n    inst.image.insert($img.data('url'), false, _getImageAttrs($img), $current_image);\n  }\n\n  /*\n   * Update tags.\n   */\n  function _updateTags () {\n    $modal.find('#fr-modal-tags > a').each (function () {\n\n      if ($modal.find('#fr-image-list [data-tag*=\"' + $(this).text() + '\"]').length === 0) {\n        $(this).removeClass('fr-selected-tag').hide();\n      }\n    });\n\n    _showImagesByTags();\n  }\n\n  /*\n   * Delete image.\n   */\n  function _deleteImage (e) {\n\n    // Image to delete.\n    var $img = $(e.currentTarget).siblings('img');\n\n    // Confirmation message.\n    var message = editor.language.translate('Are you sure? Image will be deleted.');\n\n    // Ask for confirmation.\n    if (confirm(message)) {\n\n      // If the images delete URL is set.\n      if (editor.opts.imageManagerDeleteURL) {\n\n        // Before delete image event.\n        if (editor.events.trigger('imageManager.beforeDeleteImage', [$img]) !== false) {\n          $img.parent().addClass('fr-image-deleting');\n\n          var xhr = editor.core.getXHR(editor.opts.imageManagerDeleteURL, editor.opts.imageManagerDeleteMethod)\n\n          var form_data = editor.drag_support.formdata ? new FormData() : null;\n          if (form_data) {\n            var params = Object.assign(Object.assign({ src: $img.attr('src') }, _getImageAttrs($img)), editor.opts.imageManagerDeleteParams);\n\n            for (key in params) {\n              if (Object.prototype.hasOwnProperty.call(params, key)) {\n                form_data.append(key, params[key]);\n              }\n            }\n          }\n\n          xhr.onload = function () {\n            editor.events.trigger('imageManager.imageDeleted', [JSON.parse(xhr.response)]);\n\n            // A deleted image may break the images order. Reorder them starting with this image.\n            var imgs = _getImages(parseInt($img.parent().attr('class').match(/fr-image-(\\d+)/)[1], 10) + 1);\n\n            // Remove the image.\n            $img.parent().remove();\n\n            // Reorder images.\n            _reorderImages(imgs);\n\n            // Update tags.\n            _updateTags();\n\n            // Modal needs resizing.\n            _resizeModal(true);\n          }\n          xhr.onerror = function () {\n            _throwError(ERROR_DURING_DELETE, xhr.response || xhr.responseText);\n          }\n\n          xhr.send(form_data);\n        }\n      }\n\n      // Throw missing imageManagerDeleteURL option error.\n      else {\n        _throwError(MISSING_DELETE_URL_OPTION);\n      }\n    }\n  }\n\n  /*\n   * Throw image manager errors.\n   */\n  function _throwError (code, response) {\n\n    // Load images error.\n    if (10 <= code && code < 20) {\n\n      // Hide preloader.\n      $preloader.hide();\n    }\n\n    // Delete image error.\n    else if (20 <= code && code < 30) {\n\n      // Remove deleting overlay.\n      $('.fr-image-deleting').removeClass('fr-image-deleting');\n    }\n\n    // Trigger error event.\n    editor.events.trigger('imageManager.error', [{\n      code: code,\n      message: error_messages[code]\n    }, response]);\n  }\n\n  /*\n   * Toogle (show or hide) image tags.\n   */\n  function _toggleTags () {\n    var title_height = $head.find('.fr-modal-head-line').outerHeight();\n    var tags_height = $image_tags.outerHeight();\n\n    // Use .fr-show-tags.\n    $head.toggleClass('fr-show-tags');\n\n    if ($head.hasClass('fr-show-tags')) {\n\n      // Show tags by changing height to have transition.\n      $head.css('height', title_height + tags_height);\n      $image_tags.find('a').css('opacity', 1);\n    }\n\n    else {\n\n      // Hide tags by changing height to have transition.\n      $head.css('height', title_height);\n      $image_tags.find('a').css('opacity', 0);\n    }\n  }\n\n  /*\n   * Show only images with selected tags.\n   */\n  function _showImagesByTags() {\n\n    // Get all selected tags.\n    var $tags = $image_tags.find('.fr-selected-tag');\n\n    // Show only images with selected tags.\n    if ($tags.length > 0) {\n\n      // Hide all images.\n      $media_files.find('img').parent().show();\n\n      // Show only images with tag.\n      $tags.each (function (index, tag) {\n        $media_files.find('img').each (function (index, img) {\n          var $img = $(img);\n\n          if (!_imageHasTag($img, tag.text)) {\n            $img.parent().hide();\n          }\n        });\n      });\n    }\n\n    // There are no more tags selected. Show all images.\n    else {\n      $media_files.find('img').parent().show();\n    }\n\n    // Rearrange images.\n    var imgs = _getImages();\n\n    // Reorder images.\n    _reorderImages(imgs);\n\n    // Load more images if necessary.\n    _infiniteScroll();\n  }\n\n  /*\n   * Select an image tag from the list.\n   */\n  function _selectTag (e) {\n    e.preventDefault();\n\n    // Toggle current tags class.\n    var $tag = $(e.currentTarget);\n    $tag.toggleClass('fr-selected-tag');\n\n    // Toggle selected tags.\n    if (editor.opts.imageManagerToggleTags) $tag.siblings('a').removeClass('fr-selected-tag');\n\n    // Change displayed images.\n    _showImagesByTags();\n  }\n\n  /*\n   * Method to check if an image has a specific tag.\n   */\n  function _imageHasTag ($image, tag) {\n    var tags = ($image.attr('data-tag') || '').split(',');\n\n    for (var i = 0; i < tags.length; i++) {\n      if (tags[i] == tag) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  function _delayedInit() {\n    $preloader = $modal.find('#fr-preloader');\n    $media_files = $modal.find('#fr-image-list');\n    $image_tags = $modal.find('#fr-modal-tags');\n\n    // Columns.\n    column_number = _columnNumber();\n    _buildColumns();\n\n    // Set height for title (we need this for show tags transition).\n    $head.css('height', $head.find('.fr-modal-head-line').outerHeight());\n\n    // Resize media manager modal on window resize.\n    editor.events.$on($(editor.o_win), 'resize', function () {\n\n      // Window resize with image manager opened.\n      if (images) {\n        _resizeModal(true);\n      }\n\n      // iOS window resize is triggered when modal first opens (no images loaded).\n      else {\n        _resizeModal(false);\n      }\n    });\n\n    // Delete and insert buttons for mobile.\n    if (editor.helpers.isMobile()) {\n\n      // Show image buttons on mobile.\n      editor.events.bindClick($media_files, 'div.fr-image-container', function (e) {\n        $modal.find('.fr-mobile-selected').removeClass('fr-mobile-selected');\n        $(e.currentTarget).addClass('fr-mobile-selected');\n      });\n\n      // Hide image buttons if we click outside it.\n      $modal.on(editor._mousedown, function () {\n        $modal.find('.fr-mobile-selected').removeClass('fr-mobile-selected');\n      });\n    }\n\n    // Insert image.\n    editor.events.bindClick($media_files, '.fr-insert-img', _insertImage);\n\n    // Delete image.\n    editor.events.bindClick($media_files, '.fr-delete-img', _deleteImage);\n\n    // Make sure we don't trigger blur.\n    $modal.on(editor._mousedown + ' ' + editor._mouseup, function (e) {\n      e.stopPropagation();\n    });\n\n    // Mouse down on anything.\n    $modal.on(editor._mousedown, '*', function () {\n      editor.events.disableBlur();\n    });\n\n    // Infinite scroll\n    $body.on('scroll', _infiniteScroll);\n\n    // Click on image tags button.\n    editor.events.bindClick($modal, 'i#fr-modal-more-' + editor.sid, _toggleTags);\n\n    // Select an image tag.\n    editor.events.bindClick($image_tags, 'a', _selectTag);\n  }\n\n  /*\n   * Init media manager.\n   */\n  function _init () {\n    if (!editor.$wp && editor.el.tagName != 'IMG') return false;\n  }\n\n  return {\n    require: ['image'],\n    _init: _init,\n    show: show,\n    hide: hide\n  }\n};\n\nif (!FE.PLUGINS.image) {\n  throw new Error('Image manager plugin requires image plugin.');\n}\n\nFE.DEFAULTS.imageInsertButtons.push('imageManager');\n\nFE.RegisterCommand('imageManager', {\n  title: 'Browse',\n  undo: false,\n  focus: false,\n  modal: true,\n  callback: function () {\n    this.imageManager.show();\n  },\n  plugin: 'imageManager'\n})\n\n// Add the font size icon.\nFE.DefineIcon('imageManager', {\n  NAME: 'folder'\n});\n\n// Add the font size icon.\nFE.DefineIcon('imageManagerInsert', {\n  NAME: 'plus'\n});\n\n// Add the font size icon.\nFE.DefineIcon('imageManagerDelete', {\n  NAME: 'trash'\n});","import FE from 'FroalaEditor';\n\nObject.assign(FE.DEFAULTS, {\n  inlineStyles: {\n    'Big Red': 'font-size: 20px; color: red;',\n    'Small Blue': 'font-size: 14px; color: blue;'\n  }\n})\n\nFE.PLUGINS.inlineStyle = function (editor) {\n  let $ = editor.$\n\n  function apply (val) {\n    if (editor.selection.text() !== '') {\n      var splits = val.split(';');\n\n      for (var i = 0; i < splits.length; i++) {\n        var new_split = splits[i].split(':');\n\n        if (splits[i].length && new_split.length == 2) {\n          editor.format.applyStyle(new_split[0].trim(), new_split[1].trim())\n        }\n      }\n    }\n    else {\n      editor.html.insert('<span style=\"' + val + '\">' + FE.INVISIBLE_SPACE + FE.MARKERS + '</span>');\n    }\n  }\n\n  return {\n    apply: apply\n  }\n}\n\n// Register the inline style command.\nFE.RegisterCommand('inlineStyle', {\n  type: 'dropdown',\n  html: function () {\n    var c = '<ul class=\"fr-dropdown-list\" role=\"presentation\">';\n    var options =  this.opts.inlineStyles;\n\n    for (var val in options) {\n      if (Object.prototype.hasOwnProperty.call(options, val)) {\n        c += '<li role=\"presentation\"><span style=\"' + options[val] + '\" role=\"presentation\"><a class=\"fr-command\" tabIndex=\"-1\" role=\"option\" data-cmd=\"inlineStyle\" data-param1=\"' + options[val] + '\" title=\"' + this.language.translate(val) + '\">' + this.language.translate(val) + '</a></span></li>';\n      }\n    }\n    c += '</ul>';\n\n    return c;\n  },\n  title: 'Inline Style',\n  callback: function (cmd, val) {\n    this.inlineStyle.apply(val);\n  },\n  plugin: 'inlineStyle'\n})\n\n// Add the font size icon.\nFE.DefineIcon('inlineStyle', {\n  NAME: 'paint-brush'\n});","import FE from 'FroalaEditor';\n\n// Extend defaults.\nObject.assign(FE.DEFAULTS, {\n  lineBreakerTags: ['table', 'hr', 'form', 'dl', 'span.fr-video', '.fr-embedly'],\n  lineBreakerOffset: 15,\n  lineBreakerHorizontalOffset: 10\n});\n\nFE.PLUGINS.lineBreaker = function (editor) {\n  let $ = editor.$\n\n  var $line_breaker;\n  var mouseDownFlag;\n  var mouseMoveTimer;\n\n  /*\n   * Show line breaker.\n   * Compute top, left, width and show the line breaker.\n   * tag1 and tag2 are the tags between which the line breaker must be showed.\n   * If tag1 is null then tag2 is the first tag in the editor.\n   * If tag2 is null then tag1 is the last tag in the editor.\n   */\n  function _show($tag1, $tag2) {\n\n    // Line breaker's possition and width.\n    var breakerTop;\n    var breakerLeft;\n    var breakerWidth;\n    var parent_tag;\n    var parent_top;\n    var parent_bottom;\n    var tag_top;\n    var tag_bottom;\n\n    // Mouse is over the first tag in the editor. Show line breaker above tag2.\n    if ($tag1 == null) {\n      // Compute line breaker's possition and width.\n      parent_tag = $tag2.parent();\n      parent_top = parent_tag.offset().top;\n      tag_top = $tag2.offset().top;\n\n      breakerTop = tag_top - Math.min((tag_top - parent_top) / 2, editor.opts.lineBreakerOffset);\n      breakerWidth = parent_tag.outerWidth();\n      breakerLeft = parent_tag.offset().left;\n    }\n\n    // Mouse is over the last tag in the editor. Show line breaker below tag1.\n    else if ($tag2 == null) {\n      // Compute line breaker's possition and width.\n      parent_tag = $tag1.parent();\n      parent_bottom = parent_tag.offset().top + parent_tag.outerHeight();\n      tag_bottom = $tag1.offset().top + $tag1.outerHeight();\n\n      if (parent_bottom < tag_bottom) {\n        parent_tag = $(parent_tag).parent();\n        parent_bottom = parent_tag.offset().top + parent_tag.outerHeight();\n      }\n\n      breakerTop = tag_bottom + Math.min(Math.abs(parent_bottom - tag_bottom) / 2, editor.opts.lineBreakerOffset);\n      breakerWidth = parent_tag.outerWidth();\n      breakerLeft = parent_tag.offset().left;\n    }\n\n    // Mouse is between the 2 tags.\n    else {\n      // Compute line breaker's possition and width.\n      parent_tag = $tag1.parent();\n      var tag1_bottom = $tag1.offset().top + $tag1.height();\n      var tag2_top = $tag2.offset().top;\n\n      // Tags may be on the same line, so there is no need for line breaker.\n      if (tag1_bottom > tag2_top) {\n        return false;\n      }\n\n      breakerTop = (tag1_bottom + tag2_top) / 2;\n      breakerWidth = parent_tag.outerWidth();\n      breakerLeft = parent_tag.offset().left;\n    }\n\n    if (editor.opts.iframe) {\n      breakerLeft += editor.$iframe.offset().left - editor.helpers.scrollLeft();\n      breakerTop += editor.$iframe.offset().top - editor.helpers.scrollTop();\n    }\n\n    editor.$box.append($line_breaker);\n\n    // Set line breaker's top, left and width.\n    $line_breaker.css('top', breakerTop - editor.win.pageYOffset);\n    $line_breaker.css('left', breakerLeft - editor.win.pageXOffset);\n    $line_breaker.css('width', breakerWidth);\n    $line_breaker.data('tag1', $tag1);\n    $line_breaker.data('tag2', $tag2);\n\n    // Show the line breaker.\n    $line_breaker.addClass('fr-visible').data('instance', editor);\n  }\n\n  /*\n   * Check tag siblings.\n   * The line breaker hould appear if there is no sibling or if the sibling is also in the line breaker tags list.\n   */\n  function _checkTagSiblings($tag, mouseY) {\n\n    // Tag's Y top and bottom coordinate.\n    var tag_top = $tag.offset().top;\n    var tag_bottom = $tag.offset().top + $tag.outerHeight();\n    var $sibling;\n    var tag;\n\n    // Only if the mouse is close enough to the bottom or top edges.\n    if (Math.abs(tag_bottom - mouseY) <= editor.opts.lineBreakerOffset ||\n      Math.abs(mouseY - tag_top) <= editor.opts.lineBreakerOffset) {\n\n      // Mouse is near bottom check for next sibling.\n      if (Math.abs(tag_bottom - mouseY) < Math.abs(mouseY - tag_top)) {\n        tag = $tag.get(0);\n        var next_node = tag.nextSibling;\n\n        while (next_node && next_node.nodeType == Node.TEXT_NODE && next_node.textContent.length === 0) {\n          next_node = next_node.nextSibling;\n        }\n\n        // Tag has next sibling.\n        if (next_node) {\n          $sibling = _checkTag(next_node);\n\n          // Sibling is in the line breaker tags list.\n          if ($sibling) {\n\n            // Show line breaker.\n            _show($tag, $sibling);\n\n            return true;\n          }\n\n          // No next sibling.\n        }\n        else {\n\n          // Show line breaker\n          _show($tag, null);\n\n          return true;\n        }\n      }\n\n      // Mouse is near top check for prev sibling.\n      else {\n        tag = $tag.get(0);\n\n        // No prev sibling.\n        if (!tag.previousSibling) {\n\n          // Show line breaker\n          _show(null, $tag);\n\n          return true;\n\n          // Tag has prev sibling.\n        }\n        else {\n          $sibling = _checkTag(tag.previousSibling);\n\n          // Sibling is in the line breaker tags list.\n          if ($sibling) {\n\n            // Show line breaker.\n            _show($sibling, $tag);\n\n            return true;\n          }\n        }\n      }\n    }\n\n    $line_breaker.removeClass('fr-visible').removeData('instance');\n  }\n\n  /*\n   * Check if tag is in the line breaker list and in the editor as well.\n   * Returns the tag from the line breaker list or false if the tag is not in the list.\n   */\n  function _checkTag(tag) {\n    if (tag) {\n      var $tag = $(tag);\n\n      // Make sure tag is inside the editor.\n      if (!editor.$el.contains(tag)) return null;\n\n      // Tag is in the line breaker tags list.\n      if (tag.nodeType != Node.TEXT_NODE && $tag.is(editor.opts.lineBreakerTags.join(','))) {\n\n        return $tag;\n      }\n\n      // Tag's parent is in the line breaker tags list.\n      else if ($tag.parents(editor.opts.lineBreakerTags.join(',')).length > 0) {\n        tag = $tag.parents(editor.opts.lineBreakerTags.join(',')).get(0);\n\n        if (!editor.$el.contains(tag) || !$(tag).is(editor.opts.lineBreakerTags.join(','))) return null;\n\n        return $(tag);\n      }\n    }\n\n    return null;\n  }\n\n  function _isInWp(tag) {\n    if (typeof tag.inFroalaWrapper != 'undefined') return tag.inFroalaWrapper;\n    var o_tag = tag;\n\n    while (tag.parentNode && tag.parentNode !== editor.$wp.get(0)) {\n      tag = tag.parentNode;\n    }\n\n    o_tag.inFroalaWrapper = (tag.parentNode == editor.$wp.get(0));\n\n    return o_tag.inFroalaWrapper;\n  }\n\n  /*\n   * Look for tag at the specified coordinates.\n   */\n  function _tagAt(x, y) {\n    var tag = editor.doc.elementFromPoint(x, y);\n\n    // We found a tag.\n    if (tag && !$(tag).closest('.fr-line-breaker').length && !editor.node.isElement(tag) && tag != editor.$wp.get(0) && _isInWp(tag)) {\n      return tag;\n    }\n\n    // No tag at x, y.\n    return null;\n  }\n\n  /*\n   * Look for tags above and bellow the specificed point.\n   */\n  function _searchTagVertically(x, y, step) {\n    var i = step;\n    var tag = null;\n\n    // Look up and down until a tag is found or the line breaker offset is reached.\n    while (i <= editor.opts.lineBreakerOffset && !tag) {\n\n      // Look for tag above.\n      tag = _tagAt(x, y - i);\n\n      if (!tag) {\n\n        // Look for tag below.\n        tag = _tagAt(x, y + i);\n      }\n\n      i += step;\n    }\n\n    return tag;\n  }\n\n  /*\n   * Look for tag left and right, up and down for each point.\n   */\n  function _searchTagHorizontally(x, y, direction) {\n    var tag = null;\n\n    // Do not check left / right too much.\n    var limit = 100;\n\n    // Look left / right until a tag is found or the editor margins are reached.\n    while (!tag && x > editor.$box.offset().left && x < editor.$box.offset().left + editor.$box.outerWidth() && limit > 0) {\n      tag = _tagAt(x, y);\n\n      // There's not tag here, look up and down.\n      if (!tag) {\n\n        // Look 5px up and 5 down.\n        tag = _searchTagVertically(x, y, 5);\n      }\n\n      // Move left or right.\n      if (direction == 'left') x -= editor.opts.lineBreakerHorizontalOffset;\n      else x += editor.opts.lineBreakerHorizontalOffset;\n\n      limit -= editor.opts.lineBreakerHorizontalOffset;\n    }\n\n    return tag;\n  }\n\n  /*\n   * Get the tag under the mouse cursor.\n   */\n  function _tagUnder(e) {\n    mouseMoveTimer = null;\n\n    // The tag for which the line breaker should be showed.\n    var $tag = null;\n    var tag = null;\n\n    // The tag under the mouse cursor.\n    var tag_under = editor.doc.elementFromPoint(e.pageX - editor.win.pageXOffset, e.pageY - editor.win.pageYOffset);\n\n    // Tag is the editor element. Look for closest tag above and bellow, left and right.\n    if (tag_under && (tag_under.tagName == 'HTML' || tag_under.tagName == 'BODY' || editor.node.isElement(tag_under) || (tag_under.getAttribute('class') || '').indexOf('fr-line-breaker') >= 0)) {\n\n      // Look 1px up and 1 down.\n      tag = _searchTagVertically(e.pageX - editor.win.pageXOffset, e.pageY - editor.win.pageYOffset, 1);\n\n      // Stil haven't found a tag, look left.\n      if (!tag) {\n        tag = _searchTagHorizontally(e.pageX - editor.win.pageXOffset - editor.opts.lineBreakerHorizontalOffset, e.pageY - editor.win.pageYOffset, 'left');\n      }\n\n      // Stil haven't found a tag, look right.\n      if (!tag) {\n        tag = _searchTagHorizontally(e.pageX - editor.win.pageXOffset + editor.opts.lineBreakerHorizontalOffset, e.pageY - editor.win.pageYOffset, 'right');\n      }\n\n      $tag = _checkTag(tag);\n\n      // Tag is not the editor element.\n    }\n    else {\n\n      // Check if the tag is in the line breaker list.\n      $tag = _checkTag(tag_under);\n    }\n\n    // Check tag siblings.\n    if ($tag) {\n      _checkTagSiblings($tag, e.pageY);\n    }\n    else if (editor.core.sameInstance($line_breaker)) {\n      $line_breaker.removeClass('fr-visible').removeData('instance');\n    }\n  }\n\n  /*\n   * Set mouse timer to improve performance.\n   */\n  function _mouseTimer(e) {\n    if ($line_breaker.hasClass('fr-visible') && !editor.core.sameInstance($line_breaker)) return false;\n\n    if (editor.popups.areVisible() || editor.el.querySelector('.fr-selected-cell')) {\n      $line_breaker.removeClass('fr-visible');\n\n      return true;\n    }\n\n    if (mouseDownFlag === false && !editor.edit.isDisabled()) {\n      if (mouseMoveTimer) {\n        clearTimeout(mouseMoveTimer);\n      }\n\n      mouseMoveTimer = setTimeout(_tagUnder, 30, e);\n    }\n  }\n\n  /*\n   * Hide line breaker and prevent timer from showing it again.\n   */\n  function _hide() {\n    if (mouseMoveTimer) {\n      clearTimeout(mouseMoveTimer);\n    }\n\n    if ($line_breaker.hasClass('fr-visible')) {\n      $line_breaker.removeClass('fr-visible').removeData('instance');\n    }\n  }\n\n  /*\n   * Notify that mouse is down and prevent line breaker from showing.\n   * This may happen either for selection or for drag.\n   */\n  function _mouseDown() {\n    mouseDownFlag = true;\n    _hide();\n  }\n\n  /*\n   * Notify that mouse is no longer pressed.\n   */\n  function _mouseUp() {\n    mouseDownFlag = false;\n  }\n\n  /*\n   * Add new line between the tags.\n   */\n  function _doLineBreak(e) {\n    e.preventDefault();\n\n    var instance = $line_breaker.data('instance') || editor;\n\n    // Hide the line breaker.\n    $line_breaker.removeClass('fr-visible').removeData('instance');\n\n    // Tags between which that line break needs to be done.\n    var $tag1 = $line_breaker.data('tag1');\n    var $tag2 = $line_breaker.data('tag2');\n\n    // P, DIV or none.\n    var default_tag = editor.html.defaultTag();\n\n    // The line break needs to be done before the first element in the editor.\n    if ($tag1 == null) {\n\n      // If the tag is in a TD tag then just add <br> no matter what the default_tag is.\n      if (default_tag && $tag2.parent().get(0).tagName != 'TD' && $tag2.parents(default_tag).length === 0) {\n        $tag2.before('<' + default_tag + '>' + FE.MARKERS + '<br></' + default_tag + '>')\n      }\n      else {\n        $tag2.before(FE.MARKERS + '<br>');\n      }\n\n      // The line break needs to be done either after the last element in the editor or between the 2 tags.\n      // Either way the line break is after the first tag.\n    }\n    else {\n\n      // If the tag is in a TD tag then just add <br> no matter what the default_tag is.\n      if (default_tag && $tag1.parent().get(0).tagName != 'TD' && $tag1.parents(default_tag).length === 0) {\n        $tag1.after('<' + default_tag + '>' + FE.MARKERS + '<br></' + default_tag + '>')\n      }\n      else {\n        $tag1.after(FE.MARKERS + '<br>');\n      }\n    }\n\n    // Cursor is now at the beginning of the new line.\n    instance.selection.restore();\n  }\n\n  /*\n   * Initialize the line breaker.\n   */\n  function _initLineBreaker() {\n\n    // Append line breaker HTML to editor wrapper.\n    if (!editor.shared.$line_breaker) {\n      editor.shared.$line_breaker = $('<div class=\"fr-line-breaker\"><a class=\"fr-floating-btn\" role=\"button\" tabIndex=\"-1\" title=\"' + editor.language.translate('Break') + '\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 32 32\"><rect x=\"21\" y=\"11\" width=\"2\" height=\"8\"/><rect x=\"14\" y=\"17\" width=\"7\" height=\"2\"/><path d=\"M14.000,14.000 L14.000,22.013 L9.000,18.031 L14.000,14.000 Z\"/></svg></a></div>');\n    }\n\n    $line_breaker = editor.shared.$line_breaker;\n\n    // Editor shared destroy.\n    editor.events.on('shared.destroy', function () {\n      $line_breaker.html('').removeData().remove();\n      $line_breaker = null;\n    }, true);\n\n    // Editor destroy.\n    editor.events.on('destroy', function () {\n      $('body').first($line_breaker.removeData('instance').removeClass('fr-visible'))\n      clearTimeout(mouseMoveTimer);\n    }, true)\n\n    editor.events.$on($line_breaker, 'mousemove', function (e) {\n      e.stopPropagation();\n    }, true)\n\n    // Add new line break.\n    editor.events.bindClick($line_breaker, 'a', _doLineBreak);\n  }\n\n  /*\n   * Tear up.\n   */\n  function _init() {\n    if (!editor.$wp) return false;\n\n    _initLineBreaker();\n\n    // Remember if mouse is clicked so the line breaker does not appear.\n    mouseDownFlag = false;\n\n    // Check tags under the mouse to see if the line breaker needs to be shown.\n    editor.events.$on(editor.$win, 'mousemove', _mouseTimer);\n\n    // Hide the line breaker if the page is scrolled.\n    editor.events.$on($(editor.win), 'scroll', _hide);\n\n    // Hide the line breaker on cell edit.\n    editor.events.on('popups.show.table.edit', _hide);\n\n    // Hide the line breaker after command is ran.\n    editor.events.on('commands.after', _hide);\n\n    // Prevent line breaker from showing while selecting text or dragging images.\n    editor.events.$on($(editor.win), 'mousedown', _mouseDown);\n\n    // Mouse is not pressed anymore, line breaker may be shown.\n    editor.events.$on($(editor.win), 'mouseup', _mouseUp);\n  }\n\n  return {\n    _init: _init\n  }\n};","import FE from 'FroalaEditor';\n\nObject.assign(FE.POPUP_TEMPLATES, {\n  'link.edit': '[_BUTTONS_]',\n  'link.insert': '[_BUTTONS_][_INPUT_LAYER_]'\n})\n\nObject.assign(FE.DEFAULTS, {\n  linkEditButtons: ['linkOpen', 'linkStyle', 'linkEdit', 'linkRemove'],\n  linkInsertButtons: ['linkBack', '|', 'linkList'],\n  linkAttributes: {},\n  linkAutoPrefix: 'http://',\n  linkStyles: {\n    'fr-green': 'Green',\n    'fr-strong': 'Thick'\n  },\n  linkMultipleStyles: true,\n  linkConvertEmailAddress: true,\n  linkAlwaysBlank: false,\n  linkAlwaysNoFollow: false,\n  linkNoOpener: true,\n  linkNoReferrer: true,\n  linkList: [\n    {\n      text: 'Froala',\n      href: 'https://froala.com',\n      target: '_blank'\n    },\n    {\n      text: 'Google',\n      href: 'https://google.com',\n      target: '_blank'\n    },\n    {\n      displayText: 'Facebook',\n      href: 'https://facebook.com'\n    }\n  ],\n  linkText: true\n});\n\nFE.PLUGINS.link = function (editor) {\n  let $ = editor.$\n\n  function get () {\n    var $current_image = editor.image ? editor.image.get() : null;\n\n    if (!$current_image && editor.$wp) {\n      var c_el = editor.selection.ranges(0).commonAncestorContainer;\n\n      try {\n        if (c_el && ((c_el.contains && c_el.contains(editor.el)) || !editor.el.contains(c_el) || editor.el == c_el)) c_el = null;\n      }\n      catch (ex) {\n        c_el = null;\n      }\n\n      if (c_el && c_el.tagName === 'A') return c_el;\n      var s_el = editor.selection.element();\n      var e_el = editor.selection.endElement();\n\n      if (s_el.tagName != 'A' && !editor.node.isElement(s_el)) {\n        s_el = $(s_el).parentsUntil(editor.$el, 'a').first().get(0);\n      }\n\n      if (e_el.tagName != 'A' && !editor.node.isElement(e_el)) {\n        e_el = $(e_el).parentsUntil(editor.$el, 'a').first().get(0);\n      }\n\n      try {\n        if (e_el && ((e_el.contains && e_el.contains(editor.el)) || !editor.el.contains(e_el) || editor.el == e_el)) e_el = null;\n      }\n      catch (ex) {\n        e_el = null;\n      }\n\n      try {\n        if (s_el && ((s_el.contains && s_el.contains(editor.el)) || !editor.el.contains(s_el) || editor.el == s_el)) s_el = null;\n      }\n      catch (ex) {\n        s_el = null;\n      }\n\n      if (e_el && e_el == s_el && e_el.tagName == 'A') {\n\n        // We do not clicking at the end / input of links because in IE the selection is changing shortly after mouseup.\n        // https://jsfiddle.net/jredzam3/\n        if ((editor.browser.msie || editor.helpers.isMobile()) && (editor.selection.info(s_el).atEnd || editor.selection.info(s_el).atStart)) {\n          return null;\n        }\n\n        return s_el;\n      }\n\n      return null;\n    }\n    else if (editor.el.tagName == 'A') {\n\n      return editor.el;\n    }\n    else {\n      if ($current_image && $current_image.get(0).parentNode && $current_image.get(0).parentNode.tagName == 'A') {\n\n        return $current_image.get(0).parentNode;\n      }\n    }\n  }\n\n  function allSelected () {\n    var $current_image = editor.image ? editor.image.get() : null;\n    var selectedLinks = [];\n\n    if ($current_image) {\n      if ($current_image.get(0).parentNode.tagName == 'A') {\n        selectedLinks.push($current_image.get(0).parentNode);\n      }\n    }\n    else {\n      var range;\n      var containerEl;\n      var links;\n      var linkRange;\n\n      if (editor.win.getSelection) {\n        var sel = editor.win.getSelection();\n\n        if (sel.getRangeAt && sel.rangeCount) {\n          linkRange = editor.doc.createRange();\n\n          for (var r = 0; r < sel.rangeCount; ++r) {\n            range = sel.getRangeAt(r);\n            containerEl = range.commonAncestorContainer;\n\n            if (containerEl && containerEl.nodeType != 1) {\n              containerEl = containerEl.parentNode;\n            }\n\n            if (containerEl && containerEl.nodeName.toLowerCase() == 'a') {\n              selectedLinks.push(containerEl);\n            }\n            else {\n              links = containerEl.getElementsByTagName('a');\n\n              for (var i = 0; i < links.length; ++i) {\n                linkRange.selectNodeContents(links[i]);\n\n                if (linkRange.compareBoundaryPoints(range.END_TO_START, range) < 1 && linkRange.compareBoundaryPoints(range.START_TO_END, range) > -1) {\n                  selectedLinks.push(links[i]);\n                }\n              }\n            }\n          }\n\n          // linkRange.detach();\n        }\n      }\n      else if (editor.doc.selection && editor.doc.selection.type != 'Control') {\n        range = editor.doc.selection.createRange();\n        containerEl = range.parentElement();\n\n        if (containerEl.nodeName.toLowerCase() == 'a') {\n          selectedLinks.push(containerEl);\n        }\n        else {\n          links = containerEl.getElementsByTagName('a');\n          linkRange = editor.doc.body.createTextRange();\n\n          for (var j = 0; j < links.length; ++j) {\n            linkRange.moveToElementText(links[j]);\n\n            if (linkRange.compareEndPoints('StartToEnd', range) > -1 && linkRange.compareEndPoints('EndToStart', range) < 1) {\n              selectedLinks.push(links[j]);\n            }\n          }\n        }\n      }\n    }\n\n    return selectedLinks;\n  }\n\n  function _edit (e) {\n    if (editor.core.hasFocus()) {\n      _hideEditPopup();\n\n      // Do not show edit popup for link when ALT is hit.\n      if (e && e.type === 'keyup' && (e.altKey || e.which == FE.KEYCODE.ALT)) return true;\n\n      setTimeout (function () {\n\n        // No event passed.\n        // Event passed and (left click or other event type).\n        if (!e || (e && (e.which == 1 || e.type != 'mouseup'))) {\n          var link = get();\n          var $current_image = editor.image ? editor.image.get() : null;\n\n          if (link && !$current_image) {\n            if (editor.image) {\n              var contents = editor.node.contents(link);\n\n              // https://github.com/froala/wysiwyg-editor/issues/1103\n              if (contents.length == 1 && contents[0].tagName == 'IMG') {\n                var range = editor.selection.ranges(0);\n\n                if (range.startOffset === 0 && range.endOffset === 0) {\n                  $(link).before(FE.MARKERS);\n                }\n                else {\n                  $(link).after(FE.MARKERS);\n                }\n\n                editor.selection.restore();\n\n                return false;\n              }\n            }\n\n            if (e) {\n              e.stopPropagation();\n            }\n            _showEditPopup(link);\n          }\n        }\n      }, editor.helpers.isIOS() ? 100 : 0);\n    }\n  }\n\n  function _showEditPopup (link) {\n    var $popup = editor.popups.get('link.edit');\n\n    if (!$popup) $popup = _initEditPopup();\n\n    var $link = $(link);\n\n    if (!editor.popups.isVisible('link.edit')) {\n      editor.popups.refresh('link.edit');\n    }\n    editor.popups.setContainer('link.edit', editor.$sc);\n    var left = $link.offset().left + $(link).outerWidth() / 2;\n    var top = $link.offset().top + $link.outerHeight();\n    editor.popups.show('link.edit', left, top, $link.outerHeight());\n  }\n\n  function _hideEditPopup () {\n    editor.popups.hide('link.edit');\n  }\n\n  function _initEditPopup () {\n\n    // Link buttons.\n    var link_buttons = '';\n\n    if (editor.opts.linkEditButtons.length >= 1) {\n      if (editor.el.tagName == 'A' && editor.opts.linkEditButtons.indexOf('linkRemove') >= 0) {\n        editor.opts.linkEditButtons.splice(editor.opts.linkEditButtons.indexOf('linkRemove'), 1);\n      }\n\n      link_buttons = '<div class=\"fr-buttons\">' + editor.button.buildList(editor.opts.linkEditButtons) + '</div>';\n    }\n\n    var template = {\n      buttons: link_buttons\n    };\n\n    // Set the template in the popup.\n    var $popup = editor.popups.create('link.edit', template);\n\n    if (editor.$wp) {\n      editor.events.$on(editor.$wp, 'scroll.link-edit', function () {\n        if (get() && editor.popups.isVisible('link.edit')) {\n          _showEditPopup(get());\n        }\n      });\n    }\n\n    return $popup;\n  }\n\n  /**\n   * Hide link insert popup.\n   */\n  function _hideInsertPopup () {\n  }\n\n  function _refreshInsertPopup () {\n    var $popup = editor.popups.get('link.insert');\n    var link = get();\n\n    if (link) {\n      var $link = $(link);\n      var text_inputs = $popup.find('input.fr-link-attr[type=\"text\"]');\n      var check_inputs = $popup.find('input.fr-link-attr[type=\"checkbox\"]');\n      var i;\n      var $input;\n\n      for (i = 0; i < text_inputs.length; i++) {\n        $input = $(text_inputs[i]);\n        $input.val($link.attr($input.attr('name') || ''));\n      }\n\n      check_inputs.attr('checked', false);\n\n      for (i = 0; i < check_inputs.length; i++) {\n        $input = $(check_inputs[i]);\n\n        if ($link.attr($input.attr('name')) == $input.data('checked')) {\n          $input.attr('checked', true);\n        }\n      }\n\n      $popup.find('input.fr-link-attr[type=\"text\"][name=\"text\"]').val($link.text());\n    }\n    else {\n      $popup.find('input.fr-link-attr[type=\"text\"]').val('');\n      $popup.find('input.fr-link-attr[type=\"checkbox\"]').attr('checked', false);\n      $popup.find('input.fr-link-attr[type=\"text\"][name=\"text\"]').val(editor.selection.text());\n    }\n    $popup.find('input.fr-link-attr').trigger('change');\n    var $current_image = editor.image ? editor.image.get() : null;\n\n    if ($current_image) {\n      $popup.find('.fr-link-attr[name=\"text\"]').parent().hide();\n    }\n    else {\n      $popup.find('.fr-link-attr[name=\"text\"]').parent().show();\n    }\n  }\n\n  function _showInsertPopup () {\n    var $btn = editor.$tb.find('.fr-command[data-cmd=\"insertLink\"]');\n    var $popup = editor.popups.get('link.insert');\n\n    if (!$popup) $popup = _initInsertPopup();\n\n    if (!$popup.hasClass('fr-active')) {\n      editor.popups.refresh('link.insert');\n      editor.popups.setContainer('link.insert', editor.$tb || editor.$sc);\n\n      if ($btn.isVisible()) {\n        var left = $btn.offset().left + $btn.outerWidth() / 2;\n        var top = $btn.offset().top + (editor.opts.toolbarBottom ? 10 : $btn.outerHeight() - 10);\n        editor.popups.show('link.insert', left, top, $btn.outerHeight());\n      }\n      else {\n        editor.position.forSelection($popup);\n        editor.popups.show('link.insert');\n      }\n    }\n  }\n\n  function _initInsertPopup (delayed) {\n    if (delayed) {\n      editor.popups.onRefresh('link.insert', _refreshInsertPopup);\n      editor.popups.onHide('link.insert', _hideInsertPopup);\n\n      return true;\n    }\n\n    // Image buttons.\n    var link_buttons = '';\n\n    if (editor.opts.linkInsertButtons.length >= 1) {\n      link_buttons = '<div class=\"fr-buttons\">' + editor.button.buildList(editor.opts.linkInsertButtons) + '</div>';\n    }\n\n    var checkmark = '<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"10\" height=\"10\" viewBox=\"0 0 32 32\"><path d=\"M27 4l-15 15-7-7-5 5 12 12 20-20z\" fill=\"#FFF\"></path></svg>';\n\n    // Image by url layer.\n    var input_layer = '';\n    var tab_idx = 0;\n    input_layer = '<div class=\"fr-link-insert-layer fr-layer fr-active\" id=\"fr-link-insert-layer-' + editor.id + '\">';\n    input_layer += '<div class=\"fr-input-line\"><input id=\"fr-link-insert-layer-url-' + editor.id + '\" name=\"href\" type=\"text\" class=\"fr-link-attr\" placeholder=\"' + editor.language.translate('URL') + '\" tabIndex=\"' + (++tab_idx) + '\"></div>';\n\n    if (editor.opts.linkText) {\n      input_layer += '<div class=\"fr-input-line\"><input id=\"fr-link-insert-layer-text-' + editor.id + '\" name=\"text\" type=\"text\" class=\"fr-link-attr\" placeholder=\"' + editor.language.translate('Text') + '\" tabIndex=\"' + (++tab_idx) + '\"></div>';\n    }\n\n    // Add any additional fields.\n    for (var attr in editor.opts.linkAttributes) {\n      if (Object.prototype.hasOwnProperty.call(editor.opts.linkAttributes, attr)) {\n        var placeholder = editor.opts.linkAttributes[attr];\n        input_layer += '<div class=\"fr-input-line\"><input name=\"' + attr + '\" type=\"text\" class=\"fr-link-attr\" placeholder=\"' + editor.language.translate(placeholder) + '\" tabIndex=\"' + (++tab_idx) + '\"></div>';\n      }\n    }\n\n    if (!editor.opts.linkAlwaysBlank) {\n      input_layer += '<div class=\"fr-checkbox-line\"><span class=\"fr-checkbox\"><input name=\"target\" class=\"fr-link-attr\" data-checked=\"_blank\" type=\"checkbox\" id=\"fr-link-target-' + editor.id + '\" tabIndex=\"' + (++tab_idx) + '\"><span>' + checkmark + '</span></span><label for=\"fr-link-target-' + editor.id + '\">' + editor.language.translate('Open in new tab') + '</label></div>';\n    }\n\n    input_layer += '<div class=\"fr-action-buttons\"><button class=\"fr-command fr-submit\" role=\"button\" data-cmd=\"linkInsert\" href=\"#\" tabIndex=\"' + (++tab_idx) + '\" type=\"button\">' + editor.language.translate('Insert') + '</button></div></div>'\n\n    var template = {\n      buttons: link_buttons,\n      input_layer: input_layer\n    }\n\n    // Set the template in the popup.\n    var $popup = editor.popups.create('link.insert', template);\n\n    if (editor.$wp) {\n      editor.events.$on(editor.$wp, 'scroll.link-insert', function () {\n        var $current_image = editor.image ? editor.image.get() : null;\n\n        if ($current_image && editor.popups.isVisible('link.insert')) {\n          imageLink();\n        }\n\n        if (get && editor.popups.isVisible('link.insert')) {\n          update();\n        }\n      });\n    }\n\n    return $popup;\n  }\n\n  function remove () {\n    var link = get();\n\n    var $current_image = editor.image ? editor.image.get() : null;\n\n    if (editor.events.trigger('link.beforeRemove', [link]) === false) return false;\n\n    if ($current_image && link) {\n      $current_image.unwrap();\n      editor.image.edit($current_image);\n    }\n    else if (link) {\n      editor.selection.save();\n      $(link).replaceWith($(link).html());\n      editor.selection.restore();\n      _hideEditPopup();\n    }\n  }\n\n  function _init () {\n\n    // Edit on keyup.\n    editor.events.on('keyup', function (e) {\n      if (e.which != FE.KEYCODE.ESC) {\n        _edit(e);\n      }\n    });\n\n    editor.events.on('window.mouseup', _edit);\n\n    // Do not follow links when edit is disabled.\n    editor.events.$on(editor.$el, 'click', 'a', function (e) {\n      if (editor.edit.isDisabled()) {\n        e.preventDefault();\n      }\n    });\n\n    if (editor.helpers.isMobile()) {\n      editor.events.$on(editor.$doc, 'selectionchange', _edit);\n    }\n\n    _initInsertPopup(true);\n\n    // Init on link.\n    if (editor.el.tagName == 'A') {\n      editor.$el.addClass('fr-view');\n    }\n\n    // Hit ESC when focus is in link edit popup.\n    editor.events.on('toolbar.esc', function () {\n      if (editor.popups.isVisible('link.edit')) {\n        editor.events.disableBlur();\n        editor.events.focus();\n\n        return false;\n      }\n    }, true);\n  }\n\n  function usePredefined (val) {\n    var link = editor.opts.linkList[val];\n    var $popup = editor.popups.get('link.insert');\n    var text_inputs = $popup.find('input.fr-link-attr[type=\"text\"]');\n    var check_inputs = $popup.find('input.fr-link-attr[type=\"checkbox\"]');\n    var $input;\n    var i;\n\n    for (i = 0; i < text_inputs.length; i++) {\n      $input = $(text_inputs[i]);\n\n      if (link[$input.attr('name')]) {\n        $input.val(link[$input.attr('name')]);\n      }\n      else if ($input.attr('name') != 'text') {\n        $input.val('');\n      }\n    }\n\n    for (i = 0; i < check_inputs.length; i++) {\n      $input = $(check_inputs[i]);\n      $input.attr('checked', $input.data('checked') == link[$input.attr('name')]);\n    }\n    editor.accessibility.focusPopup($popup);\n  }\n\n  function insertCallback () {\n    var $popup = editor.popups.get('link.insert');\n    var text_inputs = $popup.find('input.fr-link-attr[type=\"text\"]');\n    var check_inputs = $popup.find('input.fr-link-attr[type=\"checkbox\"]');\n    var href = (text_inputs.filter('[name=\"href\"]').val() || '').trim();\n    var text = text_inputs.filter('[name=\"text\"]').val();\n    var attrs = {};\n    var $input;\n    var i;\n\n    for (i = 0; i < text_inputs.length; i++) {\n      $input = $(text_inputs[i]);\n\n      if (['href', 'text'].indexOf($input.attr('name')) < 0) {\n        attrs[$input.attr('name')] = $input.val();\n      }\n    }\n\n    for (i = 0; i < check_inputs.length; i++) {\n      $input = $(check_inputs[i]);\n\n      if ($input.is(':checked')) {\n        attrs[$input.attr('name')] = $input.data('checked');\n      }\n      else {\n        attrs[$input.attr('name')] = $input.data('unchecked') || null;\n      }\n    }\n\n    var t = editor.helpers.scrollTop();\n    insert(href, text, attrs);\n    $(editor.o_win).scrollTop(t);\n  }\n\n  function _split () {\n    if (!editor.selection.isCollapsed()) {\n      editor.selection.save();\n      var markers = editor.$el.find('.fr-marker').addClass('fr-unprocessed').toArray();\n\n      while (markers.length) {\n        var $marker = $(markers.pop());\n        $marker.removeClass('fr-unprocessed');\n\n        // Get deepest parent.\n        var deep_parent = editor.node.deepestParent($marker.get(0));\n\n        if (deep_parent) {\n          var node = $marker.get(0);\n          var close_str = '';\n          var open_str = '';\n\n          do {\n            node = node.parentNode;\n\n            if (!editor.node.isBlock(node)) {\n              close_str = close_str + editor.node.closeTagString(node);\n              open_str = editor.node.openTagString(node) + open_str;\n            }\n          } while (node != deep_parent);\n\n          var marker_str = editor.node.openTagString($marker.get(0)) + $marker.html() +  editor.node.closeTagString($marker.get(0));\n\n          $marker.replaceWith('<span id=\"fr-break\"></span>');\n          var h = deep_parent.outerHTML;\n\n          h = h.replace(/<span id=\"fr-break\"><\\/span>/g, close_str + marker_str + open_str);\n\n          deep_parent.outerHTML = h;\n        }\n\n        markers = editor.$el.find('.fr-marker.fr-unprocessed').toArray();\n      }\n\n      editor.html.cleanEmptyTags();\n\n      editor.selection.restore();\n    }\n  }\n\n  /**\n   * Insert link into the editor.\n   */\n  function insert (href, text, attrs) {\n    if (typeof attrs == 'undefined') attrs = {};\n\n    if (editor.events.trigger('link.beforeInsert', [href, text, attrs]) === false) return false;\n\n    // Get image if we have one selected.\n    var $current_image = editor.image ? editor.image.get() : null;\n\n    if (!$current_image && editor.el.tagName != 'A') {\n      editor.selection.restore();\n      editor.popups.hide('link.insert');\n    }\n    else if (editor.el.tagName == 'A') {\n      editor.$el.focus();\n    }\n\n    var original_href = href;\n\n    // Convert email address.\n    if (editor.opts.linkConvertEmailAddress) {\n      if (editor.helpers.isEmail(href) && !/^mailto:.*/i.test(href)) {\n        href = 'mailto:' + href;\n      }\n    }\n\n    // Check if is local path.\n    var local_path = /^([A-Za-z]:(\\\\){1,2}|[A-Za-z]:((\\\\){1,2}[^\\\\]+)+)(\\\\)?$/i;\n\n    // Add autoprefix.\n    if (editor.opts.linkAutoPrefix !== '' && !new RegExp('^(' + FE.LinkProtocols.join('|') + '):.', 'i').test(href) && !/^data:image.*/i.test(href) && !/^(https?:|ftps?:|file:|)\\/\\//i.test(href) && !local_path.test(href)) {\n\n      // Do prefix only if starting character is not absolute.\n      if (['/', '{', '[', '#', '(', '.'].indexOf((href || '')[0]) < 0) {\n        href = editor.opts.linkAutoPrefix + editor.helpers.sanitizeURL(href);\n      }\n    }\n\n    // Sanitize the URL.\n    href = editor.helpers.sanitizeURL(href);\n\n    // Default attributs.\n    if (editor.opts.linkAlwaysBlank) attrs.target = '_blank';\n\n    if (editor.opts.linkAlwaysNoFollow) attrs.rel = 'nofollow';\n\n    // https://github.com/froala/wysiwyg-editor/issues/1576.\n    if (attrs.target == '_blank') {\n      if (editor.opts.linkNoOpener) {\n        if (!attrs.rel) attrs.rel = 'noopener';\n        else attrs.rel += ' noopener';\n      }\n\n      if (editor.opts.linkNoReferrer) {\n        if (!attrs.rel) attrs.rel = 'noreferrer';\n        else attrs.rel += ' noreferrer';\n      }\n    }\n    else if (attrs.target == null) {\n      if (attrs.rel) {\n        attrs.rel = attrs.rel.replace(/noopener/, '').replace(/noreferrer/, '');\n      }\n      else {\n        attrs.rel = null;\n      }\n    }\n\n    // Format text.\n    text = text || '';\n\n    if (href === editor.opts.linkAutoPrefix) {\n      var $popup = editor.popups.get('link.insert');\n      $popup.find('input[name=\"href\"]').addClass('fr-error');\n      editor.events.trigger('link.bad', [original_href]);\n\n      return false;\n    }\n\n    // Check if we have selection only in one link.\n    var link = get();\n    var $link;\n\n    if (link) {\n      $link = $(link);\n\n      $link.attr('href', href);\n\n      // Change text if it is different.\n      if (text.length > 0 && $link.text() != text && !$current_image) {\n        var child = $link.get(0);\n\n        while (child.childNodes.length === 1 && child.childNodes[0].nodeType == Node.ELEMENT_NODE) {\n          child = child.childNodes[0];\n        }\n\n        $(child).text(text);\n      }\n\n      if (!$current_image) {\n        $link\n          .prepend(FE.START_MARKER)\n          .append(FE.END_MARKER);\n      }\n\n      // Set attributes.\n      $link.attr(attrs);\n\n      if (!$current_image) {\n        editor.selection.restore();\n      }\n    }\n    else {\n\n      // We don't have any image selected.\n      if (!$current_image) {\n\n        // Remove current links.\n        editor.format.remove('a');\n\n        // Nothing is selected.\n        if (editor.selection.isCollapsed()) {\n          text = (text.length === 0 ? original_href : text);\n          editor.html.insert('<a href=\"' + href + '\">' + FE.START_MARKER + text.replace(/&/g, '&amp;') + FE.END_MARKER + '</a>');\n          editor.selection.restore();\n        }\n        else {\n          if (text.length > 0 && text != editor.selection.text().replace(/\\n/g, '')) {\n            editor.selection.remove();\n            editor.html.insert('<a href=\"' + href + '\">' + FE.START_MARKER + text.replace(/&/g, '&amp;') + FE.END_MARKER + '</a>');\n            editor.selection.restore();\n          }\n          else {\n            _split();\n\n            // Add link.\n            editor.format.apply('a', { href: href });\n          }\n        }\n      }\n      else {\n\n        // Just wrap current image with a link.\n        $current_image.wrap('<a href=\"' + href + '\"></a>');\n      }\n\n      // Set attributes.\n      var links = allSelected();\n\n      for (var i = 0; i < links.length; i++) {\n        $link = $(links[i]);\n        $link.attr(attrs);\n        $link.removeAttr('_moz_dirty');\n      }\n\n      // Show link edit if only one link.\n      if (links.length == 1 && editor.$wp && !$current_image) {\n        $(links[0])\n          .prepend(FE.START_MARKER)\n          .append(FE.END_MARKER);\n\n        editor.selection.restore();\n      }\n    }\n\n    // Hide popup and try to edit.\n    if (!$current_image) {\n      _edit();\n    }\n    else {\n      var $pop = editor.popups.get('link.insert');\n\n      if ($pop) {\n        $pop.find('input:focus').blur();\n      }\n\n      editor.image.edit($current_image);\n    }\n  }\n\n  function update () {\n    _hideEditPopup();\n\n    var link = get();\n\n    if (link) {\n      var $popup = editor.popups.get('link.insert');\n\n      if (!$popup) $popup = _initInsertPopup();\n\n      if (!editor.popups.isVisible('link.insert')) {\n        editor.popups.refresh('link.insert');\n        editor.selection.save();\n\n        if (editor.helpers.isMobile()) {\n          editor.events.disableBlur();\n          editor.$el.blur();\n          editor.events.enableBlur();\n        }\n      }\n\n      editor.popups.setContainer('link.insert', editor.$sc);\n      var $ref = (editor.image ? editor.image.get() : null) || $(link);\n      var left = $ref.offset().left + $ref.outerWidth() / 2;\n      var top = $ref.offset().top + $ref.outerHeight();\n\n      editor.popups.show('link.insert', left, top, $ref.outerHeight());\n    }\n  }\n\n  function back () {\n    var $current_image = editor.image ? editor.image.get() : null;\n\n    if (!$current_image) {\n      editor.events.disableBlur();\n      editor.selection.restore();\n      editor.events.enableBlur();\n\n      var link = get();\n\n      if (link && editor.$wp) {\n        editor.selection.restore();\n        _hideEditPopup();\n        _edit();\n      }\n      else if (editor.el.tagName == 'A') {\n        editor.$el.focus();\n        _edit();\n      }\n      else {\n        editor.popups.hide('link.insert');\n        editor.toolbar.showInline();\n      }\n    }\n    else {\n      editor.image.back();\n    }\n  }\n\n  function imageLink () {\n    var $el = editor.image ? editor.image.getEl() : null;\n\n    if ($el) {\n      var $popup = editor.popups.get('link.insert');\n\n      if (editor.image.hasCaption()) {\n        $el = $el.find('.fr-img-wrap');\n      }\n\n      if (!$popup) $popup = _initInsertPopup();\n      _refreshInsertPopup(true);\n      editor.popups.setContainer('link.insert', editor.$sc);\n      var left = $el.offset().left + $el.outerWidth() / 2;\n      var top = $el.offset().top + $el.outerHeight();\n\n      editor.popups.show('link.insert', left, top, $el.outerHeight());\n    }\n  }\n\n  /**\n   * Apply specific style.\n   */\n  function applyStyle (val, linkStyles, multipleStyles) {\n    if (typeof multipleStyles == 'undefined') multipleStyles = editor.opts.linkMultipleStyles;\n\n    if (typeof linkStyles == 'undefined') linkStyles = editor.opts.linkStyles;\n    var link = get();\n\n    if (!link) return false;\n\n    // Remove multiple styles.\n    if (!multipleStyles) {\n      var styles = Object.keys(linkStyles);\n      styles.splice(styles.indexOf(val), 1);\n      $(link).removeClass(styles.join(' '));\n    }\n\n    $(link).toggleClass(val);\n\n    _edit();\n  }\n\n  return {\n    _init: _init,\n    remove: remove,\n    showInsertPopup: _showInsertPopup,\n    usePredefined: usePredefined,\n    insertCallback: insertCallback,\n    insert: insert,\n    update: update,\n    get: get,\n    allSelected: allSelected,\n    back: back,\n    imageLink: imageLink,\n    applyStyle: applyStyle\n  }\n}\n\n// Register the link command.\nFE.DefineIcon('insertLink', { NAME: 'link' });\nFE.RegisterShortcut(FE.KEYCODE.K, 'insertLink', null, 'K');\nFE.RegisterCommand('insertLink', {\n  title: 'Insert Link',\n  undo: false,\n  focus: true,\n  refreshOnCallback: false,\n  popup: true,\n  callback: function () {\n    if (!this.popups.isVisible('link.insert')) {\n      this.link.showInsertPopup();\n    }\n    else {\n      if (this.$el.find('.fr-marker').length) {\n        this.events.disableBlur();\n        this.selection.restore();\n      }\n      this.popups.hide('link.insert');\n    }\n  },\n  plugin: 'link'\n})\n\nFE.DefineIcon('linkOpen', {\n  NAME: 'external-link',\n  FA5NAME: 'external-link-alt'\n});\nFE.RegisterCommand('linkOpen', {\n  title: 'Open Link',\n  undo: false,\n  refresh: function ($btn) {\n    var link = this.link.get();\n\n    if (link) {\n      $btn.removeClass('fr-hidden');\n    }\n    else {\n      $btn.addClass('fr-hidden');\n    }\n  },\n  callback: function () {\n    var link = this.link.get();\n\n    if (link) {\n      this.o_win.open(link.href, '_blank', 'noopener');\n\n      this.popups.hide('link.edit');\n    }\n  },\n  plugin: 'link'\n})\n\nFE.DefineIcon('linkEdit', { NAME: 'edit' });\nFE.RegisterCommand('linkEdit', {\n  title: 'Edit Link',\n  undo: false,\n  refreshAfterCallback: false,\n  popup: true,\n  callback: function () {\n    this.link.update();\n  },\n  refresh: function ($btn) {\n    var link = this.link.get();\n\n    if (link) {\n      $btn.removeClass('fr-hidden');\n    }\n    else {\n      $btn.addClass('fr-hidden');\n    }\n  },\n  plugin: 'link'\n})\n\nFE.DefineIcon('linkRemove', { NAME: 'unlink' });\nFE.RegisterCommand('linkRemove', {\n  title: 'Unlink',\n  callback: function () {\n    this.link.remove();\n  },\n  refresh: function ($btn) {\n    var link = this.link.get();\n\n    if (link) {\n      $btn.removeClass('fr-hidden');\n    }\n    else {\n      $btn.addClass('fr-hidden');\n    }\n  },\n  plugin: 'link'\n})\n\nFE.DefineIcon('linkBack', { NAME: 'arrow-left' });\nFE.RegisterCommand('linkBack', {\n  title: 'Back',\n  undo: false,\n  focus: false,\n  back: true,\n  refreshAfterCallback: false,\n  callback: function () {\n    this.link.back();\n  },\n  refresh: function ($btn) {\n    var link = this.link.get() && this.doc.hasFocus();\n    var $current_image = this.image ? this.image.get() : null;\n\n    if (!$current_image && !link && !this.opts.toolbarInline) {\n      $btn.addClass('fr-hidden');\n      $btn.next('.fr-separator').addClass('fr-hidden');\n    }\n    else {\n      $btn.removeClass('fr-hidden');\n      $btn.next('.fr-separator').removeClass('fr-hidden');\n    }\n  },\n  plugin: 'link'\n});\n\nFE.DefineIcon('linkList', { NAME: 'search' });\nFE.RegisterCommand('linkList', {\n  title: 'Choose Link',\n  type: 'dropdown',\n  focus: false,\n  undo: false,\n  refreshAfterCallback: false,\n  html: function () {\n    var c = '<ul class=\"fr-dropdown-list\" role=\"presentation\">';\n    var options =  this.opts.linkList;\n\n    for (var i = 0; i < options.length; i++) {\n      c += '<li role=\"presentation\"><a class=\"fr-command\" tabIndex=\"-1\" role=\"option\" data-cmd=\"linkList\" data-param1=\"' + i + '\">' + (options[i].displayText || options[i].text) + '</a></li>';\n    }\n    c += '</ul>';\n\n    return c;\n  },\n  callback: function (cmd, val) {\n    this.link.usePredefined(val);\n  },\n  plugin: 'link'\n})\n\nFE.RegisterCommand('linkInsert', {\n  focus: false,\n  refreshAfterCallback: false,\n  callback: function () {\n    this.link.insertCallback();\n  },\n  refresh: function ($btn) {\n    var link = this.link.get();\n\n    if (link) {\n      $btn.text(this.language.translate('Update'));\n    }\n    else {\n      $btn.text(this.language.translate('Insert'));\n    }\n  },\n  plugin: 'link'\n})\n\n// Image link.\nFE.DefineIcon('imageLink', { NAME: 'link' })\nFE.RegisterCommand('imageLink', {\n  title: 'Insert Link',\n  undo: false,\n  focus: false,\n  popup: true,\n  callback: function () {\n    this.link.imageLink();\n  },\n  refresh: function ($btn) {\n    var link = this.link.get();\n    var $prev;\n\n    if (link) {\n      $prev = $btn.prev();\n\n      if ($prev.hasClass('fr-separator')) {\n        $prev.removeClass('fr-hidden');\n      }\n\n      $btn.addClass('fr-hidden');\n    }\n    else {\n      $prev = $btn.prev();\n\n      if ($prev.hasClass('fr-separator')) {\n        $prev.addClass('fr-hidden');\n      }\n\n      $btn.removeClass('fr-hidden');\n    }\n  },\n  plugin: 'link'\n})\n\n// Link styles.\nFE.DefineIcon('linkStyle', { NAME: 'magic' })\nFE.RegisterCommand('linkStyle', {\n  title: 'Style',\n  type: 'dropdown',\n  html: function () {\n    var c = '<ul class=\"fr-dropdown-list\" role=\"presentation\">';\n    var options =  this.opts.linkStyles;\n\n    for (var cls in options) {\n      if (Object.prototype.hasOwnProperty.call(options, cls)) {\n        c += '<li role=\"presentation\"><a class=\"fr-command\" tabIndex=\"-1\" role=\"option\" data-cmd=\"linkStyle\" data-param1=\"' + cls + '\">' + this.language.translate(options[cls]) + '</a></li>';\n      }\n    }\n    c += '</ul>';\n\n    return c;\n  },\n  callback: function (cmd, val) {\n    this.link.applyStyle(val);\n  },\n  refreshOnShow: function ($btn, $dropdown) {\n    var link = this.link.get();\n\n    if (link) {\n      var $link = $(link);\n\n      $dropdown.find('.fr-command').each (function () {\n        var cls = $(this).data('param1');\n        var active = $link.hasClass(cls);\n        $(this).toggleClass('fr-active', active).attr('aria-selected', active);\n      })\n    }\n  },\n  refresh: function ($btn) {\n    var link = this.link.get();\n\n    if (link) {\n      $btn.removeClass('fr-hidden');\n    }\n    else {\n      $btn.addClass('fr-hidden');\n    }\n  },\n  plugin: 'link'\n})","import FE from 'FroalaEditor';\n\nFE.PLUGINS.lists = function (editor) {\n  let $ = editor.$\n\n  function _openFlag(tag_name) {\n    return '<span class=\"fr-open-' + tag_name.toLowerCase() + '\"></span>';\n  }\n\n  function _closeFlag(tag_name) {\n    return '<span class=\"fr-close-' + tag_name.toLowerCase() + '\"></span>';\n  }\n\n  /**\n   * Replace list type.\n   */\n  function _replace(blocks, tag_name) {\n    var lists = [];\n\n    for (var i = 0; i < blocks.length; i++) {\n      var parent_node = blocks[i].parentNode;\n\n      if (blocks[i].tagName == 'LI' && parent_node.tagName != tag_name && lists.indexOf(parent_node) < 0) {\n        lists.push(parent_node);\n      }\n    }\n\n    for (i = lists.length - 1; i >= 0; i--) {\n      var $l = $(lists[i]);\n      $l.replaceWith('<' + tag_name.toLowerCase() + ' ' + editor.node.attributes($l.get(0)) + '>' + $l.html() + '</' + tag_name.toLowerCase() + '>');\n    }\n  }\n\n  /**\n   * Format blocks.\n   */\n  function _format(blocks, tag_name) {\n    _replace(blocks, tag_name);\n\n    // Format those blocks that are not LI.\n    var default_tag = editor.html.defaultTag();\n\n    var start_margin = null;\n\n    var prop;\n\n    if (blocks.length) prop = (editor.opts.direction == 'rtl' || $(blocks[0]).css('direction') == 'rtl') ? 'margin-right' : 'margin-left';\n\n    for (var i = 0; i < blocks.length; i++) {\n      if (blocks[i].tagName != 'LI') {\n\n        // Get margin left and unset it.\n        var margin_left = editor.helpers.getPX($(blocks[i]).css(prop)) || 0;\n        blocks[i].style.marginLeft = null;\n\n        // Start indentation relative to the first element.\n        if (start_margin === null) start_margin = margin_left;\n\n        // Update open tag.\n        var open_tag = start_margin > 0 ? '<' + tag_name + ' style=\"' + prop + ': ' + start_margin + 'px;\"' + '>' : '<' + tag_name + '>';\n        var end_tag = '</' + tag_name + '>';\n\n        // Subsctract starting.\n        margin_left = margin_left - start_margin;\n\n        // Keep wrapping.\n        while (margin_left / editor.opts.indentMargin > 0) {\n          open_tag += '<' + tag_name + '>';\n          end_tag += end_tag;\n          margin_left = margin_left - editor.opts.indentMargin;\n        }\n\n        // Default tag.\n        if (default_tag && blocks[i].tagName.toLowerCase() == default_tag) {\n          $(blocks[i]).replaceWith(open_tag + '<li' + editor.node.attributes(blocks[i]) + '>' + $(blocks[i]).html() + '</li>' + end_tag);\n        }\n        else {\n          blocks[i].outerHTML = `${open_tag}<li>${blocks[i].outerHTML}</li>${end_tag}`\n        }\n      }\n    }\n\n    editor.clean.lists();\n  }\n\n  /**\n   * Unformat.\n   */\n  function _unformat(blocks) {\n    var i;\n    var j;\n\n    // If there are LI that have parents selected, then remove them.\n    for (i = blocks.length - 1; i >= 0; i--) {\n      for (j = i - 1; j >= 0; j--) {\n        if ($(blocks[j]).find(blocks[i]).length || blocks[j] == blocks[i]) {\n          blocks.splice(i, 1);\n          break;\n        }\n      }\n    }\n\n    // Unwrap remaining LI.\n    var lists = [];\n\n    for (i = 0; i < blocks.length; i++) {\n      var $li = $(blocks[i]);\n      var parent_node = blocks[i].parentNode;\n      var li_class = $li.attr('class');\n\n      $li.before(_closeFlag(parent_node.tagName));\n\n      // Nested case.\n      if (parent_node.parentNode.tagName == 'LI') {\n        $li.before(_closeFlag('LI'));\n        $li.after(_openFlag('LI'));\n      }\n      else {\n        var li_attrs = '';\n\n        // https://github.com/froala/wysiwyg-editor/issues/1765 .\n        if (li_class) {\n          li_attrs += ' class=\"' + li_class + '\"';\n        }\n\n        var prop = (editor.opts.direction == 'rtl' || $li.css('direction') == 'rtl') ? 'margin-right' : 'margin-left';\n\n        if (editor.helpers.getPX($(parent_node).css(prop)) && ($(parent_node).attr('style') || '').indexOf(prop + ':') >= 0) {\n          li_attrs += ' style=\"' + prop + ':' + editor.helpers.getPX($(parent_node).css(prop)) + 'px;\"';\n        }\n\n        // When we have a default tag.\n        if (editor.html.defaultTag()) {\n\n          // If there are no inner block tags, put everything in a default tag.\n          if ($li.find(editor.html.blockTagsQuery()).length === 0) {\n            $li.html(`<${editor.html.defaultTag()}${li_attrs}>${$li.html()}</${editor.html.defaultTag()}>`)\n          }\n        }\n\n        // Append BR if the node is not empty.\n        if (!editor.node.isEmpty($li.get(0), true) && $li.find(editor.html.blockTagsQuery()).length === 0) {\n          $li.append('<br>');\n        }\n        $li.append(_openFlag('LI'));\n        $li.prepend(_closeFlag('LI'));\n      }\n\n      $li.after(_openFlag(parent_node.tagName));\n\n      // Nested case. We should look for an upper parent.\n      if (parent_node.parentNode.tagName == 'LI') {\n        parent_node = parent_node.parentNode.parentNode;\n      }\n\n      if (lists.indexOf(parent_node) < 0) {\n        lists.push(parent_node);\n      }\n    }\n\n    // Replace the open and close tags.\n    for (i = 0; i < lists.length; i++) {\n      var $l = $(lists[i]);\n      var html = $l.html();\n      html = html.replace(/<span class=\"fr-close-([a-z]*)\"><\\/span>/g, '</$1>');\n      html = html.replace(/<span class=\"fr-open-([a-z]*)\"><\\/span>/g, '<$1>');\n      $l.replaceWith(editor.node.openTagString($l.get(0)) + html + editor.node.closeTagString($l.get(0)));\n    }\n\n    // Clean empty lists.\n    editor.$el.find('li:empty').remove();\n    editor.$el.find('ul:empty, ol:empty').remove();\n\n    editor.clean.lists();\n    editor.html.wrap();\n  }\n\n  /**\n   * Check if should unformat lists.\n   */\n  function _shouldUnformat(blocks, tag_name) {\n    var do_unformat = true;\n\n    for (var i = 0; i < blocks.length; i++) {\n\n      // Something else than LI is selected.\n      if (blocks[i].tagName != 'LI') {\n        return false;\n      }\n\n      // There is a different kind of list selected. Replace is the appropiate action.\n      if (blocks[i].parentNode.tagName != tag_name) {\n        do_unformat = false;\n      }\n    }\n\n    return do_unformat;\n  }\n\n  /**\n   * Call the list actions.\n   */\n  function format(tag_name) {\n\n    // Wrap.\n    editor.selection.save();\n    editor.html.wrap(true, true, true, true);\n    editor.selection.restore();\n\n    var blocks = editor.selection.blocks();\n\n    // Normalize nodes by keeping the LI.\n    // <li><h1>foo<h1></li> will return h1.\n    for (var i = 0; i < blocks.length; i++) {\n      if (blocks[i].tagName != 'LI' && blocks[i].parentNode.tagName == 'LI') {\n        blocks[i] = blocks[i].parentNode;\n      }\n    }\n\n    // Save selection so that we can play at wish.\n    editor.selection.save();\n\n    // Decide if to format or unformat list.\n    if (_shouldUnformat(blocks, tag_name)) {\n      _unformat(blocks);\n    }\n    else {\n      _format(blocks, tag_name);\n    }\n\n    // Unwrap.\n    editor.html.unwrap();\n\n    // Restore the selection.\n    editor.selection.restore();\n  }\n\n  /**\n   * Refresh list buttons.\n   */\n  function refresh($btn, tag_name) {\n    var $el = $(editor.selection.element());\n\n    if ($el.get(0) != editor.el) {\n      var li = $el.get(0);\n\n      if (li.tagName != 'LI' && li.firstElementChild && li.firstElementChild.tagName != 'LI') {\n        li = $el.parents('li').get(0);\n      }\n      else if (li.tagName != 'LI' && !li.firstElementChild) {\n        li = $el.parents('li').get(0);\n      }\n      else if (li.firstElementChild && li.firstElementChild.tagName == 'LI') {\n        li = $el.get(0).firstChild;\n      }\n      else {\n        li = $el.get(0)\n      }\n\n      if (li && li.parentNode.tagName == tag_name && editor.el.contains(li.parentNode)) {\n        $btn.addClass('fr-active');\n      }\n    }\n  }\n\n  /**\n   * Indent selected list items.\n   */\n  function _indent (blocks) {\n    editor.selection.save();\n\n    for (var i = 0; i < blocks.length; i++) {\n\n      // There should be a previous li.\n      var prev_li = blocks[i].previousSibling;\n\n      if (prev_li) {\n        var nl = $(blocks[i]).find('> ul, > ol').last().get(0);\n\n        // Current LI has a nested list.\n        if (nl) {\n\n          // Build a new list item and prepend it to the list.\n          var $li = $('<li>');\n          $(nl).prepend($li)\n\n          // Get first node of the list item.\n          var node = editor.node.contents(blocks[i])[0];\n\n          // While node and it is not a list, append to the new list item.\n          while (node && !editor.node.isList(node)) {\n            var tmp = node.nextSibling;\n            $li.append(node);\n            node = tmp;\n          }\n\n          // Append current list to the previous node.\n          $(prev_li).append($(nl));\n          $(blocks[i]).remove();\n        }\n        else {\n          var prev_nl = $(prev_li).find('> ul, > ol').last().get(0);\n\n          if (prev_nl) {\n            $(prev_nl).append($(blocks[i]));\n          }\n          else {\n            var $new_nl = $('<' + blocks[i].parentNode.tagName + '>');\n            $(prev_li).append($new_nl);\n            $new_nl.append($(blocks[i]));\n          }\n        }\n      }\n    }\n\n    editor.clean.lists();\n    editor.selection.restore();\n  }\n\n  /**\n   * Outdent selected list items.\n   */\n  function _outdent (blocks) {\n    editor.selection.save();\n    _unformat(blocks);\n    editor.selection.restore();\n  }\n\n  /**\n   * Hook into the indent/outdent events.\n   */\n  function _afterCommand (cmd) {\n    if (cmd == 'indent' || cmd == 'outdent') {\n      var do_indent = false;\n      var blocks = editor.selection.blocks();\n      var blks = [];\n\n      for (var i = 0; i < blocks.length; i++) {\n        if (blocks[i].tagName == 'LI') {\n          do_indent = true;\n          blks.push(blocks[i]);\n        }\n        else if (blocks[i].parentNode.tagName == 'LI') {\n          do_indent = true;\n          blks.push(blocks[i].parentNode);\n        }\n      }\n\n      if (do_indent) {\n        if (cmd == 'indent') _indent(blks);\n        else _outdent(blks);\n      }\n    }\n  }\n\n  /**\n   * Init.\n   */\n  function _init () {\n    editor.events.on('commands.after', _afterCommand);\n\n    // TAB key in lists.\n    editor.events.on('keydown', function (e) {\n      if (e.which == FE.KEYCODE.TAB) {\n        var blocks = editor.selection.blocks();\n        var blks = [];\n\n        for (var i = 0; i < blocks.length; i++) {\n          if (blocks[i].tagName == 'LI') {\n            blks.push(blocks[i]);\n          }\n          else if (blocks[i].parentNode.tagName == 'LI') {\n            blks.push(blocks[i].parentNode)\n          }\n        }\n\n        // There is more than one list item selected.\n        // Selection is at the beginning of the selected list item.\n        if (blks.length > 1 || (blks.length && (editor.selection.info(blks[0]).atStart || editor.node.isEmpty(blks[0])))) {\n          e.preventDefault();\n          e.stopPropagation();\n\n          if (!e.shiftKey) _indent(blks);\n          else _outdent(blks);\n\n          return false;\n        }\n      }\n    }, true);\n  }\n\n  return {\n    _init: _init,\n    format: format,\n    refresh: refresh\n  }\n}\n\n// Register the font size command.\nFE.RegisterCommand('formatUL', {\n  title: 'Unordered List',\n  refresh: function ($btn) {\n    this.lists.refresh($btn, 'UL');\n  },\n  callback: function () {\n    this.lists.format('UL');\n  },\n  plugin: 'lists'\n})\n\n// Register the font size command.\nFE.RegisterCommand('formatOL', {\n  title: 'Ordered List',\n  refresh: function ($btn) {\n    this.lists.refresh($btn, 'OL');\n  },\n  callback: function () {\n    this.lists.format('OL');\n  },\n  plugin: 'lists'\n})\n\n// Add the list icons.\nFE.DefineIcon('formatUL', {\n  NAME: 'list-ul'\n});\n\nFE.DefineIcon('formatOL', {\n  NAME: 'list-ol'\n});\n","import FE from 'FroalaEditor';\n\nObject.assign(FE.DEFAULTS, {\n  paragraphFormat: {\n    N: 'Normal',\n    H1: 'Heading 1',\n    H2: 'Heading 2',\n    H3: 'Heading 3',\n    H4: 'Heading 4',\n    PRE: 'Code'\n  },\n  paragraphFormatSelection: false,\n  paragraphDefaultSelection: 'Paragraph Format'\n})\n\nFE.PLUGINS.paragraphFormat = function (editor) {\n  let $ = editor.$\n\n  /**\n   * Style content inside LI when LI is selected.\n   * This case happens only when the LI contains a nested list or when it has no block tag inside.\n   */\n  function _styleLiWithoutBlocks($li, val) {\n    var defaultTag = editor.html.defaultTag();\n\n    // If val is null or default tag already do nothing.\n    if (val && val.toLowerCase() != defaultTag) {\n\n      // Deal with nested lists.\n      if ($li.find('ul, ol').length > 0) {\n        var $el = $(editor.doc.createElement(val));\n        $li.prepend($el);\n        var node = editor.node.contents($li.get(0))[0];\n\n        while (node && ['UL', 'OL'].indexOf(node.tagName) < 0) {\n          var next_node = node.nextSibling;\n          $el.append(node);\n          node = next_node;\n        }\n      }\n\n      // Wrap list content.\n      else {\n        $li.html('<' + val + '>' + $li.html() + '</' + val + '>');\n      }\n    }\n  }\n\n  /**\n   * Style content inside LI.\n   */\n  function _styleLiWithBlocks($blk, val) {\n    var defaultTag = editor.html.defaultTag();\n\n    // Prepare a temp div.\n    if (!val || val.toLowerCase() == defaultTag) val = 'div class=\"fr-temp-div\"';\n\n    $blk.replaceWith($('<' + val + '>').html($blk.html()));\n  }\n\n  /**\n   * Style content inside TD.\n   */\n  function _styleTdWithBlocks($blk, val) {\n    var defaultTag = editor.html.defaultTag();\n\n    // Prepare a temp div.\n    if (!val) val = 'div class=\"fr-temp-div\"' + (editor.node.isEmpty($blk.get(0), true) ? ' data-empty=\"true\"' : '');\n\n    // Return to the regular case. We don't use P inside TD/TH.\n    if (val.toLowerCase() == defaultTag) {\n\n      // If node is not empty, then add a BR.\n      if (!editor.node.isEmpty($blk.get(0), true)) {\n        $blk.append('<br/>');\n      }\n\n      $blk.replaceWith($blk.html());\n    }\n\n    // Replace with the new tag.\n    else {\n      $blk.replaceWith($('<' + val  + '>').html($blk.html()));\n    }\n  }\n\n  /**\n   * Basic style.\n   */\n  function _style($blk, val) {\n    if (!val) val = 'div class=\"fr-temp-div\"' + (editor.node.isEmpty($blk.get(0), true) ? ' data-empty=\"true\"' : '');\n\n    $blk.replaceWith($('<' + val  + ' ' + editor.node.attributes($blk.get(0)) + '>').html($blk.html()).removeAttr('data-empty'));\n  }\n\n  /**\n   * Apply style.\n   */\n  function apply (val) {\n\n    // Normal.\n    if (val == 'N') val = editor.html.defaultTag();\n\n    // Wrap.\n    editor.selection.save();\n    editor.html.wrap(true, true, !editor.opts.paragraphFormat.BLOCKQUOTE, true, true);\n    editor.selection.restore();\n\n    // Get blocks.\n    var blocks = editor.selection.blocks();\n\n    // Save selection to restore it later.\n    editor.selection.save();\n\n    editor.$el.find('pre').attr('skip', true);\n\n    // Go through each block and apply style to it.\n    for (var i = 0; i < blocks.length; i++) {\n      if (blocks[i].tagName != val && !editor.node.isList(blocks[i])) {\n        var $blk = $(blocks[i]);\n\n        // Style the content inside LI when there is selection right in LI.\n        if (blocks[i].tagName == 'LI') {\n          _styleLiWithoutBlocks($blk, val);\n        }\n\n        // Style the content inside LI when we have other tag in LI.\n        else if (blocks[i].parentNode.tagName == 'LI' && blocks[i]) {\n          _styleLiWithBlocks($blk, val);\n        }\n\n        // Style the content inside TD/TH.\n        else if (['TD', 'TH'].indexOf(blocks[i].parentNode.tagName) >= 0) {\n          _styleTdWithBlocks($blk, val);\n        }\n\n        // Regular case.\n        else {\n          _style($blk, val);\n        }\n      }\n    }\n\n    // Join PRE together.\n    editor.$el.find('pre:not([skip=\"true\"]) + pre:not([skip=\"true\"])').each(function () {\n      $(this).prev().append('<br>' + $(this).html());\n      $(this).remove();\n    });\n    editor.$el.find('pre').removeAttr('skip');\n\n    // Unwrap temp divs.\n    editor.html.unwrap();\n\n    // Restore selection.\n    editor.selection.restore();\n  }\n\n  function refreshOnShow($btn, $dropdown) {\n    var blocks = editor.selection.blocks();\n\n    if (blocks.length) {\n      var blk = blocks[0];\n      var tag = 'N';\n      var default_tag = editor.html.defaultTag();\n\n      if (blk.tagName.toLowerCase() != default_tag && blk != editor.el) {\n        tag = blk.tagName;\n      }\n\n      $dropdown.find('.fr-command[data-param1=\"' + tag + '\"]').addClass('fr-active').attr('aria-selected', true);\n    }\n    else {\n      $dropdown.find('.fr-command[data-param1=\"N\"]').addClass('fr-active').attr('aria-selected', true);\n    }\n  }\n\n  function refresh ($btn) {\n    if (editor.opts.paragraphFormatSelection) {\n      var blocks = editor.selection.blocks();\n\n      if (blocks.length) {\n        var blk = blocks[0];\n        var tag = 'N';\n        var default_tag = editor.html.defaultTag();\n\n        if (blk.tagName.toLowerCase() != default_tag && blk != editor.el) {\n          tag = blk.tagName;\n        }\n\n        if (['LI', 'TD', 'TH'].indexOf(tag) >= 0) {\n          tag = 'N';\n        }\n\n        $btn.find('> span').text(editor.language.translate(editor.opts.paragraphFormat[tag]));\n      }\n      else {\n        $btn.find('> span').text(editor.language.translate(editor.opts.paragraphFormat.N));\n      }\n    }\n  }\n\n  return {\n    apply: apply,\n    refreshOnShow: refreshOnShow,\n    refresh: refresh\n  }\n}\n\n// Register the font size command.\nFE.RegisterCommand('paragraphFormat', {\n  type: 'dropdown',\n  displaySelection: function (editor) {\n    return editor.opts.paragraphFormatSelection;\n  },\n  defaultSelection: function (editor) {\n    return editor.language.translate(editor.opts.paragraphDefaultSelection);\n  },\n  displaySelectionWidth: 125,\n  html: function () {\n    var c = '<ul class=\"fr-dropdown-list\" role=\"presentation\">';\n    var options =  this.opts.paragraphFormat;\n\n    for (var val in options) {\n      if (Object.prototype.hasOwnProperty.call(options, val)) {\n        var shortcut = this.shortcuts.get('paragraphFormat.' + val);\n\n        if (shortcut) {\n          shortcut = '<span class=\"fr-shortcut\">' + shortcut + '</span>';\n        }\n        else {\n          shortcut = '';\n        }\n\n        c += '<li role=\"presentation\"><' + (val == 'N' ? this.html.defaultTag() || 'DIV' : val) + ' style=\"padding: 0 !important; margin: 0 !important;\" role=\"presentation\"><a class=\"fr-command\" tabIndex=\"-1\" role=\"option\" data-cmd=\"paragraphFormat\" data-param1=\"' + val + '\" title=\"' + this.language.translate(options[val]) + '\">' + this.language.translate(options[val]) + '</a></' + (val == 'N' ? this.html.defaultTag() || 'DIV' : val) + '></li>';\n      }\n    }\n    c += '</ul>';\n\n    return c;\n  },\n  title: 'Paragraph Format',\n  callback: function (cmd, val) {\n    this.paragraphFormat.apply(val);\n  },\n  refresh: function ($btn) {\n    this.paragraphFormat.refresh($btn);\n  },\n  refreshOnShow: function ($btn, $dropdown) {\n    this.paragraphFormat.refreshOnShow($btn, $dropdown);\n  },\n  plugin: 'paragraphFormat'\n})\n\n// Add the font size icon.\nFE.DefineIcon('paragraphFormat', {\n  NAME: 'paragraph'\n});\n","import FE from 'FroalaEditor';\n\nObject.assign(FE.DEFAULTS, {\n  paragraphStyles: {\n    'fr-text-gray': 'Gray',\n    'fr-text-bordered': 'Bordered',\n    'fr-text-spaced': 'Spaced',\n    'fr-text-uppercase': 'Uppercase'\n  },\n  paragraphMultipleStyles: true\n});\n\nFE.PLUGINS.paragraphStyle = function (editor) {\n  let $ = editor.$\n\n  /**\n   * Apply style.\n   */\n  function apply (val, paragraphStyles, paragraphMultipleStyles) {\n    if (typeof paragraphStyles == 'undefined') paragraphStyles = editor.opts.paragraphStyles;\n\n    if (typeof paragraphMultipleStyles == 'undefined') paragraphMultipleStyles = editor.opts.paragraphMultipleStyles;\n\n    var styles = '';\n\n    // Remove multiple styles.\n    if (!paragraphMultipleStyles) {\n      styles = Object.keys(paragraphStyles);\n      styles.splice(styles.indexOf(val), 1);\n      styles = styles.join(' ');\n    }\n    editor.selection.save();\n    editor.html.wrap(true, true, true, true);\n    editor.selection.restore();\n\n    var blocks = editor.selection.blocks();\n\n    // Save selection to restore it later.\n    editor.selection.save();\n\n    var hasClass = $(blocks[0]).hasClass(val);\n\n    for (var i = 0; i < blocks.length; i++) {\n      $(blocks[i]).removeClass(styles).toggleClass(val, !hasClass);\n\n      if ($(blocks[i]).hasClass('fr-temp-div')) $(blocks[i]).removeClass('fr-temp-div');\n\n      if ($(blocks[i]).attr('class') === '') $(blocks[i]).removeAttr('class');\n    }\n\n    // Unwrap temp divs.\n    editor.html.unwrap();\n\n    // Restore selection.\n    editor.selection.restore();\n  }\n\n  function refreshOnShow($btn, $dropdown) {\n    var blocks = editor.selection.blocks();\n\n    if (blocks.length) {\n      var $blk = $(blocks[0]);\n\n      $dropdown.find('.fr-command').each (function () {\n        var cls = $(this).data('param1');\n        var active = $blk.hasClass(cls);\n        $(this).toggleClass('fr-active', active).attr('aria-selected', active);\n      })\n    }\n  }\n\n  function _init () {\n  }\n\n  return {\n    _init: _init,\n    apply: apply,\n    refreshOnShow: refreshOnShow\n  }\n}\n\n// Register the font size command.\nFE.RegisterCommand('paragraphStyle', {\n  type: 'dropdown',\n  html: function () {\n    var c = '<ul class=\"fr-dropdown-list\" role=\"presentation\">';\n    var options =  this.opts.paragraphStyles;\n\n    for (var val in options) {\n      if (Object.prototype.hasOwnProperty.call(options, val)) {\n        c += '<li role=\"presentation\"><a class=\"fr-command ' + val + '\" tabIndex=\"-1\" role=\"option\" data-cmd=\"paragraphStyle\" data-param1=\"' + val + '\" title=\"' + this.language.translate(options[val]) + '\">' + this.language.translate(options[val]) + '</a></li>';\n      }\n    }\n    c += '</ul>';\n\n    return c;\n  },\n  title: 'Paragraph Style',\n  callback: function (cmd, val) {\n    this.paragraphStyle.apply(val);\n  },\n  refreshOnShow: function ($btn, $dropdown) {\n    this.paragraphStyle.refreshOnShow($btn, $dropdown);\n  },\n  plugin: 'paragraphStyle'\n})\n\n// Add the font size icon.\nFE.DefineIcon('paragraphStyle', {\n  NAME: 'magic'\n});\n","import FE from 'FroalaEditor';\n\nFE.PLUGINS.print = function (editor) {\n  let $ = editor.$\n\n  function run () {\n\n    // Get editor content for printing.\n    var contents = editor.$el.html();\n\n    // Get or create the iframe for printing.\n    var print_iframe = null;\n\n    if (editor.shared.print_iframe) {\n      print_iframe = editor.shared.print_iframe;\n    }\n    else {\n      print_iframe = document.createElement('iframe');\n      print_iframe.name = 'fr-print';\n      print_iframe.style.position = 'fixed';\n      print_iframe.style.top = '0';\n      print_iframe.style.left = '-9999px';\n      print_iframe.style.height = '100%';\n      print_iframe.style.width = '0';\n      print_iframe.style.overflow = 'hidden';\n      print_iframe.style['z-index'] = '2147483647';\n      print_iframe.style.tabIndex = '-1';\n      document.body.appendChild(print_iframe);\n\n      // Iframe ready.\n      print_iframe.onload = function () {\n        setTimeout(function () {\n\n          // Focus iframe window.\n          editor.events.disableBlur();\n          window.frames['fr-print'].focus();\n\n          // Open printing window.\n          window.frames['fr-print'].print();\n\n          // Refocus editor's window.\n          editor.$win.get(0).focus();\n\n          // Focus editor.\n          editor.events.disableBlur();\n          editor.events.focus();\n        }, 0);\n      };\n\n      // Remove editor on shared destroy.\n      editor.events.on('shared.destroy', function () {\n        print_iframe.remove();\n      });\n\n      editor.shared.print_iframe = print_iframe;\n    }\n\n    // Build printing document.\n    var frame_doc = print_iframe.contentWindow;\n    frame_doc.document.open();\n    frame_doc.document.write('<!DOCTYPE html><html><head><title>' + document.title + '</title>');\n\n    // Add styles.\n    Array.prototype.forEach.call(document.querySelectorAll('style'), function (style_el) {\n      style_el = style_el.cloneNode(true);\n      frame_doc.document.write(style_el.outerHTML);\n    });\n\n    // Add css links.\n    var style_elements = document.querySelectorAll('link[rel=stylesheet]');\n\n    Array.prototype.forEach.call(style_elements, function (link_el) {\n      var new_link_el = document.createElement('link');\n      new_link_el.rel  = link_el.rel;\n      new_link_el.href = link_el.href;\n      new_link_el.media = 'print';\n      new_link_el.type = 'text/css';\n      new_link_el.media = 'all';\n      frame_doc.document.write(new_link_el.outerHTML);\n    });\n\n    frame_doc.document.write('</head><body style=\"text-align: ' + (editor.opts.direction == 'rtl' ? 'right' : 'left') + '; direction: ' + editor.opts.direction + ';\"><div class=\"fr-view\">');\n\n    // Add editor contents.\n    frame_doc.document.write(contents);\n    frame_doc.document.write('</div></body></html>');\n    frame_doc.document.close();\n  }\n\n  return {\n    run: run\n  }\n}\n\nFE.DefineIcon('print', { NAME: 'print' });\nFE.RegisterCommand('print', {\n  title: 'Print',\n  undo: false,\n  focus: false,\n  plugin: 'print',\n  callback: function () {\n    this.print.run();\n  }\n});\n\n","import FE from 'FroalaEditor';\n\n// Extend defaults.\nObject.assign(FE.DEFAULTS, {\n  quickInsertButtons: ['image', 'video', 'embedly', 'table', 'ul', 'ol', 'hr'],\n  quickInsertTags: ['p', 'div', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'pre', 'blockquote']\n});\n\nFE.QUICK_INSERT_BUTTONS = {}\n\nFE.DefineIcon('quickInsert', {\n  PATH: '<path d=\"M22,16.75 L16.75,16.75 L16.75,22 L15.25,22.000 L15.25,16.75 L10,16.75 L10,15.25 L15.25,15.25 L15.25,10 L16.75,10 L16.75,15.25 L22,15.25 L22,16.75 Z\"/>',\n  template: 'svg'\n});\n\nFE.RegisterQuickInsertButton = function (name, data) {\n  FE.QUICK_INSERT_BUTTONS[name] = Object.assign({\n    undo: true\n  }, data);\n}\n\nFE.RegisterQuickInsertButton('image', {\n  icon: 'insertImage',\n  requiredPlugin: 'image',\n  title: 'Insert Image',\n  undo: false,\n  callback: function () {\n    var editor = this;\n\n    if (!editor.shared.$qi_image_input) {\n      editor.shared.$qi_image_input = $('<input accept=\"image/*\" name=\"quickInsertImage' + this.id + '\" style=\"display: none;\" type=\"file\">');\n      $('body').first().append(editor.shared.$qi_image_input);\n\n      editor.events.$on(editor.shared.$qi_image_input, 'change', function () {\n        var inst = $(this).data('inst');\n\n        if (this.files) {\n          inst.quickInsert.hide();\n          inst.image.upload(this.files);\n        }\n\n        // Chrome fix.\n        $(this).val('');\n      }, true);\n    }\n\n    editor.$qi_image_input = editor.shared.$qi_image_input;\n\n    if (editor.helpers.isMobile()) editor.selection.save();\n    editor.events.disableBlur();\n    editor.$qi_image_input.data('inst', editor).trigger('click');\n  }\n})\n\nFE.RegisterQuickInsertButton('video', {\n  icon: 'insertVideo',\n  requiredPlugin: 'video',\n  title: 'Insert Video',\n  undo: false,\n  callback: function () {\n    var res = prompt(this.language.translate('Paste the URL of the video you want to insert.'));\n\n    if (res) {\n      this.video.insertByURL(res);\n    }\n  }\n})\n\nFE.RegisterQuickInsertButton('embedly', {\n  icon: 'embedly',\n  requiredPlugin: 'embedly',\n  title: 'Embed URL',\n  undo: false,\n  callback: function () {\n    var res = prompt(this.language.translate('Paste the URL of any web content you want to insert.'));\n\n    if (res) {\n      this.embedly.add(res);\n    }\n  }\n})\n\nFE.RegisterQuickInsertButton('table', {\n  icon: 'insertTable',\n  requiredPlugin: 'table',\n  title: 'Insert Table',\n  callback: function () {\n    this.table.insert(2, 2);\n  }\n})\n\nFE.RegisterQuickInsertButton('ol', {\n  icon: 'formatOL',\n  requiredPlugin: 'lists',\n  title: 'Ordered List',\n  callback: function () {\n    this.lists.format('OL');\n  }\n})\n\nFE.RegisterQuickInsertButton('ul', {\n  icon: 'formatUL',\n  requiredPlugin: 'lists',\n  title: 'Unordered List',\n  callback: function () {\n    this.lists.format('UL');\n  }\n})\n\nFE.RegisterQuickInsertButton('hr', {\n  icon: 'insertHR',\n  title: 'Insert Horizontal Line',\n  callback: function () {\n    this.commands.insertHR();\n  }\n})\n\nFE.PLUGINS.quickInsert = function (editor) {\n  let $ = editor.$\n\n  var $quick_insert;\n\n  /*\n   * Set the quick insert button left and top.\n   */\n  function _place($tag) {\n\n    // Quick insert's possition.\n    var qiTop;\n    var qiLeft;\n    var qiTagAlign;\n\n    qiTop = $tag.offset().top - editor.$box.offset().top;\n    qiLeft = 0 - $quick_insert.outerWidth();\n\n    if (editor.opts.enter != FE.ENTER_BR) {\n      qiTagAlign = ($quick_insert.outerHeight() - $tag.outerHeight()) / 2;\n    }\n\n    // Enter key is BR. Insert an empty SPAN to get line height.\n    else {\n      $('<span>' + FE.INVISIBLE_SPACE + '</span>').insertAfter($tag)\n      qiTagAlign = ($quick_insert.outerHeight() - $tag.next().outerHeight()) / 2;\n      $tag.next().remove()\n    }\n\n    if (editor.opts.iframe) {\n      qiTop += editor.$iframe.offset().top - editor.helpers.scrollTop();\n    }\n\n    // Reposition QI helper if visible.\n    if ($quick_insert.hasClass('fr-on')) {\n      if (qiTop >= 0) {\n        $helper.css('top', qiTop - qiTagAlign);\n      }\n    }\n\n    // Set quick insert's top and left.\n    if (qiTop >= 0 && qiTop - qiTagAlign <= editor.$box.outerHeight() - $tag.outerHeight()) {\n      if ($quick_insert.hasClass('fr-hidden')) {\n        if ($quick_insert.hasClass('fr-on')) _showQIHelper();\n        $quick_insert.removeClass('fr-hidden');\n      }\n\n      $quick_insert.css('top', qiTop - qiTagAlign);\n    }\n    else if ($quick_insert.hasClass('fr-visible')) {\n      $quick_insert.addClass('fr-hidden');\n      _hideHelper();\n    }\n\n    $quick_insert.css('left', qiLeft);\n  }\n\n  /*\n   * Show quick insert.\n   * Compute top, left, width and show the quick insert.\n   */\n  function _show($tag) {\n    if (!$quick_insert) _initquickInsert();\n\n    // Hide the quick insert helper if visible.\n    if ($quick_insert.hasClass('fr-on')) {\n      _hideHelper();\n    }\n\n    editor.$box.append($quick_insert);\n\n    // Quick insert's possition.\n    _place($tag);\n\n    $quick_insert.data('tag', $tag);\n\n    // Show the quick insert.\n    $quick_insert.addClass('fr-visible');\n  }\n\n  /*\n   * Check the tag where the cursor is.\n   */\n  function _checkTag() {\n    // If editor has focus.\n    if (editor.core.hasFocus()) {\n      var tag = editor.selection.element();\n\n      // Get block tag if Enter key is not BR.\n      if (editor.opts.enter != FE.ENTER_BR && !editor.node.isBlock(tag)) {\n        tag = editor.node.blockParent(tag);\n      }\n\n      if (editor.opts.enter == FE.ENTER_BR && !editor.node.isBlock(tag)) {\n        var deep_tag = editor.node.deepestParent(tag);\n\n        if (deep_tag) tag = deep_tag;\n      }\n\n      var _enterInBR = function () {\n        return (editor.opts.enter != FE.ENTER_BR && editor.node.isEmpty(tag) && editor.node.isElement(tag.parentNode) && editor.opts.quickInsertTags.indexOf(tag.tagName.toLowerCase()) >= 0);\n      }\n\n      var _enterInP = function () {\n        return (\n          editor.opts.enter == FE.ENTER_BR &&\n          ((tag.tagName == 'BR' && (!tag.previousSibling || tag.previousSibling.tagName == 'BR' || editor.node.isBlock(tag.previousSibling))) ||\n            (editor.node.isEmpty(tag) && (!tag.previousSibling || tag.previousSibling.tagName == 'BR' || editor.node.isBlock(tag.previousSibling)) && (!tag.nextSibling || tag.nextSibling.tagName == 'BR' || editor.node.isBlock(tag.nextSibling))))\n        );\n      }\n\n      if (tag && (_enterInBR() || _enterInP())) {\n        // If the quick insert is not repositioned, just close the helper.\n        if ($quick_insert && $quick_insert.data('tag').is($(tag)) && $quick_insert.hasClass('fr-on')) {\n          _hideHelper();\n        }\n\n        // If selection is collapsed.\n        else if (editor.selection.isCollapsed()) {\n          _show($(tag));\n        }\n      }\n\n      // Quick insert should not be visible.\n      else {\n        hide();\n      }\n    }\n  }\n\n  /*\n   * Hide quick insert.\n   */\n  function hide() {\n    if ($quick_insert) {\n      // Hide the quick insert helper if visible.\n      if ($quick_insert.hasClass('fr-on')) {\n        _hideHelper();\n      }\n\n      // Hide the quick insert.\n      $quick_insert.removeClass('fr-visible fr-on');\n      $quick_insert.css('left', -9999).css('top', -9999);\n    }\n  }\n\n  /*\n   * Show the quick insert helper.\n   */\n  var $helper;\n\n  function _showQIHelper(e) {\n    if (e) e.preventDefault();\n\n    // Hide helper.\n    if ($quick_insert.hasClass('fr-on') && !$quick_insert.hasClass('fr-hidden')) {\n      _hideHelper();\n    }\n\n    else {\n      if (!editor.shared.$qi_helper) {\n        var btns = editor.opts.quickInsertButtons;\n        var btns_html = '<div class=\"fr-qi-helper\">';\n        var idx = 0;\n\n        for (var i = 0; i < btns.length; i++) {\n          var info = FE.QUICK_INSERT_BUTTONS[btns[i]];\n\n          if (info) {\n            if (!info.requiredPlugin || (FE.PLUGINS[info.requiredPlugin] && editor.opts.pluginsEnabled.indexOf(info.requiredPlugin) >= 0)) {\n              btns_html += '<a class=\"fr-btn fr-floating-btn\" role=\"button\" title=\"' + editor.language.translate(info.title) + '\" tabIndex=\"-1\" data-cmd=\"' + btns[i] + '\" style=\"transition-delay: ' + (0.025 * (idx++)) + 's;\">' + editor.icon.create(info.icon) + '</a>';\n            }\n          }\n        }\n\n        btns_html += '</div>';\n        editor.shared.$qi_helper = $(btns_html);\n\n        // Quick insert helper tooltip.\n        editor.tooltip.bind(editor.shared.$qi_helper, '> a.fr-btn');\n\n        editor.events.$on(editor.shared.$qi_helper, 'mousedown', function (e) {\n          e.preventDefault();\n        }, true);\n      }\n\n      $helper = editor.shared.$qi_helper;\n      editor.$box.append($helper);\n\n      // Show the quick insert helper.\n      setTimeout(function () {\n        $helper.css('top', parseFloat($quick_insert.css('top')));\n        $helper.css('left', parseFloat($quick_insert.css('left')) + $quick_insert.outerWidth());\n        $helper.find('a').addClass('fr-size-1')\n        $quick_insert.addClass('fr-on');\n      }, 10);\n    }\n  }\n\n  /*\n   * Hides the quick insert helper and places the cursor.\n   */\n  function _hideHelper() {\n    var $helper = editor.$box.find('.fr-qi-helper');\n\n    if ($helper.length) {\n      $helper.find('a').removeClass('fr-size-1');\n      $helper.css('left', -9999);\n\n      if (!$quick_insert.hasClass('fr-hidden')) $quick_insert.removeClass('fr-on');\n    }\n  }\n\n  /*\n   * Initialize the quick insert.\n   */\n  function _initquickInsert() {\n    if (!editor.shared.$quick_insert) {\n      // Append quick insert HTML to editor wrapper.\n      editor.shared.$quick_insert = $('<div class=\"fr-quick-insert\"><a class=\"fr-floating-btn\" role=\"button\" tabIndex=\"-1\" title=\"' + editor.language.translate('Quick Insert') + '\">' + editor.icon.create('quickInsert') + '</a></div>');\n    }\n\n    $quick_insert = editor.shared.$quick_insert;\n\n    // Quick Insert tooltip.\n    editor.tooltip.bind(editor.$box, '.fr-quick-insert > a.fr-floating-btn');\n\n    // Editor destroy.\n    editor.events.on('destroy', function () {\n      $('body').first().append($quick_insert.removeClass('fr-on').css('left', -9999).css('top', -9999))\n\n      if ($helper) {\n        _hideHelper();\n        $('body').first().append($helpper)\n      }\n    }, true);\n\n    editor.events.on('shared.destroy', function () {\n      $quick_insert.html('').removeData().remove();\n      $quick_insert = null;\n\n      if ($helper) {\n        $helper.html('').removeData().remove();\n        $helper = null;\n      }\n    }, true);\n\n    // Hide before a command is executed.\n    editor.events.on('commands.before', hide);\n\n    // Check if the quick insert should be shown after a command has been executed.\n    editor.events.on('commands.after', function () {\n      if (!editor.popups.areVisible()) {\n        _checkTag();\n      }\n    });\n\n    // User clicks on the quick insert.\n    editor.events.bindClick(editor.$box, '.fr-quick-insert > a', _showQIHelper);\n\n    // User clicks on a button from the quick insert helper.\n    editor.events.bindClick(editor.$box, '.fr-qi-helper > a.fr-btn', function (e) {\n      var cmd = $(e.currentTarget).data('cmd');\n\n      // Trigger commands.before.\n      if (editor.events.trigger('quickInsert.commands.before', [cmd]) === false) {\n        return false;\n      }\n\n      FE.QUICK_INSERT_BUTTONS[cmd].callback.apply(editor, [e.currentTarget]);\n\n      if (FE.QUICK_INSERT_BUTTONS[cmd].undo) {\n        editor.undo.saveStep();\n      }\n\n      // Trigger commands.after.\n      editor.events.trigger('quickInsert.commands.after', [cmd]);\n\n      editor.quickInsert.hide();\n    });\n\n    // Scroll in editor wrapper. Quick insert buttons should scroll along\n    editor.events.$on(editor.$wp, 'scroll', function () {\n      if ($quick_insert.hasClass('fr-visible')) {\n        _place($quick_insert.data('tag'));\n      }\n    });\n  }\n\n  /*\n   * Tear up.\n   */\n  function _init() {\n    if (!editor.$wp) return false;\n\n    if (editor.opts.iframe) {\n      editor.$el.parent('html').find('head').append('<link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css\">');\n    }\n\n    // Hide the quick insert if user click on an image.\n    editor.popups.onShow('image.edit', hide);\n\n    // Check tag where cursor is to see if the quick insert needs to be shown.\n    editor.events.on('mouseup', _checkTag);\n\n    if (editor.helpers.isMobile()) {\n      editor.events.$on($(editor.o_doc), 'selectionchange', _checkTag);\n    }\n\n    // Hide the quick insert when editor loses focus.\n    editor.events.on('blur', hide);\n\n    // Check if the quick insert should be shown after a key was pressed.\n    editor.events.on('keyup', _checkTag);\n\n    // Hide quick insert on keydown.\n    editor.events.on('keydown', function () {\n      setTimeout(function () {\n        _checkTag();\n      }, 0);\n    });\n  }\n\n  return {\n    _init: _init,\n    hide: hide\n  }\n};\n","import FE from 'FroalaEditor';\n\nFE.PLUGINS.quote = function (editor) {\n  let $ = editor.$\n\n  function _deepestParent(node) {\n    while (node.parentNode && node.parentNode != editor.el) {\n      node = node.parentNode;\n    }\n\n    return node;\n  }\n\n  function _increase () {\n\n    // Get blocks.\n    var blocks = editor.selection.blocks();\n    var i;\n\n    // Normalize blocks.\n    for (i = 0; i < blocks.length; i++) {\n      blocks[i] = _deepestParent(blocks[i]);\n    }\n\n    // Save selection to restore it later.\n    editor.selection.save();\n\n    var $quote = $('<blockquote>');\n    $quote.insertBefore(blocks[0]);\n\n    for (i = 0; i < blocks.length; i++) {\n      $quote.append(blocks[i]);\n    }\n\n    // Unwrap temp divs.\n    editor.html.unwrap();\n\n    editor.selection.restore();\n  }\n\n  function _decrease () {\n\n    // Get blocks.\n    var blocks = editor.selection.blocks();\n    var i;\n\n    for (i = 0; i < blocks.length; i++) {\n      if (blocks[i].tagName != 'BLOCKQUOTE') {\n        blocks[i] = $(blocks[i]).parentsUntil(editor.$el, 'BLOCKQUOTE').get(0);\n      }\n    }\n\n    editor.selection.save();\n\n    for (i = 0; i < blocks.length; i++) {\n      if (blocks[i]) {\n        $(blocks[i]).replaceWith(blocks[i].innerHTML);\n      }\n    }\n\n    // Unwrap temp divs.\n    editor.html.unwrap();\n\n    editor.selection.restore();\n  }\n\n  function apply (val) {\n\n    // Wrap.\n    editor.selection.save();\n    editor.html.wrap(true, true, true, true);\n    editor.selection.restore();\n\n    if (val == 'increase') {\n      _increase();\n    }\n    else if (val == 'decrease') {\n      _decrease();\n    }\n\n\n  }\n\n  return {\n    apply: apply\n  }\n}\n\n// Register the quote command.\nFE.RegisterShortcut(FE.KEYCODE.SINGLE_QUOTE, 'quote', 'increase', '\\'');\nFE.RegisterShortcut(FE.KEYCODE.SINGLE_QUOTE, 'quote', 'decrease', '\\'', true);\nFE.RegisterCommand('quote', {\n  title: 'Quote',\n  type: 'dropdown',\n  options: {\n    increase: 'Increase',\n    decrease: 'Decrease'\n  },\n  callback: function (cmd, val) {\n    this.quote.apply(val);\n  },\n  plugin: 'quote'\n})\n\n// Add the quote icon.\nFE.DefineIcon('quote', {\n  NAME: 'quote-left'\n});\n","import FE from 'FroalaEditor';\n// Extend defaults.\nObject.assign(FE.DEFAULTS, {\n  saveInterval: 1000,\n  saveURL: null,\n  saveParams: {},\n  saveParam: 'body',\n  saveMethod: 'POST'\n});\n\n\nFE.PLUGINS.save = function (editor) {\n  var _timeout = null;\n  var _last_html = null;\n  var _force = false;\n\n  var BAD_LINK = 1;\n  var ERROR_ON_SERVER = 2;\n\n  var error_messages = {};\n  error_messages[BAD_LINK] = 'Missing saveURL option.';\n  error_messages[ERROR_ON_SERVER] = 'Something went wrong during save.';\n\n  /**\n   * Throw an image error.\n   */\n  function _throwError (code, response) {\n    editor.events.trigger('save.error', [{\n      code: code,\n      message: error_messages[code]\n    }, response]);\n  }\n\n  function save (html) {\n    if (typeof html == 'undefined') html = editor.html.get();\n\n    var original_html = html;\n\n    // Trigger before save event.\n    var event_returned_value = editor.events.trigger('save.before', [html]);\n\n    if (event_returned_value === false) return false;\n    else if (typeof event_returned_value == 'string') html = event_returned_value;\n\n    if (editor.opts.saveURL) {\n      var params = {};\n\n      for (var key in editor.opts.saveParams) {\n        if (Object.prototype.hasOwnProperty.call(editor.opts.saveParams, key)) {\n          var param = editor.opts.saveParams[key];\n\n          if (typeof(param) == 'function') {\n            params[key] = param.call(this);\n          }\n          else {\n            params[key] = param;\n          }\n        }\n      }\n\n      var dt = {};\n      dt[editor.opts.saveParam] = html;\n\n      var xhr = editor.core.getXHR(editor.opts.saveURL, editor.opts.saveMethod)\n\n      var form_data = editor.drag_support.formdata ? new FormData() : null;\n      if (form_data) {\n        var params = Object.assign(dt, params);\n\n        for (key in params) {\n          if (Object.prototype.hasOwnProperty.call(params, key)) {\n            form_data.append(key, params[key]);\n          }\n        }\n      }\n\n      xhr.onload = function () {\n        _last_html = original_html;\n\n        // data\n        editor.events.trigger('save.after', [xhr.response]);\n      }\n      xhr.onerror = function () {\n        // (error)\n        _throwError(ERROR_ON_SERVER, xhr.response || xhr.responseText);\n      }\n\n      xhr.send(form_data);\n    }\n    else {\n\n      // (error)\n      _throwError(BAD_LINK);\n    }\n  }\n\n  function _mightSave () {\n    clearTimeout(_timeout);\n    _timeout = setTimeout(function () {\n      var html = editor.html.get();\n\n      if (_last_html != html || _force) {\n        _last_html = html;\n        _force = false;\n\n        save(html);\n      }\n    }, editor.opts.saveInterval);\n  }\n\n  /**\n   * Reset the saving interval.\n   */\n  function reset () {\n    _mightSave();\n    _force = false;\n  }\n\n  /**\n   * Force saving at the end of the current interval.\n   */\n  function force () {\n    _force = true;\n  }\n\n  /*\n   * Initialize.\n   */\n  function _init () {\n    if (editor.opts.saveInterval) {\n      _last_html = editor.html.get();\n      editor.events.on('contentChanged', _mightSave);\n      editor.events.on('keydown destroy', function () {\n        clearTimeout(_timeout);\n      });\n    }\n  }\n\n  return {\n    _init: _init,\n    save: save,\n    reset: reset,\n    force: force\n  }\n}\n\nFE.DefineIcon('save', { NAME: 'floppy-o' });\nFE.RegisterCommand('save', {\n  title: 'Save',\n  undo: false,\n  focus: false,\n  refreshAfterCallback: false,\n  callback: function () {\n    this.save.save();\n  },\n  plugin: 'save'\n});","import FE from 'FroalaEditor';\n\n// Extend defaults.\nObject.assign(FE.DEFAULTS, {\n  specialCharactersSets: [\n    {\n      title: 'Latin',\n      list: [\n        { 'char': '&iexcl;', desc: 'INVERTED EXCLAMATION MARK' },\n        { 'char': '&cent;', desc: 'CENT SIGN' },\n        { 'char': '&pound;', desc: 'POUND SIGN' },\n        { 'char': '&curren;', desc: 'CURRENCY SIGN' },\n        { 'char': '&yen;', desc: 'YEN SIGN' },\n        { 'char': '&brvbar;', desc: 'BROKEN BAR' },\n        { 'char': '&sect;', desc: 'SECTION SIGN' },\n        { 'char': '&uml;', desc: 'DIAERESIS' },\n        { 'char': '&copy;', desc: 'COPYRIGHT SIGN' },\n        { 'char': '&trade;', desc: 'TRADEMARK SIGN' },\n        { 'char': '&ordf;', desc: 'FEMININE ORDINAL INDICATOR' },\n        { 'char': '&laquo;', desc: 'LEFT-POINTING DOUBLE ANGLE QUOTATION MARK' },\n        { 'char': '&not;', desc: 'NOT SIGN' },\n        { 'char': '&reg;', desc: 'REGISTERED SIGN' },\n        { 'char': '&macr;', desc: 'MACRON' },\n        { 'char': '&deg;', desc: 'DEGREE SIGN' },\n        { 'char': '&plusmn;', desc: 'PLUS-MINUS SIGN' },\n        { 'char': '&sup2;', desc: 'SUPERSCRIPT TWO' },\n        { 'char': '&sup3;', desc: 'SUPERSCRIPT THREE' },\n        { 'char': '&acute;', desc: 'ACUTE ACCENT' },\n        { 'char': '&micro;', desc: 'MICRO SIGN' },\n        { 'char': '&para;', desc: 'PILCROW SIGN' },\n        { 'char': '&middot;', desc: 'MIDDLE DOT' },\n        { 'char': '&cedil;', desc: 'CEDILLA' },\n        { 'char': '&sup1;', desc: 'SUPERSCRIPT ONE' },\n        { 'char': '&ordm;', desc: 'MASCULINE ORDINAL INDICATOR' },\n        { 'char': '&raquo;', desc: 'RIGHT-POINTING DOUBLE ANGLE QUOTATION MARK' },\n        { 'char': '&frac14;', desc: 'VULGAR FRACTION ONE QUARTER' },\n        { 'char': '&frac12;', desc: 'VULGAR FRACTION ONE HALF' },\n        { 'char': '&frac34;', desc: 'VULGAR FRACTION THREE QUARTERS' },\n        { 'char': '&iquest;', desc: 'INVERTED QUESTION MARK' },\n        { 'char': '&Agrave;', desc: 'LATIN CAPITAL LETTER A WITH GRAVE' },\n        { 'char': '&Aacute;', desc: 'LATIN CAPITAL LETTER A WITH ACUTE' },\n        { 'char': '&Acirc;', desc: 'LATIN CAPITAL LETTER A WITH CIRCUMFLEX' },\n        { 'char': '&Atilde;', desc: 'LATIN CAPITAL LETTER A WITH TILDE' },\n        { 'char': '&Auml;', desc: 'LATIN CAPITAL LETTER A WITH DIAERESIS ' },\n        { 'char': '&Aring;', desc: 'LATIN CAPITAL LETTER A WITH RING ABOVE' },\n        { 'char': '&AElig;', desc: 'LATIN CAPITAL LETTER AE' },\n        { 'char': '&Ccedil;', desc: 'LATIN CAPITAL LETTER C WITH CEDILLA' },\n        { 'char': '&Egrave;', desc: 'LATIN CAPITAL LETTER E WITH GRAVE' },\n        { 'char': '&Eacute;', desc: 'LATIN CAPITAL LETTER E WITH ACUTE' },\n        { 'char': '&Ecirc;', desc: 'LATIN CAPITAL LETTER E WITH CIRCUMFLEX' },\n        { 'char': '&Euml;', desc: 'LATIN CAPITAL LETTER E WITH DIAERESIS' },\n        { 'char': '&Igrave;', desc: 'LATIN CAPITAL LETTER I WITH GRAVE' },\n        { 'char': '&Iacute;', desc: 'LATIN CAPITAL LETTER I WITH ACUTE' },\n        { 'char': '&Icirc;', desc: 'LATIN CAPITAL LETTER I WITH CIRCUMFLEX' },\n        { 'char': '&Iuml;', desc: 'LATIN CAPITAL LETTER I WITH DIAERESIS' },\n        { 'char': '&ETH;', desc: 'LATIN CAPITAL LETTER ETH' },\n        { 'char': '&Ntilde;', desc: 'LATIN CAPITAL LETTER N WITH TILDE' },\n        { 'char': '&Ograve;', desc: 'LATIN CAPITAL LETTER O WITH GRAVE' },\n        { 'char': '&Oacute;', desc: 'LATIN CAPITAL LETTER O WITH ACUTE' },\n        { 'char': '&Ocirc;', desc: 'LATIN CAPITAL LETTER O WITH CIRCUMFLEX' },\n        { 'char': '&Otilde;', desc: 'LATIN CAPITAL LETTER O WITH TILDE' },\n        { 'char': '&Ouml;', desc: 'LATIN CAPITAL LETTER O WITH DIAERESIS' },\n        { 'char': '&times;', desc: 'MULTIPLICATION SIGN' },\n        { 'char': '&Oslash;', desc: 'LATIN CAPITAL LETTER O WITH STROKE' },\n        { 'char': '&Ugrave;', desc: 'LATIN CAPITAL LETTER U WITH GRAVE' },\n        { 'char': '&Uacute;', desc: 'LATIN CAPITAL LETTER U WITH ACUTE' },\n        { 'char': '&Ucirc;', desc: 'LATIN CAPITAL LETTER U WITH CIRCUMFLEX' },\n        { 'char': '&Uuml;', desc: 'LATIN CAPITAL LETTER U WITH DIAERESIS' },\n        { 'char': '&Yacute;', desc: 'LATIN CAPITAL LETTER Y WITH ACUTE' },\n        { 'char': '&THORN;', desc: 'LATIN CAPITAL LETTER THORN' },\n        { 'char': '&szlig;', desc: 'LATIN SMALL LETTER SHARP S' },\n        { 'char': '&agrave;', desc: 'LATIN SMALL LETTER A WITH GRAVE' },\n        { 'char': '&aacute;', desc: 'LATIN SMALL LETTER A WITH ACUTE ' },\n        { 'char': '&acirc;', desc: 'LATIN SMALL LETTER A WITH CIRCUMFLEX' },\n        { 'char': '&atilde;', desc: 'LATIN SMALL LETTER A WITH TILDE' },\n        { 'char': '&auml;', desc: 'LATIN SMALL LETTER A WITH DIAERESIS' },\n        { 'char': '&aring;', desc: 'LATIN SMALL LETTER A WITH RING ABOVE' },\n        { 'char': '&aelig;', desc: 'LATIN SMALL LETTER AE' },\n        { 'char': '&ccedil;', desc: 'LATIN SMALL LETTER C WITH CEDILLA' },\n        { 'char': '&egrave;', desc: 'LATIN SMALL LETTER E WITH GRAVE' },\n        { 'char': '&eacute;', desc: 'LATIN SMALL LETTER E WITH ACUTE' },\n        { 'char': '&ecirc;', desc: 'LATIN SMALL LETTER E WITH CIRCUMFLEX' },\n        { 'char': '&euml;', desc: 'LATIN SMALL LETTER E WITH DIAERESIS' },\n        { 'char': '&igrave;', desc: 'LATIN SMALL LETTER I WITH GRAVE' },\n        { 'char': '&iacute;', desc: 'LATIN SMALL LETTER I WITH ACUTE' },\n        { 'char': '&icirc;', desc: 'LATIN SMALL LETTER I WITH CIRCUMFLEX' },\n        { 'char': '&iuml;', desc: 'LATIN SMALL LETTER I WITH DIAERESIS' },\n        { 'char': '&eth;', desc: 'LATIN SMALL LETTER ETH' },\n        { 'char': '&ntilde;', desc: 'LATIN SMALL LETTER N WITH TILDE' },\n        { 'char': '&ograve;', desc: 'LATIN SMALL LETTER O WITH GRAVE' },\n        { 'char': '&oacute;', desc: 'LATIN SMALL LETTER O WITH ACUTE' },\n        { 'char': '&ocirc;', desc: 'LATIN SMALL LETTER O WITH CIRCUMFLEX' },\n        { 'char': '&otilde;', desc: 'LATIN SMALL LETTER O WITH TILDE' },\n        { 'char': '&ouml;', desc: 'LATIN SMALL LETTER O WITH DIAERESIS' },\n        { 'char': '&divide;', desc: 'DIVISION SIGN' },\n        { 'char': '&oslash;', desc: 'LATIN SMALL LETTER O WITH STROKE' },\n        { 'char': '&ugrave;', desc: 'LATIN SMALL LETTER U WITH GRAVE' },\n        { 'char': '&uacute;', desc: 'LATIN SMALL LETTER U WITH ACUTE' },\n        { 'char': '&ucirc;', desc: 'LATIN SMALL LETTER U WITH CIRCUMFLEX' },\n        { 'char': '&uuml;', desc: 'LATIN SMALL LETTER U WITH DIAERESIS' },\n        { 'char': '&yacute;', desc: 'LATIN SMALL LETTER Y WITH ACUTE' },\n        { 'char': '&thorn;', desc: 'LATIN SMALL LETTER THORN' },\n        { 'char': '&yuml;', desc: 'LATIN SMALL LETTER Y WITH DIAERESIS' }\n      ]\n    },\n    {\n      title: 'Greek',\n      list: [\n        { 'char': '&Alpha;', desc: 'GREEK CAPITAL LETTER ALPHA' },\n        { 'char': '&Beta;', desc: 'GREEK CAPITAL LETTER BETA' },\n        { 'char': '&Gamma;', desc: 'GREEK CAPITAL LETTER GAMMA' },\n        { 'char': '&Delta;', desc: 'GREEK CAPITAL LETTER DELTA' },\n        { 'char': '&Epsilon;', desc: 'GREEK CAPITAL LETTER EPSILON' },\n        { 'char': '&Zeta;', desc: 'GREEK CAPITAL LETTER ZETA' },\n        { 'char': '&Eta;', desc: 'GREEK CAPITAL LETTER ETA' },\n        { 'char': '&Theta;', desc: 'GREEK CAPITAL LETTER THETA' },\n        { 'char': '&Iota;', desc: 'GREEK CAPITAL LETTER IOTA' },\n        { 'char': '&Kappa;', desc: 'GREEK CAPITAL LETTER KAPPA' },\n        { 'char': '&Lambda;', desc: 'GREEK CAPITAL LETTER LAMBDA' },\n        { 'char': '&Mu;', desc: 'GREEK CAPITAL LETTER MU' },\n        { 'char': '&Nu;', desc: 'GREEK CAPITAL LETTER NU' },\n        { 'char': '&Xi;', desc: 'GREEK CAPITAL LETTER XI' },\n        { 'char': '&Omicron;', desc: 'GREEK CAPITAL LETTER OMICRON' },\n        { 'char': '&Pi;', desc: 'GREEK CAPITAL LETTER PI' },\n        { 'char': '&Rho;', desc: 'GREEK CAPITAL LETTER RHO' },\n        { 'char': '&Sigma;', desc: 'GREEK CAPITAL LETTER SIGMA' },\n        { 'char': '&Tau;', desc: 'GREEK CAPITAL LETTER TAU' },\n        { 'char': '&Upsilon;', desc: 'GREEK CAPITAL LETTER UPSILON' },\n        { 'char': '&Phi;', desc: 'GREEK CAPITAL LETTER PHI' },\n        { 'char': '&Chi;', desc: 'GREEK CAPITAL LETTER CHI' },\n        { 'char': '&Psi;', desc: 'GREEK CAPITAL LETTER PSI' },\n        { 'char': '&Omega;', desc: 'GREEK CAPITAL LETTER OMEGA' },\n        { 'char': '&alpha;', desc: 'GREEK SMALL LETTER ALPHA' },\n        { 'char': '&beta;', desc: 'GREEK SMALL LETTER BETA' },\n        { 'char': '&gamma;', desc: 'GREEK SMALL LETTER GAMMA' },\n        { 'char': '&delta;', desc: 'GREEK SMALL LETTER DELTA' },\n        { 'char': '&epsilon;', desc: 'GREEK SMALL LETTER EPSILON' },\n        { 'char': '&zeta;', desc: 'GREEK SMALL LETTER ZETA' },\n        { 'char': '&eta;', desc: 'GREEK SMALL LETTER ETA' },\n        { 'char': '&theta;', desc: 'GREEK SMALL LETTER THETA' },\n        { 'char': '&iota;', desc: 'GREEK SMALL LETTER IOTA' },\n        { 'char': '&kappa;', desc: 'GREEK SMALL LETTER KAPPA' },\n        { 'char': '&lambda;', desc: 'GREEK SMALL LETTER LAMBDA' },\n        { 'char': '&mu;', desc: 'GREEK SMALL LETTER MU' },\n        { 'char': '&nu;', desc: 'GREEK SMALL LETTER NU' },\n        { 'char': '&xi;', desc: 'GREEK SMALL LETTER XI' },\n        { 'char': '&omicron;', desc: 'GREEK SMALL LETTER OMICRON' },\n        { 'char': '&pi;', desc: 'GREEK SMALL LETTER PI' },\n        { 'char': '&rho;', desc: 'GREEK SMALL LETTER RHO' },\n        { 'char': '&sigmaf;', desc: 'GREEK SMALL LETTER FINAL SIGMA' },\n        { 'char': '&sigma;', desc: 'GREEK SMALL LETTER SIGMA' },\n        { 'char': '&tau;', desc: 'GREEK SMALL LETTER TAU' },\n        { 'char': '&upsilon;', desc: 'GREEK SMALL LETTER UPSILON' },\n        { 'char': '&phi;', desc: 'GREEK SMALL LETTER PHI' },\n        { 'char': '&chi;', desc: 'GREEK SMALL LETTER CHI' },\n        { 'char': '&psi;', desc: 'GREEK SMALL LETTER PSI' },\n        { 'char': '&omega;', desc: 'GREEK SMALL LETTER OMEGA' },\n        { 'char': '&thetasym;', desc: 'GREEK THETA SYMBOL' },\n        { 'char': '&upsih;', desc: 'GREEK UPSILON WITH HOOK SYMBOL' },\n        { 'char': '&straightphi;', desc: 'GREEK PHI SYMBOL' },\n        { 'char': '&piv;', desc: 'GREEK PI SYMBOL' },\n        { 'char': '&Gammad;', desc: 'GREEK LETTER DIGAMMA' },\n        { 'char': '&gammad;', desc: 'GREEK SMALL LETTER DIGAMMA' },\n        { 'char': '&varkappa;', desc: 'GREEK KAPPA SYMBOL' },\n        { 'char': '&varrho;', desc: 'GREEK RHO SYMBOL' },\n        { 'char': '&straightepsilon;', desc: 'GREEK LUNATE EPSILON SYMBOL' },\n        { 'char': '&backepsilon;', desc: 'GREEK REVERSED LUNATE EPSILON SYMBOL' }\n      ]\n    },\n    {\n      title: 'Cyrillic',\n      list: [\n        { 'char': '&#x400', desc: 'CYRILLIC CAPITAL LETTER IE WITH GRAVE' },\n        { 'char': '&#x401', desc: 'CYRILLIC CAPITAL LETTER IO' },\n        { 'char': '&#x402', desc: 'CYRILLIC CAPITAL LETTER DJE' },\n        { 'char': '&#x403', desc: 'CYRILLIC CAPITAL LETTER GJE' },\n        { 'char': '&#x404', desc: 'CYRILLIC CAPITAL LETTER UKRAINIAN IE' },\n        { 'char': '&#x405', desc: 'CYRILLIC CAPITAL LETTER DZE' },\n        { 'char': '&#x406', desc: 'CYRILLIC CAPITAL LETTER BYELORUSSIAN-UKRAINIAN I' },\n        { 'char': '&#x407', desc: 'CYRILLIC CAPITAL LETTER YI' },\n        { 'char': '&#x408', desc: 'CYRILLIC CAPITAL LETTER JE' },\n        { 'char': '&#x409', desc: 'CYRILLIC CAPITAL LETTER LJE' },\n        { 'char': '&#x40A', desc: 'CYRILLIC CAPITAL LETTER NJE' },\n        { 'char': '&#x40B', desc: 'CYRILLIC CAPITAL LETTER TSHE' },\n        { 'char': '&#x40C', desc: 'CYRILLIC CAPITAL LETTER KJE' },\n        { 'char': '&#x40D', desc: 'CYRILLIC CAPITAL LETTER I WITH GRAVE' },\n        { 'char': '&#x40E', desc: 'CYRILLIC CAPITAL LETTER SHORT U' },\n        { 'char': '&#x40F', desc: 'CYRILLIC CAPITAL LETTER DZHE' },\n        { 'char': '&#x410', desc: 'CYRILLIC CAPITAL LETTER A' },\n        { 'char': '&#x411', desc: 'CYRILLIC CAPITAL LETTER BE' },\n        { 'char': '&#x412', desc: 'CYRILLIC CAPITAL LETTER VE' },\n        { 'char': '&#x413', desc: 'CYRILLIC CAPITAL LETTER GHE' },\n        { 'char': '&#x414', desc: 'CYRILLIC CAPITAL LETTER DE' },\n        { 'char': '&#x415', desc: 'CYRILLIC CAPITAL LETTER IE' },\n        { 'char': '&#x416', desc: 'CYRILLIC CAPITAL LETTER ZHE' },\n        { 'char': '&#x417', desc: 'CYRILLIC CAPITAL LETTER ZE' },\n        { 'char': '&#x418', desc: 'CYRILLIC CAPITAL LETTER I' },\n        { 'char': '&#x419', desc: 'CYRILLIC CAPITAL LETTER SHORT I' },\n        { 'char': '&#x41A', desc: 'CYRILLIC CAPITAL LETTER KA' },\n        { 'char': '&#x41B', desc: 'CYRILLIC CAPITAL LETTER EL' },\n        { 'char': '&#x41C', desc: 'CYRILLIC CAPITAL LETTER EM' },\n        { 'char': '&#x41D', desc: 'CYRILLIC CAPITAL LETTER EN' },\n        { 'char': '&#x41E', desc: 'CYRILLIC CAPITAL LETTER O' },\n        { 'char': '&#x41F', desc: 'CYRILLIC CAPITAL LETTER PE' },\n        { 'char': '&#x420', desc: 'CYRILLIC CAPITAL LETTER ER' },\n        { 'char': '&#x421', desc: 'CYRILLIC CAPITAL LETTER ES' },\n        { 'char': '&#x422', desc: 'CYRILLIC CAPITAL LETTER TE' },\n        { 'char': '&#x423', desc: 'CYRILLIC CAPITAL LETTER U' },\n        { 'char': '&#x424', desc: 'CYRILLIC CAPITAL LETTER EF' },\n        { 'char': '&#x425', desc: 'CYRILLIC CAPITAL LETTER HA' },\n        { 'char': '&#x426', desc: 'CYRILLIC CAPITAL LETTER TSE' },\n        { 'char': '&#x427', desc: 'CYRILLIC CAPITAL LETTER CHE' },\n        { 'char': '&#x428', desc: 'CYRILLIC CAPITAL LETTER SHA' },\n        { 'char': '&#x429', desc: 'CYRILLIC CAPITAL LETTER SHCHA' },\n        { 'char': '&#x42A', desc: 'CYRILLIC CAPITAL LETTER HARD SIGN' },\n        { 'char': '&#x42B', desc: 'CYRILLIC CAPITAL LETTER YERU' },\n        { 'char': '&#x42C', desc: 'CYRILLIC CAPITAL LETTER SOFT SIGN' },\n        { 'char': '&#x42D', desc: 'CYRILLIC CAPITAL LETTER E' },\n        { 'char': '&#x42E', desc: 'CYRILLIC CAPITAL LETTER YU' },\n        { 'char': '&#x42F', desc: 'CYRILLIC CAPITAL LETTER YA' },\n        { 'char': '&#x430', desc: 'CYRILLIC SMALL LETTER A' },\n        { 'char': '&#x431', desc: 'CYRILLIC SMALL LETTER BE' },\n        { 'char': '&#x432', desc: 'CYRILLIC SMALL LETTER VE' },\n        { 'char': '&#x433', desc: 'CYRILLIC SMALL LETTER GHE' },\n        { 'char': '&#x434', desc: 'CYRILLIC SMALL LETTER DE' },\n        { 'char': '&#x435', desc: 'CYRILLIC SMALL LETTER IE' },\n        { 'char': '&#x436', desc: 'CYRILLIC SMALL LETTER ZHE' },\n        { 'char': '&#x437', desc: 'CYRILLIC SMALL LETTER ZE' },\n        { 'char': '&#x438', desc: 'CYRILLIC SMALL LETTER I' },\n        { 'char': '&#x439', desc: 'CYRILLIC SMALL LETTER SHORT I' },\n        { 'char': '&#x43A', desc: 'CYRILLIC SMALL LETTER KA' },\n        { 'char': '&#x43B', desc: 'CYRILLIC SMALL LETTER EL' },\n        { 'char': '&#x43C', desc: 'CYRILLIC SMALL LETTER EM' },\n        { 'char': '&#x43D', desc: 'CYRILLIC SMALL LETTER EN' },\n        { 'char': '&#x43E', desc: 'CYRILLIC SMALL LETTER O' },\n        { 'char': '&#x43F', desc: 'CYRILLIC SMALL LETTER PE' },\n        { 'char': '&#x440', desc: 'CYRILLIC SMALL LETTER ER' },\n        { 'char': '&#x441', desc: 'CYRILLIC SMALL LETTER ES' },\n        { 'char': '&#x442', desc: 'CYRILLIC SMALL LETTER TE' },\n        { 'char': '&#x443', desc: 'CYRILLIC SMALL LETTER U' },\n        { 'char': '&#x444', desc: 'CYRILLIC SMALL LETTER EF' },\n        { 'char': '&#x445', desc: 'CYRILLIC SMALL LETTER HA' },\n        { 'char': '&#x446', desc: 'CYRILLIC SMALL LETTER TSE' },\n        { 'char': '&#x447', desc: 'CYRILLIC SMALL LETTER CHE' },\n        { 'char': '&#x448', desc: 'CYRILLIC SMALL LETTER SHA' },\n        { 'char': '&#x449', desc: 'CYRILLIC SMALL LETTER SHCHA' },\n        { 'char': '&#x44A', desc: 'CYRILLIC SMALL LETTER HARD SIGN' },\n        { 'char': '&#x44B', desc: 'CYRILLIC SMALL LETTER YERU' },\n        { 'char': '&#x44C', desc: 'CYRILLIC SMALL LETTER SOFT SIGN' },\n        { 'char': '&#x44D', desc: 'CYRILLIC SMALL LETTER E' },\n        { 'char': '&#x44E', desc: 'CYRILLIC SMALL LETTER YU' },\n        { 'char': '&#x44F', desc: 'CYRILLIC SMALL LETTER YA' },\n        { 'char': '&#x450', desc: 'CYRILLIC SMALL LETTER IE WITH GRAVE' },\n        { 'char': '&#x451', desc: 'CYRILLIC SMALL LETTER IO' },\n        { 'char': '&#x452', desc: 'CYRILLIC SMALL LETTER DJE' },\n        { 'char': '&#x453', desc: 'CYRILLIC SMALL LETTER GJE' },\n        { 'char': '&#x454', desc: 'CYRILLIC SMALL LETTER UKRAINIAN IE' },\n        { 'char': '&#x455', desc: 'CYRILLIC SMALL LETTER DZE' },\n        { 'char': '&#x456', desc: 'CYRILLIC SMALL LETTER BYELORUSSIAN-UKRAINIAN I' },\n        { 'char': '&#x457', desc: 'CYRILLIC SMALL LETTER YI' },\n        { 'char': '&#x458', desc: 'CYRILLIC SMALL LETTER JE' },\n        { 'char': '&#x459', desc: 'CYRILLIC SMALL LETTER LJE' },\n        { 'char': '&#x45A', desc: 'CYRILLIC SMALL LETTER NJE' },\n        { 'char': '&#x45B', desc: 'CYRILLIC SMALL LETTER TSHE' },\n        { 'char': '&#x45C', desc: 'CYRILLIC SMALL LETTER KJE' },\n        { 'char': '&#x45D', desc: 'CYRILLIC SMALL LETTER I WITH GRAVE' },\n        { 'char': '&#x45E', desc: 'CYRILLIC SMALL LETTER SHORT U' },\n        { 'char': '&#x45F', desc: 'CYRILLIC SMALL LETTER DZHE' }\n      ]\n    },\n    {\n      title: 'Punctuation',\n      list: [\n        { 'char': '&ndash;', desc: 'EN DASH' },\n        { 'char': '&mdash;', desc: 'EM DASH' },\n        { 'char': '&lsquo;', desc: 'LEFT SINGLE QUOTATION MARK' },\n        { 'char': '&rsquo;', desc: 'RIGHT SINGLE QUOTATION MARK' },\n        { 'char': '&sbquo;', desc: 'SINGLE LOW-9 QUOTATION MARK' },\n        { 'char': '&ldquo;', desc: 'LEFT DOUBLE QUOTATION MARK' },\n        { 'char': '&rdquo;', desc: 'RIGHT DOUBLE QUOTATION MARK' },\n        { 'char': '&bdquo;', desc: 'DOUBLE LOW-9 QUOTATION MARK' },\n        { 'char': '&dagger;', desc: 'DAGGER' },\n        { 'char': '&Dagger;', desc: 'DOUBLE DAGGER' },\n        { 'char': '&bull;', desc: 'BULLET' },\n        { 'char': '&hellip;', desc: 'HORIZONTAL ELLIPSIS' },\n        { 'char': '&permil;', desc: 'PER MILLE SIGN' },\n        { 'char': '&prime;', desc: 'PRIME' },\n        { 'char': '&Prime;', desc: 'DOUBLE PRIME' },\n        { 'char': '&lsaquo;', desc: 'SINGLE LEFT-POINTING ANGLE QUOTATION MARK' },\n        { 'char': '&rsaquo;', desc: 'SINGLE RIGHT-POINTING ANGLE QUOTATION MARK' },\n        { 'char': '&oline;', desc: 'OVERLINE' },\n        { 'char': '&frasl;', desc: 'FRACTION SLASH' }\n      ]\n    },\n    {\n      title: 'Currency',\n      list: [\n        { 'char': '&#x20A0', desc: 'EURO-CURRENCY SIGN' },\n        { 'char': '&#x20A1', desc: 'COLON SIGN' },\n        { 'char': '&#x20A2', desc: 'CRUZEIRO SIGN' },\n        { 'char': '&#x20A3', desc: 'FRENCH FRANC SIGN' },\n        { 'char': '&#x20A4', desc: 'LIRA SIGN' },\n        { 'char': '&#x20A5', desc: 'MILL SIGN' },\n        { 'char': '&#x20A6', desc: 'NAIRA SIGN' },\n        { 'char': '&#x20A7', desc: 'PESETA SIGN' },\n        { 'char': '&#x20A8', desc: 'RUPEE SIGN' },\n        { 'char': '&#x20A9', desc: 'WON SIGN' },\n        { 'char': '&#x20AA', desc: 'NEW SHEQEL SIGN' },\n        { 'char': '&#x20AB', desc: 'DONG SIGN' },\n        { 'char': '&#x20AC', desc: 'EURO SIGN' },\n        { 'char': '&#x20AD', desc: 'KIP SIGN' },\n        { 'char': '&#x20AE', desc: 'TUGRIK SIGN' },\n        { 'char': '&#x20AF', desc: 'DRACHMA SIGN' },\n        { 'char': '&#x20B0', desc: 'GERMAN PENNY SYMBOL' },\n        { 'char': '&#x20B1', desc: 'PESO SIGN' },\n        { 'char': '&#x20B2', desc: 'GUARANI SIGN' },\n        { 'char': '&#x20B3', desc: 'AUSTRAL SIGN' },\n        { 'char': '&#x20B4', desc: 'HRYVNIA SIGN' },\n        { 'char': '&#x20B5', desc: 'CEDI SIGN' },\n        { 'char': '&#x20B6', desc: 'LIVRE TOURNOIS SIGN' },\n        { 'char': '&#x20B7', desc: 'SPESMILO SIGN' },\n        { 'char': '&#x20B8', desc: 'TENGE SIGN' },\n        { 'char': '&#x20B9', desc: 'INDIAN RUPEE SIGN' }\n      ]\n    },\n    {\n      title: 'Arrows',\n      list: [\n        { 'char': '&#x2190', desc: 'LEFTWARDS ARROW' },\n        { 'char': '&#x2191', desc: 'UPWARDS ARROW' },\n        { 'char': '&#x2192', desc: 'RIGHTWARDS ARROW' },\n        { 'char': '&#x2193', desc: 'DOWNWARDS ARROW' },\n        { 'char': '&#x2194', desc: 'LEFT RIGHT ARROW' },\n        { 'char': '&#x2195', desc: 'UP DOWN ARROW' },\n        { 'char': '&#x2196', desc: 'NORTH WEST ARROW' },\n        { 'char': '&#x2197', desc: 'NORTH EAST ARROW' },\n        { 'char': '&#x2198', desc: 'SOUTH EAST ARROW' },\n        { 'char': '&#x2199', desc: 'SOUTH WEST ARROW' },\n        { 'char': '&#x219A', desc: 'LEFTWARDS ARROW WITH STROKE' },\n        { 'char': '&#x219B', desc: 'RIGHTWARDS ARROW WITH STROKE' },\n        { 'char': '&#x219C', desc: 'LEFTWARDS WAVE ARROW' },\n        { 'char': '&#x219D', desc: 'RIGHTWARDS WAVE ARROW' },\n        { 'char': '&#x219E', desc: 'LEFTWARDS TWO HEADED ARROW' },\n        { 'char': '&#x219F', desc: 'UPWARDS TWO HEADED ARROW' },\n        { 'char': '&#x21A0', desc: 'RIGHTWARDS TWO HEADED ARROW' },\n        { 'char': '&#x21A1', desc: 'DOWNWARDS TWO HEADED ARROW' },\n        { 'char': '&#x21A2', desc: 'LEFTWARDS ARROW WITH TAIL' },\n        { 'char': '&#x21A3', desc: 'RIGHTWARDS ARROW WITH TAIL' },\n        { 'char': '&#x21A4', desc: 'LEFTWARDS ARROW FROM BAR' },\n        { 'char': '&#x21A5', desc: 'UPWARDS ARROW FROM BAR' },\n        { 'char': '&#x21A6', desc: 'RIGHTWARDS ARROW FROM BAR' },\n        { 'char': '&#x21A7', desc: 'DOWNWARDS ARROW FROM BAR' },\n        { 'char': '&#x21A8', desc: 'UP DOWN ARROW WITH BASE' },\n        { 'char': '&#x21A9', desc: 'LEFTWARDS ARROW WITH HOOK' },\n        { 'char': '&#x21AA', desc: 'RIGHTWARDS ARROW WITH HOOK' },\n        { 'char': '&#x21AB', desc: 'LEFTWARDS ARROW WITH LOOP' },\n        { 'char': '&#x21AC', desc: 'RIGHTWARDS ARROW WITH LOOP' },\n        { 'char': '&#x21AD', desc: 'LEFT RIGHT WAVE ARROW' },\n        { 'char': '&#x21AE', desc: 'LEFT RIGHT ARROW WITH STROKE' },\n        { 'char': '&#x21AF', desc: 'DOWNWARDS ZIGZAG ARROW' },\n        { 'char': '&#x21B0', desc: 'UPWARDS ARROW WITH TIP LEFTWARDS' },\n        { 'char': '&#x21B1', desc: 'UPWARDS ARROW WITH TIP RIGHTWARDS' },\n        { 'char': '&#x21B2', desc: 'DOWNWARDS ARROW WITH TIP LEFTWARDS' },\n        { 'char': '&#x21B3', desc: 'DOWNWARDS ARROW WITH TIP RIGHTWARDS' },\n        { 'char': '&#x21B4', desc: 'RIGHTWARDS ARROW WITH CORNER DOWNWARDS' },\n        { 'char': '&#x21B5', desc: 'DOWNWARDS ARROW WITH CORNER LEFTWARDS' },\n        { 'char': '&#x21B6', desc: 'ANTICLOCKWISE TOP SEMICIRCLE ARROW' },\n        { 'char': '&#x21B7', desc: 'CLOCKWISE TOP SEMICIRCLE ARROW' },\n        { 'char': '&#x21B8', desc: 'NORTH WEST ARROW TO LONG BAR' },\n        { 'char': '&#x21B9', desc: 'LEFTWARDS ARROW TO BAR OVER RIGHTWARDS ARROW TO BAR' },\n        { 'char': '&#x21BA', desc: 'ANTICLOCKWISE OPEN CIRCLE ARROW' },\n        { 'char': '&#x21BB', desc: 'CLOCKWISE OPEN CIRCLE ARROW' },\n        { 'char': '&#x21BC', desc: 'LEFTWARDS HARPOON WITH BARB UPWARDS' },\n        { 'char': '&#x21BD', desc: 'LEFTWARDS HARPOON WITH BARB DOWNWARDS' },\n        { 'char': '&#x21BE', desc: 'UPWARDS HARPOON WITH BARB RIGHTWARDS' },\n        { 'char': '&#x21BF', desc: 'UPWARDS HARPOON WITH BARB LEFTWARDS' },\n        { 'char': '&#x21C0', desc: 'RIGHTWARDS HARPOON WITH BARB UPWARDS' },\n        { 'char': '&#x21C1', desc: 'RIGHTWARDS HARPOON WITH BARB DOWNWARDS' },\n        { 'char': '&#x21C2', desc: 'DOWNWARDS HARPOON WITH BARB RIGHTWARDS' },\n        { 'char': '&#x21C3', desc: 'DOWNWARDS HARPOON WITH BARB LEFTWARDS' },\n        { 'char': '&#x21C4', desc: 'RIGHTWARDS ARROW OVER LEFTWARDS ARROW' },\n        { 'char': '&#x21C5', desc: 'UPWARDS ARROW LEFTWARDS OF DOWNWARDS ARROW' },\n        { 'char': '&#x21C6', desc: 'LEFTWARDS ARROW OVER RIGHTWARDS ARROW' },\n        { 'char': '&#x21C7', desc: 'LEFTWARDS PAIRED ARROWS' },\n        { 'char': '&#x21C8', desc: 'UPWARDS PAIRED ARROWS' },\n        { 'char': '&#x21C9', desc: 'RIGHTWARDS PAIRED ARROWS' },\n        { 'char': '&#x21CA', desc: 'DOWNWARDS PAIRED ARROWS' },\n        { 'char': '&#x21CB', desc: 'LEFTWARDS HARPOON OVER RIGHTWARDS HARPOON' },\n        { 'char': '&#x21CC', desc: 'RIGHTWARDS HARPOON OVER LEFTWARDS HARPOON' },\n        { 'char': '&#x21CD', desc: 'LEFTWARDS DOUBLE ARROW WITH STROKE' },\n        { 'char': '&#x21CE', desc: 'LEFT RIGHT DOUBLE ARROW WITH STROKE' },\n        { 'char': '&#x21CF', desc: 'RIGHTWARDS DOUBLE ARROW WITH STROKE' },\n        { 'char': '&#x21D0', desc: 'LEFTWARDS DOUBLE ARROW' },\n        { 'char': '&#x21D1', desc: 'UPWARDS DOUBLE ARROW' },\n        { 'char': '&#x21D2', desc: 'RIGHTWARDS DOUBLE ARROW' },\n        { 'char': '&#x21D3', desc: 'DOWNWARDS DOUBLE ARROW' },\n        { 'char': '&#x21D4', desc: 'LEFT RIGHT DOUBLE ARROW' },\n        { 'char': '&#x21D5', desc: 'UP DOWN DOUBLE ARROW' },\n        { 'char': '&#x21D6', desc: 'NORTH WEST DOUBLE ARROW' },\n        { 'char': '&#x21D7', desc: 'NORTH EAST DOUBLE ARROW' },\n        { 'char': '&#x21D8', desc: 'SOUTH EAST DOUBLE ARROW' },\n        { 'char': '&#x21D9', desc: 'SOUTH WEST DOUBLE ARROW' },\n        { 'char': '&#x21DA', desc: 'LEFTWARDS TRIPLE ARROW' },\n        { 'char': '&#x21DB', desc: 'RIGHTWARDS TRIPLE ARROW' },\n        { 'char': '&#x21DC', desc: 'LEFTWARDS SQUIGGLE ARROW' },\n        { 'char': '&#x21DD', desc: 'RIGHTWARDS SQUIGGLE ARROW' },\n        { 'char': '&#x21DE', desc: 'UPWARDS ARROW WITH DOUBLE STROKE' },\n        { 'char': '&#x21DF', desc: 'DOWNWARDS ARROW WITH DOUBLE STROKE' },\n        { 'char': '&#x21E0', desc: 'LEFTWARDS DASHED ARROW' },\n        { 'char': '&#x21E1', desc: 'UPWARDS DASHED ARROW' },\n        { 'char': '&#x21E2', desc: 'RIGHTWARDS DASHED ARROW' },\n        { 'char': '&#x21E3', desc: 'DOWNWARDS DASHED ARROW' },\n        { 'char': '&#x21E4', desc: 'LEFTWARDS ARROW TO BAR' },\n        { 'char': '&#x21E5', desc: 'RIGHTWARDS ARROW TO BAR' },\n        { 'char': '&#x21E6', desc: 'LEFTWARDS WHITE ARROW' },\n        { 'char': '&#x21E7', desc: 'UPWARDS WHITE ARROW' },\n        { 'char': '&#x21E8', desc: 'RIGHTWARDS WHITE ARROW' },\n        { 'char': '&#x21E9', desc: 'DOWNWARDS WHITE ARROW' },\n        { 'char': '&#x21EA', desc: 'UPWARDS WHITE ARROW FROM BAR' },\n        { 'char': '&#x21EB', desc: 'UPWARDS WHITE ARROW ON PEDESTAL' },\n        { 'char': '&#x21EC', desc: 'UPWARDS WHITE ARROW ON PEDESTAL WITH HORIZONTAL BAR' },\n        { 'char': '&#x21ED', desc: 'UPWARDS WHITE ARROW ON PEDESTAL WITH VERTICAL BAR' },\n        { 'char': '&#x21EE', desc: 'UPWARDS WHITE DOUBLE ARROW' },\n        { 'char': '&#x21EF', desc: 'UPWARDS WHITE DOUBLE ARROW ON PEDESTAL' },\n        { 'char': '&#x21F0', desc: 'RIGHTWARDS WHITE ARROW FROM WALL' },\n        { 'char': '&#x21F1', desc: 'NORTH WEST ARROW TO CORNER' },\n        { 'char': '&#x21F2', desc: 'SOUTH EAST ARROW TO CORNER' },\n        { 'char': '&#x21F3', desc: 'UP DOWN WHITE ARROW' },\n        { 'char': '&#x21F4', desc: 'RIGHT ARROW WITH SMALL CIRCLE' },\n        { 'char': '&#x21F5', desc: 'DOWNWARDS ARROW LEFTWARDS OF UPWARDS ARROW' },\n        { 'char': '&#x21F6', desc: 'THREE RIGHTWARDS ARROWS' },\n        { 'char': '&#x21F7', desc: 'LEFTWARDS ARROW WITH VERTICAL STROKE' },\n        { 'char': '&#x21F8', desc: 'RIGHTWARDS ARROW WITH VERTICAL STROKE' },\n        { 'char': '&#x21F9', desc: 'LEFT RIGHT ARROW WITH VERTICAL STROKE' },\n        { 'char': '&#x21FA', desc: 'LEFTWARDS ARROW WITH DOUBLE VERTICAL STROKE' },\n        { 'char': '&#x21FB', desc: 'RIGHTWARDS ARROW WITH DOUBLE VERTICAL STROKE' },\n        { 'char': '&#x21FC', desc: 'LEFT RIGHT ARROW WITH DOUBLE VERTICAL STROKE' },\n        { 'char': '&#x21FD', desc: 'LEFTWARDS OPEN-HEADED ARROW' },\n        { 'char': '&#x21FE', desc: 'RIGHTWARDS OPEN-HEADED ARROW' },\n        { 'char': '&#x21FF', desc: 'LEFT RIGHT OPEN-HEADED ARROW' }\n      ]\n    },\n    {\n      title: 'Math',\n      list: [\n        { 'char': '&forall;', desc: 'FOR ALL' },\n        { 'char': '&part;', desc: 'PARTIAL DIFFERENTIAL' },\n        { 'char': '&exist;', desc: 'THERE EXISTS' },\n        { 'char': '&empty;', desc: 'EMPTY SET' },\n        { 'char': '&nabla;', desc: 'NABLA' },\n        { 'char': '&isin;', desc: 'ELEMENT OF' },\n        { 'char': '&notin;', desc: 'NOT AN ELEMENT OF' },\n        { 'char': '&ni;', desc: 'CONTAINS AS MEMBER' },\n        { 'char': '&prod;', desc: 'N-ARY PRODUCT' },\n        { 'char': '&sum;', desc: 'N-ARY SUMMATION' },\n        { 'char': '&minus;', desc: 'MINUS SIGN' },\n        { 'char': '&lowast;', desc: 'ASTERISK OPERATOR' },\n        { 'char': '&radic;', desc: 'SQUARE ROOT' },\n        { 'char': '&prop;', desc: 'PROPORTIONAL TO' },\n        { 'char': '&infin;', desc: 'INFINITY' },\n        { 'char': '&ang;', desc: 'ANGLE' },\n        { 'char': '&and;', desc: 'LOGICAL AND' },\n        { 'char': '&or;', desc: 'LOGICAL OR' },\n        { 'char': '&cap;', desc: 'INTERSECTION' },\n        { 'char': '&cup;', desc: 'UNION' },\n        { 'char': '&int;', desc: 'INTEGRAL' },\n        { 'char': '&there4;', desc: 'THEREFORE' },\n        { 'char': '&sim;', desc: 'TILDE OPERATOR' },\n        { 'char': '&cong;', desc: 'APPROXIMATELY EQUAL TO' },\n        { 'char': '&asymp;', desc: 'ALMOST EQUAL TO' },\n        { 'char': '&ne;', desc: 'NOT EQUAL TO' },\n        { 'char': '&equiv;', desc: 'IDENTICAL TO' },\n        { 'char': '&le;', desc: 'LESS-THAN OR EQUAL TO' },\n        { 'char': '&ge;', desc: 'GREATER-THAN OR EQUAL TO' },\n        { 'char': '&sub;', desc: 'SUBSET OF' },\n        { 'char': '&sup;', desc: 'SUPERSET OF' },\n        { 'char': '&nsub;', desc: 'NOT A SUBSET OF' },\n        { 'char': '&sube;', desc: 'SUBSET OF OR EQUAL TO' },\n        { 'char': '&supe;', desc: 'SUPERSET OF OR EQUAL TO' },\n        { 'char': '&oplus;', desc: 'CIRCLED PLUS' },\n        { 'char': '&otimes;', desc: 'CIRCLED TIMES' },\n        { 'char': '&perp;', desc: 'UP TACK' }\n      ]\n    },\n    {\n      title: 'Misc',\n      list: [\n        { 'char': '&spades;', desc: 'BLACK SPADE SUIT' },\n        { 'char': '&clubs;', desc: 'BLACK CLUB SUIT' },\n        { 'char': '&hearts;', desc: 'BLACK HEART SUIT' },\n        { 'char': '&diams;', desc: 'BLACK DIAMOND SUIT' },\n        { 'char': '&#x2669', desc: 'QUARTER NOTE' },\n        { 'char': '&#x266A', desc: 'EIGHTH NOTE' },\n        { 'char': '&#x266B', desc: 'BEAMED EIGHTH NOTES' },\n        { 'char': '&#x266C', desc: 'BEAMED SIXTEENTH NOTES' },\n        { 'char': '&#x266D', desc: 'MUSIC FLAT SIGN' },\n        { 'char': '&#x266E', desc: 'MUSIC NATURAL SIGN' },\n        { 'char': '&#x2600', desc: 'BLACK SUN WITH RAYS' },\n        { 'char': '&#x2601', desc: 'CLOUD' },\n        { 'char': '&#x2602', desc: 'UMBRELLA' },\n        { 'char': '&#x2603', desc: 'SNOWMAN' },\n        { 'char': '&#x2615', desc: 'HOT BEVERAGE' },\n        { 'char': '&#x2618', desc: 'SHAMROCK' },\n        { 'char': '&#x262F', desc: 'YIN YANG' },\n        { 'char': '&#x2714', desc: 'HEAVY CHECK MARK' },\n        { 'char': '&#x2716', desc: 'HEAVY MULTIPLICATION X' },\n        { 'char': '&#x2744', desc: 'SNOWFLAKE' },\n        { 'char': '&#x275B', desc: 'HEAVY SINGLE TURNED COMMA QUOTATION MARK ORNAMENT' },\n        { 'char': '&#x275C', desc: 'HEAVY SINGLE COMMA QUOTATION MARK ORNAMENT' },\n        { 'char': '&#x275D', desc: 'HEAVY DOUBLE TURNED COMMA QUOTATION MARK ORNAMENT' },\n        { 'char': '&#x275E', desc: 'HEAVY DOUBLE COMMA QUOTATION MARK ORNAMENT' },\n        { 'char': '&#x2764', desc: 'HEAVY BLACK HEART' }\n      ]\n    }\n  ]\n});\n\nFE.PLUGINS.specialCharacters = function (editor) {\n  let $ = editor.$\n\n  var $modal;\n  var modal_id = 'special_characters';\n\n  var $head;\n  var $body;\n\n  /*\n   * Init Special Characters.\n   */\n  function _init () {\n\n  }\n\n  /*\n   * Build html body.\n   */\n  function _buildBody () {\n\n    // Begin body.\n    var body = '<div class=\"fr-special-characters-modal\">';\n\n    for (var k = 0; k < editor.opts.specialCharactersSets.length; k++) {\n      var set = editor.opts.specialCharactersSets[k];\n      var list = set.list;\n\n      // Add title.\n      var html_list = '<div class=\"fr-special-characters-list\"><p class=\"fr-special-characters-title\">' + editor.language.translate(set.title) + '</p>';\n\n      for (var i = 0; i < list.length; i++) {\n        var item = list[i];\n        html_list += '<span class=\"fr-command fr-special-character\" tabIndex=\"-1\" role=\"button\" value=\"' + item['char'] + '\" title=\"' + item.desc + '\">' + item['char'] + '<span class=\"fr-sr-only\">' + editor.language.translate(item.desc) + '&nbsp;&nbsp;&nbsp;</span></span>';\n\n      }\n\n      // Add list to body.\n      body += html_list + '</div>';\n    }\n\n    // End body.\n    body += '</div>';\n\n    return body;\n  }\n\n  /*\n   * Focus a special character.\n   */\n  function _focusChar ($char, e) {\n\n    editor.events.disableBlur();\n    $char.focus();\n\n    e.preventDefault();\n    e.stopPropagation();\n  }\n\n  function _addAccessibility () {\n\n    // Keydown handler.\n    editor.events.$on($body, 'keydown', function (e) {\n      var keycode = e.which;\n      var $focused_char = $body.find('span.fr-special-character:focus:first');\n\n      // Alt + F10.\n      if (!$focused_char.length && keycode == FE.KEYCODE.F10 && !editor.keys.ctrlKey(e) && !e.shiftKey && e.altKey) {\n\n        // Focus first character.\n        var $char = $body.find('span.fr-special-character:first');\n        _focusChar($char, e);\n\n        return false;\n      }\n\n      // Tab and arrows.\n      else if (keycode == FE.KEYCODE.TAB || keycode == FE.KEYCODE.ARROW_LEFT || keycode == FE.KEYCODE.ARROW_RIGHT) {\n\n        // The next char that will get focused.\n        var $next_char = null;\n\n        // Forward of backward.\n        var forward = null;\n\n        // Arrow or Tab.\n        var isArrow = false;\n\n        if (keycode == FE.KEYCODE.ARROW_LEFT || keycode == FE.KEYCODE.ARROW_RIGHT) {\n          forward = keycode == FE.KEYCODE.ARROW_RIGHT;\n          isArrow = true;\n        }\n        else {\n          forward = !e.shiftKey;\n        }\n\n        if ($focused_char.length) {\n\n          // Next or previous char from a category. Only if arrow are used.\n          if (isArrow) {\n            if (forward) {\n              $next_char = $focused_char.nextAll('span.fr-special-character:first');\n            }\n            else {\n              $next_char = $focused_char.prevAll('span.fr-special-character:first');\n            }\n          }\n\n          // First or last char reached within a category. Or Tab is used.\n          if (!$next_char || !$next_char.length) {\n\n            // First or last char from next or previous category.\n            if (forward) {\n              $next_char = $focused_char.parent().next().find('span.fr-special-character:first');\n            }\n            else {\n              $next_char = $focused_char.parent().prev().find('span.fr-special-character:' + (isArrow ? 'last' : 'first'));\n            }\n\n            // First or last category reached.\n            if (!$next_char.length) {\n\n              // First category and first char or last category and last char.\n              $next_char = $body.find('span.fr-special-character:' + (forward ? 'first' : 'last'));\n            }\n          }\n        }\n\n        // First category and first char or last category and last char.\n        else {\n          $next_char = $body.find('span.fr-special-character:' + (forward ? 'first' : 'last'));\n        }\n        _focusChar($next_char, e);\n\n        return false;\n      }\n\n      // Enter on a focused item.\n      else if (keycode == FE.KEYCODE.ENTER && $focused_char.length) {\n        var instance = $modal.data('instance') || editor;\n\n        instance.specialCharacters.insert($focused_char);\n      }\n      else {\n\n        return true;\n      }\n    }, true);\n  }\n\n  /*\n   * Show Special Characters.\n   */\n  function show () {\n    if (!$modal) {\n      var head = '<h4>' + editor.language.translate('Special Characters') + '</h4>';\n      var body = _buildBody();\n      var modalHash = editor.modals.create(modal_id, head, body);\n      $modal = modalHash.$modal;\n      $head = modalHash.$head;\n      $body = modalHash.$body;\n\n      // Resize Special Characters modal on window resize.\n      editor.events.$on($(editor.o_win), 'resize', function () {\n        var instance = $modal.data('instance') || editor;\n\n        instance.modals.resize(modal_id);\n      });\n\n      // Insert image.\n      editor.events.bindClick($body, '.fr-special-character', function (e) {\n        var instance = $modal.data('instance') || editor;\n        var $target = $(e.currentTarget);\n\n        instance.specialCharacters.insert($target);\n      });\n\n      _addAccessibility();\n    }\n\n\n    // Show modal.\n    editor.modals.show(modal_id);\n\n    // Modal may not fit window size.\n    editor.modals.resize(modal_id);\n  }\n\n  /*\n   * Hide Special Characters.\n   */\n  function hide () {\n    editor.modals.hide(modal_id);\n  }\n\n  /*\n   * Insert special character.\n   */\n  function insert($target) {\n\n    // Hide modal.\n    editor.specialCharacters.hide();\n\n    // Insert character.\n    editor.undo.saveStep();\n    editor.html.insert($target.attr('value'), true);\n    editor.undo.saveStep();\n  }\n\n  return {\n    _init: _init,\n    show: show,\n    hide: hide,\n    insert: insert\n  };\n};\n\nFE.DefineIcon('specialCharacters', { template: 'text', NAME: '&#937;' })\n\nFE.RegisterCommand('specialCharacters', {\n  title: 'Special Characters',\n  icon: 'specialCharacters',\n  undo: false,\n  focus: false,\n  modal: true,\n  callback: function () {\n    this.specialCharacters.show();\n  },\n  plugin: 'specialCharacters',\n  showOnMobile: false\n});\n\n","import FE from 'FroalaEditor';\n\nObject.assign(FE.POPUP_TEMPLATES, {\n  'table.insert': '[_BUTTONS_][_ROWS_COLUMNS_]',\n  'table.edit': '[_BUTTONS_]',\n  'table.colors': '[_BUTTONS_][_COLORS_][_CUSTOM_COLOR_]'\n})\n\n// Extend defaults.\nObject.assign(FE.DEFAULTS, {\n  tableInsertMaxSize: 10,\n  tableEditButtons: ['tableHeader', 'tableRemove', '|', 'tableRows', 'tableColumns', 'tableStyle', '-', 'tableCells', 'tableCellBackground', 'tableCellVerticalAlign', 'tableCellHorizontalAlign', 'tableCellStyle'],\n  tableInsertButtons: ['tableBack', '|'],\n  tableResizer: true,\n  tableDefaultWidth: '100%',\n  tableResizerOffset: 5,\n  tableResizingLimit: 30,\n  tableColorsButtons: ['tableBack', '|'],\n  tableColors: [\n    '#61BD6D', '#1ABC9C', '#54ACD2', '#2C82C9', '#9365B8', '#475577', '#CCCCCC',\n    '#41A85F', '#00A885', '#3D8EB9', '#2969B0', '#553982', '#28324E', '#000000',\n    '#F7DA64', '#FBA026', '#EB6B56', '#E25041', '#A38F84', '#EFEFEF', '#FFFFFF',\n    '#FAC51C', '#F37934', '#D14841', '#B8312F', '#7C706B', '#D1D5D8', 'REMOVE'\n  ],\n  tableColorsStep: 7,\n  tableCellStyles: {\n    'fr-highlighted': 'Highlighted',\n    'fr-thick': 'Thick'\n  },\n  tableStyles: {\n    'fr-dashed-borders': 'Dashed Borders',\n    'fr-alternate-rows': 'Alternate Rows'\n  },\n  tableCellMultipleStyles: true,\n  tableMultipleStyles: true,\n  tableInsertHelper: true,\n  tableInsertHelperOffset: 15\n});\n\nFE.PLUGINS.table = function (editor) {\n  let $ = editor.$\n\n  var $resizer;\n  var $insert_helper;\n  var mouseDownCellFlag;\n  var mouseDownFlag;\n  var mouseDownCell;\n  var mouseMoveTimer;\n  var resizingFlag;\n\n  /*\n   * Show the insert table popup.\n   */\n  function _showInsertPopup () {\n    var $btn = editor.$tb.find('.fr-command[data-cmd=\"insertTable\"]');\n\n    var $popup = editor.popups.get('table.insert');\n\n    if (!$popup) $popup = _initInsertPopup();\n\n    if (!$popup.hasClass('fr-active')) {\n\n      // Insert table popup\n      editor.popups.refresh('table.insert');\n      editor.popups.setContainer('table.insert', editor.$tb);\n\n      // Insert table left and top position.\n      var left = $btn.offset().left + $btn.outerWidth() / 2;\n      var top = $btn.offset().top + (editor.opts.toolbarBottom ? 10 : $btn.outerHeight() - 10);\n      editor.popups.show('table.insert', left, top, $btn.outerHeight());\n    }\n  }\n\n  /*\n   * Show the table edit popup.\n   */\n  function _showEditPopup () {\n    // Set popup position.\n    var map = _tableMap();\n\n    if (map) {\n      var $popup = editor.popups.get('table.edit');\n\n      if (!$popup) $popup = _initEditPopup();\n\n      if ($popup) {\n        editor.popups.setContainer('table.edit', editor.$sc);\n        var offset = _selectionOffset(map);\n        var left = (offset.left + offset.right) / 2;\n        var top = offset.bottom;\n\n        editor.popups.show('table.edit', left, top, offset.bottom - offset.top);\n\n        // Disable toolbar buttons only if there are more than one cells selected.\n        if (editor.edit.isDisabled()) {\n\n          // Disable toolbar.\n          if (selectedCells().length > 1) {\n            editor.toolbar.disable();\n          }\n\n          // Allow text selection.\n          editor.$el.removeClass('fr-no-selection');\n          editor.edit.on();\n\n          editor.button.bulkRefresh();\n\n          // https://github.com/froala/wysiwyg-editor/issues/1851.\n          // https://github.com/froala-labs/froala-editor-js-2/issues/314.\n          // https://github.com/froala/wysiwyg-editor/issues/1656.\n          // https://github.com/froala-labs/froala-editor-js-2/issues/294.\n\n          // Place selection in last selected table cell.\n          editor.selection.setAtEnd(editor.$el.find('.fr-selected-cell').last().get(0));\n          editor.selection.restore();\n        }\n      }\n    }\n  }\n\n  /*\n   * Show the table colors popup.\n   */\n  function _showColorsPopup () {\n\n    // Set popup position.\n    var map = _tableMap();\n\n    if (map) {\n      var $popup = editor.popups.get('table.colors');\n\n      if (!$popup) $popup = _initColorsPopup();\n\n      editor.popups.setContainer('table.colors', editor.$sc);\n      var offset = _selectionOffset(map);\n      var left = (offset.left + offset.right) / 2;\n      var top = offset.bottom;\n\n      // Refresh selected color.\n      _refreshColor();\n\n      editor.popups.show('table.colors', left, top, offset.bottom - offset.top);\n    }\n  }\n\n  /*\n   * Called on table edit popup hide.\n   */\n  function _hideEditPopup () {\n\n    // Enable toolbar.\n    if (selectedCells().length === 0) {\n      editor.toolbar.enable();\n    }\n  }\n\n  /**\n   * Init the insert table popup.\n   */\n  function _initInsertPopup (delayed) {\n    if (delayed) {\n      editor.popups.onHide('table.insert', function () {\n\n        // Clear previous cell selection.\n        editor.popups.get('table.insert').find('.fr-table-size .fr-select-table-size > span[data-row=\"1\"][data-col=\"1\"]').trigger('mouseenter');\n      });\n\n      return true;\n    }\n\n    // Table buttons.\n    var table_buttons = '';\n\n    if (editor.opts.tableInsertButtons.length > 0) {\n      table_buttons = '<div class=\"fr-buttons\">' + editor.button.buildList(editor.opts.tableInsertButtons) + '</div>';\n    }\n\n    var template = {\n      buttons: table_buttons,\n      rows_columns: _insertTableHtml()\n    };\n\n    var $popup = editor.popups.create('table.insert', template);\n\n    // Initialize insert table grid events.\n    editor.events.$on($popup, 'mouseover', '.fr-table-size .fr-select-table-size .fr-table-cell', function (e) {\n      _hoverCell($(e.currentTarget));\n    }, true);\n\n    _addAccessibility($popup);\n\n    return $popup;\n  }\n\n  /*\n   * Hover table cell.\n   */\n  function _hoverCell ($table_cell) {\n    var row = parseInt($table_cell.data('row'), 10);\n    var col = parseInt($table_cell.data('col'), 10);\n    var $select_size = $table_cell.parent();\n\n    // Update size in title.\n    $select_size.siblings('.fr-table-size-info').html(row + ' &times; ' + col);\n\n    // Remove hover and fr-active-item class from all cells.\n    $select_size.find('> span').removeClass('hover fr-active-item');\n\n    // Add hover class only to the correct cells.\n    for (var i = 1; i <= editor.opts.tableInsertMaxSize; i++) {\n      for (var j = 0; j <= editor.opts.tableInsertMaxSize; j++) {\n        var $cell = $select_size.find('> span[data-row=\"' + i + '\"][data-col=\"' + j + '\"]');\n\n        if (i <= row && j <= col) {\n          $cell.addClass('hover');\n        }\n        else if ((i <= row + 1 || (i <= 2 && !editor.helpers.isMobile()))) {\n          $cell.css('display', 'inline-block');\n        }\n        else if (i > 2 && !editor.helpers.isMobile()) {\n          $cell.css('display', 'none');\n        }\n      }\n    }\n\n    // Mark table cell as the active item.\n    $table_cell.addClass('fr-active-item');\n  }\n\n  /*\n   * The HTML for insert table grid.\n   */\n  function _insertTableHtml () {\n\n    // Grid html\n    var rows_columns = '<div class=\"fr-table-size\"><div class=\"fr-table-size-info\">1 &times; 1</div><div class=\"fr-select-table-size\">'\n\n    for (var i = 1; i <= editor.opts.tableInsertMaxSize; i++) {\n      for (var j = 1; j <= editor.opts.tableInsertMaxSize; j++) {\n        var display = 'inline-block';\n\n        // Display only first 2 rows.\n        if (i > 2 && !editor.helpers.isMobile()) {\n          display = 'none';\n        }\n\n        var cls = 'fr-table-cell ';\n\n        if (i == 1 && j == 1) {\n          cls += ' hover';\n        }\n\n        rows_columns += '<span class=\"fr-command ' + cls + '\" tabIndex=\"-1\" data-cmd=\"tableInsert\" data-row=\"' + i + '\" data-col=\"' + j + '\" data-param1=\"' + i + '\" data-param2=\"' + j + '\" style=\"display: ' + display + ';\" role=\"button\"><span></span><span class=\"fr-sr-only\">' + i + ' &times; ' + j + '&nbsp;&nbsp;&nbsp;</span></span>';\n      }\n      rows_columns += '<div class=\"new-line\"></div>';\n    }\n\n    rows_columns += '</div></div>';\n\n    return rows_columns;\n  }\n\n  /*\n   * Register keyboard events.\n   */\n  function _addAccessibility ($popup) {\n\n    // Hover cell when table.insert cells are focused.\n    editor.events.$on($popup, 'focus', '[tabIndex]', function (e) {\n      var $focused_el = $(e.currentTarget);\n      _hoverCell($focused_el);\n    });\n\n    // Register popup event.\n    editor.events.on('popup.tab', function (e) {\n      var $focused_item = $(e.currentTarget);\n\n      // Skip if popup is not visible or focus is elsewere.\n      if (!editor.popups.isVisible('table.insert') || !$focused_item.is('span, a')) {\n        return true;\n      }\n\n      var key_code = e.which;\n      var status;\n\n      if (FE.KEYCODE.ARROW_UP == key_code || FE.KEYCODE.ARROW_DOWN == key_code || FE.KEYCODE.ARROW_LEFT == key_code || FE.KEYCODE.ARROW_RIGHT == key_code) {\n        if ($focused_item.is('span.fr-table-cell')) {\n\n          // Get all current cells.\n          var $cells = $focused_item.parent().find('span.fr-table-cell');\n\n          // Get focused item position.\n          var index = $cells.index($focused_item);\n\n          // Get cell matrix dimensions.\n          var columns = editor.opts.tableInsertMaxSize;\n\n          // Get focused item coordinates.\n          var column = index % columns;\n          var line = Math.floor(index / columns);\n\n          // Calculate next coordinates. Go to the other opposite site of the matrix if there is no next adjacent element.\n          if (FE.KEYCODE.ARROW_UP == key_code) {\n            line = Math.max(0, line - 1);\n          }\n          else if (FE.KEYCODE.ARROW_DOWN == key_code) {\n            line = Math.min(editor.opts.tableInsertMaxSize - 1, line + 1);\n          }\n          else if (FE.KEYCODE.ARROW_LEFT == key_code) {\n            column = Math.max(0, column - 1);\n          }\n          else if (FE.KEYCODE.ARROW_RIGHT == key_code) {\n            column = Math.min(editor.opts.tableInsertMaxSize - 1, column + 1);\n          }\n\n          // Get the next element based on the new coordinates.\n          var nextIndex = line * columns + column;\n          var $el = $($cells.get(nextIndex));\n\n          // Hover cell\n          _hoverCell($el);\n\n          // Focus.\n          editor.events.disableBlur();\n          $el.focus();\n\n          status = false;\n        }\n      }\n\n      // ENTER or SPACE.\n      else if (FE.KEYCODE.ENTER == key_code) {\n\n        editor.button.exec($focused_item);\n        status = false;\n      }\n\n      // Prevent propagation.\n      if (status === false) {\n        e.preventDefault();\n        e.stopPropagation();\n      }\n\n      return status;\n    }, true);\n  }\n\n  /**\n   * Init the table edit popup.\n   */\n  function _initEditPopup (delayed) {\n    if (delayed) {\n      editor.popups.onHide('table.edit', _hideEditPopup);\n\n      return true;\n    }\n\n    // Table buttons.\n    var table_buttons = '';\n\n    if (editor.opts.tableEditButtons.length > 0) {\n      table_buttons = '<div class=\"fr-buttons\">' + editor.button.buildList(editor.opts.tableEditButtons) + '</div>';\n\n      var template = {\n        buttons: table_buttons\n      };\n\n      var $popup = editor.popups.create('table.edit', template);\n\n      editor.events.$on(editor.$wp, 'scroll.table-edit', function () {\n        if (editor.popups.isVisible('table.edit')) {\n          _showEditPopup();\n        }\n      });\n\n      return $popup;\n    }\n\n    return false;\n  }\n\n  /*\n   * Init the table cell background popup.\n   */\n  function _initColorsPopup () {\n\n    // Table colors buttons.\n    var table_buttons = '';\n\n    if (editor.opts.tableColorsButtons.length > 0) {\n      table_buttons = '<div class=\"fr-buttons fr-table-colors-buttons\">' + editor.button.buildList(editor.opts.tableColorsButtons) + '</div>';\n    }\n\n    // Custom HEX.\n    var custom_color = '';\n\n    if (editor.opts.colorsHEXInput) {\n      custom_color = '<div class=\"fr-table-colors-hex-layer fr-active fr-layer\" id=\"fr-table-colors-hex-layer-' + editor.id + '\"><div class=\"fr-input-line\"><input maxlength=\"7\" id=\"fr-table-colors-hex-layer-text-' + editor.id + '\" type=\"text\" placeholder=\"' + editor.language.translate('HEX Color') + '\" tabIndex=\"1\" aria-required=\"true\"></div><div class=\"fr-action-buttons\"><button type=\"button\" class=\"fr-command fr-submit\" data-cmd=\"tableCellBackgroundCustomColor\" tabIndex=\"2\" role=\"button\">' + editor.language.translate('OK') + '</button></div></div>';\n    }\n\n    var template = {\n      buttons: table_buttons,\n      colors: _colorsHTML(),\n      custom_color: custom_color\n    };\n\n    var $popup = editor.popups.create('table.colors', template);\n\n    editor.events.$on(editor.$wp, 'scroll.table-colors', function () {\n      if (editor.popups.isVisible('table.colors')) {\n        _showColorsPopup();\n      }\n    });\n\n    _addColorsAccessibility($popup);\n\n    return $popup;\n  }\n\n  /*\n   * HTML for the table colors.\n   */\n  function _colorsHTML () {\n\n    // Create colors html.\n    var colors_html = '<div class=\"fr-table-colors\">';\n\n    // Add colors.\n    for (var i = 0; i < editor.opts.tableColors.length; i++) {\n      if (i !== 0 && i % editor.opts.tableColorsStep === 0) {\n        colors_html += '<br>';\n      }\n\n      if (editor.opts.tableColors[i] != 'REMOVE') {\n        colors_html += '<span class=\"fr-command\" style=\"background: ' + editor.opts.tableColors[i] + ';\" tabIndex=\"-1\" role=\"button\" data-cmd=\"tableCellBackgroundColor\" data-param1=\"' + editor.opts.tableColors[i] + '\"><span class=\"fr-sr-only\">' + editor.language.translate('Color') + ' ' + editor.opts.tableColors[i] + '&nbsp;&nbsp;&nbsp;</span></span>';\n      }\n\n      else {\n        colors_html += '<span class=\"fr-command\" data-cmd=\"tableCellBackgroundColor\" tabIndex=\"-1\" role=\"button\" data-param1=\"REMOVE\" title=\"' + editor.language.translate('Clear Formatting') + '\">' + editor.icon.create('tableColorRemove') + '<span class=\"fr-sr-only\">' + editor.language.translate('Clear Formatting') + '</span></span>';\n      }\n    }\n\n    colors_html += '</div>';\n\n    return colors_html;\n  }\n\n  /*\n   * Set custom color\n   */\n  function customColor () {\n    var $popup = editor.popups.get('table.colors');\n    var $input = $popup.find('.fr-table-colors-hex-layer input');\n\n    if ($input.length) {\n      setBackground($input.val())\n    }\n  }\n\n  /*\n   * Register keyboard events for colors.\n   */\n  function _addColorsAccessibility ($popup) {\n\n    // Register popup event.\n    editor.events.on('popup.tab', function (e) {\n      var $focused_item = $(e.currentTarget);\n\n      // Skip if popup is not visible or focus is elsewere.\n      if (!editor.popups.isVisible('table.colors') || !$focused_item.is('span')) {\n        return true;\n      }\n      var key_code = e.which;\n      var status = true;\n\n      // Tabbing.\n      if (FE.KEYCODE.TAB == key_code) {\n        var $tb = $popup.find('.fr-buttons');\n\n        // Focus back the popup's toolbar if exists.\n        status = !editor.accessibility.focusToolbar($tb, (e.shiftKey ? true : false));\n      }\n\n      // Arrows.\n      else if (FE.KEYCODE.ARROW_UP == key_code || FE.KEYCODE.ARROW_DOWN == key_code || FE.KEYCODE.ARROW_LEFT == key_code || FE.KEYCODE.ARROW_RIGHT == key_code) {\n\n        // Get all current colors.\n        var $colors = $focused_item.parent().find('span.fr-command');\n\n        // Get focused item position.\n        var index = $colors.index($focused_item);\n\n        // Get color matrix dimensions.\n        var columns = editor.opts.colorsStep;\n        var lines = Math.floor($colors.length / columns);\n\n        // Get focused item coordinates.\n        var column = index % columns;\n        var line = Math.floor(index / columns);\n\n        var nextIndex = line * columns + column;\n        var dimension = lines * columns;\n\n        // Calculate next index. Go to the other opposite site of the matrix if there is no next adjacent element.\n        // Up/Down: Traverse matrix lines.\n        // Left/Right: Traverse the matrix as it is a vector.\n        if (FE.KEYCODE.ARROW_UP == key_code) {\n          nextIndex = (((nextIndex - columns) % dimension) + dimension) % dimension; // Javascript negative modulo bug.\n        }\n        else if (FE.KEYCODE.ARROW_DOWN == key_code) {\n          nextIndex = (nextIndex + columns) % dimension;\n        }\n        else if (FE.KEYCODE.ARROW_LEFT == key_code) {\n          nextIndex = (((nextIndex - 1) % dimension) + dimension) % dimension; // Javascript negative modulo bug.\n        }\n        else if (FE.KEYCODE.ARROW_RIGHT == key_code) {\n          nextIndex = (nextIndex + 1) % dimension;\n        }\n\n        // Get the next element based on the new index.\n        var $el = $($colors.get(nextIndex));\n\n        // Focus.\n        editor.events.disableBlur();\n        $el.focus();\n\n        status = false;\n      }\n\n      // ENTER or SPACE.\n      else if (FE.KEYCODE.ENTER == key_code) {\n\n        editor.button.exec($focused_item);\n        status = false;\n      }\n\n      // Prevent propagation.\n      if (status === false) {\n        e.preventDefault();\n        e.stopPropagation();\n      }\n\n      return status;\n    }, true);\n  }\n\n  /*\n   * Show the current selected color.\n   */\n  function _refreshColor () {\n    var $popup = editor.popups.get('table.colors');\n    var $cell = editor.$el.find('.fr-selected-cell').first();\n    var color = editor.helpers.RGBToHex($cell.css('background-color'));\n    var $input = $popup.find('.fr-table-colors-hex-layer input');\n\n    // Remove current color selection.\n    $popup.find('.fr-selected-color').removeClass('fr-selected-color fr-active-item');\n\n    // Find the selected color.\n    $popup.find('span[data-param1=\"' + color + '\"]').addClass('fr-selected-color fr-active-item');\n    $input.val(color).trigger('change');\n  }\n\n  /*\n   * Insert table method.\n   */\n  function insert (rows, cols) {\n\n    // Create table HTML.\n    var table = '<table ' + (!editor.opts.tableDefaultWidth ? '' : 'style=\"width: ' + editor.opts.tableDefaultWidth + ';\" ') + 'class=\"fr-inserted-table\"><tbody>';\n    var cell_width = 100 / cols;\n    var i;\n    var j;\n\n    for (i = 0; i < rows; i++) {\n      table += '<tr>';\n\n      for (j = 0; j < cols; j++) {\n        table += '<td' + (!editor.opts.tableDefaultWidth ? '' : ' style=\"width: ' + cell_width.toFixed(4) + '%;\"') + '>';\n\n        if (i === 0 && j === 0)table += FE.MARKERS;\n        table += '<br></td>';\n      }\n      table += '</tr>';\n    }\n    table += '</tbody></table>';\n\n    editor.html.insert(table);\n\n    // Update cursor position.\n    editor.selection.restore()\n\n    var $table = editor.$el.find('.fr-inserted-table');\n    $table.removeClass('fr-inserted-table');\n    editor.events.trigger('table.inserted', [$table.get(0)]);\n  }\n\n  /*\n   * Delete table method.\n   */\n  function remove () {\n    if (selectedCells().length > 0) {\n      var $current_table = selectedTable();\n\n      // Update cursor position.\n      editor.selection.setBefore($current_table.get(0)) || editor.selection.setAfter($current_table.get(0));\n      editor.selection.restore();\n\n      // Hide table edit popup.\n      editor.popups.hide('table.edit');\n\n      // Delete table.\n      $current_table.remove();\n\n      // Enable toolbar.\n      editor.toolbar.enable();\n    }\n  }\n\n  /*\n   * Add table header.\n   */\n  function addHeader () {\n    var $table = selectedTable();\n\n    // If there is a selection in the table and the table doesn't have a header already.\n    if ($table.length > 0 && $table.find('th').length === 0) {\n\n      // Create header HTML.\n      var thead = '<thead><tr>';\n\n      var i;\n      var col = 0;\n\n      // Get first row and count table columns.\n      $table.find('tr').first().find('> td').each (function () {\n        var $td = $(this);\n\n        col += parseInt($td.attr('colspan'), 10) || 1;\n      });\n\n      // Add cells.\n      for (i = 0; i < col; i++) {\n        thead += '<th><br></th>';\n      }\n\n      thead += '</tr></thead>'\n\n      $table.prepend(thead);\n\n      // Reposition table edit popup.\n      _showEditPopup();\n    }\n  }\n\n  /*\n   * Remove table header.\n   */\n  function removeHeader () {\n    var $current_table = selectedTable();\n    var $table_header = $current_table.find('thead');\n\n    // Table has a header.\n    if ($table_header.length > 0) {\n\n      // If table does not have any other rows then delete table.\n      if ($current_table.find('tbody tr').length === 0) {\n\n        // Remove table.\n        remove();\n      }\n\n      else {\n        $table_header.remove();\n\n        // Reposition table edit popup if there any more selected celss.\n        if (selectedCells().length > 0) {\n          _showEditPopup();\n        }\n        else {\n\n          // Hide popup.\n          editor.popups.hide('table.edit');\n\n          // Update cursor position.\n          var td = $current_table.find('tbody tr td').first().get(0);\n\n          if (td) {\n            editor.selection.setAtEnd(td);\n            editor.selection.restore();\n          }\n        }\n      }\n    }\n  }\n\n  /*\n   * Insert row method.\n   */\n  function insertRow (position) {\n    var $table = selectedTable();\n\n    // We have selection in a table.\n    if ($table.length > 0) {\n\n      // Cannot insert row above the table header.\n      if (editor.$el.find('th.fr-selected-cell').length > 0 && position == 'above') {\n        return;\n      }\n\n      else {\n        var i;\n        var ref_row;\n        var $ref_row;\n\n        // Create a table map.\n        var map = _tableMap();\n\n        // Get selected cells from the table.\n        var selection = _currentSelection(map);\n\n        // Reference row.\n        if (position == 'above') {\n          ref_row = selection.min_i;\n        }\n        else {\n          ref_row = selection.max_i;\n        }\n\n        // Create row HTML.\n        var tr = '<tr>';\n\n        // Add cells.\n        for (i = 0; i < map[ref_row].length; i++) {\n\n          // If cell has rowspan we should increase it.\n          if ((position == 'below' && ref_row < map.length - 1 && map[ref_row][i] == map[ref_row + 1][i]) ||\n              (position == 'above' && ref_row > 0 && map[ref_row][i] == map[ref_row - 1][i])) {\n\n            // Don't increase twice for colspan.\n            if (i === 0 || (i > 0 && map[ref_row][i] != map[ref_row][i - 1])) {\n              var $cell = $(map[ref_row][i]);\n              $cell.attr('rowspan', parseInt($cell.attr('rowspan'), 10) + 1);\n            }\n\n          }\n          else {\n            tr += '<td><br></td>';\n          }\n        }\n\n        // Close row tag.\n        tr += '</tr>';\n\n        // Current selection is in header. Should insert in table body\n        if (editor.$el.find('th.fr-selected-cell').length > 0 && position == 'below') {\n          $ref_row = $($table.find('tbody').not($table.find('> table tbody')));\n        }\n\n        // Selection is in body\n        else {\n          $ref_row = $($table.find('tr').not($table.find('> table tr')).get(ref_row));\n        }\n\n        // Insert new row.\n        if (position == 'below') {\n          if ($ref_row.get(0) && $ref_row.get(0).tagName == 'TBODY') {\n            $ref_row.prepend(tr);\n          }\n          else {\n            $ref_row.after(tr);\n          }\n        }\n        else if (position == 'above') {\n          $ref_row.before(tr);\n\n          // Reposition table edit popup.\n          if (editor.popups.isVisible('table.edit')) {\n            _showEditPopup();\n          }\n        }\n      }\n    }\n  }\n\n  /*\n   * Delete row method.\n   */\n  function deleteRow () {\n    var $table = selectedTable();\n\n    // We have selection in a table.\n    if ($table.length > 0) {\n      var i;\n      var j;\n      var $row;\n\n      // Create a table map.\n      var map = _tableMap();\n\n      // Get selected cells from the table.\n      var selection = _currentSelection(map);\n\n      // If all the rows are selected then delete the entire table.\n      if (selection.min_i === 0 && selection.max_i == map.length - 1) {\n        remove();\n\n      }\n      else {\n\n        // We should delete selected rows.\n        for (i = selection.max_i; i >= selection.min_i; i--) {\n          $row = $($table.find('tr').not($table.find('> table tr')).get(i));\n\n          // Go through the table map to check for rowspan on the row to delete.\n          for (j = 0; j < map[i].length; j++) {\n\n            // Don't do this twice if we have a colspan.\n            if (j === 0 || map[i][j] != map[i][j - 1]) {\n              var $cell = $(map[i][j]);\n\n              // We should decrease rowspan.\n              if (parseInt($cell.attr('rowspan'), 10) > 1) {\n                var rowspan = parseInt($cell.attr('rowspan'), 10) - 1;\n\n                if (rowspan == 1) {\n                  $cell.removeAttr('rowspan');\n                }\n                else {\n                  $cell.attr('rowspan', rowspan);\n                }\n              }\n\n              // We might need to move tds on the row below if we have a rowspan that starts here.\n              if (i < map.length - 1 && map[i][j] == map[i + 1][j] && (i === 0 || map[i][j] != map[i - 1][j])) {\n\n                // Move td to the row below.\n                var td = map[i][j];\n                var col = j;\n\n                // Go back until we get the last element (we might have colspan).\n                while (col > 0 && map[i][col] == map[i][col - 1]) {\n                  col--;\n                }\n\n                // Add td at the beginning of the row below.\n                if (col === 0) {\n                  $($table.find('tr').not($table.find('> table tr')).get(i + 1)).prepend(td);\n\n                }\n                else {\n                  $(map[i + 1][col - 1]).after(td);\n                }\n              }\n            }\n          }\n\n          // Remove tbody or thead if there are no more rows.\n          var $row_parent = $row.parent();\n          $row.remove();\n\n          if ($row_parent.find('tr').length === 0) {\n            $row_parent.remove();\n          }\n\n          // Table has changed.\n          map = _tableMap($table);\n        }\n\n        _updateCellSpan(0, map.length - 1, 0, map[0].length - 1, $table);\n\n        // Update cursor position\n        if (selection.min_i > 0) {\n\n          // Place cursor in the row above selection.\n          editor.selection.setAtEnd(map[selection.min_i - 1][0]);\n        }\n        else {\n\n          // Place cursor in the row below selection.\n          editor.selection.setAtEnd(map[0][0]);\n        }\n        editor.selection.restore();\n\n        // Hide table edit popup.\n        editor.popups.hide('table.edit');\n      }\n    }\n  }\n\n  /*\n   * Insert column method.\n   */\n  function insertColumn (position) {\n    var $table = selectedTable();\n\n    // We have selection in a table.\n    if ($table.length > 0) {\n\n      // Create a table map.\n      var map = _tableMap();\n\n      // Get selected cells from the table.\n      var selection = _currentSelection(map);\n\n      // Reference row.\n      var ref_col;\n\n      if (position == 'before') {\n        ref_col = selection.min_j;\n      }\n      else {\n        ref_col = selection.max_j;\n      }\n\n      // Old and new column widths.\n      var old_width = 100 / map[0].length;\n      var new_width = 100 / (map[0].length + 1);\n\n      // Go through all cells and get their initial (old) widths.\n      var $cell;\n\n      $table.find('th, td').each (function () {\n        $cell = $(this);\n        $cell.data('old-width', $cell.outerWidth() / $table.outerWidth() * 100);\n      });\n\n      // Parse each row to insert a new td.\n      $table.find('tr').not($table.find(' > table tr')).each (function (index) {\n\n        // Get the exact td index before / after which we have to add the new td.\n        // ref_col means the table column number, but this is not the same with the td number in a row.\n        // We might have colspan or rowspan greater than 1.\n        var $row = $(this);\n        var col_no = 0;\n        var td_no = 0;\n        var ref_td;\n\n        // Start with the first td (td_no = 0) in the current row.\n        // Sum colspans (col_no) to see when we reach ref_col.\n        // Summing colspans we get the same number with the table column number.\n        while (col_no - 1 < ref_col) {\n\n          // Get current td.\n          ref_td = $row.find('> th, > td').get(td_no);\n\n          // There are no more tds in this row.\n          if (!ref_td) {\n            ref_td = null;\n            break;\n          }\n\n          // The current td is the same with the td from the table map.\n          if (ref_td == map[index][col_no]) {\n\n            // The current td might have colspan.\n            col_no += parseInt($(ref_td).attr('colspan'), 10) || 1;\n\n            // Go to the next td on the current row.\n            td_no++;\n          }\n\n          // If current td is not the same with the td from the table map.\n          // This means that this table cell (map[index][td_no]) has rowspan.\n          // There is at least one td less on this row due to rowspan (based on map[index][td_no] colspan value).\n          // We want to count this as a column as well.\n          else {\n            col_no += parseInt($(map[index][col_no]).attr('colspan'), 10) || 1;\n\n            // ref_td is one td ahead. Get previous td if we want to insert column after.\n            if (position == 'after') {\n\n              // There is a rowspan and so ref_td is the first td, but it is not in the first column.\n              if (td_no === 0) {\n                ref_td = -1;\n\n              }\n              else {\n                ref_td = $row.find('> th, > td').get(td_no - 1);\n              }\n            }\n          }\n        }\n\n        var $ref_td = $(ref_td);\n\n        // If the computed column number is higher than the reference number\n        // then on this row we have a colspan longer than the reference column.\n        // When adding a column after we should increase colspan on this row.\n        //\n        // If we want to add a column before, but the td on the reference column is\n        // the same with the previous one then we have a td with colspan that\n        // starts before the column reference number.\n        // When adding a column before we should increase colspan on this row.\n        if ((position == 'after' && col_no - 1 > ref_col) ||\n            (position == 'before' && ref_col > 0 && map[index][ref_col] == map[index][ref_col - 1])) {\n\n          // Don't increase twice for rowspan.\n          if (index === 0 || (index > 0 && map[index][ref_col] != map[index - 1][ref_col])) {\n            var colspan = parseInt($ref_td.attr('colspan'), 10) + 1;\n\n            $ref_td.attr('colspan', colspan)\n\n            // Update this cell's width.\n            $ref_td.css('width', ($ref_td.data('old-width') * new_width / old_width + new_width).toFixed(4) + '%');\n            $ref_td.removeData('old-width');\n          }\n\n        }\n\n        else {\n\n          // Create HTML for a new cell.\n          var td;\n\n          // Might be a td or a th.\n          if ($row.find('th').length > 0) {\n            td = '<th style=\"width: ' + new_width.toFixed(4) + '%;\"><br></th>';\n          }\n          else {\n            td = '<td style=\"width: ' + new_width.toFixed(4) + '%;\"><br></td>';\n          }\n\n          // Insert exactly at the beginning.\n          if (ref_td == -1) {\n            $row.prepend(td);\n\n          // Insert exactly at the end.\n          }\n          else if (ref_td == null) {\n            $row.append(td);\n\n          // Insert td on the current row.\n          }\n          else {\n            if (position == 'before') {\n              $ref_td.before(td);\n            }\n\n            else if (position == 'after') {\n              $ref_td.after(td);\n            }\n          }\n        }\n      });\n\n      // Parse each row to update cells' width.\n      $table.find('th, td').each (function () {\n        $cell = $(this);\n\n        // Update width and remove data.\n        if ($cell.data('old-width')) {\n          $cell.css('width', ($cell.data('old-width') * new_width / old_width).toFixed(4) + '%');\n          $cell.removeData('old-width')\n        }\n      });\n\n      // Reposition table edit popup.\n      if (editor.popups.isVisible('table.edit')) {\n        _showEditPopup();\n      }\n    }\n  }\n\n  /*\n   * Delete column method.\n   */\n  function deleteColumn () {\n    var $table = selectedTable();\n\n    // We have selection in a table.\n    if ($table.length > 0) {\n      var i;\n      var j;\n      var $cell;\n\n      // Create a table map.\n      var map = _tableMap();\n\n      // Get selected cells from the table.\n      var selection = _currentSelection(map);\n\n      // If all the rows are selected then delete the entire table.\n      if (selection.min_j === 0 && selection.max_j == map[0].length - 1) {\n        remove();\n      }\n      else {\n        // Old width of all the columns that remain afte the delete.\n        var old_width = 0;\n\n        // Go through all cells and get their initial (old) widths.\n        for (i = 0; i < map.length; i++) {\n          for (j = 0; j < map[0].length; j++) {\n            $cell = $(map[i][j]);\n\n            if (!$cell.hasClass('fr-selected-cell')) {\n              $cell.data('old-width', $cell.outerWidth() / $table.outerWidth() * 100);\n\n              if (j < selection.min_j || j > selection.max_j) {\n                old_width += $cell.outerWidth() / $table.outerWidth() * 100;\n              }\n            }\n          }\n        }\n\n        old_width /= map.length;\n\n        // We should delete selected columns.\n        for (j = selection.max_j; j >= selection.min_j; j--) {\n\n          // Go through the table map to check for colspan.\n          for (i = 0; i < map.length; i++) {\n\n            // Don't do this twice if we have a rowspan.\n            if (i === 0 || map[i][j] != map[i - 1][j]) {\n\n              // We should decrease colspan.\n              $cell = $(map[i][j]);\n\n              if ((parseInt($cell.attr('colspan'), 10) || 1) > 1) {\n                var colspan = parseInt($cell.attr('colspan'), 10) - 1;\n\n                if (colspan == 1) {\n                  $cell.removeAttr('colspan');\n                }\n                else {\n                  $cell.attr('colspan', colspan);\n                }\n\n                // Update cell width.\n                $cell.css('width', (($cell.data('old-width') - _columnWidth(j, map)) * 100 / old_width).toFixed(4) + '%');\n                $cell.removeData('old-width');\n\n              // If there is no colspan delete the cell.\n              }\n              else {\n\n                // We might need to delete the row too if it is empty.\n                var $row = $($cell.parent().get(0));\n\n                $cell.remove();\n\n                // Check if there are any more tds in the current row.\n                if ($row.find('> th, > td').length === 0) {\n\n                  // Check if it is okay to delete the tr.\n                  if ($row.prev().length === 0 || $row.next().length === 0 ||\n                      $row.prev().find('> th[rowspan], > td[rowspan]').length < $row.prev().find('> th, > td').length) {\n                    $row.remove();\n                  }\n                }\n              }\n            }\n          }\n        }\n\n        _updateCellSpan(0, map.length - 1, 0, map[0].length - 1, $table);\n\n        // Update cursor position\n        if (selection.min_j > 0) {\n          // Place cursor in the column before selection.\n          editor.selection.setAtEnd(map[selection.min_i][selection.min_j - 1]);\n        }\n        else {\n          // Place cursor in the column after selection.\n          editor.selection.setAtEnd(map[selection.min_i][0]);\n        }\n        editor.selection.restore();\n\n        // Hide table edit popup.\n        editor.popups.hide('table.edit');\n\n        // Scale current cells' width after column has been deleted.\n        $table.find('th, td').each (function () {\n          $cell = $(this);\n\n          // Update width and remove data.\n          if ($cell.data('old-width')) {\n            $cell.css('width', ($cell.data('old-width') * 100 / old_width).toFixed(4) + '%');\n            $cell.removeData('old-width');\n          }\n        });\n      }\n    }\n  }\n\n  /*\n   * Update or remove colspan attribute.\n   */\n  function _updateColspan (min_j, max_j, $table) {\n    var i;\n    var j;\n    var k;\n    var first_span;\n    var span;\n    var decrease = 0;\n\n    // Create a table map.\n    var map = _tableMap($table);\n\n    // A column might have been deleted.\n    max_j = Math.min(max_j, map[0].length - 1);\n\n    // If max_j and min_j are the same, then only one column is selected and colspan is preserved.\n    if (max_j > min_j) {\n      // Find out how much we should decrease colspan.\n      // Parsing only the first row is enough.\n      for (j = min_j; j <= max_j; j++) {\n\n        // This cell has colspan and has already been checked.\n        if (j > min_j && map[0][j] == map[0][j - 1]) {\n          continue;\n        }\n\n        // Current cell colspan\n        first_span = Math.min(parseInt(map[0][j].getAttribute('colspan'), 10) || 1, max_j - min_j + 1);\n\n        // Cell has colspan between min_j and max_j.\n        /* j + 1 will never exceed the number of columns in a table.\n         * A colspan is detected before the last column and all next cells on that row are skipped.\n         */\n        if (first_span > 1 && map[0][j] == map[0][j + 1]) {\n\n          // The value we should decrease colspan with.\n          decrease = first_span - 1;\n\n          // Check all columns on the current row.\n          // We found a colspan on the first row (i = 0), continue with second row (i = 1).\n          for (i = 1; i < map.length; i++) {\n\n            // This cell has rowspan and has already been checked.\n            if (map[i][j] == map[i - 1][j]) {\n              continue;\n            }\n\n            // Look for a colspan on the same columns.\n            for (k = j; k < j + first_span; k++) {\n              span = parseInt(map[i][k].getAttribute('colspan'), 10) || 1;\n\n              // There are other cells with colspan on this column.\n              /* k + 1 will never exceed the number of columns in a table.\n               * A colspan is detected before the last column and all next cells on that row are skipped.\n               */\n              if (span > 1 && map[i][k] == map[i][k + 1]) {\n                decrease = Math.min(decrease, span - 1);\n\n                // Skip colspan.\n                k += decrease;\n              }\n              else {\n                decrease = Math.max (0, decrease - 1);\n\n                // Stop if decrease reaches 0.\n                if (!decrease) {\n                  break;\n                }\n              }\n            }\n\n            // Stop looking on the next columns if decrease reaches 0.\n            if (!decrease) {\n              break;\n            }\n          }\n        }\n      }\n    }\n\n    // Update colspan attribute.\n    if (decrease) {\n      _decreaseCellSpan(map, decrease, 'colspan', 0, map.length - 1, min_j, max_j);\n    }\n  }\n\n  /*\n   * Update or remove rowspan attribute.\n   */\n  function _updateRowspan (min_i, max_i, $table) {\n    var i;\n    var j;\n    var k;\n    var first_span;\n    var span;\n    var decrease = 0;\n\n    // Create a table map.\n    var map = _tableMap($table);\n\n    // A row might have been deleted.\n    max_i = Math.min(max_i, map.length - 1);\n\n    // If max_i and min_i are the same, then only one row is selected and rowspan is preserved.\n    if (max_i > min_i) {\n      // Find out how much we should decrease rowspan.\n      // Parsing only the first column is enough.\n      for (i = min_i; i <= max_i; i++) {\n\n        // This cell has rowspan and has already been checked.\n        if (i > min_i && map[i][0] == map[i - 1][0]) {\n          continue;\n        }\n\n        // Current cell rowspan\n        first_span = Math.min(parseInt(map[i][0].getAttribute('rowspan'), 10) || 1, max_i - min_i + 1);\n\n        // Cell has rowspan between min_i and max_i.\n        /* i + 1 will never exceed the number of rows in a table.\n         * A rowspan is detected before the last row and all next cells on that column are skipped.\n         */\n        if (first_span > 1 && map[i][0] == map[i + 1][0]) {\n\n          // The value we should decrease rowspan with.\n          decrease = first_span - 1;\n\n          // Check all columns on the current row.\n          // We found a rowspan on the first column (j = 0), continue with second column (j = 1).\n          for (j = 1; j < map[0].length; j++) {\n\n            // This cell has colspan and has already been checked.\n            if (map[i][j] == map[i][j - 1]) {\n              continue;\n            }\n\n            // Look for a rowspan on the same rows.\n            for (k = i; k < i + first_span; k++) {\n              span = parseInt(map[k][j].getAttribute('rowspan'), 10) || 1;\n\n              // There are other cells with rowspan on this row.\n              /* k + 1 will never exceed the number of rows in a table.\n               * A rowspan is detected before the last row and all next cells on that column are skipped.\n               */\n              if (span > 1 && map[k][j] == map[k + 1][j]) {\n                decrease = Math.min(decrease, span - 1);\n\n                // Skip rowspan.\n                k += decrease;\n              }\n              else {\n                decrease = Math.max (0, decrease - 1);\n\n                // Stop if decrease reaches 0.\n                if (!decrease) {\n                  break;\n                }\n              }\n            }\n\n            // Stop looking on the next columns if decrease reaches 0.\n            if (!decrease) {\n              break;\n            }\n          }\n        }\n      }\n    }\n\n    // Update rowspan attribute.\n    if (decrease) {\n      _decreaseCellSpan(map, decrease, 'rowspan', min_i, max_i, 0, map[0].length - 1);\n    }\n  }\n\n  /*\n   * Decrease the colspan or rowspan with the amount specified.\n   */\n  function _decreaseCellSpan (map, decrease, span_type, min_i, max_i, min_j, max_j) {\n\n    // Update span attribute.\n    var i;\n    var j;\n    var span;\n\n    // Go only through lines and columns that need to be updated.\n    for (i = min_i; i <= max_i; i++) {\n      for (j = min_j; j <= max_j; j++) {\n\n        // This cell has rowspan or colspan and has already been checked.\n        if ((i > min_i && map[i][j] == map[i - 1][j]) || (j > min_j && map[i][j] == map[i][j - 1])) {\n          continue;\n        }\n\n        span = parseInt(map[i][j].getAttribute(span_type), 10) || 1;\n\n        // Update cell span.\n        if (span > 1) {\n          if (span - decrease > 1) map[i][j].setAttribute(span_type, span - decrease);\n          else map[i][j].removeAttribute(span_type);\n        }\n      }\n    }\n  }\n\n  /*\n   * Update or remove colspan and rowspan attributes.\n   */\n  function _updateCellSpan (min_i, max_i, min_j, max_j, $table) {\n    _updateRowspan(min_i, max_i, $table);\n    _updateColspan(min_j, max_j, $table);\n  }\n\n  /*\n   * Merge selected cells method.\n   */\n  function mergeCells () {\n\n    // We have more than one cell selected in a table. Cannot merge td and th.\n    if (selectedCells().length > 1 && (editor.$el.find('th.fr-selected-cell').length === 0 || editor.$el.find('td.fr-selected-cell').length === 0)) {\n\n      _removeKeyboardSelectionHandlers();\n\n      // Create a table map.\n      var map = _tableMap();\n\n      // Get selected cells.\n      var selection = _currentSelection(map);\n\n      var i;\n      var $cell;\n      var cells = editor.$el.find('.fr-selected-cell');\n      var $first_cell = $(cells[0]);\n      var $first_row = $first_cell.parent();\n      var first_row_cells = $first_row.find('.fr-selected-cell');\n      var $current_table = $first_cell.closest('table');\n      var content = $first_cell.html();\n      var width = 0;\n\n      // Update cell width.\n      for (i = 0; i < first_row_cells.length; i++) {\n        width += $(first_row_cells[i]).outerWidth();\n      }\n\n      $first_cell.css('width', (width / $current_table.outerWidth() * 100).toFixed(4) + '%');\n\n      // Set the colspan for the merged cells.\n      if (selection.min_j < selection.max_j) {\n        $first_cell.attr('colspan', selection.max_j - selection.min_j + 1);\n      }\n\n      // Set the rowspan for the merged cells.\n      if (selection.min_i < selection.max_i) {\n        $first_cell.attr('rowspan', selection.max_i - selection.min_i + 1);\n      }\n\n      // Go through all selected cells to merge their content.\n      for (i = 1; i < cells.length; i++) {\n        $cell = $(cells[i])\n\n        // If cell is empty, don't add only <br> tags.\n        if ($cell.html() != '<br>' && $cell.html() !== '') {\n          content += '<br>' + $cell.html();\n        }\n\n        // Remove cell.\n        $cell.remove();\n      }\n\n      // Set the HTML content.\n      $first_cell.html(content);\n      editor.selection.setAtEnd($first_cell.get(0));\n      editor.selection.restore();\n\n      // Enable toolbar.\n      editor.toolbar.enable();\n\n      // Update rowspan before removing empty rows (otherwise table map is not correct).\n      _updateRowspan(selection.min_i, selection.max_i, $current_table);\n\n      // Merge is done, check if we have empty trs to clean.\n      var empty_trs = $current_table.find('tr:empty');\n\n      for (i = empty_trs.length - 1; i >= 0; i--) {\n        $(empty_trs[i]).remove();\n      }\n\n      // Update colspan after removing empty rows and updating rowspan.\n      _updateColspan(selection.min_j, selection.max_j, $current_table);\n\n      // Reposition table edit popup.\n      _showEditPopup();\n    }\n  }\n\n  /*\n   * Split cell horizontally method.\n   */\n  function splitCellHorizontally () {\n\n    // We have only one cell selected in a table.\n    if (selectedCells().length == 1) {\n      var $selected_cell = editor.$el.find('.fr-selected-cell');\n      var $current_row = $selected_cell.parent();\n      var $current_table = $selected_cell.closest('table');\n      var current_rowspan = parseInt($selected_cell.attr('rowspan'), 10);\n\n      // Create a table map.\n      var map = _tableMap();\n      var cell_origin = _cellOrigin($selected_cell.get(0), map);\n\n      // Create new td.\n      var $new_td = $selected_cell.clone().html('<br>');\n\n      // Cell has rowspan.\n      if (current_rowspan > 1) {\n\n        // Split current cell's rowspan.\n        var new_rowspan = Math.ceil(current_rowspan / 2);\n\n        if (new_rowspan > 1) {\n          $selected_cell.attr('rowspan', new_rowspan);\n        }\n        else {\n          $selected_cell.removeAttr('rowspan');\n        }\n\n        // Update new td's rowspan.\n        if (current_rowspan - new_rowspan > 1) {\n          $new_td.attr('rowspan', current_rowspan - new_rowspan);\n        }\n        else {\n          $new_td.removeAttr('rowspan');\n        }\n\n        // Find where we should insert the new td.\n        var row = cell_origin.row + new_rowspan;\n        var col = cell_origin.col === 0 ? cell_origin.col : cell_origin.col - 1;\n\n        // Go back until we find a td on this row. We might have colspans and rowspans.\n        while (col >= 0 && (map[row][col] == map[row][col - 1] || (row > 0 && map[row][col] == map[row - 1][col]))) {\n          col--;\n        }\n\n        if (col == -1) {\n\n          // We couldn't find a previous td on this row. Prepend the new td.\n          $($current_table.find('tr').not($current_table.find('> table tr')).get(row)).prepend($new_td);\n\n        }\n        else {\n          $(map[row][col]).after($new_td.get(0));\n        }\n\n      }\n      else {\n\n        // Add new row bellow with only one cell.\n        var $row = $(editor.doc.createElement('TR')).append($new_td);\n\n        var i;\n\n        // Increase rowspan for all cells on the current row.\n        for (i = 0; i < map[0].length; i++) {\n\n          // Don't do this twice if we have a colspan.\n          if (i === 0 || map[cell_origin.row][i] != map[cell_origin.row][i - 1]) {\n            var $cell = $(map[cell_origin.row][i]);\n\n            if (!$cell.is($selected_cell)) {\n              $cell.attr('rowspan', (parseInt($cell.attr('rowspan'), 10) || 1) + 1);\n            }\n          }\n        }\n\n        $current_row.after($row.get(0));\n      }\n\n      // Remove selection\n      _removeSelection();\n\n      // Hide table edit popup.\n      editor.popups.hide('table.edit');\n    }\n  }\n\n  /*\n   * Split cell vertically method.\n   */\n  function splitCellVertically () {\n\n    // We have only one cell selected in a table.\n    if (selectedCells().length == 1) {\n      var $selected_cell = editor.$el.find('.fr-selected-cell');\n      var current_colspan = parseInt($selected_cell.attr('colspan'), 10) || 1;\n      var parent_width = $selected_cell.parent().outerWidth();\n      var width = $selected_cell.outerWidth();\n\n      // Create new td.\n      var $new_td = $selected_cell.clone().html('<br>');\n\n      // Create a table map.\n      var map = _tableMap();\n      var cell_origin = _cellOrigin($selected_cell.get(0), map);\n\n      if (current_colspan > 1) {\n\n        // Split current colspan.\n        var new_colspan = Math.ceil(current_colspan / 2);\n\n        width = _columnsWidth(cell_origin.col, cell_origin.col + new_colspan - 1, map) / parent_width * 100;\n        var new_width = _columnsWidth(cell_origin.col + new_colspan, cell_origin.col + current_colspan - 1, map) / parent_width * 100;\n\n        // Update colspan for current cell.\n        if (new_colspan > 1) {\n          $selected_cell.attr('colspan', new_colspan);\n        }\n        else {\n          $selected_cell.removeAttr('colspan');\n        }\n\n        // Update new td's colspan.\n        if (current_colspan - new_colspan > 1) {\n          $new_td.attr('colspan', current_colspan - new_colspan);\n        }\n        else {\n          $new_td.removeAttr('colspan');\n        }\n\n        // Update cell width.\n        $selected_cell.css('width', width.toFixed(4) + '%');\n        $new_td.css('width', new_width.toFixed(4) + '%');\n\n      // Increase colspan for all cells on the current column.\n      }\n      else {\n        var i;\n\n        for (i = 0; i < map.length; i++) {\n\n          // Don't do this twice if we have a rowspan.\n          if (i === 0 || map[i][cell_origin.col] != map[i - 1][cell_origin.col]) {\n            var $cell = $(map[i][cell_origin.col]);\n\n            if (!$cell.is($selected_cell)) {\n              var colspan = (parseInt($cell.attr('colspan'), 10) || 1) + 1;\n              $cell.attr('colspan', colspan);\n            }\n          }\n        }\n\n        // Update cell width.\n        width = width / parent_width * 100 / 2;\n\n        $selected_cell.css('width', width.toFixed(4) + '%');\n        $new_td.css('width', width.toFixed(4) + '%');\n      }\n\n      // Add a new td after the current one.\n      $selected_cell.after($new_td.get(0));\n\n      // Remove selection\n      _removeSelection();\n\n      // Hide table edit popup.\n      editor.popups.hide('table.edit');\n    }\n  }\n\n  /*\n   * Set background color to selected cells.\n   */\n  function setBackground (color) {\n    var $selected_cells = editor.$el.find('.fr-selected-cell');\n\n    // Set background  color.\n    if (color != 'REMOVE') {\n      $selected_cells.css('background-color', editor.helpers.HEXtoRGB(color));\n    }\n\n    // Remove background color.\n    else {\n      $selected_cells.css('background-color', '');\n    }\n\n    _showEditPopup();\n  }\n\n  /*\n   * Set vertical align to selected cells.\n   */\n  function verticalAlign (val) {\n    editor.$el.find('.fr-selected-cell').css('vertical-align', val);\n  }\n\n  /*\n   * Apply horizontal alignment to selected cells.\n   */\n  function horizontalAlign (val) {\n    editor.$el.find('.fr-selected-cell').css('text-align', val);\n  }\n\n  /**\n   * Apply specific style to selected table or selected cells.\n   * val              class to apply.\n   * obj              table or selected cells.\n   * multiple_styles  editor.opts.tableStyles or editor.opts.tableCellStyles.\n   * style            editor.opts.tableStyles or editor.opts.tableCellStyles\n   */\n  function applyStyle (val, obj, multiple_styles, styles) {\n    if (obj.length > 0) {\n\n      // Remove multiple styles.\n      if (!multiple_styles) {\n        var classes = Object.keys(styles);\n        classes.splice(classes.indexOf(val), 1);\n        obj.removeClass(classes.join(' '));\n      }\n\n      obj.toggleClass(val);\n    }\n  }\n\n  /*\n   * Create a table map.\n   */\n  function _tableMap ($table) {\n    $table = $table || null;\n\n    var map = [];\n\n    if ($table == null && selectedCells().length > 0) {\n      $table = selectedTable();\n    }\n\n    if ($table) {\n      $table.find('tr').not($table.find('> table tr')).each (function (row, tr) {\n        var $tr = $(tr);\n\n        var c_index = 0;\n        $tr.find('> th, > td').each (function (col, td) {\n          var $td = $(td);\n          var cspan = parseInt($td.attr('colspan'), 10) || 1;\n          var rspan = parseInt($td.attr('rowspan'), 10) || 1;\n\n          for (var i = row; i < row + rspan; i++) {\n            for (var j = c_index; j < c_index + cspan; j++) {\n              if (!map[i]) map[i] = [];\n\n              if (!map[i][j]) {\n                map[i][j] = td;\n              }\n              else {\n                c_index++;\n              }\n            }\n          }\n\n          c_index += cspan;\n        })\n      });\n    }\n\n    return map;\n  }\n\n  /*\n   * Get the i, j coordinates of a cell in the table map.\n   * These are the coordinates where the cell starts.\n   */\n  function _cellOrigin (td, map) {\n    for (var i = 0; i < map.length; i++) {\n      for (var j = 0; j < map[i].length; j++) {\n        if (map[i][j] == td) {\n          return {\n            row: i,\n            col: j\n          };\n        }\n      }\n    }\n  }\n\n  /*\n   * Get the i, j coordinates where a cell ends in the table map.\n   */\n  function _cellEnds (origin_i, origin_j, map) {\n    var max_i = origin_i + 1;\n    var max_j = origin_j + 1;\n\n    // Compute max_i\n    while (max_i < map.length) {\n      if (map[max_i][origin_j] != map[origin_i][origin_j]) {\n        max_i--;\n        break;\n      }\n\n      max_i++;\n    }\n\n    if (max_i == map.length) {\n      max_i--;\n    }\n\n    // Compute max_j\n    while (max_j < map[origin_i].length) {\n      if (map[origin_i][max_j] != map[origin_i][origin_j]) {\n        max_j--;\n        break;\n      }\n\n      max_j++;\n    }\n\n    if (max_j == map[origin_i].length) {\n      max_j--;\n    }\n\n    return {\n      row: max_i,\n      col: max_j\n    };\n  }\n\n  /*\n   * Remove handler classes that are used to select table cells with keyboard.\n   */\n  function _removeKeyboardSelectionHandlers () {\n    if (editor.el.querySelector('.fr-cell-fixed')) {\n      editor.el.querySelector('.fr-cell-fixed').classList.remove('fr-cell-fixed');\n    }\n\n    if (editor.el.querySelector('.fr-cell-handler')) {\n      editor.el.querySelector('.fr-cell-handler').classList.remove('fr-cell-handler');\n    }\n  }\n\n  /*\n   * Remove selection from cells.\n   */\n  function _removeSelection () {\n    var cells = editor.$el.find('.fr-selected-cell');\n\n    if (cells.length > 0) {\n\n      // Remove selection.\n      cells.each (function () {\n        var $cell = $(this);\n\n        $cell.removeClass('fr-selected-cell');\n\n        if ($cell.attr('class') === '') {\n          $cell.removeAttr('class');\n        }\n      });\n    }\n\n    _removeKeyboardSelectionHandlers();\n  }\n\n  /*\n   * Clear selection to prevent Firefox cell selection.\n   */\n  function _clearSelection () {\n    editor.events.disableBlur();\n    editor.selection.clear();\n\n    // Prevent text selection while selecting multiple cells.\n    // Happens in Chrome.\n    editor.$el.addClass('fr-no-selection');\n\n    // Cursor will not appear if we don't make blur.\n    editor.$el.blur();\n    editor.events.enableBlur();\n  }\n\n  /*\n   * Get current selected cells coordintates.\n   */\n  function _currentSelection (map) {\n    var cells = editor.$el.find('.fr-selected-cell');\n\n    if (cells.length > 0) {\n      var min_i = map.length;\n      var max_i = 0;\n      var min_j = map[0].length;\n      var max_j = 0;\n      var i;\n\n      for (i = 0; i < cells.length; i++) {\n        var cellOrigin = _cellOrigin(cells[i], map);\n        var cellEnd = _cellEnds(cellOrigin.row, cellOrigin.col, map);\n\n        min_i = Math.min(cellOrigin.row, min_i);\n        max_i = Math.max(cellEnd.row, max_i);\n        min_j = Math.min(cellOrigin.col, min_j);\n        max_j = Math.max(cellEnd.col, max_j);\n      }\n\n      return {\n        min_i: min_i,\n        max_i: max_i,\n        min_j: min_j,\n        max_j: max_j\n      };\n    }\n    else {\n      return null;\n    }\n  }\n\n  /*\n   * Minimum and maximum coordinates for the selection in the table map.\n   */\n  function _selectionLimits (min_i, max_i, min_j, max_j, map) {\n    var first_i = min_i;\n    var last_i = max_i;\n    var first_j = min_j;\n    var last_j = max_j;\n    var i;\n    var j;\n    var cellOrigin;\n    var cellEnd;\n\n    // Go through first and last columns.\n    for (i = first_i; i <= last_i; i++) {\n\n      // First column.\n      if ((parseInt($(map[i][first_j]).attr('rowspan'), 10) || 1) > 1 ||\n          (parseInt($(map[i][first_j]).attr('colspan'), 10) || 1) > 1) {\n        cellOrigin = _cellOrigin(map[i][first_j], map);\n        cellEnd = _cellEnds(cellOrigin.row, cellOrigin.col, map);\n\n        first_i = Math.min(cellOrigin.row, first_i);\n        last_i = Math.max(cellEnd.row, last_i);\n        first_j = Math.min(cellOrigin.col, first_j);\n        last_j = Math.max(cellEnd.col, last_j);\n      }\n\n      // Last column.\n      if ((parseInt($(map[i][last_j]).attr('rowspan'), 10) || 1) > 1 ||\n          (parseInt($(map[i][last_j]).attr('colspan'), 10) || 1) > 1) {\n        cellOrigin = _cellOrigin(map[i][last_j], map);\n        cellEnd = _cellEnds(cellOrigin.row, cellOrigin.col, map);\n\n        first_i = Math.min(cellOrigin.row, first_i);\n        last_i = Math.max(cellEnd.row, last_i);\n        first_j = Math.min(cellOrigin.col, first_j);\n        last_j = Math.max(cellEnd.col, last_j);\n      }\n    }\n\n    // Go through first and last rows.\n    for (j = first_j; j <= last_j; j++) {\n\n      // First row.\n      if ((parseInt($(map[first_i][j]).attr('rowspan'), 10) || 1) > 1 ||\n          (parseInt($(map[first_i][j]).attr('colspan'), 10) || 1) > 1) {\n        cellOrigin = _cellOrigin(map[first_i][j], map);\n        cellEnd = _cellEnds(cellOrigin.row, cellOrigin.col, map);\n\n        first_i = Math.min(cellOrigin.row, first_i);\n        last_i = Math.max(cellEnd.row, last_i);\n        first_j = Math.min(cellOrigin.col, first_j);\n        last_j = Math.max(cellEnd.col, last_j);\n      }\n\n      // Last column.\n      if ((parseInt($(map[last_i][j]).attr('rowspan'), 10) || 1) > 1 ||\n          (parseInt($(map[last_i][j]).attr('colspan'), 10) || 1) > 1) {\n        cellOrigin = _cellOrigin(map[last_i][j], map);\n        cellEnd = _cellEnds(cellOrigin.row, cellOrigin.col, map);\n\n        first_i = Math.min(cellOrigin.row, first_i);\n        last_i = Math.max(cellEnd.row, last_i);\n        first_j = Math.min(cellOrigin.col, first_j);\n        last_j = Math.max(cellEnd.col, last_j);\n      }\n    }\n\n    if (first_i == min_i && last_i == max_i && first_j == min_j && last_j == max_j) {\n      return {\n        min_i: min_i,\n        max_i: max_i,\n        min_j: min_j,\n        max_j: max_j\n      };\n\n    }\n    else {\n      return _selectionLimits(first_i, last_i, first_j, last_j, map);\n    }\n  }\n\n  /*\n   * Get the left and right offset position for the current selection.\n   */\n  function _selectionOffset (map) {\n    var selection = _currentSelection(map);\n\n    // Top left cell.\n    var $tl = $(map[selection.min_i][selection.min_j]);\n\n    // Top right cell.\n    var $tr = $(map[selection.min_i][selection.max_j]);\n\n    // Bottom left cell.\n    var $bl = $(map[selection.max_i][selection.min_j]);\n\n    var left = $tl.offset().left\n    var right = $tr.offset().left + $tr.outerWidth();\n    var top = $tl.offset().top;\n    var bottom = $bl.offset().top + $bl.outerHeight();\n\n    return {\n      left: left,\n      right: right,\n      top: top,\n      bottom: bottom\n    };\n  }\n\n  /*\n   * Select table cells.\n   * firstCell is either the top left corner or the fr-cell-fixed corner of the selection.\n   * lastCell is either the bottom right corner ot the fr-cell-handler of the selection.\n   */\n  function _selectCells (firstCell, lastCell) {\n\n    // If the first and last cells are the same then just select it.\n    if ($(firstCell).is(lastCell)) {\n\n      // Remove previous selection.\n      _removeSelection();\n\n      $(firstCell).addClass('fr-selected-cell');\n    }\n\n    // Select multiple cells.\n    else {\n      // Prevent Firefox cell selection.\n      _clearSelection();\n\n      // Turn editor toolbar off.\n      editor.edit.off();\n\n      // Create a table map.\n      var map = _tableMap();\n\n      // Get first and last cell's i and j map coordinates.\n      var firstCellOrigin = _cellOrigin(firstCell, map);\n      var lastCellOrigin = _cellOrigin(lastCell, map);\n\n      // Some cells between these coordinates might have colspan or rowspan.\n      // The selected area exceeds first and last cells' coordinates.\n      var limits = _selectionLimits(Math.min(firstCellOrigin.row, lastCellOrigin.row),\n                                                Math.max(firstCellOrigin.row, lastCellOrigin.row),\n                                                Math.min(firstCellOrigin.col, lastCellOrigin.col),\n                                                Math.max(firstCellOrigin.col, lastCellOrigin.col),\n                                                map);\n\n      // Remove previous selection.\n      _removeSelection();\n\n      // We always need to set the selection handler classes as user may use keyboard to select at anytime.\n      firstCell.classList.add('fr-cell-fixed');\n      lastCell.classList.add('fr-cell-handler');\n\n      // Select all cells between the first and last cell.\n      for (var i = limits.min_i; i <= limits.max_i; i++) {\n        for (var j = limits.min_j; j <= limits.max_j; j++) {\n          $(map[i][j]).addClass('fr-selected-cell');\n        }\n      }\n    }\n  }\n\n  /*\n   * Get the cell under the mouse cursor.\n   */\n  function _getCellUnder (e) {\n    var cell = null;\n    var $target = $(e.target);\n\n    if (e.target.tagName == 'TD' || e.target.tagName == 'TH') {\n      cell = e.target;\n    }\n    else if ($target.closest('td').length > 0) {\n      cell = $target.closest('td').get(0);\n    }\n    else if ($target.closest('th').length > 0) {\n      cell = $target.closest('th').get(0);\n    }\n\n    // Cell should reside inside editor.\n    if (!editor.$el.contains(cell)) return null;\n\n    return cell;\n  }\n\n  /*\n   * Stop table cell editing and allow text editing.\n   */\n  function _stopEdit () {\n\n    // Clear previous selection.\n    _removeSelection();\n\n    // Hide table edit popup.\n    editor.popups.hide('table.edit');\n  }\n\n  /*\n   * Mark that mouse is down.\n   */\n  function _mouseDown (e) {\n    var cell = _getCellUnder(e);\n\n    if ($(cell).parents('[contenteditable]:not(.fr-element):not(.fr-img-caption):not(body)').first().attr('contenteditable') == 'false') return true;\n\n    // Stop table editing if user clicks outside the table.\n    if (selectedCells().length > 0 && !cell) {\n      _stopEdit();\n    }\n\n    // Only do mouseDown if the editor is not disabled by user.\n    if (!editor.edit.isDisabled() || editor.popups.isVisible('table.edit')) {\n\n      // On left click.\n      if (e.which == 1 && !(e.which == 1 && editor.helpers.isMac() && e.ctrlKey)) {\n        mouseDownFlag = true;\n\n        // User clicked on a table cell.\n        if (cell) {\n\n          // We always have to clear previous selection except when using shift key to select multiple cells.\n          if (selectedCells().length > 0 && !e.shiftKey) {\n            _stopEdit();\n          }\n\n          e.stopPropagation();\n\n          editor.events.trigger('image.hideResizer');\n          editor.events.trigger('video.hideResizer');\n\n          // Keep record of left mouse click being down\n          mouseDownCellFlag = true;\n\n          var tag_name = cell.tagName.toLowerCase();\n\n          // Select multiple cells using Shift key\n          if (e.shiftKey && editor.$el.find(tag_name + '.fr-selected-cell').length > 0) {\n\n            // Cells must be in the same table.\n            if ($(editor.$el.find(tag_name + '.fr-selected-cell').closest('table')).is($(cell).closest('table'))) {\n\n              // Select cells between.\n              _selectCells(mouseDownCell, cell);\n\n            // Do nothing if cells are not in the same table.\n            }\n            else {\n\n              // Prevent Firefox selection.\n              _clearSelection();\n            }\n          }\n\n          else {\n\n            // Prevent Firefox selection for ctrl / cmd key.\n            // https://github.com/froala/wysiwyg-editor/issues/1323:\n            //  - we have more than one cell selected or\n            //  - selection is starting in another cell than the one we clicked on.\n            if ((editor.keys.ctrlKey(e) || e.shiftKey) && (selectedCells().length > 1 || ($(cell).find(editor.selection.element()).length === 0 && !$(cell).is(editor.selection.element())))) {\n              _clearSelection();\n            }\n\n            // Save cell where mouse has been clicked\n            mouseDownCell = cell;\n\n            // Select cell.\n            _selectCells(mouseDownCell, mouseDownCell);\n          }\n        }\n      }\n\n      // On right click stop table editing.\n      else if ((e.which == 3 || (e.which == 1 && editor.helpers.isMac() && e.ctrlKey)) && cell) {\n        _stopEdit();\n      }\n    }\n  }\n\n  /*\n   * Notify that mouse is no longer pressed.\n   */\n  function _mouseUp (e) {\n    // User clicked somewhere else in the editor (except the toolbar).\n    // We need this because mouse down is not triggered outside the editor.\n    if (!mouseDownCellFlag && !editor.$tb.is(e.target) && !editor.$tb.is($(e.target).closest('.fr-toolbar'))) {\n      if (selectedCells().length > 0) {\n        editor.toolbar.enable();\n      }\n\n      _removeSelection();\n    }\n\n    // On left click.\n    if (e.which == 1 && !(e.which == 1 && editor.helpers.isMac() && e.ctrlKey)) {\n      mouseDownFlag = false;\n\n      // Mouse down was in a table cell.\n      if (mouseDownCellFlag) {\n\n        // Left click is no longer pressed.\n        mouseDownCellFlag = false;\n\n        var cell = _getCellUnder(e);\n\n        // If we have one selected cell and mouse is lifted somewhere else.\n        if (!cell && selectedCells().length == 1) {\n\n          // We have a text selection and not cell selection.\n          _removeSelection();\n        }\n\n        // If there are selected cells then show table edit popup.\n        else if (selectedCells().length > 0) {\n          if (editor.selection.isCollapsed()) {\n            _showEditPopup();\n          }\n\n          // No text selection.\n          else {\n            _removeSelection();\n          }\n        }\n      }\n\n      // Resizing stops.\n      if (resizingFlag) {\n        resizingFlag = false;\n\n        $resizer.removeClass('fr-moving');\n\n        // Allow text selection.\n        editor.$el.removeClass('fr-no-selection');\n        editor.edit.on();\n\n        // Set release Y coordinate.\n        var left = parseFloat($resizer.css('left')) + editor.opts.tableResizerOffset + editor.$wp.offset().left;\n\n        if (editor.opts.iframe) {\n          left -= editor.$iframe.offset().left;\n        }\n        $resizer.data('release-position', left);\n\n        // Clear resizing limits.\n        $resizer.removeData('max-left');\n        $resizer.removeData('max-right');\n\n        // Resize.\n        _resize(e);\n\n        // Hide resizer.\n        _hideResizer();\n      }\n    }\n  }\n\n  /*\n   * User drags mouse over multiple cells to select them.\n   */\n  function _mouseEnter (e) {\n    if (mouseDownCellFlag === true) {\n      var $cell = $(e.currentTarget);\n\n      // Cells should be in the same table.\n      if ($cell.closest('table').is(selectedTable())) {\n\n        // Don't select both ths and tds.\n        if (e.currentTarget.tagName == 'TD' && editor.$el.find('th.fr-selected-cell').length === 0) {\n\n          // Select cells between.\n          _selectCells(mouseDownCell, e.currentTarget);\n\n          return;\n        }\n\n        else if (e.currentTarget.tagName == 'TH' && editor.$el.find('td.fr-selected-cell').length === 0) {\n\n          // Select cells between.\n          _selectCells(mouseDownCell, e.currentTarget);\n\n          return;\n        }\n      }\n\n      // Prevent firefox selection.\n      _clearSelection();\n    }\n  }\n\n  /*\n   * Move cursor in a nested table.\n   */\n  function _moveInNestedTable (cell, direction) {\n    var table = cell;\n\n    // Get parent table (editor might be initialized inside cell).\n    while (table && table.tagName != 'TABLE' && table.parentNode != editor.el) {\n      table = table.parentNode;\n    }\n\n    if (table && table.tagName == 'TABLE') {\n      var new_map = _tableMap($(table));\n\n      // Move up in the parent table.\n      if (direction == 'up') _moveUp(_cellOrigin(cell, new_map), table, new_map);\n      else if (direction == 'down') _moveDown(_cellOrigin(cell, new_map), table, new_map);\n    }\n  }\n\n  /*\n   * Move cursor up or down outside table.\n   */\n  function _moveWithArrows (origin, table, map, direction) {\n    var up = table;\n    var sibling;\n\n    // Look up in DOM for the previous or next element.\n    while (up != editor.el) {\n\n      // Nested table.\n      if (up.tagName == 'TD' || up.tagName == 'TH') {\n        break;\n      }\n\n      // The table has a sibling element.\n      if (direction == 'up') sibling = up.previousElementSibling;\n      else if (direction == 'down') sibling = up.nextElementSibling;\n\n      if (sibling) {\n        break;\n      }\n\n      // Table might be in a block tag.\n      up = up.parentNode;\n    }\n\n    // We have another table (nested).\n    if (up.tagName == 'TD' || up.tagName == 'TH') {\n      _moveInNestedTable(up, direction);\n    }\n\n    // Table has a sibling.\n    else if (sibling) {\n      if (direction == 'up') editor.selection.setAtEnd(sibling);\n\n      if (direction == 'down') editor.selection.setAtStart(sibling);\n    }\n  }\n\n  /*\n   * Move cursor up while in table cell.\n   */\n  function _moveUp (origin, table, map) {\n\n    // Not the first line.\n    if (origin.row > 0) {\n      editor.selection.setAtEnd(map[origin.row - 1][origin.col])\n    }\n\n    // First line.\n    else {\n      _moveWithArrows(origin, table, map, 'up');\n    }\n  }\n\n  /*\n   * Move cursor down while in table cell.\n   */\n  function _moveDown (origin, table, map) {\n\n    // Cell might have rowspan.\n    var row = parseInt(map[origin.row][origin.col].getAttribute('rowspan'), 10) || 1;\n\n    // Not the last line.\n    if (origin.row < map.length - row) {\n      editor.selection.setAtStart(map[origin.row + row][origin.col]);\n    }\n\n    // Last line.\n    else {\n      _moveWithArrows(origin, table, map, 'down');\n    }\n  }\n\n  /*\n   * Using the arrow keys to move the cursor through the table will not select cells.\n   */\n  function _navigateWithArrows (e) {\n    var key_code = e.which;\n\n    // Get current selection.\n    var sel = editor.selection.blocks();\n\n    if (sel.length) {\n      sel = sel[0];\n\n      // Selection should be in a table cell.\n      if (sel.tagName == 'TD' || sel.tagName == 'TH') {\n        var table = sel;\n\n        // Get parent table (editor might be initialized inside cell).\n        while (table && table.tagName != 'TABLE' && table.parentNode != editor.el) {\n          table = table.parentNode;\n        }\n\n        if (table && table.tagName == 'TABLE') {\n          if (FE.KEYCODE.ARROW_LEFT == key_code || FE.KEYCODE.ARROW_UP == key_code || FE.KEYCODE.ARROW_RIGHT == key_code || FE.KEYCODE.ARROW_DOWN == key_code) {\n            if (selectedCells().length > 0) {\n              _stopEdit();\n            }\n\n            // Up and down in Webkit.\n            if (editor.browser.webkit && (FE.KEYCODE.ARROW_UP == key_code || FE.KEYCODE.ARROW_DOWN == key_code)) {\n              var node = editor.selection.ranges(0).startContainer;\n\n              if (node.nodeType == Node.TEXT_NODE && ((FE.KEYCODE.ARROW_UP == key_code && node.previousSibling) || (FE.KEYCODE.ARROW_DOWN == key_code && node.nextSibling))) {\n                return;\n              }\n\n              e.preventDefault();\n              e.stopPropagation();\n\n              // Table map.\n              var map = _tableMap($(table));\n\n              // Current cell map coordinates.\n              var origin = _cellOrigin(sel, map);\n\n              // Arrow up\n              if (FE.KEYCODE.ARROW_UP == key_code) {\n                _moveUp(origin, table, map);\n              }\n\n              // Arrow down\n              else if (FE.KEYCODE.ARROW_DOWN == key_code) {\n                _moveDown(origin, table, map);\n              }\n\n              // Update cursor position.\n              editor.selection.restore();\n\n              return false;\n            }\n          }\n        }\n      }\n    }\n  }\n\n  /*\n   * Initilize table resizer.\n   */\n  function _initResizer () {\n\n    // Append resizer HTML to editor wrapper.\n    if (!editor.shared.$table_resizer) editor.shared.$table_resizer = $('<div class=\"fr-table-resizer\"><div></div></div>');\n    $resizer = editor.shared.$table_resizer;\n\n    // Resize table. Mousedown.\n    editor.events.$on($resizer, 'mousedown', function (e) {\n      if (!editor.core.sameInstance($resizer)) return true;\n\n      // Stop table editing.\n      if (selectedCells().length > 0) {\n        _stopEdit();\n      }\n\n      // Resize table only using left click.\n      if (e.which == 1) {\n\n        // Save selection so that we can put cursor back at the end.\n        editor.selection.save();\n\n        resizingFlag = true;\n\n        $resizer.addClass('fr-moving');\n\n        // Prevent text selection while dragging the table resizer.\n        _clearSelection();\n\n        // Turn editor toolbar off while resizing.\n        editor.edit.off();\n\n        // Show resizer.\n        $resizer.find('div').css('opacity', 1);\n\n        // Prevent selecting text when doing resize.\n        return false;\n      }\n    });\n\n    // Mousemove on table resizer.\n    editor.events.$on($resizer, 'mousemove', function (e) {\n      if (!editor.core.sameInstance($resizer)) return true;\n\n      if (resizingFlag) {\n        if (editor.opts.iframe) {\n          e.pageX -= editor.$iframe.offset().left;\n        }\n\n        _mouseMove(e);\n      }\n    })\n\n    // Editor destroy.\n    editor.events.on('shared.destroy', function () {\n      $resizer.html('').removeData().remove();\n      $resizer = null;\n    }, true);\n\n    editor.events.on('destroy', function () {\n      editor.$el.find('.fr-selected-cell').removeClass('fr-selected-cell');\n      $resizer.hide().appendTo($('body').first());\n    }, true);\n  }\n\n  /*\n   * Also clears top and left values, so it doesn't interfer with the insert helper.\n   */\n  function _hideResizer () {\n    if ($resizer) {\n      $resizer.find('div').css('opacity', 0);\n      $resizer.css('top', 0);\n      $resizer.css('left', 0);\n      $resizer.css('height', 0);\n      $resizer.find('div').css('height', 0);\n      $resizer.hide();\n    }\n  }\n\n  /**\n   * Hide the insert helper.\n   */\n  function _hideInsertHelper () {\n    if ($insert_helper) $insert_helper.removeClass('fr-visible').css('left', '-9999px');\n  }\n\n  /*\n   * Place the table resizer between the columns where the mouse is.\n   */\n  function _placeResizer (e, tag_under) {\n    var $tag_under = $(tag_under);\n    var $table = $tag_under.closest('table');\n    var $table_parent = $table.parent();\n\n    // We might have another tag inside the table cell.\n    if (tag_under && (tag_under.tagName != 'TD' && tag_under.tagName != 'TH')) {\n      if ($tag_under.closest('td').length > 0) {\n        tag_under = $tag_under.closest('td');\n      }\n      else if ($tag_under.closest('th').length > 0) {\n        tag_under = $tag_under.closest('th');\n      }\n    }\n\n    // The tag should be a table cell (TD or TH).\n    if (tag_under && (tag_under.tagName == 'TD' || tag_under.tagName == 'TH')) {\n      $tag_under = $(tag_under);\n\n      // https://github.com/froala/wysiwyg-editor/issues/786.\n      if (!editor.$el.contains(tag_under)) return false;\n\n      // Tag's left and right coordinate.\n      var tag_left = $tag_under.offset().left - 1;\n      var tag_right = tag_left + $tag_under.outerWidth();\n\n      // Only if the mouse is close enough to the left or right edges.\n      if (Math.abs(e.pageX - tag_left) <= editor.opts.tableResizerOffset ||\n          Math.abs(tag_right - e.pageX) <= editor.opts.tableResizerOffset) {\n\n        // Create a table map.\n        var map = _tableMap($table);\n        var tag_origin = _cellOrigin(tag_under, map);\n\n        var tag_end = _cellEnds(tag_origin.row, tag_origin.col, map);\n\n        // The column numbers from the map that have to be resized.\n        var first;\n        var second;\n\n        // Table resizer position and height.\n        var resizer_top = $table.offset().top;\n        var resizer_height = $table.outerHeight() - 1;\n        var resizer_left;\n\n        // The left and right limits between which the resizer can be moved.\n        var max_left;\n        var max_right;\n\n        if (editor.opts.direction != 'rtl') {\n\n          // Mouse is near the cells's left margin.\n          if (e.pageX - tag_left <= editor.opts.tableResizerOffset) {\n\n            // Table resizer's left position.\n            resizer_left = tag_left;\n\n            // Resize cells.\n            if (tag_origin.col > 0) {\n\n              // Left limit.\n              max_left = tag_left - _columnWidth(tag_origin.col - 1, map) + editor.opts.tableResizingLimit;\n\n              // Right limit.\n              max_right = tag_left + _columnWidth(tag_origin.col, map) - editor.opts.tableResizingLimit;\n\n              // Columns to resize.\n              first = tag_origin.col - 1;\n              second = tag_origin.col;\n            }\n\n            // Resize table.\n            else {\n\n              // Columns to resize.\n              first = null;\n              second = 0;\n\n              // Resizer limits.\n              max_left = $table.offset().left - 1 - parseInt($table.css('margin-left'), 10);\n              max_right = $table.offset().left - 1 + $table.width() - map[0].length * editor.opts.tableResizingLimit;\n            }\n          }\n\n          // Mouse is near the cell's right margin.\n          else if (tag_right - e.pageX <= editor.opts.tableResizerOffset) {\n\n            // Table resizer's left possition.\n            resizer_left = tag_right;\n\n            // Check for next td.\n            if (tag_end.col < map[tag_end.row].length && map[tag_end.row][tag_end.col + 1]) {\n\n              // Left limit.\n              max_left = tag_right - _columnWidth(tag_end.col, map) + editor.opts.tableResizingLimit;\n\n              // Right limit.\n              max_right = tag_right + _columnWidth(tag_end.col + 1, map) - editor.opts.tableResizingLimit;\n\n              // Columns to resize.\n              first = tag_end.col;\n              second = tag_end.col + 1;\n            }\n\n            // Resize table.\n            else {\n\n              // Columns to resize.\n              first = tag_end.col;\n              second = null;\n\n              // Resizer limits.\n              max_left = $table.offset().left - 1 + map[0].length * editor.opts.tableResizingLimit;\n              max_right = $table_parent.offset().left - 1 + $table_parent.width() + parseFloat($table_parent.css('padding-left'));\n            }\n          }\n        }\n\n        // RTL\n        else {\n\n          // Mouse is near the cell's right margin.\n          if (tag_right - e.pageX <= editor.opts.tableResizerOffset) {\n\n            // Table resizer's left position.\n            resizer_left = tag_right;\n\n            // Resize cells.\n            if (tag_origin.col > 0) {\n\n              // Left limit.\n              max_left = tag_right - _columnWidth(tag_origin.col, map) + editor.opts.tableResizingLimit;\n\n              // Right limit.\n              max_right = tag_right + _columnWidth(tag_origin.col - 1, map) - editor.opts.tableResizingLimit;\n\n              // Columns to resize.\n              first = tag_origin.col;\n              second = tag_origin.col - 1;\n            }\n\n            // Resize table.\n            else {\n              first = null;\n              second = 0;\n\n              // Resizer limits.\n              max_left = $table.offset().left + map[0].length * editor.opts.tableResizingLimit;\n              max_right = $table_parent.offset().left - 1 + $table_parent.width() + parseFloat($table_parent.css('padding-left'));\n            }\n          }\n\n          // Mouse is near the cell's left margin.\n          else if (e.pageX - tag_left <= editor.opts.tableResizerOffset) {\n\n            // Table resizer's left position.\n            resizer_left = tag_left;\n\n            // Check for next td.\n            if (tag_end.col < map[tag_end.row].length && map[tag_end.row][tag_end.col + 1]) {\n\n              // Left limit.\n              max_left = tag_left - _columnWidth(tag_end.col + 1, map) + editor.opts.tableResizingLimit;\n\n              // Right limit.\n              max_right = tag_left + _columnWidth(tag_end.col, map) - editor.opts.tableResizingLimit;\n\n              // Columns to resize.\n              first = tag_end.col + 1;\n              second = tag_end.col;\n            }\n\n            // Resize table.\n            else {\n\n              // Columns to resize.\n              first = tag_end.col;\n              second = null;\n\n              // Resizer limits.\n              max_left = $table_parent.offset().left + parseFloat($table_parent.css('padding-left'));\n              max_right = $table.offset().left - 1 + $table.width() - map[0].length * editor.opts.tableResizingLimit;\n            }\n          }\n        }\n\n        if (!$resizer) _initResizer();\n\n        // Save table.\n        $resizer.data('table', $table);\n\n        // Save columns to resize.\n        $resizer.data('first', first);\n        $resizer.data('second', second);\n\n        $resizer.data('instance', editor);\n        editor.$wp.append($resizer);\n\n        var left = resizer_left - editor.win.pageXOffset - editor.opts.tableResizerOffset - editor.$wp.offset().left;\n        var top = resizer_top - editor.$wp.offset().top + editor.$wp.scrollTop();\n\n        if (editor.opts.iframe) {\n          left += editor.$iframe.offset().left;\n          top += editor.$iframe.offset().top;\n\n          max_left += editor.$iframe.offset().left;\n          max_right += editor.$iframe.offset().left;\n        }\n\n        // Set resizing limits.\n        $resizer.data('max-left', max_left);\n        $resizer.data('max-right', max_right);\n\n        // Initial position of the resizer\n        $resizer.data('origin', resizer_left - editor.win.pageXOffset);\n\n        // Set table resizer's top, left and height.\n        $resizer.css('top', top);\n        $resizer.css('left', left);\n        $resizer.css('height', resizer_height);\n        $resizer.find('div').css('height', resizer_height);\n\n        // Set padding according to tableResizerOffset.\n        $resizer.css('padding-left', editor.opts.tableResizerOffset);\n        $resizer.css('padding-right', editor.opts.tableResizerOffset);\n\n        // Show table resizer.\n        $resizer.show();\n      }\n\n      // Hide resizer when the mouse moves away from the cell's border.\n      else {\n        if (editor.core.sameInstance($resizer)) _hideResizer();\n      }\n    }\n\n    // Hide resizer if mouse is no longer over it.\n    else if ($resizer && $tag_under.get(0) != $resizer.get(0) && $tag_under.parent().get(0) != $resizer.get(0)) {\n      if (editor.core.sameInstance($resizer))  _hideResizer();\n    }\n  }\n\n  /*\n   * Show the insert column helper button.\n   */\n  function _showInsertColHelper (e, table) {\n    if (editor.$box.find('.fr-line-breaker').isVisible()) return false;\n\n    // Insert Helper.\n    if (!$insert_helper) _initInsertHelper();\n\n    editor.$box.append($insert_helper);\n    $insert_helper.data('instance', editor);\n    var $table = $(table);\n    var $row = $table.find('tr').first();\n    var mouseX = e.pageX;\n    var left = 0;\n    var top = 0;\n\n    if (editor.opts.iframe) {\n      left += editor.$iframe.offset().left - editor.helpers.scrollLeft();\n      top += editor.$iframe.offset().top - editor.helpers.scrollTop();\n    }\n\n    // Check where the column should be inserted.\n    var btn_width;\n\n    $row.find('th, td').each (function () {\n      var $td = $(this);\n\n      // Insert before this td.\n      if ($td.offset().left <= mouseX && mouseX < $td.offset().left + $td.outerWidth() / 2) {\n        btn_width = parseInt($insert_helper.find('a').css('width'), 10);\n        $insert_helper.css('top', top + $td.offset().top - editor.$box.offset().top - editor.win.pageYOffset - btn_width - 5);\n        $insert_helper.css('left', left + $td.offset().left - editor.$box.offset().left - editor.win.pageXOffset - btn_width / 2);\n        $insert_helper.data('selected-cell', $td);\n        $insert_helper.data('position', 'before');\n        $insert_helper.addClass('fr-visible');\n\n        return false;\n\n      // Insert after this td.\n      }\n      else if ($td.offset().left + $td.outerWidth() / 2 <= mouseX && mouseX < $td.offset().left + $td.outerWidth()) {\n        btn_width = parseInt($insert_helper.find('a').css('width'), 10);\n\n        $insert_helper.css('top', top + $td.offset().top - editor.$box.offset().top - editor.win.pageYOffset - btn_width - 5);\n        $insert_helper.css('left', left + $td.offset().left - editor.$box.offset().left + $td.outerWidth() - editor.win.pageXOffset - btn_width / 2);\n        $insert_helper.data('selected-cell', $td);\n        $insert_helper.data('position', 'after');\n        $insert_helper.addClass('fr-visible');\n\n        return false;\n      }\n    });\n  }\n\n  /*\n   * Show the insert row helper button.\n   */\n  function _showInsertRowHelper (e, table) {\n    if (editor.$box.find('.fr-line-breaker').isVisible()) return false;\n\n    if (!$insert_helper) _initInsertHelper();\n\n    editor.$box.append($insert_helper);\n    $insert_helper.data('instance', editor);\n    var $table = $(table);\n    var mouseY = e.pageY;\n    var left = 0;\n    var top = 0;\n\n    if (editor.opts.iframe) {\n      left += editor.$iframe.offset().left - editor.helpers.scrollLeft();\n      top += editor.$iframe.offset().top - editor.helpers.scrollTop();\n    }\n\n    // Check where the row should be inserted.\n    var btn_width;\n\n    $table.find('tr').each (function () {\n      var $tr = $(this);\n\n      // Insert above this tr.\n      if ($tr.offset().top <= mouseY && mouseY < $tr.offset().top + $tr.outerHeight() / 2) {\n        btn_width = parseInt($insert_helper.find('a').css('width'), 10);\n\n        $insert_helper.css('top', top + $tr.offset().top - editor.$box.offset().top - editor.win.pageYOffset - btn_width / 2);\n        $insert_helper.css('left', left + $tr.offset().left - editor.$box.offset().left - editor.win.pageXOffset - btn_width - 5);\n        $insert_helper.data('selected-cell', $tr.find('td').first());\n        $insert_helper.data('position', 'above');\n        $insert_helper.addClass('fr-visible');\n\n        return false;\n\n      // Insert below this tr.\n      }\n      else if ($tr.offset().top + $tr.outerHeight() / 2 <= mouseY && mouseY < $tr.offset().top + $tr.outerHeight()) {\n        btn_width = parseInt($insert_helper.find('a').css('width'), 10);\n\n        $insert_helper.css('top', top + $tr.offset().top - editor.$box.offset().top + $tr.outerHeight() - editor.win.pageYOffset - btn_width / 2);\n        $insert_helper.css('left', left + $tr.offset().left - editor.$box.offset().left - editor.win.pageXOffset - btn_width - 5);\n        $insert_helper.data('selected-cell', $tr.find('td').first());\n        $insert_helper.data('position', 'below');\n        $insert_helper.addClass('fr-visible');\n\n        return false;\n      }\n    });\n  }\n\n  /*\n   * Check if should show the insert column / row helper button.\n   */\n  function _insertHelper (e, tag_under) {\n\n    // Don't show the insert helper if there are table cells selected.\n    if (selectedCells().length === 0) {\n      var i;\n      var tag_below;\n      var tag_right;\n\n      // Tag is the editor element or body (inline toolbar). Look for closest tag bellow and at the right.\n      if (tag_under && (tag_under.tagName == 'HTML' || tag_under.tagName == 'BODY' || editor.node.isElement(tag_under))) {\n\n        // Look 1px down until a table tag is found or the insert helper offset is reached.\n        for (i = 1; i <= editor.opts.tableInsertHelperOffset; i++) {\n\n          // Look for tag below.\n          tag_below = editor.doc.elementFromPoint(e.pageX - editor.win.pageXOffset, e.pageY - editor.win.pageYOffset + i);\n\n          // We're on tooltip.\n          if ($(tag_below).hasClass('fr-tooltip')) return true;\n\n          // We found a tag bellow.\n          if (tag_below && ((tag_below.tagName == 'TH' || tag_below.tagName == 'TD' || tag_below.tagName == 'TABLE') && ($(tag_below).parents('.fr-wrapper').length || editor.opts.iframe))) {\n\n            // Show the insert column helper button.\n            _showInsertColHelper (e, $(tag_below).closest('table'));\n\n            return true;\n          }\n\n          // Look for tag at the right.\n          tag_right = editor.doc.elementFromPoint(e.pageX - editor.win.pageXOffset + i, e.pageY - editor.win.pageYOffset);\n\n          // We're on tooltip.\n          if ($(tag_right).hasClass('fr-tooltip')) return true;\n\n          // We found a tag at the right.\n          if (tag_right && ((tag_right.tagName == 'TH' || tag_right.tagName == 'TD' || tag_right.tagName == 'TABLE') && ($(tag_right).parents('.fr-wrapper').length || editor.opts.iframe))) {\n\n            // Show the insert row helper button.\n            _showInsertRowHelper (e, $(tag_right).closest('table'));\n\n            return true;\n          }\n        }\n      }\n\n      // Hide insert helper.\n      if (editor.core.sameInstance($insert_helper)) {\n        _hideInsertHelper();\n      }\n    }\n  }\n\n  /*\n   * Check tag under the mouse on mouse move.\n   */\n  function _tagUnder (e) {\n    mouseMoveTimer = null;\n\n    // The tag under the mouse cursor.\n    var tag_under = editor.doc.elementFromPoint(e.pageX - editor.win.pageXOffset, e.pageY - editor.win.pageYOffset);\n\n    // Place table resizer if necessary.\n    if (editor.opts.tableResizer && (!editor.popups.areVisible() || (editor.popups.areVisible() && editor.popups.isVisible('table.edit')))) {\n      _placeResizer(e, tag_under);\n    }\n\n    // Show the insert column / row helper button.\n    if (editor.opts.tableInsertHelper && !editor.popups.areVisible() && !(editor.$tb.hasClass('fr-inline') && editor.$tb.isVisible())) {\n      _insertHelper(e, tag_under);\n    }\n  }\n\n  /*\n   * Repositon the resizer if the user scrolls while resizing.\n   */\n  function _repositionResizer () {\n    if (resizingFlag) {\n      var $table = $resizer.data('table');\n      var top = $table.offset().top - editor.win.pageYOffset;\n\n      if (editor.opts.iframe) {\n        top += editor.$iframe.offset().top - editor.helpers.scrollTop();\n      }\n\n      $resizer.css('top', top);\n    }\n  }\n\n  /*\n   * Resize table method.\n   */\n  function _resize () {\n\n    // Resizer initial position.\n    var initial_positon = $resizer.data('origin');\n\n    // Resizer release position.\n    var release_position = $resizer.data('release-position');\n\n    // Do resize only if the resizer's position has changed.\n    if (initial_positon !== release_position) {\n\n      // Columns that have to be resized.\n      var first = $resizer.data('first');\n      var second = $resizer.data('second');\n\n      var $table = $resizer.data('table');\n      var table_width = $table.outerWidth();\n\n      if (!editor.undo.canDo()) editor.undo.saveStep();\n\n      // Resize columns and not the table.\n      if (first !== null && second !== null) {\n\n        // Create a table map.\n        var map = _tableMap($table);\n\n        // Got through all cells on these columns and get their initial width.\n        var first_widths = [];\n        var first_percentages = [];\n        var second_widths = [];\n        var second_percentages = [];\n        var i;\n        var $first_cell;\n        var $second_cell;\n\n        // We must do this before updating widths.\n        for (i = 0; i < map.length; i++) {\n          $first_cell = $(map[i][first]);\n          $second_cell = $(map[i][second]);\n\n          // Widths in px.\n          first_widths[i] = $first_cell.outerWidth();\n          second_widths[i] = $second_cell.outerWidth();\n\n          // Widths in percentages.\n          first_percentages[i] = first_widths[i] / table_width * 100;\n          second_percentages[i] = second_widths[i] / table_width * 100;\n        }\n\n        // Got through all cells on these columns and update their widths.\n        for (i = 0; i < map.length; i++) {\n          $first_cell = $(map[i][first]);\n          $second_cell = $(map[i][second]);\n\n          // New percentage for the first cell.\n          var first_cell_percentage = (first_percentages[i] * (first_widths[i] + release_position - initial_positon) / first_widths[i]).toFixed(4);\n\n          $first_cell.css('width', first_cell_percentage + '%');\n          $second_cell.css('width', (first_percentages[i] + second_percentages[i] - first_cell_percentage).toFixed(4) + '%');\n        }\n      }\n\n      // Resize the table.\n      else {\n        var $table_parent = $table.parent();\n        var table_percentage = table_width / $table_parent.width() * 100;\n        var left_margin = (parseInt($table.css('margin-left'), 10) || 0) / $table_parent.width() * 100;\n        var right_margin = (parseInt($table.css('margin-right'), 10) || 0) / $table_parent.width() * 100;\n        var width;\n\n        // Right border RTL or LTR.\n        if ((editor.opts.direction == 'rtl' && second === 0) || (editor.opts.direction != 'rtl' && second !== 0)) {\n          width = (table_width + release_position - initial_positon) / table_width * table_percentage;\n          $table.css('margin-right', 'calc(100% - ' + Math.round(width).toFixed(4) + '% - ' + Math.round(left_margin).toFixed(4) + '%)');\n        }\n\n        // Left border RTL or LTR.\n        else if ((editor.opts.direction == 'rtl' && second !== 0) || (editor.opts.direction != 'rtl' && second === 0)) {\n          width = (table_width - release_position + initial_positon) / table_width * table_percentage;\n          $table.css('margin-left', 'calc(100% - ' + Math.round(width).toFixed(4) + '% - ' + Math.round(right_margin).toFixed(4) + '%)');\n        }\n\n        // Update table width.\n        $table.css('width', Math.round(width).toFixed(4) + '%');\n      }\n\n      editor.selection.restore();\n      editor.undo.saveStep();\n    }\n\n    // Clear resizer data.\n    $resizer.removeData('origin');\n    $resizer.removeData('release-position');\n    $resizer.removeData('first');\n    $resizer.removeData('second');\n    $resizer.removeData('table');\n  }\n\n  /*\n   * Get the width of the column. (columns may have colspan)\n   */\n  function _columnWidth (col, map) {\n    var i;\n    var width = $(map[0][col]).outerWidth();\n\n    for (i = 1; i < map.length; i++) {\n      width = Math.min(width, $(map[i][col]).outerWidth());\n    }\n\n    return width;\n  }\n\n  /*\n   * Get the width of the columns between specified indexes.\n   */\n  function _columnsWidth(col1, col2, map) {\n    var i;\n    var width = 0;\n\n    // Sum all columns widths.\n    for (i = col1; i <= col2; i++) {\n      width += _columnWidth(i, map);\n    }\n\n    return width;\n  }\n\n  /*\n   * Set mouse timer to improve performance.\n   */\n  function _mouseMove (e) {\n\n    // Prevent selecting text when we have cells selected.\n    if (selectedCells().length > 1 && mouseDownFlag) {\n      _clearSelection();\n    }\n\n    // Reset or set timer.\n    if (mouseDownFlag === false && mouseDownCellFlag === false && resizingFlag === false) {\n      if (mouseMoveTimer) {\n        clearTimeout(mouseMoveTimer);\n      }\n\n      // Only resize table if the editor is not disabled by user.\n      if (!editor.edit.isDisabled() || editor.popups.isVisible('table.edit')) {\n\n        // Check tag under in order to place the table resizer or insert helper button.\n        mouseMoveTimer = setTimeout(_tagUnder, 30, e);\n      }\n\n    // Move table resizer.\n    }\n    else if (resizingFlag) {\n\n      // Cursor position.\n      var pos = e.pageX - editor.win.pageXOffset;\n\n      if (editor.opts.iframe) {\n        pos += editor.$iframe.offset().left;\n      }\n\n      // Left and right limits.\n      var left_limit = $resizer.data('max-left');\n      var right_limit = $resizer.data('max-right');\n\n      // Cursor is between the left and right limits.\n      if (pos >= left_limit && pos <= right_limit) {\n        $resizer.css('left', pos - editor.opts.tableResizerOffset - editor.$wp.offset().left);\n\n      // Cursor has exceeded the left limit. Don't update if it already has the correct value.\n      }\n      else if (pos < left_limit && parseFloat($resizer.css('left'), 10) > left_limit - editor.opts.tableResizerOffset) {\n        $resizer.css('left', left_limit - editor.opts.tableResizerOffset - editor.$wp.offset().left);\n\n      // Cursor has exceeded the right limit. Don't update if it already has the correct value.\n      }\n      else if (pos > right_limit && parseFloat($resizer.css('left'), 10) < right_limit - editor.opts.tableResizerOffset) {\n        $resizer.css('left', right_limit - editor.opts.tableResizerOffset - editor.$wp.offset().left);\n      }\n    }\n    else if (mouseDownFlag) {\n      _hideInsertHelper();\n    }\n  }\n\n  /*\n   * Place selection markers in a table cell.\n   */\n  function _addMarkersInCell ($cell) {\n    if (editor.node.isEmpty($cell.get(0))) {\n      $cell.prepend(FE.MARKERS);\n    }\n    else {\n      $cell.prepend(FE.START_MARKER).append(FE.END_MARKER);\n    }\n  }\n\n  /*\n   * Use TAB key to navigate through cells.\n   */\n  function _useTab (e) {\n    var key_code = e.which;\n\n    if (key_code == FE.KEYCODE.TAB) {\n\n      // Get starting cell.\n      var $cell;\n\n      if (selectedCells().length > 0) {\n        $cell = editor.$el.find('.fr-selected-cell').last()\n      }\n      else {\n        var cell = editor.selection.element();\n\n        if (cell.tagName == 'TD' || cell.tagName == 'TH') {\n          $cell = $(cell);\n        }\n        else if (cell != editor.el) {\n          if ($(cell).parentsUntil(editor.$el, 'td').length > 0) {\n            $cell = $(cell).parents('td').first();\n          }\n          else if ($(cell).parentsUntil(editor.$el, 'th').length > 0) {\n            $cell = $(cell).parents('th').first();\n          }\n        }\n      }\n\n      if ($cell) {\n        e.preventDefault();\n\n        if ($(editor.selection.element()).parentsUntil(editor.$el, 'ol, ul').length > 0 && ($(editor.selection.element()).parents('li').prev().length > 0 || ($(editor.selection.element()).is('li') && $(editor.selection.element()).prev().length > 0))) {\n\n          return true;\n        }\n\n        _stopEdit();\n\n        // Go backwards.\n        if (e.shiftKey) {\n\n          // Go to previous cell.\n          if ($cell.prev().length > 0) {\n            _addMarkersInCell($cell.prev());\n          }\n\n          // Go to prev row, last cell.\n          else if ($cell.closest('tr').length > 0 && $cell.closest('tr').prev().length > 0) {\n            _addMarkersInCell($cell.closest('tr').prev().find('td').last());\n          }\n\n          // Go in THEAD, last cell.\n          else if ($cell.closest('tbody').length > 0 && $cell.closest('table').find('thead tr').length > 0) {\n            _addMarkersInCell($cell.closest('table').find('thead tr th').last());\n          }\n        }\n\n        // Go forward.\n        else {\n\n          // Go to next cell.\n          if ($cell.next().length > 0) {\n            _addMarkersInCell($cell.next());\n          }\n\n          // Go to next row, first cell.\n          else if ($cell.closest('tr').length > 0 && $cell.closest('tr').next().length > 0) {\n            _addMarkersInCell($cell.closest('tr').next().find('td').first());\n          }\n\n          // Cursor is in THEAD. Go to next row in TBODY\n          else if ($cell.closest('thead').length > 0 && $cell.closest('table').find('tbody tr').length > 0) {\n            _addMarkersInCell($cell.closest('table').find('tbody tr td').first());\n          }\n\n          // Add new row.\n          else {\n            $cell.addClass('fr-selected-cell');\n            insertRow('below');\n            _removeSelection();\n            _addMarkersInCell($cell.closest('tr').next().find('td').first());\n          }\n        }\n\n        // Update cursor position.\n        editor.selection.restore();\n\n        // Prevent event propagation.\n        return false;\n      }\n    }\n  }\n\n  /*\n   * Initilize insert helper.\n   */\n  function _initInsertHelper () {\n\n    // Append insert helper HTML to editor wrapper.\n    if (!editor.shared.$ti_helper) {\n      editor.shared.$ti_helper = $('<div class=\"fr-insert-helper\"><a class=\"fr-floating-btn\" role=\"button\" tabIndex=\"-1\" title=\"' + editor.language.translate('Insert') + '\"><svg viewBox=\"0 0 32 32\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M22,16.75 L16.75,16.75 L16.75,22 L15.25,22.000 L15.25,16.75 L10,16.75 L10,15.25 L15.25,15.25 L15.25,10 L16.75,10 L16.75,15.25 L22,15.25 L22,16.75 Z\"/></svg></a></div>');\n\n      // Click on insert helper.\n      editor.events.bindClick(editor.shared.$ti_helper, 'a', function () {\n        var $td = $insert_helper.data('selected-cell');\n        var position = $insert_helper.data('position');\n        var inst = $insert_helper.data('instance') || editor;\n\n        if (position == 'before') {\n          editor.undo.saveStep();\n\n          $td.addClass('fr-selected-cell');\n          inst.table.insertColumn(position);\n          $td.removeClass('fr-selected-cell');\n\n          editor.undo.saveStep();\n        }\n        else if (position == 'after') {\n          editor.undo.saveStep();\n\n          $td.addClass('fr-selected-cell');\n          inst.table.insertColumn(position);\n          $td.removeClass('fr-selected-cell');\n\n          editor.undo.saveStep();\n        }\n        else if (position == 'above') {\n          editor.undo.saveStep();\n\n          $td.addClass('fr-selected-cell');\n          inst.table.insertRow(position);\n          $td.removeClass('fr-selected-cell');\n\n          editor.undo.saveStep();\n        }\n        else if (position == 'below') {\n          editor.undo.saveStep();\n\n          $td.addClass('fr-selected-cell');\n          inst.table.insertRow(position);\n          $td.removeClass('fr-selected-cell');\n\n          editor.undo.saveStep();\n        }\n\n        // Hide the insert helper so it will reposition.\n        _hideInsertHelper();\n      });\n\n      // Editor destroy.\n      editor.events.on('shared.destroy', function () {\n        editor.shared.$ti_helper.html('').removeData().remove();\n        editor.shared.$ti_helper = null;\n      }, true);\n\n      // Prevent the insert helper hide when mouse is over it.\n      editor.events.$on(editor.shared.$ti_helper, 'mousemove', function (e) {\n        e.stopPropagation();\n      }, true);\n\n      // Hide the insert helper if the page is scrolled.\n      editor.events.$on($(editor.o_win), 'scroll', function () {\n        _hideInsertHelper();\n      }, true);\n\n      editor.events.$on(editor.$wp, 'scroll', function () {\n        _hideInsertHelper();\n      }, true);\n    }\n\n    $insert_helper = editor.shared.$ti_helper;\n\n    editor.events.on('destroy', function () {\n      $insert_helper = null;\n    });\n\n    // Table insert helper tooltip.\n    editor.tooltip.bind(editor.$box, '.fr-insert-helper > a.fr-floating-btn');\n  }\n\n  /**\n   * Destroy\n   */\n  function _destroy () {\n    mouseDownCell = null;\n    clearTimeout(mouseMoveTimer);\n  }\n\n  /*\n   * Go back to the table edit popup.\n   */\n  function back () {\n    if (selectedCells().length > 0) {\n      _showEditPopup();\n    }\n    else {\n      editor.popups.hide('table.insert');\n      editor.toolbar.showInline();\n    }\n  }\n\n  /**\n   * Return selected cells.\n   */\n  function selectedCells () {\n    return editor.el.querySelectorAll('.fr-selected-cell');\n  }\n\n  /**\n   * Return selected table.\n   */\n  function selectedTable () {\n    var cells = selectedCells();\n\n    if (cells.length) {\n      var cell = cells[0];\n\n      while (cell && cell.tagName != 'TABLE' && cell.parentNode != editor.el) {\n        cell = cell.parentNode;\n      }\n\n      if (cell && cell.tagName == 'TABLE') return $(cell);\n\n      return $([]);\n    }\n\n    return $([]);\n  }\n\n  /**\n   * Select table cell with alt + space.\n   */\n  function _selectCellWithKeyboard (e) {\n\n    // Alt+space was hit. Try to select cell.\n    if (e.altKey && e.which == FE.KEYCODE.SPACE) {\n      var cell;\n      var el = editor.selection.element();\n\n      // Get cell where cursor is.\n      if (el.tagName == 'TD' || el.tagName == 'TH') {\n        cell = el;\n      }\n      else if ($(el).closest('td').length > 0) {\n        cell = $(el).closest('td').get(0);\n      }\n      else if ($(el).closest('th').length > 0) {\n        cell = $(el).closest('th').get(0);\n      }\n\n      // Select this cell.\n      if (cell) {\n        e.preventDefault();\n        _selectCells(cell, cell);\n        _showEditPopup();\n\n        return false;\n      }\n    }\n  }\n\n  /**\n   * Select table cells using arrows.\n   */\n  function _selectCellsWithKeyboard (e) {\n    var selection = selectedCells();\n\n    // There are some selected cells.\n    if (selection.length > 0) {\n      var map = _tableMap();\n      var key_code = e.which;\n      var fixedCell;\n      var handlerCell;\n\n      // Only one cell is selected.\n      if (selection.length == 1) {\n        fixedCell = selection[0];\n        handlerCell = fixedCell;\n      }\n\n      else {\n        fixedCell = editor.el.querySelector('.fr-cell-fixed');\n        handlerCell = editor.el.querySelector('.fr-cell-handler');\n      }\n\n      var handlerOrigin = _cellOrigin(handlerCell, map);\n\n      // Select column at the right.\n      if (FE.KEYCODE.ARROW_RIGHT == key_code) {\n        if (handlerOrigin.col < map[0].length - 1) {\n          _selectCells(fixedCell, map[handlerOrigin.row][handlerOrigin.col + 1]);\n\n          return false;\n        }\n      }\n\n      // Select row below.\n      else if (FE.KEYCODE.ARROW_DOWN == key_code) {\n        if (handlerOrigin.row < map.length - 1) {\n          _selectCells(fixedCell, map[handlerOrigin.row + 1][handlerOrigin.col]);\n\n          return false;\n        }\n      }\n\n      // Select column at the left.\n      else if (FE.KEYCODE.ARROW_LEFT == key_code) {\n        if (handlerOrigin.col > 0) {\n          _selectCells(fixedCell, map[handlerOrigin.row][handlerOrigin.col - 1]);\n\n          return false;\n        }\n      }\n\n      // Select row above.\n      else if (FE.KEYCODE.ARROW_UP == key_code) {\n        if (handlerOrigin.row > 0) {\n          _selectCells(fixedCell, map[handlerOrigin.row - 1][handlerOrigin.col]);\n\n          return false;\n        }\n      }\n    }\n  }\n\n  /*\n   * Init table.\n   */\n  function _init () {\n    if (!editor.$wp) return false;\n\n    // Do cell selection only on desktops (no touch devices)\n    if (!editor.helpers.isMobile()) {\n\n      // Remember if mouse is clicked.\n      mouseDownFlag = false;\n      mouseDownCellFlag = false;\n      resizingFlag = false;\n\n      // Mouse is down in a table cell.\n      editor.events.$on(editor.$el, 'mousedown', _mouseDown);\n\n      // Deselect table cells when user clicks on an image.\n      editor.popups.onShow('image.edit', function () {\n        _removeSelection();\n        mouseDownFlag = false;\n        mouseDownCellFlag = false;\n      });\n\n      // Deselect table cells when user clicks on a link.\n      editor.popups.onShow('link.edit', function () {\n        _removeSelection();\n        mouseDownFlag = false;\n        mouseDownCellFlag = false;\n      });\n\n      // Deselect table cells when a command is run.\n      editor.events.on('commands.mousedown', function ($btn) {\n        if ($btn.parents('.fr-toolbar').length > 0) {\n          _removeSelection();\n        }\n      });\n\n      // Mouse enter's a table cell.\n      editor.events.$on(editor.$el, 'mouseover', 'th, td', _mouseEnter);\n\n      // Mouse is no longer pressed.\n      editor.events.$on(editor.$win, 'mouseup', _mouseUp);\n\n      // Iframe mouseup.\n      if (editor.opts.iframe) {\n        editor.events.$on($(editor.o_win), 'mouseup', _mouseUp);\n      }\n\n      // Check tags under the mouse to see if the resizer needs to be shown.\n      editor.events.$on(editor.$win, 'mousemove', _mouseMove);\n\n      // Update resizer's position on scroll.\n      editor.events.$on($(editor.o_win), 'scroll', _repositionResizer);\n\n      // Reposition table edit popup when table cell content changes.\n      editor.events.on('contentChanged', function () {\n        if (selectedCells().length > 0) {\n          _showEditPopup();\n\n          // Make sure we reposition on image load.\n          editor.$el.find('img').on('load.selected-cells', function () {\n            $(this).off('load.selected-cells');\n\n            if (selectedCells().length > 0) {\n              _showEditPopup();\n            }\n          });\n        }\n      });\n\n      // Reposition table edit popup on window resize.\n      editor.events.$on($(editor.o_win), 'resize', function () {\n        _removeSelection();\n      });\n\n      editor.events.on('toolbar.esc', function () {\n        if (selectedCells().length > 0) {\n          editor.events.disableBlur();\n          editor.events.focus();\n\n          return false;\n        }\n      }, true);\n\n      // Allow keyboard while selecting table cells.\n      // https://github.com/froala/wysiwyg-editor/issues/2256\n      editor.events.$on($(editor.o_win), 'keydown', function () {\n        if (mouseDownFlag && mouseDownCellFlag) {\n          mouseDownFlag = false;\n          mouseDownCellFlag = false;\n\n          // Allow text selection.\n          editor.$el.removeClass('fr-no-selection');\n          editor.edit.on();\n\n          editor.selection.setAtEnd(editor.$el.find('.fr-selected-cell').last().get(0));\n          editor.selection.restore();\n\n          // Remove selected cells.\n          _removeSelection();\n        }\n      });\n\n      // Selecting cells with keyboard or moving cursor with arrow keys.\n      editor.events.$on(editor.$el, 'keydown', function (e) {\n        if (e.shiftKey) {\n          if (_selectCellsWithKeyboard(e) === false) {\n\n            // Timeout needed due to clearSelection timeout.\n            setTimeout(function () {\n              _showEditPopup();\n            }, 0);\n          }\n        }\n        else {\n          _navigateWithArrows(e);\n        }\n      });\n\n      // Prevent backspace from doing browser back.\n      editor.events.on('keydown', function (e) {\n\n        // Tab in cell.\n        if (_useTab(e) === false) return false;\n\n        var selected_cells = selectedCells();\n\n        if (selected_cells.length > 0) {\n\n          // CMD + A clear table cell selection and allow propagation.\n          if (selected_cells.length > 0 && editor.keys.ctrlKey(e) && e.which == FE.KEYCODE.A) {\n            _removeSelection();\n\n            if (editor.popups.isVisible('table.edit')) {\n              editor.popups.hide('table.edit');\n            }\n            selected_cells = [];\n\n            return true;\n          }\n\n          // ESC clear table cell selection.\n          if (e.which == FE.KEYCODE.ESC) {\n            if (editor.popups.isVisible('table.edit')) {\n              _removeSelection();\n              editor.popups.hide('table.edit');\n              e.preventDefault();\n              e.stopPropagation();\n              e.stopImmediatePropagation();\n              selected_cells = [];\n\n              return false;\n            }\n          }\n\n          // Backspace clears selected cells content.\n          if (selected_cells.length > 1 && (e.which == FE.KEYCODE.BACKSPACE || e.which == FE.KEYCODE.DELETE)) {\n            editor.undo.saveStep();\n\n            for (var i = 0; i < selected_cells.length; i++) {\n              $(selected_cells[i]).html('<br>');\n\n              if (i == selected_cells.length - 1) {\n                $(selected_cells[i]).prepend(FE.MARKERS);\n              }\n            }\n\n            editor.selection.restore();\n            editor.undo.saveStep();\n            selected_cells = [];\n\n            return false;\n          }\n\n          // Prevent typing if cells are selected. (Allow browser refresh using keyboard)\n          if (selected_cells.length > 1 && e.which != FE.KEYCODE.F10 && !editor.keys.isBrowserAction(e)) {\n            e.preventDefault();\n            selected_cells = [];\n\n            return false;\n          }\n        }\n\n        // We may want to select a cell with keyboard.\n        else {\n\n          // Garbage collector.\n          selected_cells = [];\n\n          if (_selectCellWithKeyboard(e) === false) return false;\n        }\n      }, true);\n\n      // Clean selected cells.\n      var c_selected_cells = [];\n      editor.events.on('html.beforeGet', function () {\n        c_selected_cells = selectedCells();\n\n        for (var i = 0; i < c_selected_cells.length; i++) {\n          c_selected_cells[i].className = (c_selected_cells[i].className || '').replace(/fr-selected-cell/g, '');\n        }\n      });\n\n      editor.events.on('html.afterGet', function () {\n        for (var i = 0; i < c_selected_cells.length; i++) {\n          c_selected_cells[i].className = (c_selected_cells[i].className ? c_selected_cells[i].className.trim() + ' ' : '') + 'fr-selected-cell';\n        }\n        c_selected_cells = [];\n      });\n\n      _initInsertPopup(true);\n      _initEditPopup(true);\n    }\n\n    editor.events.on('destroy', _destroy);\n  }\n\n  return {\n    _init: _init,\n    insert: insert,\n    remove: remove,\n    insertRow: insertRow,\n    deleteRow: deleteRow,\n    insertColumn: insertColumn,\n    deleteColumn: deleteColumn,\n    mergeCells: mergeCells,\n    splitCellVertically: splitCellVertically,\n    splitCellHorizontally: splitCellHorizontally,\n    addHeader: addHeader,\n    removeHeader: removeHeader,\n    setBackground: setBackground,\n    showInsertPopup: _showInsertPopup,\n    showEditPopup: _showEditPopup,\n    showColorsPopup: _showColorsPopup,\n    back: back,\n    verticalAlign: verticalAlign,\n    horizontalAlign: horizontalAlign,\n    applyStyle: applyStyle,\n    selectedTable: selectedTable,\n    selectedCells: selectedCells,\n    customColor: customColor\n  }\n};\n\n// Insert table button.\nFE.DefineIcon('insertTable', { NAME: 'table' });\nFE.RegisterCommand('insertTable', {\n  title: 'Insert Table',\n  undo: false,\n  focus: true,\n  refreshOnCallback: false,\n  popup: true,\n  callback: function () {\n    if (!this.popups.isVisible('table.insert')) {\n      this.table.showInsertPopup();\n    }\n    else {\n      if (this.$el.find('.fr-marker').length) {\n        this.events.disableBlur();\n        this.selection.restore();\n      }\n      this.popups.hide('table.insert');\n    }\n  },\n  plugin: 'table'\n});\n\nFE.RegisterCommand('tableInsert', {\n  callback: function (cmd, rows, cols) {\n    this.table.insert(rows, cols);\n    this.popups.hide('table.insert');\n  }\n})\n\n// Table header button.\nFE.DefineIcon('tableHeader', {\n  NAME: 'header',\n  FA5NAME: 'heading'\n})\nFE.RegisterCommand('tableHeader', {\n  title: 'Table Header',\n  focus: false,\n  toggle: true,\n  callback: function () {\n    var $btn = this.popups.get('table.edit').find('.fr-command[data-cmd=\"tableHeader\"]');\n\n    // If button is active the table has a header,\n    if ($btn.hasClass('fr-active')) {\n      this.table.removeHeader();\n    }\n\n    // Add table header.\n    else {\n      this.table.addHeader();\n    }\n  },\n  refresh: function ($btn) {\n    var $table = this.table.selectedTable();\n\n    if ($table.length > 0) {\n\n      // If table doesn't have a header.\n      if ($table.find('th').length === 0) {\n        $btn.removeClass('fr-active').attr('aria-pressed', false);\n      }\n\n      // Header button is active if table has header.\n      else {\n        $btn.addClass('fr-active').attr('aria-pressed', true);\n      }\n    }\n  }\n});\n\n// Table rows action dropdown.\nFE.DefineIcon('tableRows', { NAME: 'bars' })\nFE.RegisterCommand('tableRows', {\n  type: 'dropdown',\n  focus: false,\n  title: 'Row',\n  options: {\n    above: 'Insert row above',\n    below: 'Insert row below',\n    'delete': 'Delete row'\n  },\n  html: function () {\n    var c = '<ul class=\"fr-dropdown-list\" role=\"presentation\">';\n    var options =  FE.COMMANDS.tableRows.options;\n\n    for (var val in options) {\n      if (Object.prototype.hasOwnProperty.call(options, val)) {\n        c += '<li role=\"presentation\"><a class=\"fr-command\" tabIndex=\"-1\" role=\"option\" data-cmd=\"tableRows\" data-param1=\"' + val + '\" title=\"' + this.language.translate(options[val]) + '\">' + this.language.translate(options[val]) + '</a></li>';\n      }\n    }\n    c += '</ul>';\n\n    return c;\n  },\n  callback: function (cmd, val) {\n    if (val == 'above' || val == 'below') {\n      this.table.insertRow(val);\n    }\n    else {\n      this.table.deleteRow();\n    }\n  }\n});\n\n// Table columns action dropdown.\nFE.DefineIcon('tableColumns', { NAME: 'bars fa-rotate-90' })\nFE.RegisterCommand('tableColumns', {\n  type: 'dropdown',\n  focus: false,\n  title: 'Column',\n  options: {\n    before: 'Insert column before',\n    after: 'Insert column after',\n    'delete': 'Delete column'\n  },\n  html: function () {\n    var c = '<ul class=\"fr-dropdown-list\" role=\"presentation\">';\n    var options =  FE.COMMANDS.tableColumns.options;\n\n    for (var val in options) {\n      if (Object.prototype.hasOwnProperty.call(options, val)) {\n        c += '<li role=\"presentation\"><a class=\"fr-command\" tabIndex=\"-1\" role=\"option\" data-cmd=\"tableColumns\" data-param1=\"' + val + '\" title=\"' + this.language.translate(options[val]) + '\">' + this.language.translate(options[val]) + '</a></li>';\n      }\n    }\n    c += '</ul>';\n\n    return c;\n  },\n  callback: function (cmd, val) {\n    if (val == 'before' || val == 'after') {\n      this.table.insertColumn(val);\n    }\n    else {\n      this.table.deleteColumn();\n    }\n  }\n});\n\n// Table cells action dropdown.\nFE.DefineIcon('tableCells', {\n  NAME: 'square-o',\n  FA5NAME: 'square'\n})\nFE.RegisterCommand('tableCells', {\n  type: 'dropdown',\n  focus: false,\n  title: 'Cell',\n  options: {\n    merge: 'Merge cells',\n    'vertical-split': 'Vertical split',\n    'horizontal-split': 'Horizontal split'\n  },\n  html: function () {\n    var c = '<ul class=\"fr-dropdown-list\" role=\"presentation\">';\n    var options =  FE.COMMANDS.tableCells.options;\n\n    for (var val in options) {\n      if (Object.prototype.hasOwnProperty.call(options, val)) {\n        c += '<li role=\"presentation\"><a class=\"fr-command\" tabIndex=\"-1\" role=\"option\" data-cmd=\"tableCells\" data-param1=\"' + val + '\" title=\"' + this.language.translate(options[val]) + '\">' + this.language.translate(options[val]) + '</a></li>';\n      }\n    }\n    c += '</ul>';\n\n    return c;\n  },\n  callback: function (cmd, val) {\n    if (val == 'merge') {\n      this.table.mergeCells();\n    }\n    else if (val == 'vertical-split') {\n      this.table.splitCellVertically();\n    }\n\n    // 'horizontal-split'\n    else {\n      this.table.splitCellHorizontally();\n    }\n  },\n  refreshOnShow: function ($btn, $dropdown) {\n\n    // More than one cell selected.\n    if (this.$el.find('.fr-selected-cell').length > 1) {\n      $dropdown.find('a[data-param1=\"vertical-split\"]').addClass('fr-disabled').attr('aria-disabled', true);\n      $dropdown.find('a[data-param1=\"horizontal-split\"]').addClass('fr-disabled').attr('aria-disabled', true);\n      $dropdown.find('a[data-param1=\"merge\"]').removeClass('fr-disabled').attr('aria-disabled', false);\n    }\n\n    // Only one selected cell.\n    else {\n      $dropdown.find('a[data-param1=\"merge\"]').addClass('fr-disabled').attr('aria-disabled', true);\n      $dropdown.find('a[data-param1=\"vertical-split\"]').removeClass('fr-disabled').attr('aria-disabled', false);\n      $dropdown.find('a[data-param1=\"horizontal-split\"]').removeClass('fr-disabled').attr('aria-disabled', false);\n    }\n  }\n});\n\n// Remove table button.\nFE.DefineIcon('tableRemove', { NAME: 'trash' })\nFE.RegisterCommand('tableRemove', {\n  title: 'Remove Table',\n  focus: false,\n  callback: function () {\n    this.table.remove();\n  }\n});\n\n// Table styles.\nFE.DefineIcon('tableStyle', { NAME: 'paint-brush' })\nFE.RegisterCommand('tableStyle', {\n  title: 'Table Style',\n  type: 'dropdown',\n  focus: false,\n  html: function () {\n    var c = '<ul class=\"fr-dropdown-list\" role=\"presentation\">';\n    var options =  this.opts.tableStyles;\n\n    for (var val in options) {\n      if (Object.prototype.hasOwnProperty.call(options, val)) {\n        c += '<li role=\"presentation\"><a class=\"fr-command\" tabIndex=\"-1\" role=\"option\" data-cmd=\"tableStyle\" data-param1=\"' + val + '\" title=\"' + this.language.translate(options[val]) + '\">' + this.language.translate(options[val]) + '</a></li>';\n      }\n    }\n    c += '</ul>';\n\n    return c;\n  },\n  callback: function (cmd, val) {\n    this.table.applyStyle(val, this.$el.find('.fr-selected-cell').closest('table'), this.opts.tableMultipleStyles, this.opts.tableStyles);\n  },\n  refreshOnShow: function ($btn, $dropdown) {\n    var $table = this.$el.find('.fr-selected-cell').closest('table');\n\n    if ($table) {\n      $dropdown.find('.fr-command').each (function () {\n        var cls = $(this).data('param1');\n        var active = $table.hasClass(cls);\n        $(this).toggleClass('fr-active', active).attr('aria-selected', active);\n      })\n    }\n  }\n});\n\n// Table cell background color button.\nFE.DefineIcon('tableCellBackground', { NAME: 'tint' })\nFE.RegisterCommand('tableCellBackground', {\n  title: 'Cell Background',\n  focus: false,\n  popup: true,\n  callback: function () {\n    this.table.showColorsPopup();\n  }\n});\n\n// Select table cell background color command.\nFE.RegisterCommand('tableCellBackgroundColor', {\n  undo: true,\n  focus: false,\n  callback: function (cmd, val) {\n    this.table.setBackground(val);\n  }\n});\n\n// Table back.\nFE.DefineIcon('tableBack', { NAME: 'arrow-left' });\nFE.RegisterCommand('tableBack', {\n  title: 'Back',\n  undo: false,\n  focus: false,\n  back: true,\n  callback: function () {\n    this.table.back();\n  },\n  refresh: function ($btn) {\n    if (this.table.selectedCells().length === 0 && !this.opts.toolbarInline) {\n      $btn.addClass('fr-hidden');\n      $btn.next('.fr-separator').addClass('fr-hidden');\n    }\n    else {\n      $btn.removeClass('fr-hidden');\n      $btn.next('.fr-separator').removeClass('fr-hidden');\n    }\n  }\n});\n\n// Table vertical align dropdown.\nFE.DefineIcon('tableCellVerticalAlign', {\n  NAME: 'arrows-v',\n  FA5NAME: 'arrows-alt-v'\n})\nFE.RegisterCommand('tableCellVerticalAlign', {\n  type: 'dropdown',\n  focus: false,\n  title: 'Vertical Align',\n  options: {\n    Top: 'Align Top',\n    Middle: 'Align Middle',\n    Bottom: 'Align Bottom'\n  },\n  html: function () {\n    var c = '<ul class=\"fr-dropdown-list\" role=\"presentation\">';\n    var options =  FE.COMMANDS.tableCellVerticalAlign.options;\n\n    for (var val in options) {\n      if (Object.prototype.hasOwnProperty.call(options, val)) {\n        c += '<li role=\"presentation\"><a class=\"fr-command\" tabIndex=\"-1\" role=\"option\" data-cmd=\"tableCellVerticalAlign\" data-param1=\"' + val.toLowerCase() + '\" title=\"' + this.language.translate(options[val]) + '\">' + this.language.translate(val) + '</a></li>';\n      }\n    }\n    c += '</ul>';\n\n    return c;\n  },\n  callback: function (cmd, val) {\n    this.table.verticalAlign(val);\n  },\n  refreshOnShow: function ($btn, $dropdown) {\n    $dropdown.find('.fr-command[data-param1=\"' + this.$el.find('.fr-selected-cell').css('vertical-align') + '\"]').addClass('fr-active').attr('aria-selected', true);\n  }\n});\n\n// Table horizontal align dropdown.\nFE.DefineIcon('tableCellHorizontalAlign', { NAME: 'align-left' });\nFE.DefineIcon('align-left', { NAME: 'align-left' });\nFE.DefineIcon('align-right', { NAME: 'align-right' });\nFE.DefineIcon('align-center', { NAME: 'align-center' });\nFE.DefineIcon('align-justify', { NAME: 'align-justify' });\nFE.RegisterCommand('tableCellHorizontalAlign', {\n  type: 'dropdown',\n  focus: false,\n  title: 'Horizontal Align',\n  options: {\n    left: 'Align Left',\n    center: 'Align Center',\n    right: 'Align Right',\n    justify: 'Align Justify'\n  },\n  html: function () {\n    var c = '<ul class=\"fr-dropdown-list\" role=\"presentation\">';\n    var options =  FE.COMMANDS.tableCellHorizontalAlign.options;\n\n    for (var val in options) {\n      if (Object.prototype.hasOwnProperty.call(options, val)) {\n        c += '<li role=\"presentation\"><a class=\"fr-command fr-title\" tabIndex=\"-1\" role=\"option\" data-cmd=\"tableCellHorizontalAlign\" data-param1=\"' + val + '\" title=\"' + this.language.translate(options[val]) + '\">' + this.icon.create('align-' + val) + '<span class=\"fr-sr-only\">' + this.language.translate(options[val]) + '</span></a></li>';\n      }\n    }\n    c += '</ul>';\n\n    return c;\n  },\n  callback: function (cmd, val) {\n    this.table.horizontalAlign(val);\n  },\n  refresh: function ($btn) {\n    var selected_cells = this.table.selectedCells();\n\n    if (selected_cells.length) {\n      $btn.find('> *').first().replaceWith(this.icon.create('align-' + this.helpers.getAlignment(selected_cells[0])));\n    }\n  },\n  refreshOnShow: function ($btn, $dropdown) {\n    $dropdown.find('.fr-command[data-param1=\"' + this.helpers.getAlignment(this.$el.find('.fr-selected-cell').first()) + '\"]').addClass('fr-active').attr('aria-selected', true);\n  }\n});\n\n// Table cell styles.\nFE.DefineIcon('tableCellStyle', { NAME: 'magic' })\nFE.RegisterCommand('tableCellStyle', {\n  title: 'Cell Style',\n  type: 'dropdown',\n  focus: false,\n  html: function () {\n    var c = '<ul class=\"fr-dropdown-list\" role=\"presentation\">';\n    var options =  this.opts.tableCellStyles;\n\n    for (var val in options) {\n      if (Object.prototype.hasOwnProperty.call(options, val)) {\n        c += '<li role=\"presentation\"><a class=\"fr-command\" tabIndex=\"-1\" role=\"option\" data-cmd=\"tableCellStyle\" data-param1=\"' + val + '\" title=\"' + this.language.translate(options[val]) + '\">' + this.language.translate(options[val]) + '</a></li>';\n      }\n    }\n    c += '</ul>';\n\n    return c;\n  },\n  callback: function (cmd, val) {\n    this.table.applyStyle(val, this.$el.find('.fr-selected-cell'), this.opts.tableCellMultipleStyles, this.opts.tableCellStyles);\n  },\n  refreshOnShow: function ($btn, $dropdown) {\n    var $cell = this.$el.find('.fr-selected-cell').first();\n\n    if ($cell) {\n      $dropdown.find('.fr-command').each (function () {\n        var cls = $(this).data('param1');\n        var active = $cell.hasClass(cls);\n        $(this).toggleClass('fr-active', active).attr('aria-selected', active);\n      })\n    }\n  }\n});\n\nFE.RegisterCommand('tableCellBackgroundCustomColor', {\n  title: 'OK',\n  undo: true,\n  callback: function () {\n    this.table.customColor();\n  }\n});\n\nFE.DefineIcon('tableColorRemove', { NAME: 'eraser' });\n","import FE from 'FroalaEditor';\n\nFE.URLRegEx = '(^| |\\\\u00A0)(' + FE.LinkRegEx + '|' + '([a-z0-9+-_.]{1,}@[a-z0-9+-_.]{1,}\\\\.[a-z0-9+-_]{1,})' + ')$';\n\nFE.PLUGINS.url = function (editor) {\n  let $ = editor.$\n\n  var rel = null;\n\n  /*\n   * Transform string into a hyperlink.\n   */\n  function _linkReplaceHandler (match, p1, p2) {\n    var dots = '';\n\n    while (p2.length && p2[p2.length - 1] == '.') {\n      dots += '.';\n      p2 = p2.substring(0, p2.length - 1);\n    }\n\n    var link = p2;\n\n    // Convert email.\n    if (editor.opts.linkConvertEmailAddress) {\n      if (editor.helpers.isEmail(link) && !/^mailto:.*/i.test(link)) {\n        link = 'mailto:' + link;\n      }\n    }\n    else if (editor.helpers.isEmail(link)) {\n      return p1 + p2;\n    }\n\n    if (!/^((http|https|ftp|ftps|mailto|tel|sms|notes|data)\\:)/i.test(link)) {\n      link = '//' + link;\n    }\n\n    return (p1 ? p1 : '') + '<a' + (editor.opts.linkAlwaysBlank ? ' target=\"_blank\"' : '') + (rel ? (' rel=\"' + rel + '\"') : '') + ' data-fr-linked=\"true\" href=\"' + link + '\">' + p2.replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/&amp;/g, '&').replace(/&/g, '&amp;') + '</a>' + dots;\n  }\n\n  function _getRegEx () {\n    return new RegExp(FE.URLRegEx, 'gi');\n  }\n\n  /*\n   * Convert link paterns from html into hyperlinks.\n   */\n  function _convertToLink (html) {\n\n    if (editor.opts.linkAlwaysNoFollow) {\n      rel = 'nofollow';\n    }\n\n    // https://github.com/froala/wysiwyg-editor/issues/1576.\n    if (editor.opts.linkAlwaysBlank) {\n      if (editor.opts.linkNoOpener) {\n        if (!rel) rel = 'noopener';\n        else rel += ' noopener';\n      }\n\n      if (editor.opts.linkNoReferrer) {\n        if (!rel) rel = 'noreferrer';\n        else rel += ' noreferrer';\n      }\n    }\n\n    return html.replace(_getRegEx(), _linkReplaceHandler);\n  }\n\n  function _isA (node) {\n    if (!node) return false;\n\n    if (node.tagName === 'A') return true;\n\n    if (node.parentNode && node.parentNode != editor.el) return _isA(node.parentNode);\n\n    return false;\n  }\n\n  function _lastPart(text) {\n    var splits = text.split(' ');\n\n    return splits[splits.length - 1];\n  }\n\n  function _inlineType () {\n    var range = editor.selection.ranges(0);\n    var node = range.startContainer;\n\n    if (!node || node.nodeType !== Node.TEXT_NODE) return false;\n\n    if (_isA(node)) return false;\n\n    if (_getRegEx().test(_lastPart(node.textContent))) {\n      $(node).before(_convertToLink(node.textContent));\n\n      // Get linked link.\n      var $link = $(node.parentNode).find('a[data-fr-linked]');\n      $link.removeAttr('data-fr-linked');\n\n      node.parentNode.removeChild(node);\n\n      // Trigger link event.\n      editor.events.trigger('url.linked', [$link.get(0)]);\n    }\n    else if (node.textContent.split(' ').length <= 2 && node.previousSibling && node.previousSibling.tagName === 'A') {\n      var text = node.previousSibling.innerText + node.textContent;\n\n      if (_getRegEx().test(_lastPart(text))) {\n        $(node.previousSibling).replaceWith(_convertToLink(text));\n\n        node.parentNode.removeChild(node);\n      }\n    }\n  }\n\n  /*\n   * Initialize.\n   */\n  function _init () {\n    // Handle special keys.\n    editor.events.on('keypress', function (e) {\n      if (editor.selection.isCollapsed() && (e.key == '.' || e.key == ')' || e.key == '(')) {\n        _inlineType();\n      }\n    }, true);\n\n    // Handle ENTER and SPACE.\n    editor.events.on('keydown', function (e) {\n      var keycode = e.which;\n\n      if (editor.selection.isCollapsed() && (keycode == FE.KEYCODE.ENTER || keycode == FE.KEYCODE.SPACE)) {\n        _inlineType();\n      }\n    }, true);\n\n    // Handle pasting.\n    editor.events.on('paste.beforeCleanup', function (html) {\n      if (editor.helpers.isURL(html)) {\n        var rel_attr = null;\n\n        if (editor.opts.linkAlwaysBlank) {\n          if (editor.opts.linkNoOpener) {\n            if (!rel_attr) rel_attr = 'noopener';\n            else rel_attr += ' noopener';\n          }\n\n          if (editor.opts.linkNoReferrer) {\n            if (!rel_attr) rel_attr = 'noreferrer';\n            else rel_attr += ' noreferrer';\n          }\n        }\n\n        return '<a' + (editor.opts.linkAlwaysBlank ? ' target=\"_blank\"' : '') + (rel_attr ? (' rel=\"' + rel_attr + '\"') : '') + ' href=\"' + html + '\" >' + html + '</a>';\n      }\n    })\n  }\n\n  return {\n    _init: _init\n  }\n}\n","import FE from 'FroalaEditor'\n\nObject.assign(FE.POPUP_TEMPLATES, {\n  'video.insert': '[_BUTTONS_][_BY_URL_LAYER_][_EMBED_LAYER_][_UPLOAD_LAYER_][_PROGRESS_BAR_]',\n  'video.edit': '[_BUTTONS_]',\n  'video.size': '[_BUTTONS_][_SIZE_LAYER_]'\n})\n\nObject.assign(FE.DEFAULTS, {\n  videoAllowedTypes: ['mp4', 'webm', 'ogg'],\n  videoAllowedProviders: ['.*'],\n  videoDefaultAlign: 'center',\n  videoDefaultDisplay: 'block',\n  videoDefaultWidth: 600,\n  videoEditButtons: ['videoReplace', 'videoRemove', '|', 'videoDisplay', 'videoAlign', 'videoSize'],\n  videoInsertButtons: ['videoBack', '|', 'videoByURL', 'videoEmbed', 'videoUpload'],\n  videoMaxSize: 50 * 1024 * 1024,\n  videoMove: true,\n  videoResize: true,\n  videoSizeButtons: ['videoBack', '|'],\n  videoSplitHTML: false,\n  videoTextNear: true,\n  videoUpload: true,\n  videoUploadMethod: 'POST',\n  videoUploadParam: 'file',\n  videoUploadParams: {},\n  videoUploadToS3: false,\n  videoUploadURL: 'https://i.froala.com/upload'\n});\n\nFE.VIDEO_PROVIDERS = [\n  {\n    test_regex: /^.*((youtu.be)|(youtube.com))\\/((v\\/)|(\\/u\\/\\w\\/)|(embed\\/)|(watch\\?))?\\??v?=?([^#\\&\\?]*).*/,\n    url_regex: /(?:https?:\\/\\/)?(?:www\\.)?(?:m\\.)?(?:youtube\\.com|youtu\\.be)\\/(?:watch\\?v=|embed\\/)?([0-9a-zA-Z_\\-]+)(.+)?/g,\n    url_text: 'https://www.youtube.com/embed/$1',\n    html: '<iframe width=\"640\" height=\"360\" src=\"{url}?wmode=opaque\" frameborder=\"0\" allowfullscreen></iframe>',\n    provider: 'youtube'\n  },\n  {\n    test_regex: /^.*(?:vimeo.com)\\/(?:channels(\\/\\w+\\/)?|groups\\/*\\/videos\\/\\d+\\/|video\\/|)(\\d+)(?:$|\\/|\\?)/,\n    url_regex: /(?:https?:\\/\\/)?(?:www\\.|player\\.)?vimeo.com\\/(?:channels\\/(?:\\w+\\/)?|groups\\/(?:[^\\/]*)\\/videos\\/|album\\/(?:\\d+)\\/video\\/|video\\/|)(\\d+)(?:[a-zA-Z0-9_\\-]+)?/i,\n    url_text: 'https://player.vimeo.com/video/$1',\n    html: '<iframe width=\"640\" height=\"360\" src=\"{url}\" frameborder=\"0\" allowfullscreen></iframe>',\n    provider: 'vimeo'\n  },\n  {\n    test_regex: /^.+(dailymotion.com|dai.ly)\\/(video|hub)?\\/?([^_]+)[^#]*(#video=([^_&]+))?/,\n    url_regex: /(?:https?:\\/\\/)?(?:www\\.)?(?:dailymotion\\.com|dai\\.ly)\\/(?:video|hub)?\\/?(.+)/g,\n    url_text: 'https://www.dailymotion.com/embed/video/$1',\n    html: '<iframe width=\"640\" height=\"360\" src=\"{url}\" frameborder=\"0\" allowfullscreen></iframe>',\n    provider: 'dailymotion'\n  },\n  {\n    test_regex: /^.+(screen.yahoo.com)\\/[^_&]+/,\n    url_regex: '',\n    url_text: '',\n    html: '<iframe width=\"640\" height=\"360\" src=\"{url}?format=embed\" frameborder=\"0\" allowfullscreen=\"true\" mozallowfullscreen=\"true\" webkitallowfullscreen=\"true\" allowtransparency=\"true\"></iframe>',\n    provider: 'yahoo'\n  },\n  {\n    test_regex: /^.+(rutube.ru)\\/[^_&]+/,\n    url_regex: /(?:https?:\\/\\/)?(?:www\\.)?(?:rutube\\.ru)\\/(?:video)?\\/?(.+)/g,\n    url_text: 'https://rutube.ru/play/embed/$1',\n    html: '<iframe width=\"640\" height=\"360\" src=\"{url}\" frameborder=\"0\" allowfullscreen=\"true\" mozallowfullscreen=\"true\" webkitallowfullscreen=\"true\" allowtransparency=\"true\"></iframe>',\n    provider: 'rutube'\n  },\n  {\n    test_regex: /^(?:.+)vidyard.com\\/(?:watch)?\\/?([^.&/]+)\\/?(?:[^_.&]+)?/,\n    url_regex: /^(?:.+)vidyard.com\\/(?:watch)?\\/?([^.&/]+)\\/?(?:[^_.&]+)?/g,\n    url_text: 'https://play.vidyard.com/$1',\n    html: '<iframe width=\"640\" height=\"360\" src=\"{url}\" frameborder=\"0\" allowfullscreen></iframe>',\n    provider: 'vidyard'\n  }\n];\n\nFE.VIDEO_EMBED_REGEX = /^\\W*((<iframe.*><\\/iframe>)|(<embed.*>))\\W*$/i;\n\nFE.PLUGINS.video = function (editor) {\n  let $ = editor.$\n\n  var $overlay;\n  var $handler;\n  var $video_resizer;\n  var $current_video;\n\n  var BAD_LINK = 1;\n  var MISSING_LINK = 2;\n  var ERROR_DURING_UPLOAD = 3;\n  var BAD_RESPONSE = 4;\n  var MAX_SIZE_EXCEEDED = 5;\n  var BAD_FILE_TYPE = 6;\n  var NO_CORS_IE = 7;\n\n  var error_messages = {};\n  error_messages[BAD_LINK] = 'Video cannot be loaded from the passed link.',\n  error_messages[MISSING_LINK] = 'No link in upload response.',\n  error_messages[ERROR_DURING_UPLOAD] = 'Error during file upload.',\n  error_messages[BAD_RESPONSE] = 'Parsing response failed.',\n  error_messages[MAX_SIZE_EXCEEDED] = 'File is too large.',\n  error_messages[BAD_FILE_TYPE] = 'Video file type is invalid.',\n  error_messages[NO_CORS_IE] = 'Files can be uploaded only to same domain in IE 8 and IE 9.'\n\n  /**\n   * Refresh the video insert popup.\n   */\n  function _refreshInsertPopup () {\n    var $popup = editor.popups.get('video.insert');\n\n    var $url_input = $popup.find('.fr-video-by-url-layer input');\n    $url_input.val('').trigger('change');\n\n    var $embed_area = $popup.find('.fr-video-embed-layer textarea');\n    $embed_area.val('').trigger('change');\n\n    $embed_area = $popup.find('.fr-video-upload-layer input');\n    $embed_area.val('').trigger('change');\n  }\n\n  /**\n   * Show the video insert popup.\n   */\n  function showInsertPopup () {\n    var $btn = editor.$tb.find('.fr-command[data-cmd=\"insertVideo\"]');\n\n    var $popup = editor.popups.get('video.insert');\n\n    if (!$popup) $popup = _initInsertPopup();\n\n    hideProgressBar();\n\n    if (!$popup.hasClass('fr-active')) {\n      editor.popups.refresh('video.insert');\n      editor.popups.setContainer('video.insert', editor.$tb);\n\n      if ($btn.isVisible()) {\n        var left = $btn.offset().left + $btn.outerWidth() / 2;\n        var top = $btn.offset().top + (editor.opts.toolbarBottom ? 10 : $btn.outerHeight() - 10);\n        editor.popups.show('video.insert', left, top, $btn.outerHeight());\n      }\n      else {\n        editor.position.forSelection($popup);\n        editor.popups.show('video.insert');\n      }\n    }\n  }\n\n  /**\n   * Show the video edit popup.\n   */\n  function _showEditPopup () {\n    var $popup = editor.popups.get('video.edit');\n\n    if (!$popup) $popup = _initEditPopup();\n\n    if ($popup) {\n      editor.popups.setContainer('video.edit', editor.$sc);\n      editor.popups.refresh('video.edit');\n\n      var $video_obj = $current_video.find('iframe, embed, video');\n      var left = $video_obj.offset().left + $video_obj.outerWidth() / 2;\n      var top = $video_obj.offset().top + $video_obj.outerHeight();\n\n      editor.popups.show('video.edit', left, top, $video_obj.outerHeight());\n    }\n  }\n\n  function _initInsertPopup (delayed) {\n    if (delayed) {\n      editor.popups.onRefresh('video.insert', _refreshInsertPopup);\n      editor.popups.onHide('image.insert', _hideInsertPopup);\n\n      return true;\n    }\n\n    // Video buttons.\n    var video_buttons = '';\n\n    if (!editor.opts.videoUpload) {\n      editor.opts.videoInsertButtons.splice(editor.opts.videoInsertButtons.indexOf('videoUpload'), 1);\n    }\n\n    if (editor.opts.videoInsertButtons.length > 1) {\n      video_buttons = '<div class=\"fr-buttons\">' + editor.button.buildList(editor.opts.videoInsertButtons) + '</div>';\n    }\n\n    // Video by url layer.\n    var by_url_layer = '';\n\n    var uploadIndex = editor.opts.videoInsertButtons.indexOf('videoUpload');\n    var urlIndex = editor.opts.videoInsertButtons.indexOf('videoByURL');\n    var embedIndex = editor.opts.videoInsertButtons.indexOf('videoEmbed');\n\n    var active;\n\n    if (urlIndex >= 0) {\n      active = ' fr-active';\n\n      if ((urlIndex > uploadIndex && uploadIndex >= 0) || (urlIndex > embedIndex && embedIndex >= 0)) {\n        active = ''\n      }\n\n      by_url_layer = '<div class=\"fr-video-by-url-layer fr-layer' + active + '\" id=\"fr-video-by-url-layer-' + editor.id + '\"><div class=\"fr-input-line\"><input id=\"fr-video-by-url-layer-text-' + editor.id + '\" type=\"text\" placeholder=\"' + editor.language.translate('Paste in a video URL') + '\" tabIndex=\"1\" aria-required=\"true\"></div><div class=\"fr-action-buttons\"><button type=\"button\" class=\"fr-command fr-submit\" data-cmd=\"videoInsertByURL\" tabIndex=\"2\" role=\"button\">' + editor.language.translate('Insert') + '</button></div></div>'\n    }\n\n    // Video embed layer.\n    var embed_layer = '';\n\n    if (embedIndex >= 0) {\n      active = ' fr-active';\n\n      if ((embedIndex > uploadIndex && uploadIndex >= 0) || (embedIndex > urlIndex && urlIndex >= 0)) {\n        active = ''\n      }\n\n      embed_layer = '<div class=\"fr-video-embed-layer fr-layer' + active + '\" id=\"fr-video-embed-layer-' + editor.id + '\"><div class=\"fr-input-line\"><textarea id=\"fr-video-embed-layer-text' + editor.id + '\" type=\"text\" placeholder=\"' + editor.language.translate('Embedded Code') + '\" tabIndex=\"1\" aria-required=\"true\" rows=\"5\"></textarea></div><div class=\"fr-action-buttons\"><button type=\"button\" class=\"fr-command fr-submit\" data-cmd=\"videoInsertEmbed\" tabIndex=\"2\" role=\"button\">' + editor.language.translate('Insert') + '</button></div></div>'\n    }\n\n    // Video upload layer.\n    var upload_layer = '';\n\n    if (uploadIndex >= 0) {\n      active = ' fr-active';\n\n      if ((uploadIndex > embedIndex && embedIndex >= 0) || (uploadIndex > urlIndex && urlIndex >= 0)) {\n        active = ''\n      }\n\n      upload_layer = '<div class=\"fr-video-upload-layer fr-layer' + active + '\" id=\"fr-video-upload-layer-' + editor.id + '\"><strong>' + editor.language.translate('Drop video') + '</strong><br>(' + editor.language.translate('or click') + ')<div class=\"fr-form\"><input type=\"file\" accept=\"video/' + editor.opts.videoAllowedTypes.join(', video/').toLowerCase() + '\" tabIndex=\"-1\" aria-labelledby=\"fr-video-upload-layer-' + editor.id + '\" role=\"button\"></div></div>'\n    }\n\n    // Progress bar.\n    var progress_bar_layer = '<div class=\"fr-video-progress-bar-layer fr-layer\"><h3 tabIndex=\"-1\" class=\"fr-message\">Uploading</h3><div class=\"fr-loader\"><span class=\"fr-progress\"></span></div><div class=\"fr-action-buttons\"><button type=\"button\" class=\"fr-command fr-dismiss\" data-cmd=\"videoDismissError\" tabIndex=\"2\" role=\"button\">OK</button></div></div>';\n\n\n    var template = {\n      buttons: video_buttons,\n      by_url_layer: by_url_layer,\n      embed_layer: embed_layer,\n      upload_layer: upload_layer,\n      progress_bar: progress_bar_layer\n    }\n\n    // Set the template in the popup.\n    var $popup = editor.popups.create('video.insert', template);\n\n    _bindInsertEvents($popup);\n\n    return $popup;\n  }\n\n  /**\n   * Show the video upload layer.\n   */\n  function showLayer (name) {\n    var $popup = editor.popups.get('video.insert');\n\n    var left;\n    var top;\n\n    if (!$current_video && !editor.opts.toolbarInline) {\n      var $btn = editor.$tb.find('.fr-command[data-cmd=\"insertVideo\"]');\n      left = $btn.offset().left + $btn.outerWidth() / 2;\n      top = $btn.offset().top + (editor.opts.toolbarBottom ? 10 : $btn.outerHeight() - 10);\n    }\n\n    if (editor.opts.toolbarInline) {\n\n      // Set top to the popup top.\n      top = $popup.offset().top - editor.helpers.getPX($popup.css('margin-top'));\n\n      // If the popup is above apply height correction.\n      if ($popup.hasClass('fr-above')) {\n        top += $popup.outerHeight();\n      }\n    }\n\n    // Show the new layer.\n    $popup.find('.fr-layer').removeClass('fr-active');\n    $popup.find('.fr-' + name + '-layer').addClass('fr-active');\n    editor.popups.show('video.insert', left, top, 0);\n    editor.accessibility.focusPopup($popup);\n  }\n\n  /**\n   * Refresh the insert by url button.\n   */\n  function refreshByURLButton ($btn) {\n    var $popup = editor.popups.get('video.insert');\n\n    if ($popup.find('.fr-video-by-url-layer').hasClass('fr-active')) {\n      $btn.addClass('fr-active').attr('aria-pressed', true);\n    }\n  }\n\n  /**\n   * Refresh the insert embed button.\n   */\n  function refreshEmbedButton ($btn) {\n    var $popup = editor.popups.get('video.insert');\n\n    if ($popup.find('.fr-video-embed-layer').hasClass('fr-active')) {\n      $btn.addClass('fr-active').attr('aria-pressed', true);\n    }\n  }\n\n  /**\n   * Refresh the insert upload button.\n   */\n  function refreshUploadButton ($btn) {\n    var $popup = editor.popups.get('video.insert');\n\n    if ($popup.find('.fr-video-upload-layer').hasClass('fr-active')) {\n      $btn.addClass('fr-active').attr('aria-pressed', true);\n    }\n  }\n\n  /**\n   * Insert video embedded object.\n   */\n  function insert (embedded_code) {\n\n    // Make sure we have focus.\n    editor.events.focus(true);\n    editor.selection.restore();\n\n    // Flag to tell if the video is replaced.\n    var replaced = false;\n\n    // If current video found we have to replace it.\n    if ($current_video) {\n\n      // Remove the old video.\n      remove();\n\n      // Mark that the video is replaced.\n      replaced = true;\n    }\n\n    editor.html.insert('<span contenteditable=\"false\" draggable=\"true\" class=\"fr-jiv fr-video\">' + embedded_code + '</span>', false, editor.opts.videoSplitHTML);\n\n    editor.popups.hide('video.insert');\n\n    var $video = editor.$el.find('.fr-jiv');\n    $video.removeClass('fr-jiv');\n\n    _setStyle($video, editor.opts.videoDefaultDisplay, editor.opts.videoDefaultAlign);\n\n    $video.toggleClass('fr-draggable', editor.opts.videoMove);\n\n    editor.events.trigger(replaced ? 'video.replaced' : 'video.inserted', [$video]);\n  }\n\n  function _loadedCallback () {\n    var $video = $(this);\n\n    editor.popups.hide('video.insert');\n\n    $video.removeClass('fr-uploading');\n\n    // Select the image.\n    if ($video.parent().next().is('br')) {\n      $video.parent().next().remove();\n    }\n\n    _editVideo($video.parent());\n\n    editor.events.trigger('video.loaded', [$video.parent()]);\n  }\n\n  /**\n   * Insert html video into the editor.\n   */\n\n  function insertHtmlVideo (link, sanitize, data, $existing_video, response) {\n    editor.edit.off();\n    _setProgressMessage('Loading video');\n\n    if (sanitize) link = editor.helpers.sanitizeURL(link);\n\n    var _add = function () {\n      var $video;\n      var attr;\n\n      if ($existing_video) {\n        if (!editor.undo.canDo() && !$existing_video.find('video').hasClass('fr-uploading')) editor.undo.saveStep();\n\n        var old_src = $existing_video.find('video').data('fr-old-src');\n\n        var replaced = $existing_video.data('fr-replaced');\n        $existing_video.data('fr-replaced', false);\n\n        if (editor.$wp) {\n\n          // Clone existing video.\n          $video = $existing_video.clone();\n          $video.find('video').removeData('fr-old-src').removeClass('fr-uploading');\n\n          // Remove load event.\n          $video.find('video').off('canplay');\n\n          // Set new SRC.\n          if (old_src) $existing_video.find('video').attr('src', old_src);\n\n          // Replace existing video with its clone.\n          $existing_video.replaceWith($video);\n        }\n        else {\n          $video = $existing_video;\n        }\n\n        // Remove old data.\n        var atts = $video.find('video').get(0).attributes;\n\n        for (var i = 0; i < atts.length; i++) {\n          var att = atts[i];\n\n          if (att.nodeName.indexOf('data-') === 0) {\n            $video.find('video').removeAttr(att.nodeName);\n          }\n        }\n\n        // Set new data.\n        if (typeof data != 'undefined') {\n          for (attr in data) {\n            if (Object.prototype.hasOwnProperty.call(data, attr)) {\n              if (attr != 'link') {\n                $video.find('video').attr('data-' + attr, data[attr]);\n              }\n            }\n          }\n        }\n\n        $video.find('video').on('canplay', _loadedCallback);\n        $video.find('video').attr('src', link);\n        editor.edit.on();\n        _syncVideos();\n        editor.undo.saveStep();\n\n        // Cursor will not appear if we don't make blur.\n        editor.$el.blur();\n\n        editor.events.trigger(replaced ? 'video.replaced' : 'video.inserted', [$video, response]);\n      }\n      else {\n        $video = _addVideo(link, data, _loadedCallback);\n        _syncVideos();\n        editor.undo.saveStep();\n        editor.events.trigger('video.inserted', [$video, response]);\n      }\n    }\n\n    showProgressBar('Loading video');\n\n    _add();\n  }\n\n  /**\n   * Show progress bar.\n   */\n\n  function showProgressBar (no_message) {\n    var $popup = editor.popups.get('video.insert');\n\n    if (!$popup) $popup = _initInsertPopup();\n\n    $popup.find('.fr-layer.fr-active').removeClass('fr-active').addClass('fr-pactive');\n    $popup.find('.fr-video-progress-bar-layer').addClass('fr-active');\n    $popup.find('.fr-buttons').hide();\n\n    if ($current_video) {\n      var $current_video_obj = $current_video.find('video');\n      editor.popups.setContainer('video.insert', editor.$sc);\n      var left = $current_video_obj.offset().left + $current_video_obj.width() / 2;\n      var top = $current_video_obj.offset().top + $current_video_obj.height();\n\n      editor.popups.show('video.insert', left, top, $current_video_obj.outerHeight());\n    }\n\n    if (typeof no_message == 'undefined') {\n      _setProgressMessage(editor.language.translate('Uploading'), 0);\n    }\n  }\n\n  /**\n   * Hide progress bar.\n   */\n  function hideProgressBar (dismiss) {\n    var $popup = editor.popups.get('video.insert');\n\n    if ($popup) {\n      $popup.find('.fr-layer.fr-pactive').addClass('fr-active').removeClass('fr-pactive');\n      $popup.find('.fr-video-progress-bar-layer').removeClass('fr-active');\n      $popup.find('.fr-buttons').show();\n\n      // Dismiss error message.\n      if (dismiss || editor.$el.find('video.fr-error').length) {\n        editor.events.focus();\n\n        if (editor.$el.find('video.fr-error').length) {\n          editor.$el.find('video.fr-error').parent().remove();\n          editor.undo.saveStep();\n          editor.undo.run();\n          editor.undo.dropRedo();\n        }\n\n        if (!editor.$wp && $current_video) {\n          var $video = $current_video;\n          _exitEdit(true);\n          editor.selection.setAfter($video.find('video').get(0));\n          editor.selection.restore();\n        }\n        editor.popups.hide('video.insert');\n      }\n    }\n  }\n\n  /**\n   * Set a progress message.\n   */\n\n  function _setProgressMessage (message, progress) {\n    var $popup = editor.popups.get('video.insert');\n\n    if ($popup) {\n      var $layer = $popup.find('.fr-video-progress-bar-layer');\n      $layer.find('h3').text(message + (progress ? ' ' + progress + '%' : ''));\n\n      $layer.removeClass('fr-error');\n\n      if (progress) {\n        $layer.find('div').removeClass('fr-indeterminate');\n        $layer.find('div > span').css('width', progress + '%');\n      }\n      else {\n        $layer.find('div').addClass('fr-indeterminate');\n      }\n    }\n  }\n\n  /**\n   * Show error message to the user.\n   */\n\n  function _showErrorMessage (message) {\n    showProgressBar();\n    var $popup = editor.popups.get('video.insert');\n    var $layer = $popup.find('.fr-video-progress-bar-layer');\n    $layer.addClass('fr-error');\n    var $message_header = $layer.find('h3');\n    $message_header.text(message);\n    editor.events.disableBlur();\n    $message_header.focus();\n  }\n\n  /**\n   * Insert video by URL.\n   */\n  function insertByURL (link) {\n    if (typeof link == 'undefined') {\n      var $popup = editor.popups.get('video.insert');\n      link = ($popup.find('.fr-video-by-url-layer input[type=\"text\"]').val() || '').trim();\n    }\n\n    var video = null;\n\n    if (!/^http/.test(link)) {\n      link = 'https://' + link;\n    }\n\n    if (editor.helpers.isURL(link)) {\n      for (var i = 0; i < FE.VIDEO_PROVIDERS.length; i++) {\n        var vp = FE.VIDEO_PROVIDERS[i];\n\n        // Check if video provider is allowed.\n        if (vp.test_regex.test(link) && (new RegExp(editor.opts.videoAllowedProviders.join('|'))).test(vp.provider)) {\n          video = link.replace(vp.url_regex, vp.url_text);\n          video = vp.html.replace(/\\{url\\}/, video);\n          break;\n        }\n      }\n    }\n\n    if (video) {\n      insert(video);\n    }\n    else {\n      editor.events.trigger('video.linkError', [link]);\n    }\n  }\n\n  /**\n   * Insert embedded video.\n   */\n  function insertEmbed (code) {\n    if (typeof code == 'undefined') {\n      var $popup = editor.popups.get('video.insert');\n      code = $popup.find('.fr-video-embed-layer textarea').val() || '';\n    }\n\n    if (code.length === 0 || !FE.VIDEO_EMBED_REGEX.test(code)) {\n      editor.events.trigger('video.codeError', [code]);\n    }\n    else {\n      insert(code);\n    }\n  }\n\n  function _editVideo ($video) {\n    _edit.call($video.get(0));\n  }\n\n  /**\n   * Parse video response.\n   */\n\n  function _parseResponse (response) {\n    try {\n      if (editor.events.trigger('video.uploaded', [response], true) === false) {\n        editor.edit.on();\n\n        return false;\n      }\n\n      var resp = JSON.parse(response);\n\n      if (resp.link) {\n\n        return resp;\n      }\n      else {\n\n        // No link in upload request.\n        _throwError(MISSING_LINK, response);\n\n        return false;\n      }\n    }\n    catch (ex) {\n\n      // Bad response.\n      _throwError(BAD_RESPONSE, response);\n\n      return false;\n    }\n  }\n\n  /**\n   * Parse video response.\n   */\n\n  function _parseXMLResponse (response) {\n    try {\n      var link = $(response).find('Location').text();\n      var key = $(response).find('Key').text();\n\n      if (editor.events.trigger('video.uploadedToS3', [link, key, response], true) === false) {\n        editor.edit.on();\n\n        return false;\n      }\n\n      return link;\n    }\n    catch (ex) {\n\n      // Bad response.\n      _throwError(BAD_RESPONSE, response);\n\n      return false;\n    }\n  }\n\n  /**\n   * Video was uploaded to the server and we have a response.\n   */\n\n  function _videoUploaded ($video) {\n    _setProgressMessage('Loading video');\n\n    var status = this.status;\n    var response = this.response;\n    var responseXML = this.responseXML;\n    var responseText = this.responseText;\n\n    try {\n      if (editor.opts.videoUploadToS3) {\n        if (status == 201) {\n          var link = _parseXMLResponse(responseXML);\n\n          if (link) {\n            insertHtmlVideo(link, false, [], $video, response || responseXML);\n          }\n        }\n        else {\n          _throwError(BAD_RESPONSE, response || responseXML);\n        }\n      }\n      else {\n        if (status >= 200 && status < 300) {\n          var resp = _parseResponse(responseText);\n\n          if (resp) {\n            insertHtmlVideo(resp.link, false, resp, $video, response || responseText);\n          }\n        }\n        else {\n          _throwError(ERROR_DURING_UPLOAD, response || responseText);\n        }\n      }\n    }\n    catch (ex) {\n\n      // Bad response.\n      _throwError(BAD_RESPONSE, response || responseText);\n    }\n  }\n\n  /**\n   * Video upload error.\n   */\n\n  function _videoUploadError () {\n    _throwError(BAD_RESPONSE, this.response || this.responseText || this.responseXML);\n  }\n\n  /**\n   * Video upload progress.\n   */\n\n  function _videoUploadProgress (e) {\n    if (e.lengthComputable) {\n      var complete = (e.loaded / e.total * 100 | 0);\n      _setProgressMessage(editor.language.translate('Uploading'), complete);\n    }\n  }\n\n  /**\n   * Video upload aborted.\n   */\n  function _videoUploadAborted () {\n    editor.edit.on();\n    hideProgressBar(true);\n  }\n\n  function _addVideo (link, data, loadCallback) {\n\n    // Build video data string.\n    var data_str = '';\n    var attr;\n\n    if (data && typeof data != 'undefined') {\n      for (attr in data) {\n        if (Object.prototype.hasOwnProperty.call(data, attr)) {\n          if (attr != 'link') {\n            data_str += ' data-' + attr + '=\"' + data[attr] + '\"';\n          }\n        }\n      }\n    }\n\n    var width = editor.opts.videoDefaultWidth;\n\n    if (width && width != 'auto') {\n      width = width + 'px';\n    }\n\n    // Create video object and set the load event.\n    var $video = $('<span contenteditable=\"false\" draggable=\"true\" class=\"fr-video fr-dv' + (editor.opts.videoDefaultDisplay[0]) + (editor.opts.videoDefaultAlign != 'center' ? ' fr-fv' + editor.opts.videoDefaultAlign[0] : '') + '\"><video src=\"' + link + '\" ' + data_str + (width ? ' style=\"width: ' + width + ';\" ' : '') + ' controls>' + editor.language.translate('Your browser does not support HTML5 video.') + '</video></span>');\n    $video.toggleClass('fr-draggable', editor.opts.videoMove);\n\n    // Make sure we have focus.\n    // Call the event.\n    editor.edit.on();\n    editor.events.focus(true);\n    editor.selection.restore();\n\n    editor.undo.saveStep();\n\n    // Insert marker and then replace it with the video.\n    if (editor.opts.videoSplitHTML) {\n      editor.markers.split();\n    }\n    else {\n      editor.markers.insert();\n    }\n\n    editor.html.wrap();\n    var $marker = editor.$el.find('.fr-marker');\n\n    // Do not insert video inside emoticon.\n    if (editor.node.isLastSibling($marker) && $marker.parent().hasClass('fr-deletable')) {\n\n      $marker.insertAfter($marker.parent());\n    }\n\n    $marker.replaceWith($video);\n\n    editor.selection.clear();\n\n    if ($video.find('video').get(0).readyState > $video.find('video').get(0).HAVE_FUTURE_DATA || editor.helpers.isIOS()) {\n      loadCallback.call($video.find('video').get(0));\n    }\n    else {\n      $video.find('video').on('canplaythrough load', loadCallback);\n    }\n\n    return $video;\n  }\n\n  /**\n   * Mouse down to start resize.\n   */\n  function _handlerMousedown (e) {\n\n    // Check if resizer belongs to current instance.\n    if (!editor.core.sameInstance($video_resizer)) return true;\n\n    e.preventDefault();\n    e.stopPropagation();\n\n    var c_x = e.pageX || (e.originalEvent.touches ? e.originalEvent.touches[0].pageX : null);\n    var c_y = e.pageY || (e.originalEvent.touches ? e.originalEvent.touches[0].pageY : null);\n\n    if (!c_x || !c_y) {\n\n      return false;\n    }\n\n    // Only on mousedown. This function could be called from keydown on accessibility.\n    if (e.type == 'mousedown') {\n\n      // See if the entire editor is inside iframe to adjust starting offsets.\n      var oel = editor.$oel.get(0);\n      var doc = oel.ownerDocument;\n      var win = doc.defaultView || doc.parentWindow;\n      var editor_inside_iframe = false;\n\n      try {\n        editor_inside_iframe = (win.location != win.parent.location && !(win.$ && win.FE));\n      }\n      catch (ex) {\n      }\n\n      if (editor_inside_iframe && win.frameElement) {\n        c_x += editor.helpers.getPX($(win.frameElement).offset().left) + win.frameElement.clientLeft;\n\n        // Override c_y with clientY attribute.\n        c_y = e.clientY + editor.helpers.getPX($(win.frameElement).offset().top) + win.frameElement.clientTop;\n      }\n    }\n\n    if (!editor.undo.canDo()) editor.undo.saveStep();\n\n    $handler = $(this);\n    $handler.data('start-x', c_x);\n    $handler.data('start-y', c_y);\n    $overlay.show();\n    editor.popups.hideAll();\n\n    _unmarkExit();\n  }\n\n  /**\n   * Do resize.\n   */\n  function _handlerMousemove (e) {\n\n    // Check if resizer belongs to current instance.\n    if (!editor.core.sameInstance($video_resizer)) return true;\n\n    if ($handler) {\n      e.preventDefault()\n\n      var c_x = e.pageX || (e.originalEvent.touches ? e.originalEvent.touches[0].pageX : null);\n      var c_y = e.pageY || (e.originalEvent.touches ? e.originalEvent.touches[0].pageY : null);\n\n      if (!c_x || !c_y) {\n\n        return false;\n      }\n\n      var s_x = $handler.data('start-x');\n      var s_y = $handler.data('start-y');\n\n      $handler.data('start-x', c_x);\n      $handler.data('start-y', c_y);\n\n      var diff_x = c_x - s_x;\n      var diff_y = c_y - s_y;\n\n      var $video_obj = $current_video.find('iframe, embed, video');\n      var width = $video_obj.width();\n      var height = $video_obj.height();\n\n      if ($handler.hasClass('fr-hnw') || $handler.hasClass('fr-hsw')) {\n        diff_x = 0 - diff_x;\n      }\n\n      if ($handler.hasClass('fr-hnw') || $handler.hasClass('fr-hne')) {\n        diff_y = 0 - diff_y;\n      }\n\n      $video_obj.css('width', width + diff_x);\n      $video_obj.css('height', height + diff_y);\n      $video_obj.removeAttr('width');\n      $video_obj.removeAttr('height');\n\n      _repositionResizer();\n    }\n  }\n\n  /**\n   * Stop resize.\n   */\n  function _handlerMouseup (e) {\n\n    // Check if resizer belongs to current instance.\n    if (!editor.core.sameInstance($video_resizer)) return true;\n\n    if ($handler && $current_video) {\n      if (e) e.stopPropagation();\n      $handler = null;\n      $overlay.hide();\n      _repositionResizer();\n      _showEditPopup();\n\n      editor.undo.saveStep();\n    }\n  }\n\n  /**\n   * Create resize handler.\n   */\n  function _getHandler (pos) {\n\n    return '<div class=\"fr-handler fr-h' + pos + '\"></div>';\n  }\n\n  function _resizeVideo (e, initPageX, direction, step) {\n    e.pageX = initPageX;\n    e.pageY = initPageX;\n    _handlerMousedown.call(this, e);\n    e.pageX = e.pageX + direction * Math.floor(Math.pow(1.1, step));\n    e.pageY = e.pageY + direction * Math.floor(Math.pow(1.1, step));\n    _handlerMousemove.call(this, e);\n    _handlerMouseup.call(this, e);\n\n    return ++step;\n  }\n\n  /**\n   * Init video resizer.\n   */\n  function _initResizer () {\n    var doc;\n\n    // No shared video resizer.\n    if (!editor.shared.$video_resizer) {\n\n      // Create shared video resizer.\n      editor.shared.$video_resizer = $('<div class=\"fr-video-resizer\"></div>');\n      $video_resizer = editor.shared.$video_resizer;\n\n      // Bind mousedown event shared.\n      editor.events.$on($video_resizer, 'mousedown', function (e) {\n        e.stopPropagation();\n      }, true);\n\n      // video resize is enabled.\n      if (editor.opts.videoResize) {\n        $video_resizer.append(_getHandler('nw') + _getHandler('ne') + _getHandler('sw') + _getHandler('se'));\n\n        // Add video resizer overlay and set it.\n        editor.shared.$vid_overlay = $('<div class=\"fr-video-overlay\"></div>');\n        $overlay = editor.shared.$vid_overlay;\n        doc = $video_resizer.get(0).ownerDocument;\n        $(doc).find('body').first().append($overlay);\n      }\n    }\n    else {\n      $video_resizer = editor.shared.$video_resizer;\n      $overlay = editor.shared.$vid_overlay;\n\n      editor.events.on('destroy', function () {\n        $video_resizer.removeClass('fr-active').appendTo($('body').first());\n      }, true);\n    }\n\n    // Shared destroy.\n    editor.events.on('shared.destroy', function () {\n      $video_resizer.html('').removeData().remove();\n      $video_resizer = null;\n\n      if (editor.opts.videoResize) {\n        $overlay.remove();\n        $overlay = null;\n      }\n    }, true);\n\n    // Window resize. Exit from edit.\n    if (!editor.helpers.isMobile()) {\n      editor.events.$on($(editor.o_win), 'resize.video', function () {\n        _exitEdit(true);\n      });\n    }\n\n    // video resize is enabled.\n    if (editor.opts.videoResize) {\n      doc = $video_resizer.get(0).ownerDocument;\n\n      editor.events.$on($video_resizer, editor._mousedown, '.fr-handler', _handlerMousedown);\n      editor.events.$on($(doc), editor._mousemove, _handlerMousemove);\n      editor.events.$on($(doc.defaultView || doc.parentWindow), editor._mouseup, _handlerMouseup);\n\n      editor.events.$on($overlay, 'mouseleave', _handlerMouseup);\n\n\n      // Accessibility.\n\n      // Used for keys holing.\n      var step = 1;\n      var prevKey = null;\n      var prevTimestamp = 0;\n\n      // Keydown event.\n      editor.events.on('keydown', function (e) {\n        if ($current_video) {\n          var ctrlKey = navigator.userAgent.indexOf('Mac OS X') != -1 ? e.metaKey : e.ctrlKey;\n          var keycode = e.which;\n\n          if (keycode !== prevKey || e.timeStamp - prevTimestamp > 200) {\n            step = 1;\n\n            // Reset step. Known browser issue: Keyup does not trigger when ctrl is pressed.\n          }\n\n          // Increase video size.\n          if ((keycode == FE.KEYCODE.EQUALS || (editor.browser.mozilla && keycode == FE.KEYCODE.FF_EQUALS)) && ctrlKey && !e.altKey) {\n            step = _resizeVideo.call(this, e, 1, 1, step);\n          }\n\n          // Decrease video size.\n          else if ((keycode == FE.KEYCODE.HYPHEN || (editor.browser.mozilla && keycode == FE.KEYCODE.FF_HYPHEN)) && ctrlKey && !e.altKey) {\n            step = _resizeVideo.call(this, e, 2, -1, step);\n          }\n\n          // Save key code.\n          prevKey = keycode;\n\n          // Save timestamp.\n          prevTimestamp = e.timeStamp;\n        }\n      });\n\n      // Reset the step on key up event.\n      editor.events.on('keyup', function () {\n        step = 1;\n      });\n    }\n  }\n\n  /**\n   * Keep videos in sync when content changed.\n   */\n  var videos;\n\n  function _syncVideos () {\n\n    // Get current videos.\n    var c_videos = Array.prototype.slice.call(editor.el.querySelectorAll('video, .fr-video > *'));\n\n    // Current videos src.\n    var video_srcs = [];\n    var i;\n\n    for (i = 0; i < c_videos.length; i++) {\n      video_srcs.push(c_videos[i].getAttribute('src'));\n\n      $(c_videos[i]).toggleClass('fr-draggable', editor.opts.videoMove);\n\n      if (c_videos[i].getAttribute('class') === '') c_videos[i].removeAttribute('class');\n\n      if (c_videos[i].getAttribute('style') === '') c_videos[i].removeAttribute('style');\n    }\n\n    // Loop previous videos and check their src.\n    if (videos) {\n      for (i = 0; i < videos.length; i++) {\n        if (video_srcs.indexOf(videos[i].getAttribute('src')) < 0) {\n          editor.events.trigger('video.removed', [$(videos[i])]);\n        }\n      }\n    }\n\n    // Current videos are the old ones.\n    videos = c_videos;\n  }\n\n  /**\n   * Reposition resizer.\n   */\n  function _repositionResizer () {\n    if (!$video_resizer) _initResizer();\n\n    (editor.$wp || editor.$sc).append($video_resizer);\n    $video_resizer.data('instance', editor);\n\n    var $video_obj = $current_video.find('iframe, embed, video');\n\n    $video_resizer\n      .css('top', (editor.opts.iframe ? $video_obj.offset().top - 1 : $video_obj.offset().top - editor.$wp.offset().top - 1) + editor.$wp.scrollTop())\n      .css('left', (editor.opts.iframe ? $video_obj.offset().left - 1 : $video_obj.offset().left - editor.$wp.offset().left - 1) + editor.$wp.scrollLeft())\n      .css('width', $video_obj.get(0).getBoundingClientRect().width)\n      .css('height', $video_obj.get(0).getBoundingClientRect().height)\n      .addClass('fr-active');\n  }\n\n  /**\n   * Edit video.\n   */\n  var touchScroll;\n\n  function _edit (e) {\n    if (e && e.type == 'touchend' && touchScroll) {\n\n      return true;\n    }\n\n    if (e && editor.edit.isDisabled()) {\n      e.stopPropagation();\n      e.preventDefault();\n\n      return false;\n    }\n\n    if (editor.edit.isDisabled()) {\n\n      return false;\n    }\n\n    // Hide resizer for other instances.\n    for (var i = 0; i < FE.INSTANCES.length; i++) {\n      if (FE.INSTANCES[i] != editor) {\n        FE.INSTANCES[i].events.trigger('video.hideResizer');\n      }\n    }\n\n    editor.toolbar.disable();\n\n    // Hide keyboard.\n    if (editor.helpers.isMobile()) {\n      editor.events.disableBlur();\n      editor.$el.blur();\n      editor.events.enableBlur();\n    }\n\n    // Unselect all other videos.\n    editor.$el.find('.fr-video.fr-active').removeClass('fr-active');\n\n    $current_video = $(this);\n    $current_video.addClass('fr-active');\n\n    if (editor.opts.iframe) {\n      editor.size.syncIframe();\n    }\n\n    _selectVideo()\n    _repositionResizer();\n    _showEditPopup();\n\n    editor.selection.clear();\n    editor.button.bulkRefresh();\n\n    editor.events.trigger('image.hideResizer');\n  }\n\n  /**\n   * Exit edit.\n   */\n  function _exitEdit (force_exit) {\n    if ($current_video && (_canExit() || force_exit === true)) {\n      $video_resizer.removeClass('fr-active');\n\n      editor.toolbar.enable();\n\n      $current_video.removeClass('fr-active');\n      $current_video = null;\n\n      _unmarkExit();\n    }\n  }\n\n  editor.shared.vid_exit_flag = false;\n\n  function _markExit () {\n    editor.shared.vid_exit_flag = true;\n  }\n\n  function _unmarkExit () {\n    editor.shared.vid_exit_flag = false;\n  }\n\n  function _canExit () {\n\n    return editor.shared.vid_exit_flag;\n  }\n\n  function _drop (e) {\n\n    // Check if we are dropping files.\n    var dt = e.originalEvent.dataTransfer;\n\n    if (dt && dt.files && dt.files.length) {\n      var vid = dt.files[0];\n\n      if (vid && vid.type && vid.type.indexOf('video') !== -1) {\n        if (!editor.opts.videoUpload) {\n          e.preventDefault();\n          e.stopPropagation();\n\n          return false;\n        }\n\n\n        editor.markers.remove();\n        editor.markers.insertAtPoint(e.originalEvent);\n        editor.$el.find('.fr-marker').replaceWith(FE.MARKERS);\n\n        // Hide popups.\n        editor.popups.hideAll();\n\n        // Show the video insert popup.\n        var $popup = editor.popups.get('video.insert');\n\n        if (!$popup) $popup = _initInsertPopup();\n        editor.popups.setContainer('video.insert', editor.$sc);\n        editor.popups.show('video.insert', e.originalEvent.pageX, e.originalEvent.pageY);\n        showProgressBar();\n\n        // Dropped file is an video that we allow.\n        if (editor.opts.videoAllowedTypes.indexOf(vid.type.replace(/video\\//g, '')) >= 0) {\n\n          // Upload videos.\n          upload(dt.files);\n        }\n        else {\n          _throwError(BAD_FILE_TYPE);\n        }\n\n        // Cancel anything else.\n        e.preventDefault();\n        e.stopPropagation();\n\n        return false;\n      }\n    }\n  }\n\n  /**\n   * Do video upload.\n   */\n  function upload (videos) {\n\n    // Make sure we have what to upload.\n    if (typeof videos != 'undefined' && videos.length > 0) {\n\n      // Check if we should cancel the video upload.\n      if (editor.events.trigger('video.beforeUpload', [videos]) === false) {\n\n        return false;\n      }\n\n      var video = videos[0];\n\n      // Check video max size.\n      if (video.size > editor.opts.videoMaxSize) {\n        _throwError(MAX_SIZE_EXCEEDED);\n\n        return false;\n      }\n\n      // Check video types.\n      if (editor.opts.videoAllowedTypes.indexOf(video.type.replace(/video\\//g, '')) < 0) {\n        _throwError(BAD_FILE_TYPE);\n\n        return false;\n      }\n\n      // Create form Data.\n      var form_data;\n\n      if (editor.drag_support.formdata) {\n        form_data = editor.drag_support.formdata ? new FormData() : null;\n      }\n\n      // Prepare form data for request.\n      if (form_data) {\n        var key;\n\n        // Upload to S3.\n        if (editor.opts.videoUploadToS3 !== false) {\n          form_data.append('key', editor.opts.videoUploadToS3.keyStart + (new Date()).getTime() + '-' + (video.name || 'untitled'));\n          form_data.append('success_action_status', '201');\n          form_data.append('X-Requested-With', 'xhr');\n          form_data.append('Content-Type', video.type);\n\n          for (key in editor.opts.videoUploadToS3.params) {\n            if (Object.prototype.hasOwnProperty.call(editor.opts.videoUploadToS3.params, key)) {\n              form_data.append(key, editor.opts.videoUploadToS3.params[key]);\n            }\n          }\n        }\n\n        // Add upload params.\n        for (key in editor.opts.videoUploadParams) {\n          if (Object.prototype.hasOwnProperty.call(editor.opts.videoUploadParams, key)) {\n            form_data.append(key, editor.opts.videoUploadParams[key]);\n          }\n        }\n\n        // Set the video in the request.\n        form_data.append(editor.opts.videoUploadParam, video);\n\n        // Create XHR request.\n        var url = editor.opts.videoUploadURL;\n\n        if (editor.opts.videoUploadToS3) {\n          if (editor.opts.videoUploadToS3.uploadURL) {\n            url = editor.opts.videoUploadToS3.uploadURL;\n          }\n          else {\n            url = 'https://' + editor.opts.videoUploadToS3.region + '.amazonaws.com/' + editor.opts.videoUploadToS3.bucket;\n          }\n        }\n\n        var xhr = editor.core.getXHR(url, editor.opts.videoUploadMethod);\n\n        // Set upload events.\n        xhr.onload = function () {\n          _videoUploaded.call(xhr, $current_video);\n        };\n        xhr.onerror = _videoUploadError;\n        xhr.upload.onprogress = _videoUploadProgress;\n        xhr.onabort = _videoUploadAborted;\n\n        showProgressBar();\n        editor.events.disableBlur();\n        editor.edit.off();\n        editor.events.enableBlur();\n\n        var $popup = editor.popups.get('video.insert');\n\n        if ($popup) {\n          $popup.off('abortUpload').on('abortUpload', function () {\n            if (xhr.readyState != 4) {\n              xhr.abort();\n            }\n          })\n        }\n\n        // Send data.\n        xhr.send(form_data);\n      }\n    }\n  }\n\n  /**\n   * Video drop inside the upload zone.\n   */\n\n  function _bindInsertEvents ($popup) {\n\n    // Drag over the dropable area.\n    editor.events.$on($popup, 'dragover dragenter', '.fr-video-upload-layer', function () {\n      $(this).addClass('fr-drop');\n\n      return false;\n    }, true);\n\n    // Drag end.\n    editor.events.$on($popup, 'dragleave dragend', '.fr-video-upload-layer', function () {\n      $(this).removeClass('fr-drop');\n\n      return false;\n    }, true);\n\n    // Drop.\n    editor.events.$on($popup, 'drop', '.fr-video-upload-layer', function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n\n      $(this).removeClass('fr-drop');\n\n      var dt = e.originalEvent.dataTransfer;\n\n      if (dt && dt.files) {\n        var inst = $popup.data('instance') || editor;\n        inst.events.disableBlur();\n        inst.video.upload(dt.files);\n        inst.events.enableBlur();\n      }\n    }, true);\n\n    if (editor.helpers.isIOS()) {\n      editor.events.$on($popup, 'touchstart', '.fr-video-upload-layer input[type=\"file\"]', function () {\n        $(this).trigger('click');\n      }, true);\n    }\n\n    editor.events.$on($popup, 'change', '.fr-video-upload-layer input[type=\"file\"]', function () {\n      if (this.files) {\n        var inst = $popup.data('instance') || editor;\n        inst.events.disableBlur();\n        $popup.find('input:focus').blur();\n        inst.events.enableBlur();\n        inst.video.upload(this.files);\n      }\n\n      // Else IE 9 case.\n      // Chrome fix.\n      $(this).val('');\n    }, true);\n  }\n\n  /**\n   * Init the video events.\n   */\n  function _initEvents () {\n\n    // Drop inside the editor.\n    editor.events.on('drop', _drop, true);\n\n    editor.events.on('mousedown window.mousedown', _markExit);\n    editor.events.on('window.touchmove', _unmarkExit);\n    editor.events.on('mouseup window.mouseup', _exitEdit);\n\n    editor.events.on('commands.mousedown', function ($btn) {\n      if ($btn.parents('.fr-toolbar').length > 0) {\n        _exitEdit();\n      }\n    });\n\n    editor.events.on('video.hideResizer commands.undo commands.redo element.dropped', function () {\n      _exitEdit(true);\n    });\n  }\n\n  /**\n   * Throw a video error.\n   */\n\n  function _throwError (code, response) {\n    editor.edit.on();\n\n    if ($current_video) $current_video.find('video').addClass('fr-error');\n    _showErrorMessage(editor.language.translate('Something went wrong. Please try again.'));\n\n    editor.events.trigger('video.error', [{\n        code: code,\n        message: error_messages[code]\n      },\n      response\n    ]);\n  }\n\n  /**\n   * Init the video edit popup.\n   */\n  function _initEditPopup () {\n\n    // Video buttons.\n    var video_buttons = '';\n\n    if (editor.opts.videoEditButtons.length > 0) {\n      video_buttons += '<div class=\"fr-buttons\">';\n      video_buttons += editor.button.buildList(editor.opts.videoEditButtons);\n      video_buttons += '</div>';\n\n      var template = {\n        buttons: video_buttons\n      }\n\n      var $popup = editor.popups.create('video.edit', template);\n\n      editor.events.$on(editor.$wp, 'scroll.video-edit', function () {\n        if ($current_video && editor.popups.isVisible('video.edit')) {\n\n          editor.events.disableBlur();\n          _editVideo($current_video);\n        }\n      });\n\n      return $popup;\n    }\n\n    return false;\n  }\n\n  /**\n   * Refresh the size popup.\n   */\n  function _refreshSizePopup () {\n    if ($current_video) {\n      var $popup = editor.popups.get('video.size');\n      var $video_obj = $current_video.find('iframe, embed, video')\n      $popup.find('input[name=\"width\"]').val($video_obj.get(0).style.width || $video_obj.attr('width')).trigger('change');\n      $popup.find('input[name=\"height\"]').val($video_obj.get(0).style.height || $video_obj.attr('height')).trigger('change');\n    }\n  }\n\n  /**\n   * Show the size popup.\n   */\n  function showSizePopup () {\n    var $popup = editor.popups.get('video.size');\n\n    if (!$popup) $popup = _initSizePopup();\n    hideProgressBar();\n    editor.popups.refresh('video.size');\n    editor.popups.setContainer('video.size', editor.$sc);\n    var $video_obj = $current_video.find('iframe, embed, video')\n    var left = $video_obj.offset().left + $video_obj.width() / 2;\n    var top = $video_obj.offset().top + $video_obj.height();\n\n    editor.popups.show('video.size', left, top, $video_obj.height());\n  }\n\n  /**\n   * Init the video upload popup.\n   */\n  function _initSizePopup (delayed) {\n    if (delayed) {\n      editor.popups.onRefresh('video.size', _refreshSizePopup);\n\n      return true;\n    }\n\n    // Video buttons.\n    var video_buttons = '';\n    video_buttons = '<div class=\"fr-buttons\">' + editor.button.buildList(editor.opts.videoSizeButtons) + '</div>';\n\n    // Size layer.\n    var size_layer = '';\n    size_layer = '<div class=\"fr-video-size-layer fr-layer fr-active\" id=\"fr-video-size-layer-' + editor.id + '\"><div class=\"fr-video-group\"><div class=\"fr-input-line\"><input id=\"fr-video-size-layer-width-' + editor.id + '\" type=\"text\" name=\"width\" placeholder=\"' + editor.language.translate('Width') + '\" tabIndex=\"1\"></div><div class=\"fr-input-line\"><input id=\"fr-video-size-layer-height-' + editor.id + '\" type=\"text\" name=\"height\" placeholder=\"' + editor.language.translate('Height') + '\" tabIndex=\"1\"></div></div><div class=\"fr-action-buttons\"><button type=\"button\" class=\"fr-command fr-submit\" data-cmd=\"videoSetSize\" tabIndex=\"2\" role=\"button\">' + editor.language.translate('Update') + '</button></div></div>';\n\n    var template = {\n      buttons: video_buttons,\n      size_layer: size_layer\n    }\n\n    // Set the template in the popup.\n    var $popup = editor.popups.create('video.size', template);\n\n    editor.events.$on(editor.$wp, 'scroll', function () {\n      if ($current_video && editor.popups.isVisible('video.size')) {\n\n        editor.events.disableBlur();\n        _editVideo($current_video);\n      }\n    });\n\n    return $popup;\n  }\n\n  /**\n   * Get video alignment.\n   */\n  function getAlign ($video) {\n    if (typeof $video == 'undefined') $video = $current_video;\n\n    if ($video) {\n\n      // Video has left class.\n      if ($video.hasClass('fr-fvl')) {\n\n        return 'left';\n      }\n\n      // Video has right class.\n      else if ($video.hasClass('fr-fvr')) {\n\n        return 'right';\n      }\n\n      // Video has display class set.\n      else if ($video.hasClass('fr-dvb') || $video.hasClass('fr-dvi')) {\n\n        return 'center';\n      }\n      else {\n\n        // Video has display block.\n        if ($video.css('display') == 'block') {\n\n          // Margin left is 0.\n          // Margin right is auto.\n          if ($video.css('text-algin') == 'left') {\n            return 'left';\n          }\n\n          // Margin left is auto.\n          // Margin right is 0.\n          else if ($video.css('text-align') == 'right') {\n            return 'right';\n          }\n        }\n\n        // Display inline.\n        else {\n\n          // Float left.\n          if ($video.css('float') == 'left') {\n            return 'left';\n          }\n\n          // Float right.\n          else if ($video.css('float') == 'right') {\n            return 'right';\n          }\n        }\n      }\n    }\n\n    return 'center';\n  }\n\n  /**\n   * Align video.\n   */\n  function align (val) {\n    $current_video.removeClass('fr-fvr fr-fvl');\n\n    // Easy case. Use classes.\n    if (!editor.opts.htmlUntouched && editor.opts.useClasses) {\n      if (val == 'left') {\n        $current_video.addClass('fr-fvl');\n      }\n      else if (val == 'right') {\n        $current_video.addClass('fr-fvr');\n      }\n    }\n    else {\n      _setStyle($current_video, getDisplay(), val);\n    }\n\n    _selectVideo()\n    _repositionResizer();\n    _showEditPopup();\n    editor.selection.clear();\n  }\n\n  /**\n   * Refresh the align icon.\n   */\n  function refreshAlign ($btn) {\n    if (!$current_video) return false;\n\n    $btn.find('> *').first().replaceWith(editor.icon.create('video-align-' + getAlign()));\n  }\n\n  /**\n   * Refresh the align option from the dropdown.\n   */\n  function refreshAlignOnShow ($btn, $dropdown) {\n    if ($current_video) {\n      $dropdown.find('.fr-command[data-param1=\"' + getAlign() + '\"]').addClass('fr-active').attr('aria-selected', true);\n    }\n  }\n\n  /**\n   * Get video display.\n   */\n  function getDisplay ($video) {\n    if (typeof $video == 'undefined') $video = $current_video;\n\n    // Set float to none.\n    var flt = $video.css('float');\n    $video.css('float', 'none');\n\n    // Video has display block.\n    if ($video.css('display') == 'block') {\n\n      // Set float to the initial value.\n      $video.css('float', '');\n\n      if ($video.css('float') != flt) $video.css('float', flt);\n\n      return 'block';\n    }\n\n    // Display inline.\n    else {\n\n      // Set float.\n      $video.css('float', '');\n\n      if ($video.css('float') != flt) $video.css('float', flt);\n\n      return 'inline';\n    }\n\n    return 'inline';\n  }\n\n\n  /**\n   * Set video display.\n   */\n  function display (val) {\n    $current_video.removeClass('fr-dvi fr-dvb');\n\n    // Easy case. Use classes.\n    if (!editor.opts.htmlUntouched && editor.opts.useClasses) {\n      if (val == 'inline') {\n        $current_video.addClass('fr-dvi');\n      }\n      else if (val == 'block') {\n        $current_video.addClass('fr-dvb');\n      }\n    }\n    else {\n      _setStyle($current_video, val, getAlign());\n    }\n\n    _selectVideo()\n    _repositionResizer();\n    _showEditPopup();\n    editor.selection.clear();\n  }\n\n  /**\n   * Refresh the video display selected option.\n   */\n  function refreshDisplayOnShow ($btn, $dropdown) {\n    if ($current_video) {\n      $dropdown.find('.fr-command[data-param1=\"' + getDisplay() + '\"]').addClass('fr-active').attr('aria-selected', true);\n    }\n  }\n\n  /**\n   * Show the replace popup.\n   */\n\n  function replace () {\n    var $popup = editor.popups.get('video.insert');\n\n    if (!$popup) $popup = _initInsertPopup();\n\n    if (!editor.popups.isVisible('video.insert')) {\n      hideProgressBar();\n      editor.popups.refresh('video.insert');\n      editor.popups.setContainer('video.insert', editor.$sc);\n    }\n\n    var left = $current_video.offset().left + $current_video.width() / 2;\n    var top = $current_video.offset().top + $current_video.height();\n\n    editor.popups.show('video.insert', left, top, $current_video.outerHeight());\n  }\n\n  /**\n   * Remove current selected video.\n   */\n  function remove () {\n    if ($current_video) {\n      if (editor.events.trigger('video.beforeRemove', [$current_video]) !== false) {\n        var $video = $current_video;\n        editor.popups.hideAll();\n        _exitEdit(true);\n\n        editor.selection.setBefore($video.get(0)) || editor.selection.setAfter($video.get(0));\n        $video.remove();\n        editor.selection.restore();\n\n        editor.html.fillEmptyBlocks();\n\n        editor.events.trigger('video.removed', [$video]);\n      }\n    }\n  }\n\n  /**\n   * Hide image upload popup.\n   */\n\n  function _hideInsertPopup () {\n    hideProgressBar();\n  }\n\n  function _setStyle ($video, _display, _align) {\n    if (!editor.opts.htmlUntouched && editor.opts.useClasses) {\n      $video.removeClass('fr-fvl fr-fvr fr-dvb fr-dvi');\n      $video.addClass('fr-fv' + _align[0] + ' fr-dv' + _display[0]);\n    }\n    else {\n      if (_display == 'inline') {\n        $video.css({\n          display: 'inline-block'\n        })\n\n        if (_align == 'center') {\n          $video.css({\n            'float': 'none'\n          })\n        }\n        else if (_align == 'left') {\n          $video.css({\n            'float': 'left'\n          })\n        }\n        else {\n          $video.css({\n            'float': 'right'\n          })\n        }\n      }\n      else {\n        $video.css({\n          display: 'block',\n          clear: 'both'\n        })\n\n        if (_align == 'left') {\n          $video.css({\n            textAlign: 'left'\n          })\n        }\n        else if (_align == 'right') {\n          $video.css({\n            textAlign: 'right'\n          })\n        }\n        else {\n          $video.css({\n            textAlign: 'center'\n          })\n        }\n      }\n    }\n  }\n\n  /**\n   * Convert style to classes.\n   */\n  function _convertStyleToClasses ($video) {\n    if (!$video.hasClass('fr-dvi') && !$video.hasClass('fr-dvb')) {\n      $video.addClass('fr-fv' + getAlign($video)[0]);\n      $video.addClass('fr-dv' + getDisplay($video)[0]);\n    }\n  }\n\n  /**\n   * Convert classes to style.\n   */\n  function _convertClassesToStyle ($video) {\n    var d = $video.hasClass('fr-dvb') ? 'block' : $video.hasClass('fr-dvi') ? 'inline' : null;\n    var a = $video.hasClass('fr-fvl') ? 'left' : $video.hasClass('fr-fvr') ? 'right' : getAlign($video);\n\n    _setStyle($video, d, a);\n\n    $video.removeClass('fr-dvb fr-dvi fr-fvr fr-fvl');\n  }\n\n  /**\n   * Refresh video list.\n   */\n  function _refreshVideoList () {\n\n    // Find possible candidates that are not wrapped.\n    editor.$el.find('video').filter(function () {\n\n      return $(this).parents('span.fr-video').length === 0;\n    }).each(function () {\n      this.outerHTML = `<span class=\"fr-video\" contenteditable=\"false\">${this.outerHTML}</span>`\n    });\n\n    editor.$el.find('embed, iframe').filter(function () {\n      if (editor.browser.safari && this.getAttribute('src')) {\n        this.setAttribute('src', this.src);\n      }\n\n      if ($(this).parents('span.fr-video').length > 0) return false;\n\n      var link = $(this).attr('src');\n\n      for (var i = 0; i < FE.VIDEO_PROVIDERS.length; i++) {\n        var vp = FE.VIDEO_PROVIDERS[i];\n\n        // Check if video provider is allowed.\n        if (vp.test_regex.test(link) && (new RegExp(editor.opts.videoAllowedProviders.join('|'))).test(vp.provider)) {\n\n          return true;\n        }\n      }\n\n      return false;\n    }).each(function () {\n      const el = $(this).parents('object').length === 0 ? this : $(this).parents('object').get(0);\n\n      el.outerHTML = `<span class=\"fr-video\" contenteditable=\"false\">${el.outerHTML}</span>`\n    })\n\n    var videos = editor.$el.find('span.fr-video, video');\n\n    for (var i = 0; i < videos.length; i++) {\n      var $video = $(videos[i]);\n\n      if (!editor.opts.htmlUntouched && editor.opts.useClasses) {\n        _convertStyleToClasses($video);\n\n        if (!editor.opts.videoTextNear) {\n          $video.removeClass('fr-dvi').addClass('fr-dvb');\n        }\n      }\n      else if (!editor.opts.htmlUntouched && !editor.opts.useClasses) {\n        _convertClassesToStyle($video);\n      }\n    }\n\n    videos.toggleClass('fr-draggable', editor.opts.videoMove);\n  }\n\n  function _init () {\n    _initEvents();\n\n    if (editor.helpers.isMobile()) {\n      editor.events.$on(editor.$el, 'touchstart', 'span.fr-video', function () {\n        touchScroll = false;\n      })\n\n      editor.events.$on(editor.$el, 'touchmove', function () {\n        touchScroll = true;\n      });\n    }\n\n    editor.events.on('html.set', _refreshVideoList);\n    _refreshVideoList();\n\n    editor.events.$on(editor.$el, 'mousedown', 'span.fr-video', function (e) {\n      e.stopPropagation();\n    })\n    editor.events.$on(editor.$el, 'click touchend', 'span.fr-video', function (e) {\n      if ($(this).parents('[contenteditable]:not(.fr-element):not(.fr-img-caption):not(body)').first().attr('contenteditable') == 'false') return true;\n\n      _edit.call(this, e);\n    });\n\n    editor.events.on('keydown', function (e) {\n      var key_code = e.which;\n\n      if ($current_video && (key_code == FE.KEYCODE.BACKSPACE || key_code == FE.KEYCODE.DELETE)) {\n        e.preventDefault();\n        remove();\n        editor.undo.saveStep();\n\n        return false;\n      }\n\n      if ($current_video && key_code == FE.KEYCODE.ESC) {\n        _exitEdit(true);\n        e.preventDefault();\n\n        return false;\n      }\n\n      if ($current_video && key_code != FE.KEYCODE.F10 && !editor.keys.isBrowserAction(e)) {\n        e.preventDefault();\n\n        return false;\n      }\n    }, true);\n\n    // ESC from accessibility.\n    editor.events.on('toolbar.esc', function () {\n      if ($current_video) {\n        editor.events.disableBlur();\n        editor.events.focus();\n\n        return false;\n      }\n    }, true);\n\n    // focusEditor from accessibility.\n    editor.events.on('toolbar.focusEditor', function () {\n      if ($current_video) {\n\n        return false;\n      }\n    }, true);\n\n    // Make sure we don't leave empty tags.\n    editor.events.on('keydown', function () {\n      editor.$el.find('span.fr-video:empty').remove();\n    })\n\n    if (editor.$wp) {\n      _syncVideos();\n      editor.events.on('contentChanged', _syncVideos);\n    }\n\n    _initInsertPopup(true);\n    _initSizePopup(true);\n  }\n\n  /**\n   * Place selection around current video.\n   */\n  function _selectVideo () {\n    if ($current_video) {\n      editor.selection.clear();\n      var range = editor.doc.createRange();\n      range.selectNode($current_video.get(0));\n      var selection = editor.selection.get();\n      selection.addRange(range);\n    }\n  }\n\n  /**\n   * Get back to the video main popup.\n   */\n  function back () {\n    if ($current_video) {\n      editor.events.disableBlur();\n      $current_video.trigger('click');\n    }\n    else {\n      editor.events.disableBlur();\n      editor.selection.restore();\n      editor.events.enableBlur();\n\n      editor.popups.hide('video.insert');\n      editor.toolbar.showInline();\n    }\n  }\n\n  /**\n   * Set size based on the current video size.\n   */\n  function setSize (width, height) {\n    if ($current_video) {\n      var $popup = editor.popups.get('video.size');\n      var $video_obj = $current_video.find('iframe, embed, video');\n      $video_obj.css('width', width || $popup.find('input[name=\"width\"]').val());\n      $video_obj.css('height', height || $popup.find('input[name=\"height\"]').val());\n\n      if ($video_obj.get(0).style.width) $video_obj.removeAttr('width');\n\n      if ($video_obj.get(0).style.height) $video_obj.removeAttr('height');\n\n      $popup.find('input:focus').blur();\n      setTimeout(function () {\n        $current_video.trigger('click');\n      }, editor.helpers.isAndroid() ? 50 : 0);\n    }\n  }\n\n  function get () {\n\n    return $current_video;\n  }\n\n  return {\n    _init: _init,\n    showInsertPopup: showInsertPopup,\n    showLayer: showLayer,\n    refreshByURLButton: refreshByURLButton,\n    refreshEmbedButton: refreshEmbedButton,\n    refreshUploadButton: refreshUploadButton,\n    upload: upload,\n    insertByURL: insertByURL,\n    insertEmbed: insertEmbed,\n    insert: insert,\n    align: align,\n    refreshAlign: refreshAlign,\n    refreshAlignOnShow: refreshAlignOnShow,\n    display: display,\n    refreshDisplayOnShow: refreshDisplayOnShow,\n    remove: remove,\n    hideProgressBar: hideProgressBar,\n    showSizePopup: showSizePopup,\n    replace: replace,\n    back: back,\n    setSize: setSize,\n    get: get\n  }\n}\n\n// Register the font size command.\nFE.RegisterCommand('insertVideo', {\n  title: 'Insert Video',\n  undo: false,\n  focus: true,\n  refreshAfterCallback: false,\n  popup: true,\n  callback: function () {\n    if (!this.popups.isVisible('video.insert')) {\n      this.video.showInsertPopup();\n    }\n    else {\n      if (this.$el.find('.fr-marker').length) {\n        this.events.disableBlur();\n        this.selection.restore();\n      }\n      this.popups.hide('video.insert');\n    }\n  },\n  plugin: 'video'\n})\n\n// Add the font size icon.\nFE.DefineIcon('insertVideo', {\n  NAME: 'video-camera',\n  FA5NAME: 'camera'\n});\n\n// Video by URL button inside the insert video popup.\nFE.DefineIcon('videoByURL', { NAME: 'link' });\nFE.RegisterCommand('videoByURL', {\n  title: 'By URL',\n  undo: false,\n  focus: false,\n  toggle: true,\n  callback: function () {\n    this.video.showLayer('video-by-url');\n  },\n  refresh: function ($btn) {\n    this.video.refreshByURLButton($btn);\n  }\n})\n\n// Video embed button inside the insert video popup.\nFE.DefineIcon('videoEmbed', { NAME: 'code' });\nFE.RegisterCommand('videoEmbed', {\n  title: 'Embedded Code',\n  undo: false,\n  focus: false,\n  toggle: true,\n  callback: function () {\n    this.video.showLayer('video-embed');\n  },\n  refresh: function ($btn) {\n    this.video.refreshEmbedButton($btn);\n  }\n})\n\n// Video upload button inside the insert video popup.\nFE.DefineIcon('videoUpload', { NAME: 'upload' });\nFE.RegisterCommand('videoUpload', {\n  title: 'Upload Video',\n  undo: false,\n  focus: false,\n  toggle: true,\n  callback: function () {\n    this.video.showLayer('video-upload');\n  },\n  refresh: function ($btn) {\n    this.video.refreshUploadButton($btn);\n  }\n})\n\nFE.RegisterCommand('videoInsertByURL', {\n  undo: true,\n  focus: true,\n  callback: function () {\n    this.video.insertByURL();\n  }\n})\n\nFE.RegisterCommand('videoInsertEmbed', {\n  undo: true,\n  focus: true,\n  callback: function () {\n    this.video.insertEmbed();\n  }\n})\n\n// Video display.\nFE.DefineIcon('videoDisplay', { NAME: 'star' })\nFE.RegisterCommand('videoDisplay', {\n  title: 'Display',\n  type: 'dropdown',\n  options: {\n    inline: 'Inline',\n    block: 'Break Text'\n  },\n  callback: function (cmd, val) {\n    this.video.display(val);\n  },\n  refresh: function ($btn) {\n    if (!this.opts.videoTextNear) $btn.addClass('fr-hidden');\n  },\n  refreshOnShow: function ($btn, $dropdown) {\n    this.video.refreshDisplayOnShow($btn, $dropdown);\n  }\n})\n\n// Video align.\nFE.DefineIcon('video-align', { NAME: 'align-left' });\nFE.DefineIcon('video-align-left', { NAME: 'align-left' });\nFE.DefineIcon('video-align-right', { NAME: 'align-right' });\nFE.DefineIcon('video-align-center', { NAME: 'align-justify' });\n\n// Video align.\nFE.DefineIcon('videoAlign', { NAME: 'align-center' })\nFE.RegisterCommand('videoAlign', {\n  type: 'dropdown',\n  title: 'Align',\n  options: {\n    left: 'Align Left',\n    center: 'None',\n    right: 'Align Right'\n  },\n  html: function () {\n    var c = '<ul class=\"fr-dropdown-list\" role=\"presentation\">';\n    var options =  FE.COMMANDS.videoAlign.options;\n\n    for (var val in options) {\n      if (Object.prototype.hasOwnProperty.call(options, val)) {\n        c += '<li role=\"presentation\"><a class=\"fr-command fr-title\" tabIndex=\"-1\" role=\"option\" data-cmd=\"videoAlign\" data-param1=\"' + val + '\" title=\"' + this.language.translate(options[val]) + '\">' + this.icon.create('video-align-' + val) + '<span class=\"fr-sr-only\">' + this.language.translate(options[val]) + '</span></a></li>';\n      }\n    }\n    c += '</ul>';\n\n    return c;\n  },\n  callback: function (cmd, val) {\n    this.video.align(val);\n  },\n  refresh: function ($btn) {\n    this.video.refreshAlign($btn);\n  },\n  refreshOnShow: function ($btn, $dropdown) {\n    this.video.refreshAlignOnShow($btn, $dropdown);\n  }\n})\n\n// Video replace.\nFE.DefineIcon('videoReplace', {\n  NAME: 'exchange'\n})\nFE.RegisterCommand('videoReplace', {\n  title: 'Replace',\n  undo: false,\n  focus: false,\n  popup: true,\n  refreshAfterCallback: false,\n  callback: function () {\n    this.video.replace();\n  }\n})\n\n// Video remove.\nFE.DefineIcon('videoRemove', { NAME: 'trash' })\nFE.RegisterCommand('videoRemove', {\n  title: 'Remove',\n  callback: function () {\n    this.video.remove();\n  }\n})\n\n// Video size.\nFE.DefineIcon('videoSize', { NAME: 'arrows-alt' })\nFE.RegisterCommand('videoSize', {\n  undo: false,\n  focus: false,\n  popup: true,\n  title: 'Change Size',\n  callback: function () {\n    this.video.showSizePopup();\n  }\n});\n\n// Video back.\nFE.DefineIcon('videoBack', { NAME: 'arrow-left' });\nFE.RegisterCommand('videoBack', {\n  title: 'Back',\n  undo: false,\n  focus: false,\n  back: true,\n  callback: function () {\n    this.video.back();\n  },\n  refresh: function ($btn) {\n    var $current_video = this.video.get();\n\n    if (!$current_video && !this.opts.toolbarInline) {\n      $btn.addClass('fr-hidden');\n      $btn.next('.fr-separator').addClass('fr-hidden');\n    }\n    else {\n      $btn.removeClass('fr-hidden');\n      $btn.next('.fr-separator').removeClass('fr-hidden');\n    }\n  }\n});\n\nFE.RegisterCommand('videoDismissError', {\n  title: 'OK',\n  undo: false,\n  callback: function () {\n    this.video.hideProgressBar(true);\n  }\n})\n\nFE.RegisterCommand('videoSetSize', {\n  undo: true,\n  focus: false,\n  title: 'Update',\n  refreshAfterCallback: false,\n  callback: function () {\n    this.video.setSize();\n  }\n})\n","import FE from 'FroalaEditor';\n\nObject.assign(FE.DEFAULTS, {\n  wordDeniedTags: [],\n  wordDeniedAttrs: [],\n  wordAllowedStyleProps: ['font-family', 'font-size', 'background', 'color', 'width', 'text-align', 'vertical-align', 'background-color', 'padding', 'margin', 'height', 'margin-top', 'margin-left', 'margin-right', 'margin-bottom', 'text-decoration', 'font-weight', 'font-style', 'text-indent'],\n  wordPasteModal: true\n});\n\nFE.PLUGINS.wordPaste = function (editor) {\n  let $ = editor.$\n\n  var $modal;\n  var modal_id = 'word_paste';\n  var clipboard_html;\n\n  /*\n   * Init Word Paste.\n   */\n  function _init () {\n    editor.events.on('paste.wordPaste', function (html) {\n      clipboard_html = html;\n\n      if (editor.opts.wordPasteModal) {\n        _showModal();\n      }\n      else {\n        clean(true);\n      }\n\n      return false;\n    });\n  }\n\n  /*\n   * Build html body.\n   */\n  function _buildModalBody () {\n\n    // Begin body.\n    var body = '<div class=\"fr-word-paste-modal\" style=\"padding: 20px 20px 10px 20px;\">';\n    body += '<p style=\"text-align: left;\">' + editor.language.translate('The pasted content is coming from a Microsoft Word document. Do you want to keep the format or clean it up?') + '</p>';\n    body += '<div style=\"text-align: right; margin-top: 50px;\"><button class=\"fr-remove-word fr-command\">' + editor.language.translate('Clean') + '</button> <button class=\"fr-keep-word fr-command\">' + editor.language.translate('Keep') + '</button></div>';\n\n    // End body.\n    body += '</div>';\n\n    return body;\n  }\n\n  /*\n   * Show modal.\n   */\n  function _showModal () {\n    if (!$modal) {\n      var head = '<h4><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 74.95 73.23\" style=\"height: 25px; vertical-align: text-bottom; margin-right: 5px; display: inline-block\"><defs><style>.a{fill:#2a5699;}.b{fill:#fff;}</style></defs><path class=\"a\" d=\"M615.15,827.22h5.09V834c9.11.05,18.21-.09,27.32.05a2.93,2.93,0,0,1,3.29,3.25c.14,16.77,0,33.56.09,50.33-.09,1.72.17,3.63-.83,5.15-1.24.89-2.85.78-4.3.84-8.52,0-17,0-25.56,0v6.81h-5.32c-13-2.37-26-4.54-38.94-6.81q0-29.8,0-59.59c13.05-2.28,26.11-4.5,39.17-6.83Z\" transform=\"translate(-575.97 -827.22)\"/><path class=\"b\" d=\"M620.24,836.59h28.1v54.49h-28.1v-6.81h22.14v-3.41H620.24v-4.26h22.14V873.2H620.24v-4.26h22.14v-3.41H620.24v-4.26h22.14v-3.41H620.24v-4.26h22.14v-3.41H620.24V846h22.14v-3.41H620.24Zm-26.67,15c1.62-.09,3.24-.16,4.85-.25,1.13,5.75,2.29,11.49,3.52,17.21,1-5.91,2-11.8,3.06-17.7,1.7-.06,3.41-.15,5.1-.26-1.92,8.25-3.61,16.57-5.71,24.77-1.42.74-3.55,0-5.24.09-1.13-5.64-2.45-11.24-3.47-16.9-1,5.5-2.29,10.95-3.43,16.42q-2.45-.13-4.92-.3c-1.41-7.49-3.07-14.93-4.39-22.44l4.38-.18c.88,5.42,1.87,10.82,2.64,16.25,1.2-5.57,2.43-11.14,3.62-16.71Z\" transform=\"translate(-575.97 -827.22)\"/></svg> ' + editor.language.translate('Word Paste Detected') + '</h4>';\n      var body = _buildModalBody();\n\n      var modalHash = editor.modals.create(modal_id, head, body);\n\n      var $body = modalHash.$body;\n      $modal = modalHash.$modal;\n\n      modalHash.$modal.addClass('fr-middle');\n\n      editor.events.bindClick($body, 'button.fr-remove-word', function () {\n        var inst = $modal.data('instance') || editor;\n        inst.wordPaste.clean();\n      });\n\n      editor.events.bindClick($body, 'button.fr-keep-word', function () {\n        var inst = $modal.data('instance') || editor;\n\n        inst.wordPaste.clean(true);\n      });\n\n      // Resize help modal on window resize.\n      editor.events.$on($(editor.o_win), 'resize', function () {\n        editor.modals.resize(modal_id);\n      })\n    }\n\n    // Show modal.\n    editor.modals.show(modal_id);\n\n    // Modal may not fit window size.\n    editor.modals.resize(modal_id);\n  }\n\n  /*\n   * Hide modal.\n   */\n  function _hideModal () {\n    editor.modals.hide(modal_id);\n  }\n\n  /*\n   * Word paste cleanup.\n   */\n  function clean (keep_formatting) {\n    var wordAllowedStylePropsBackup = editor.opts.wordAllowedStyleProps;\n\n    if (!keep_formatting) {\n      editor.opts.wordAllowedStyleProps = [];\n    }\n\n    // Firefox paste.\n    if (clipboard_html.indexOf('<colgroup>') === 0) {\n      clipboard_html = '<table>' + clipboard_html + '</table>';\n    }\n\n\n    // Replace spaces.\n    clipboard_html = clipboard_html.replace(/<span[\\n\\r ]*style='mso-spacerun:yes'>([\\r\\n\\u00a0 ]*)<\\/span>/g, function (str, match) {\n      var spaces = '';\n      var i = 0;\n\n      while (i++ < match.length) {\n        spaces += '&nbsp;';\n      }\n\n      return spaces;\n    });\n\n    clipboard_html = _wordClean(clipboard_html, editor.paste.getRtfClipboard());\n\n    // Remove unwanted spaces.\n    var div = editor.doc.createElement('DIV');\n    div.innerHTML = clipboard_html;\n    editor.html.cleanBlankSpaces(div);\n    clipboard_html = div.innerHTML;\n\n    clipboard_html = editor.paste.cleanEmptyTagsAndDivs(clipboard_html);\n\n    // Remove invisible space.\n    clipboard_html = clipboard_html.replace(/\\u200b/g, '');\n\n    _hideModal();\n\n    // Clean the processed clipboard_html.\n    editor.paste.clean(clipboard_html, true, true);\n\n    editor.opts.wordAllowedStyleProps = wordAllowedStylePropsBackup;\n  }\n\n  /**\n   * Remove a node. IE conpatible.\n   */\n  function _removeNode(node) {\n\n    var parent = node.parentNode;\n\n    if (!parent) {\n\n      return;\n    }\n\n    node.parentNode.removeChild(node);\n  }\n\n  /*\n   * Depth-first search traversing of the DOM.\n   */\n  function _traverse (node, callback) {\n\n    // Process node.\n    if (!callback(node)) {\n\n      return;\n    }\n\n    // Expand node. Take its first child.\n    var child = node.firstChild;\n\n    // While all childs are traversed.\n    while (child) {\n\n      // Store the current child.\n      var current_child = child;\n\n      // Store the previous child.\n      var previous_child = child.previousSibling;\n\n      // Take next child.\n      child = child.nextSibling;\n\n      // Expand the current child.\n      _traverse(current_child, callback);\n\n\n      // An unwrap was made. Need to calculate again the next child.\n      if ((!current_child.previousSibling && !current_child.nextSibling && !current_child.parentNode) && child && (previous_child != child.previousSibling) && child.parentNode) {\n        if (previous_child) {\n          child = previous_child.nextSibling;\n        }\n        else {\n          child = node.firstChild;\n        }\n      }\n\n      // A list was created. Need to calculate again the next child.\n      else if ((!current_child.previousSibling && !current_child.nextSibling && !current_child.parentNode) && child && (!child.previousSibling && !child.nextSibling && !child.parentNode)) {\n        if (previous_child) {\n          if (previous_child.nextSibling) {\n            child = previous_child.nextSibling.nextSibling;\n          }\n          else {\n            child = null;\n          }\n        }\n        else {\n          if (node.firstChild) {\n            child = node.firstChild.nextSibling;\n          }\n        }\n      }\n    }\n  }\n\n  /*\n   * Check if a node is a list. TODO: use Regex.\n   */\n  function _isList (node) {\n    // Check if it has mso-list:l in its style attribute.\n    if (!(node.getAttribute('style') && /mso-list:[\\s]*l/gi.test(node.getAttribute('style').replace(/\\n/gi, '')))) {\n\n      return false;\n    }\n\n    // Using try-catch to skip undefined checking.\n    try {\n      // Check mso-list.\n      if (!node.querySelector('[style=\"mso-list:Ignore\"]')) {\n\n        return false;\n      }\n    }\n    catch (e) {\n\n      return false;\n    }\n\n    return true;\n  }\n\n  /*\n   * Get list level based on level attribute from node style.\n   */\n  function _getListLevel (node) {\n\n    return node.getAttribute('style').replace(/\\n/gi, '').replace(/.*level([0-9]+?).*/gi, '$1')\n  }\n\n  /*\n   * Get list content.\n   */\n  function _getListContent (node, head_style_hash) {\n\n    var cloned_node = node.cloneNode(true);\n\n    // Some lists might be wrapped in a link. So we need to unwrap.\n    // if (cloned_node.firstElementChild && cloned_node.firstElementChild.tagName == 'A') {\n    //   cloned_node = cloned_node.firstElementChild;\n    // }\n\n    // Heading list.\n    if (['H1', 'H2', 'H3', 'H4', 'H5', 'H6'].indexOf(node.tagName) != -1) {\n      var heading = document.createElement(node.tagName.toLowerCase());\n      heading.setAttribute('style', node.getAttribute('style'));\n      heading.innerHTML = cloned_node.innerHTML;\n      cloned_node.innerHTML = heading.outerHTML;\n    }\n\n    // Clean node recursively.\n    _traverse(cloned_node, function (node) {\n      if (node.nodeType == Node.ELEMENT_NODE) {\n\n        // Skip the first child which is an mso-list:Ignore node.\n        if (node.getAttribute('style') == 'mso-list:Ignore') {\n          node.parentNode.removeChild(node);\n        }\n\n        _cleanElement(node, head_style_hash);\n      }\n\n      return true;\n    });\n\n    // Take content.\n    var content = cloned_node.innerHTML;\n\n    // Replace comments.\n    content = content.replace(/<!--[\\s\\S]*?-->/gi, '');\n\n    return content;\n  }\n\n  /*\n   * Build ol/ul list.\n   */\n  function _buildList (node, head_style_hash) {\n\n    // Check ol/ul.\n    var order_regex = /[0-9a-zA-Z]./gi;\n    var is_ordered = false;\n\n    if (node.firstElementChild && node.firstElementChild.firstElementChild && node.firstElementChild.firstElementChild.firstChild) {\n      is_ordered = is_ordered || order_regex.test(node.firstElementChild.firstElementChild.firstChild.data || '');\n\n      if (!is_ordered && node.firstElementChild.firstElementChild.firstElementChild && node.firstElementChild.firstElementChild.firstElementChild.firstChild) {\n        is_ordered = is_ordered || order_regex.test(node.firstElementChild.firstElementChild.firstElementChild.firstChild.data || '');\n      }\n    }\n\n    var list_tag = is_ordered ? 'ol' : 'ul';\n\n    // Get list level.\n    var level = _getListLevel(node);\n\n    // Build list with first line.\n    var s = '<' + list_tag + '><li>' + _getListContent(node, head_style_hash);\n\n    // Get next sibling and remove the current node.\n    var next_element_sibling = node.nextElementSibling;\n    var parent_node = node.parentNode;\n    _removeNode(node);\n    node = null;\n\n    // Check if next siblings are lists too.\n    while (next_element_sibling) {\n\n      // Stop at first sibling that is not a list.\n      if (!_isList(next_element_sibling)) {\n        break;\n      }\n\n      // Store the previous element sibling.\n      var previous_element_sibling = next_element_sibling.previousElementSibling;\n\n      var next_level = _getListLevel(next_element_sibling);\n\n      // Compare the levels.\n      if (next_level > level) {\n\n        // Add nested list with a higher level.\n        s += _buildList(next_element_sibling, head_style_hash).outerHTML;\n      }\n      else if (next_level < level) {\n\n        // Lower level found. Current list is done.\n        break;\n      }\n      else {\n\n        // Add a new line with the content of the current sibling.\n        s += '</li><li>' + _getListContent(next_element_sibling, head_style_hash);\n      }\n\n      level = next_level;\n\n      // Sibling was not removed when nested list was added.\n      if (next_element_sibling.previousElementSibling || next_element_sibling.nextElementSibling || next_element_sibling.parentNode) {\n        var next_element_sibling_copy = next_element_sibling;\n        next_element_sibling = next_element_sibling.nextElementSibling;\n        _removeNode(next_element_sibling_copy);\n        next_element_sibling_copy = null;\n      }\n\n      // Sibling was removed. Take again the next sibling.\n      else if (previous_element_sibling) {\n        next_element_sibling = previous_element_sibling.nextElementSibling;\n      }\n      else {\n        next_element_sibling = parent_node.firstElementChild;\n      }\n    }\n\n    // Finish list.\n    s += '</li></' + list_tag + '>';\n\n    // Convert string to node element.\n    var div = document.createElement('div');\n    div.innerHTML = s;\n    var element = div.firstElementChild;\n\n    return element;\n  }\n\n  /*\n   * Change tag name of an element.\n   */\n  function _changeTagName (old_node, tag_name) {\n\n    var new_node = document.createElement(tag_name);\n\n    for (var i = 0; i < old_node.attributes.length; i++) {\n      var attribute = old_node.attributes[i].name;\n      new_node.setAttribute(attribute, old_node.getAttribute(attribute));\n    }\n\n    new_node.innerHTML = old_node.innerHTML;\n\n    old_node.parentNode.replaceChild(new_node, old_node)\n\n    return new_node;\n  }\n\n  /*\n   * Clean tr element.\n   */\n  function _cleanTr (tr, head_style_hash) {\n\n    // Clean tr attributes.\n    editor.node.clearAttributes(tr);\n\n    // Get first child.\n    var child = tr.firstElementChild;\n\n    // Total table width.\n    var total_width = 0;\n\n    // Tell if at least one child has a missing width.\n    var missing_width = false;\n\n    // Width attribute.\n    var width_attr = null;\n\n    // Clean td childs and calculate total table width.\n    while (child) {\n\n      // Cleanup w: tags.\n      if (child.firstElementChild && child.firstElementChild.tagName.indexOf('W:') != -1) {\n        child.innerHTML = child.firstElementChild.innerHTML;\n      }\n\n      // Add width to total.\n      width_attr = child.getAttribute('width');\n\n      if (!width_attr && !missing_width) {\n        missing_width = true;\n      }\n      total_width += parseInt(width_attr, 10);\n\n      // Replace to <br> childs that are empty or &nbsp.\n      if (!child.firstChild || (child.firstChild && child.firstChild.data == FE.UNICODE_NBSP)) {\n        if (child.firstChild) {\n          _removeNode(child.firstChild);\n        }\n        child.innerHTML = '<br>';\n      }\n\n      var td_child = child.firstElementChild;\n\n      // If child has more than one children, it means that every child has its own alignment.\n      var has_single_child = child.children.length == 1;\n\n      // Change p to span or div and clean alignment on every element child.\n      while (td_child) {\n\n        if (td_child.tagName == 'P' && !_isList(td_child)) {\n          // Set alignment to td parent.\n          if (has_single_child) {\n            _cleanAlignment(td_child);\n          }\n        }\n\n        // Move to next element sibling.\n        td_child = td_child.nextElementSibling;\n      }\n\n      // Add styles from head.\n      if (head_style_hash) {\n\n        // Style from .xl classes.\n        // Get class from child.\n        var class_attr = child.getAttribute('class');\n\n        if (class_attr) {\n          class_attr = _normalizeAttribute(class_attr);\n\n          // Match xl class.\n          var class_matches = class_attr.match(/xl[0-9]+/gi);\n\n          if (class_matches) {\n            var xl_class = class_matches[0];\n            var dot_xl_class = '.' + xl_class;\n\n            if (head_style_hash[dot_xl_class]) {\n              _appendStyle(child, head_style_hash[dot_xl_class]);\n            }\n          }\n        }\n\n        // Style from td.\n        if (head_style_hash.td) {\n          _appendStyle(child, head_style_hash.td);\n        }\n      }\n\n      var style = child.getAttribute('style');\n\n      if (style) {\n        style = _normalizeAttribute(style);\n\n        // Add semicolon, if it is missing, to the end of current style.\n        if (style && style.slice(-1) != ';') {\n          style += ';';\n        }\n      }\n\n      // Store valign attribute.\n      var valign = child.getAttribute('valign');\n\n      if (!valign && style) {\n        var valign_matches = style.match(/vertical-align:.+?[; \"]{1,1}/gi);\n\n        if (valign_matches) {\n          valign = valign_matches[valign_matches.length - 1].replace(/vertical-align:(.+?)[; \"]{1,1}/gi, '$1');\n        }\n      }\n\n      // Store text-align style attribute.\n      var halign = null;\n\n      if (style) {\n        var halign_matches = style.match(/text-align:.+?[; \"]{1,1}/gi);\n\n        if (halign_matches) {\n          halign = halign_matches[halign_matches.length - 1].replace(/text-align:(.+?)[; \"]{1,1}/gi, '$1');\n        }\n\n        if (halign == 'general') {\n          halign = null;\n        }\n      }\n\n      // Store background color style attribute.\n      var background_color = null;\n\n      if (style) {\n        var background_matches = style.match(/background:.+?[; \"]{1,1}/gi);\n\n        if (background_matches) {\n          background_color = background_matches[background_matches.length - 1].replace(/background:(.+?)[; \"]{1,1}/gi, '$1');\n        }\n      }\n\n      // Store colspan.\n      var colspan = child.getAttribute('colspan');\n\n      // Store rowspan.\n      var rowspan = child.getAttribute('rowspan');\n\n      // Restore colspan.\n      if (colspan) {\n        child.setAttribute('colspan', colspan);\n      }\n\n      // Restore rowspan.\n      if (rowspan) {\n        child.setAttribute('rowspan', rowspan);\n      }\n\n      // Add valign to style.\n      if (valign) {\n        child.style['vertical-align'] = valign;\n      }\n\n      // Add horizontal align to style.\n      if (halign) {\n        child.style['text-align'] = halign;\n      }\n\n      // Add background color to style.\n      if (background_color) {\n        child.style['background-color'] = background_color;\n      }\n\n      // Set the width again.\n      if (width_attr) {\n        child.setAttribute('width', width_attr);\n      }\n\n      // Move to next sibling.\n      child = child.nextElementSibling;\n\n    }\n\n    // Get first child again.\n    child = tr.firstElementChild;\n\n    // Set the width in percentage to every child.\n    while (child) {\n      width_attr = child.getAttribute('width');\n\n      if (missing_width) {\n\n        // Remove width.\n        child.removeAttribute('width');\n      }\n      else {\n\n        // Set the width considering that every child has equal widths.\n        child.setAttribute('width', (parseInt(width_attr, 10) * 100) / total_width + '%');\n      }\n\n      // Move to next sibling.\n      child = child.nextElementSibling;\n    }\n  }\n\n  /*\n   * Clean align attribute.\n   */\n  function _cleanAlignment (el) {\n\n    var parent = el.parentNode;\n    var align = el.getAttribute('align');\n\n    if (align) {\n      if (parent && parent.tagName == 'TD') {\n        parent.setAttribute('style', parent.getAttribute('style') + 'text-align:' + align + ';')\n        el.removeAttribute('align');\n      }\n      else {\n        el.style['text-align'] = align;\n        el.removeAttribute('align');\n      }\n    }\n  }\n\n  /*\n   * Clean up atribute.\n   */\n  function _normalizeAttribute (attribute) {\n\n    return attribute.replace(/\\n|\\r|\\n\\r|&quot;/g, '');\n  }\n\n  /*\n   * Append style to element.\n   */\n  function _appendStyle (el, style, last) {\n\n    if (!style) {\n      return;\n    }\n\n    // Get current element style.\n    var old_style = el.getAttribute('style');\n\n    // Add semicolon, if it is missing, to the end of current style.\n    if (old_style && old_style.slice(-1) != ';') {\n      old_style += ';';\n    }\n\n    // Add semicolon, if it is missing, to the end of current style.\n    if (style && style.slice(-1) != ';') {\n      style += ';';\n    }\n\n    // Remove newlines.\n    style = style.replace(/\\n/gi, '');\n\n    // Append at the begining or at the end.\n    var new_style = null;\n\n    if (last) {\n      new_style = (old_style || '') + style;\n    }\n    else {\n      new_style = style + (old_style || '');\n    }\n    el.setAttribute('style', new_style);\n  }\n\n  /*\n   * Delete duplicate attributes found on style. Keep the last one.\n   */\n  function _cleanStyleDuplicates (el) {\n    var style = el.getAttribute('style');\n\n    if (!style) {\n\n      return;\n    }\n\n    style = _normalizeAttribute(style);\n\n    // Add semicolon, if it is missing, to the end of style.\n    if (style && style.slice(-1) != ';') {\n      style += ';';\n    }\n\n    // Get styles: attr:value;\n    var style_list = style.match(/(^|\\S+?):.+?;{1,1}/gi);\n\n    if (!style_list) {\n      return;\n    }\n\n    // Key = attribute. Value = attribute's value. Duplicate keys will be overrided.\n    var style_hash = {};\n\n    for (var i = 0; i < style_list.length; i++) {\n      var style_list_item = style_list[i];\n\n      var splited_style = style_list_item.split(':');\n\n      if (splited_style.length != 2) {\n        continue;\n      }\n\n      // Add style to hash without text-align on span.\n      if (!(splited_style[0] == 'text-align' && el.tagName == 'SPAN')) {\n        style_hash[splited_style[0]] = splited_style[1];\n      }\n    }\n\n    // Create the new style without duplicates.\n    var new_style = '';\n\n    for (var attr in style_hash) {\n      if (Object.prototype.hasOwnProperty.call(style_hash, attr)) {\n\n        // Change font-size form pt to px;\n        if (attr == 'font-size' && style_hash[attr].slice(-3) == 'pt;') {\n          var number = null;\n\n          try {\n            number = parseFloat(style_hash[attr].slice(0, -3), 10);\n          }\n          catch (e) {\n          }\n\n          if (number) {\n            number = Math.round(1.33 * number);\n            style_hash[attr] = number + 'px;';\n          }\n        }\n\n        new_style += attr + ':' + style_hash[attr];\n      }\n    }\n\n    if (new_style) {\n      el.setAttribute('style', new_style);\n    }\n  }\n\n  /*\n   * Convert a hex string to base64.\n   */\n  function _hexToBase64 (hex) {\n    var hexa_chars = hex.match(/[0-9a-f]{2}/gi);\n\n    var dec_chars = [];\n\n    for (var i = 0; i < hexa_chars.length; i++) {\n      dec_chars.push(String.fromCharCode(parseInt(hexa_chars[i], 16)));\n    }\n\n    var dec = dec_chars.join('');\n\n    return btoa(dec);\n  }\n\n  var _rtf_map = null;\n\n  function _getRtfData(rtf, letter, p_type) {\n    var imgs = rtf.split(p_type);\n\n    for (var i = 1; i < imgs.length; i++) {\n      var img_data = imgs[i];\n\n      img_data = img_data.split('shplid');\n\n      if (img_data.length > 1) {\n\n        img_data = img_data[1];\n\n        var id = '';\n        var t = 0;\n\n        while (t < img_data.length) {\n          if (img_data[t] == '\\\\' || img_data[t] == '{' || img_data[t] == ' ' || img_data[t] == '\\r' || img_data[t] == '\\n') {\n            break;\n          }\n\n          id += img_data[t];\n\n          t++;\n        }\n\n        var bliptab_split = img_data.split('bliptag');\n\n        if (bliptab_split && bliptab_split.length < 2) {\n\n          continue;\n        }\n\n        var image_type = null;\n\n        if (bliptab_split[0].indexOf('pngblip') != -1) {\n          image_type = 'image/png';\n        }\n        else if (bliptab_split[0].indexOf('jpegblip') != -1) {\n          image_type = 'image/jpeg';\n        }\n\n        if (!image_type) {\n\n          continue;\n        }\n\n        var bracket_split = bliptab_split[1].split('}');\n\n        if (bracket_split && bracket_split.length < 2) {\n\n          continue;\n        }\n\n        var space_split;\n\n        if (bracket_split.length > 2 && bracket_split[0].indexOf('blipuid') != -1) {\n          space_split = bracket_split[1].split(' ');\n        }\n        else {\n          space_split = bracket_split[0].split(' ');\n\n          if (space_split && space_split.length < 2) {\n\n            continue;\n          }\n\n          space_split.shift();\n        }\n\n        var image_hex = space_split.join('');\n\n        _rtf_map[letter + id] = {\n          image_hex: image_hex,\n          image_type: image_type\n        }\n      }\n    }\n  }\n\n  function _buildRtfMap (rtf) {\n    _rtf_map = {};\n\n    _getRtfData(rtf, 'i', '\\\\shppict');\n    _getRtfData(rtf, 's', '\\\\shp{');\n  }\n\n  /*\n   * Clean HTML Image.\n   */\n  function _cleanImage (el, rtf) {\n\n    if (!rtf) {\n\n      return;\n    }\n\n    // vshapes_tag will identify the image in rtf.\n    var vshapes_tag;\n\n    // Image case.\n    if (el.tagName == 'IMG') {\n      // Get src.\n      var src = el.getAttribute('src');\n\n      if (!src || src.indexOf('file://') == -1) {\n        return;\n      }\n\n      else if (src.indexOf('file://') === 0) {\n        if (editor.helpers.isURL(el.getAttribute('alt'))) {\n          el.setAttribute('src', el.getAttribute('alt'))\n\n          return;\n        }\n      }\n\n      // vshapes_tag will identify the image in rtf.\n      vshapes_tag = _v_shapes_map[el.getAttribute('v:shapes')];\n\n      if (!vshapes_tag) {\n        vshapes_tag = el.getAttribute('v:shapes');\n      }\n    }\n    else {\n      vshapes_tag = el.parentNode.getAttribute('o:spid');\n    }\n\n    el.removeAttribute('height');\n\n    if (!vshapes_tag) {\n\n      return;\n    }\n\n    _buildRtfMap(rtf);\n\n    var img_data = _rtf_map[vshapes_tag.substring(7)];\n\n    if (img_data) {\n\n      // Convert image hex to base64.\n      var image_base64 = _hexToBase64(img_data.image_hex);\n\n      // Build data uri.\n      var data_uri = 'data:' + img_data.image_type + ';base64,' + image_base64;\n\n      if (el.tagName === 'IMG') {\n        el.src = data_uri;\n        el.setAttribute('data-fr-image-pasted', true)\n      }\n      else {\n        $(el.parentNode).before('<img data-fr-image-pasted=\"true\" src=\"' + data_uri + '\" style=\"' + el.parentNode.getAttribute('style') + '\">').remove();\n      }\n    }\n  }\n\n  /*\n   * Clean element.\n   */\n  function _cleanElement (el, head_style_hash) {\n\n    var tag_name = el.tagName;\n    var tag_name_lower_case = tag_name.toLowerCase();\n\n    // Check if we need to change a tag. Tags should be changed only from parent.\n    if (el.firstElementChild) {\n\n      // Change i to em.\n      if (el.firstElementChild.tagName == 'I') {\n        _changeTagName(el.firstElementChild, 'em');\n\n      // Change b to strong.\n      }\n      else if (el.firstElementChild.tagName == 'B') {\n        _changeTagName(el.firstElementChild, 'strong');\n      }\n    }\n\n    // Remove no needed tags.\n    var word_tags = ['SCRIPT', 'APPLET', 'EMBED', 'NOFRAMES', 'NOSCRIPT'];\n\n    if (word_tags.indexOf(tag_name) != -1) {\n      _removeNode(el);\n\n      return false;\n    }\n\n    // Check single spaces.\n    // if (tag_name == 'O:P' && el.innerHTML == '&nbsp;') {\n    //   el.innerHTML = FE.INVISIBLE_SPACE;\n    // }\n\n    // Index used in for loops.\n    var i = -1;\n\n    // Remove tags but keep content.\n    var ignore_tags = ['META', 'LINK', 'XML', 'ST1:', 'O:', 'W:', 'FONT'];\n\n    for (i = 0; i < ignore_tags.length; i++) {\n      if (tag_name.indexOf(ignore_tags[i]) != -1) {\n        if (el.innerHTML) {\n          el.outerHTML = el.innerHTML;\n          _removeNode(el);\n\n          return false;\n        }\n        else {\n\n          // Remove if does not have content.\n          _removeNode(el);\n\n          return false;\n        }\n        break;\n      }\n    }\n\n    // Add class style from head.\n    if (tag_name != 'TD') {\n\n      var class_attr = el.getAttribute('class');\n\n      if (head_style_hash && class_attr) {\n        class_attr = _normalizeAttribute(class_attr);\n        var class_contents = class_attr.split(' ');\n\n        // All classes.\n        for (i = 0; i < class_contents.length; i++) {\n          var class_content = class_contents[i];\n\n          // Create style attributes list.\n          var style_attrs = [];\n\n          // Only classes.\n          var style_attr = '.' + class_content;\n          style_attrs.push(style_attr);\n\n          // Classes under tag.\n          style_attr = tag_name_lower_case + style_attr;\n          style_attrs.push(style_attr);\n\n          for (var j = 0; j < style_attrs.length; j++) {\n            if (head_style_hash[style_attrs[j]]) {\n              _appendStyle(el, head_style_hash[style_attrs[j]]);\n            }\n          }\n        }\n\n        el.removeAttribute('class');\n      }\n\n      // Add tag style from head.\n      if (head_style_hash && head_style_hash[tag_name_lower_case]) {\n        _appendStyle(el, head_style_hash[tag_name_lower_case]);\n      }\n    }\n\n    // Wrap paragraphs inner html in a span.\n    var paragraph_tag_list = ['P', 'H1', 'H2', 'H3', 'H4', 'H5', 'H6', 'PRE'];\n\n    if (paragraph_tag_list.indexOf(tag_name) != -1) {\n\n      // Set style from head.\n      var el_class = el.getAttribute('class');\n\n      if (el_class) {\n        if (head_style_hash && head_style_hash[tag_name.toLowerCase() + '.' + el_class]) {\n          _appendStyle(el, head_style_hash[tag_name.toLowerCase() + '.' + el_class]);\n        }\n\n        // Remove mso values from class.\n        if (el_class.toLowerCase().indexOf('mso') != -1) {\n          var cleaned_class = _normalizeAttribute(el_class);\n          cleaned_class = cleaned_class.replace(/[0-9a-z-_]*mso[0-9a-z-_]*/gi, '');\n\n          if (cleaned_class) {\n            el.setAttribute('class', cleaned_class);\n          }\n          else {\n            el.removeAttribute('class');\n          }\n        }\n      }\n\n      // keep only text-align in style.\n      var paragraph_style = el.getAttribute('style');\n      var paragraph_text_align = null;\n\n      if (paragraph_style) {\n        var paragraph_style_matches = paragraph_style.match(/text-align:.+?[; \"]{1,1}/gi);\n\n        if (paragraph_style_matches) {\n          paragraph_text_align = paragraph_style_matches[paragraph_style_matches.length - 1].replace(/(text-align:.+?[; \"]{1,1})/gi, '$1');\n        }\n      }\n\n      _cleanAlignment(el);\n    }\n\n    // Clean tr.\n    if (tag_name == 'TR') {\n      _cleanTr(el, head_style_hash);\n    }\n\n    // Clean empty links.\n    if (tag_name == 'A' &&  !el.attributes.getNamedItem('href') && !el.attributes.getNamedItem('name') && el.innerHTML) {\n      el.outerHTML = el.innerHTML;\n    }\n\n    // Keep empty TH and TD.\n    if ((tag_name == 'TD' || tag_name == 'TH') && !el.innerHTML) {\n      el.innerHTML = '<br>';\n    }\n\n    // Clean table.\n    if (tag_name == 'TABLE') {\n      el.style.width = '100%';\n    }\n\n    // Remove lang attribute.\n    if (el.getAttribute('lang')) {\n      el.removeAttribute('lang');\n    }\n\n    // Remove mso values from style.\n    if (el.getAttribute('style') && el.getAttribute('style').toLowerCase().indexOf('mso') != -1) {\n      var cleaned_style = _normalizeAttribute(el.getAttribute('style'));\n      cleaned_style = cleaned_style.replace(/[0-9a-z-_]*mso[0-9a-z-_]*:.+?(;{1,1}|$)/gi, '');\n\n      if (cleaned_style) {\n        el.setAttribute('style', cleaned_style);\n      }\n      else {\n        el.removeAttribute('style');\n      }\n    }\n\n    return true;\n  }\n\n  /*\n   * Parse styles from head and return them into a hash.\n   */\n  function _parseHeadStyle (head) {\n\n    var head_style_hash = {};\n\n    var head_styles = head.getElementsByTagName('style');\n\n    if (head_styles.length) {\n      var head_style = head_styles[0];\n\n      // Match styles.\n      var style_list = head_style.innerHTML.match(/[\\S ]+\\s+{[\\s\\S]+?}/gi);\n\n      if (style_list) {\n        for (var i = 0; i < style_list.length; i++) {\n          var style = style_list[i];\n\n          // Get style attributes.\n          var style_attrs = style.replace(/([\\S ]+\\s+){[\\s\\S]+?}/gi, '$1');\n\n          // Get style definitions.\n          var style_definitions = style.replace(/[\\S ]+\\s+{([\\s\\S]+?)}/gi, '$1');\n\n          // Trim whitespaces.\n          style_attrs = style_attrs.replace(/^[\\s]|[\\s]$/gm, '');\n          style_definitions = style_definitions.replace(/^[\\s]|[\\s]$/gm, '');\n\n          // Trim new lines.\n          style_attrs = style_attrs.replace(/\\n|\\r|\\n\\r/g, '');\n          style_definitions = style_definitions.replace(/\\n|\\r|\\n\\r/g, '');\n\n          var style_attrs_array = style_attrs.split(', ');\n\n          // Add every attribute to hash.\n          for (var j = 0; j < style_attrs_array.length; j++) {\n            head_style_hash[style_attrs_array[j]] = style_definitions;\n          }\n        }\n      }\n    }\n\n    return head_style_hash;\n  }\n\n  var _v_shapes_map = {};\n\n  /**\n   * Create a map with the ID for images.\n   */\n  function _getVShapes (html) {\n    var splits = html.split('v:shape');\n\n    for (var i = 1; i < splits.length; i++) {\n      var split = splits[i];\n      var id = split.split(' id=\"')[1];\n\n      if (id && id.length > 1) {\n        id = id.split('\"')[0];\n\n        var oid = split.split(' o:spid=\"')[1];\n\n        if (oid && oid.length > 1) {\n          oid = oid.split('\"')[0];\n\n          _v_shapes_map[id] = oid;\n        }\n      }\n    }\n  }\n\n  /*\n   * Clean HTML that was pasted from Word.\n   */\n  function _wordClean (html, rtf) {\n\n    // Remove junk from outside html.\n    html = html.replace(/[.\\s\\S\\w\\W<>]*(<html[^>]*>[.\\s\\S\\w\\W<>]*<\\/html>)[.\\s\\S\\w\\W<>]*/i, '$1');\n\n    // Get the vshapes for images.\n    _getVShapes(html);\n\n    // Convert string into document.\n    var parser = new DOMParser();\n    var word_doc = parser.parseFromString(html, 'text/html');\n\n    var head = word_doc.head;\n    var body = word_doc.body;\n\n    // Create style attrs hash.\n    var head_style_hash = _parseHeadStyle(head);\n\n    // Remove text nodes that do not contain non-whitespace characters and has new lines in them.\n    _traverse(body, function (node) {\n      if (node.nodeType == Node.TEXT_NODE && /\\n|\\u00a0|\\r/.test(node.data)) {\n\n        if (!/\\S| /.test(node.data)) {\n          // Keep single &nbsp;\n          if (node.data == FE.UNICODE_NBSP) {\n            node.data = '\\u200b';\n\n            return true;\n          }\n\n          if (node.data.length == 1 && node.data.charCodeAt(0) == 10) {\n            node.data = ' ';\n\n            return true;\n          }\n\n          _removeNode(node);\n\n          return false;\n        }\n\n        // Remove newlines.\n        else {\n          node.data = node.data.replace(/\\n|\\r/gi, ' ');\n        }\n      }\n\n      return true;\n    });\n\n    // Process images.\n    _traverse(body, function (node) {\n\n      // Element node.\n      if (node.nodeType == Node.ELEMENT_NODE && (node.tagName == 'V:IMAGEDATA' || node.tagName == 'IMG')) {\n        _cleanImage(node, rtf)\n      }\n\n      return true;\n    });\n\n    // Process lists.\n    var lists = body.querySelectorAll('ul > ul, ul > ol, ol > ul, ol > ol');\n\n    for (var i = lists.length - 1; i >= 0; i--) {\n      if (lists[i].previousElementSibling && lists[i].previousElementSibling.tagName === 'LI') {\n        lists[i].previousElementSibling.appendChild(lists[i]);\n      }\n    }\n\n    // Clean the body.\n    _traverse(body, function (node) {\n\n      // Text node.\n      if (node.nodeType == Node.TEXT_NODE) {\n\n        // https://github.com/froala/wysiwyg-editor/issues/1364.\n        node.data = node.data.replace(/<br>(\\n|\\r)/gi, '<br>');\n\n        return false;\n      }\n\n      // Element node.\n      else if (node.nodeType == Node.ELEMENT_NODE) {\n        // List found.\n        if (_isList(node)) {\n          // Keep the parent node and previous sibling because the node could be deleted in the list building.\n          var parent_node = node.parentNode;\n          var previous_sibling = node.previousSibling;\n\n          // Get list element.\n          var list_element = _buildList(node, head_style_hash);\n\n          // Find the element to insert the new list before it.\n          var before_element = null;\n\n          // Current node was not the first.\n          if (previous_sibling) {\n            before_element = previous_sibling.nextSibling;\n          }\n          else {\n            before_element = parent_node.firstChild;\n          }\n\n          // Insert before.\n          if (before_element) {\n            parent_node.insertBefore(list_element, before_element);\n          }\n\n          // Push to the end.\n          else {\n            parent_node.appendChild(list_element);\n          }\n\n          return false;\n        }\n        else {\n\n          return _cleanElement(node, head_style_hash);\n        }\n      }\n\n      // Comment node.\n      else if (node.nodeType == Node.COMMENT_NODE) {\n        _removeNode(node);\n\n        return false;\n      }\n\n      return true;\n    });\n\n    // Remove empty tags and clean duplicate styles.\n    _traverse(body, function (node) {\n\n      // Element node.\n      if (node.nodeType == Node.ELEMENT_NODE) {\n\n        var tag_name = node.tagName;\n\n        // Empty. Skip br tag.\n        if (!node.innerHTML && ['BR', 'IMG'].indexOf(tag_name) == -1) {\n          var parent = node.parentNode;\n\n          // Remove recursively.\n          while (parent) {\n            _removeNode(node);\n            node = parent;\n\n            // Stop when non-empty element is found.\n            if (node.innerHTML) {\n              break;\n            }\n            parent = node.parentNode;\n          }\n\n          return false;\n        }\n        else {\n          _cleanStyleDuplicates(node);\n        }\n      }\n\n      return true;\n    });\n\n    // Converd document to string.\n    var word_doc_string = body.outerHTML;\n\n    // Clean HTML.\n    var htmlAllowedStylePropsCopy = editor.opts.htmlAllowedStyleProps;\n    editor.opts.htmlAllowedStyleProps = editor.opts.wordAllowedStyleProps;\n\n    word_doc_string = editor.clean.html(word_doc_string, editor.opts.wordDeniedTags, editor.opts.wordDeniedAttrs, false);\n\n    editor.opts.htmlAllowedStyleProps = htmlAllowedStylePropsCopy;\n\n    return word_doc_string;\n  }\n\n  return {\n    _init: _init,\n    clean: clean\n  };\n};\n"],"names":["$","prototype","contains","obj","Array","isArray","i","length","nodeType","Node","ELEMENT_NODE","findVisible","selector","$els","find","isVisible","splice","css","attr","Element","matches","msMatchesSelector","webkitMatchesSelector","closest","s","el","document","documentElement","parentElement","parentNode","matchesSelector","mozMatchesSelector","oMatchesSelector","ownerDocument","querySelectorAll","item","arg","Object","toString","call","constructor","firstElementChild","defineProperty","get","node","nodes","childNodes","window","DEFAULTS","initOnClick","pluginsEnabled","MODULES","PLUGINS","VERSION","INSTANCES","OPTS_MAPPING","SHARED","ID","FroalaEditor","options","Bootstrap","fn","froalaEditor","option","arg_list","arguments","push","returns","each","$this","editor","data","console","warn","context","nm","indexOf","split","returned_value","apply","slice","undefined","error","that","assign","defaults","Constructor","FE","XS","SM","MD","LG","x","LinkRegExCommon","LinkRegExEnd","LinkRegExTLD","LinkRegExHTTP","LinkRegExAuth","LinkRegExWWW","LinkRegEx","LinkProtocols","MAIL_REGEX","helpers","_ieVersion","rv","ua","re","navigator","appName","userAgent","RegExp","exec","parseFloat","$1","_browser","browser","ie_version","msie","toLowerCase","match","matched","version","chrome","webkit","safari","isIOS","test","isWindowsPhone","isAndroid","isBlackberry","isMobile","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","callback","setTimeout","getPX","val","parseInt","screenSize","$test","doc","createElement","addClass","first","append","size","remove","ex","isTouch","DocumentTouch","isURL","url","String","replace","test_reg","isEmail","sanitizeURL","local_path","join","encodeURIComponent","propertyIsEnumerable","RGBToHex","rgb","hex","toUpperCase","HEXtoRGB","shorthandRegex","m","r","g","b","result","default_alignment","getAlignment","$block","alignment","$div","opts","direction","$el","l1","getBoundingClientRect","left","l2","is_mac","isMac","platform","_scopeShim","scopeRE","container","o_doc","overrideNodeMethod","methodName","oldMethod","query","nodeList","gaveId","gaveContainer","appendChild","id","Date","getTime","removeChild","e","HTMLElement","scrollTop","o_win","pageYOffset","body","scrollLeft","pageXOffset","isInViewPort","rect","top","bottom","innerHeight","clientHeight","_init","events","_events","_do_blur","_assignEvent","evs","handler","$on","_forPaste","trigger","type","_forElement","on","popups","areVisible","_forKeys","_forWindow","$win","_mousedown","enableBlur","_mouseup","_forDocument","$doc","focus","do_focus","info","$wp","core","hasFocus","st","$box","disableBlur","selection","atStart","isCollapsed","html","defaultTag","marker","markers","insert","blockParent","element","blockTagsQuery","prepend","MARKERS","restore","focused","_forFocus","blurActive","_forMouse","_move","_mousemove","_buttonMouseDown","$btn","currentTarget","edit","isDisabled","hasClass","preventDefault","which","parents","stopPropagation","_buttonMouseUp","stopImmediatePropagation","button","getButtons","removeClass","removeData","timeout","clearTimeout","bindClick","$element","name","names","callbacks","shared","unshift","$_events","ary","sid","eventName","trim","_$off","off","$off","count","args","force","$oel","triggerHandler","merge","chainTrigger","param","resp","_destroy","k","hasOwnProperty","_sharedDestroy","accessibility","can_blur","focusToolbarElement","is","inst","$f_el","focusToolbar","$tb","last","position","focusContentElement","saveSelection","focusContent","$content","backward","$first_input","filter","not","with_kb","$active_item","$first_tab_index","save","restoreSelection","focusPopup","$popup","$popup_content","children","$focused_item","blur","focusModal","$modal","clear","focusToolbars","_getActiveFocusedDropdown","$activeDropdown","prev","_moveHorizontally","tab_key","forward","click","$buttons","index","status","parent","moveForward","moveBackward","_moveVertically","down","$destination","next","nextAllVisible","prevAllVisible","moveDown","enter","moveUp","toolbarInline","focusPopupButton","$visible_popup","$visible_modal","modals","focusEditor","esc","hide","toolbar","showInline","ctrlKey","metaKey","keycode","KEYCODE","TAB","shiftKey","altKey","ARROW_RIGHT","ARROW_LEFT","ARROW_UP","ARROW_DOWN","ENTER","SPACE","ESC","F10","keys","isBrowserAction","registerToolbar","target","$hovered_el","registerPopup","ev","_getPopupEvents","_tiMouseenter","_tiKeydown","onHide","onShow","key_code","inputs","toArray","idx","Boolean","tagName","$active_button","_clearPopupButton","$popup_button","focusModalButton","$modal_button","_editorKeydownHandler","focused_content","getContents","isBlock","BLOCK_TAGS","isLink","isEmpty","ignore_markers","querySelector","contents","has_br","TEXT_NODE","textContent","VOID_ELEMENTS","htmlAllowedEmptyTags","htmlDoNotWrapTags","deepestParent","until","simple_enter","SIMPLE_ENTER_TAGS","rawAttributes","attrs","atts","attributes","att","nodeName","value","str","sort","clearAttributes","removeAttribute","openTagString","closeTagString","isFirstSibling","sibling","previousSibling","isLastSibling","nextSibling","isVoid","isList","isElement","isDeletable","getAttribute","activeElement","href","tabIndex","isEditable","cls","classList","acceptNode","htmlAllowedTags","htmlRemoveTags","htmlAllowedAttrs","htmlAllowedStyleProps","htmlAllowComments","htmlUntouched","fullPage","HTML5Map","B","I","STRIKE","clean","allowedTagsRE","removeTagsRE","allowedAttrsRE","allowedStylePropsRE","_removeInvisible","normalize","insertBefore","cloneNode","_toHTML","is_pre","COMMENT_NODE","nodeValue","outerHTML","temp","node_clone","innerHTML","scripts","_encode","dirty_html","_decode","a1","_cleanStyle","style","cleaned_style","charAt","_cleanAttrs","is_attr_allowed","allowed_style_props_matches","_rebuild","body_html","head_html","original_html","doctype","extractDoctype","html_attrs","extractNodeAttrs","extractNode","head_attrs","body_attrs","_process","func","implementation","createHTMLDocument","new_html","els","parse_head","b_html","h_html","invisibleSpaces","toHTML5","sel_saved","replaceWith","_convertHref","div","innerText","_node","_cleanPre","setAttribute","pasteAllowLocalImages","tg","new_node","insertAdjacentHTML","_run","pre","content","denied_tags","denied_attrs","full_page","allowed_tags","allowed_attrs","_tablesWrapTHEAD","trs","ok","j","tr","thead","firstChild","tables","_listsWrapMissplacedLI","lis","filterListItem","li","ul","tmp","li_sel","_listsJoinSiblings","sibling_lists","list","childs","_listsRemoveEmpty","do_remove","removeEmptyList","lst","empty_lis","remaining_lists","_listsWrapLists","direct_lists","prev_li","wrap","_listsNoTagAfterNested","nested_lists","$new_li","after","_listsTypeInNested","before","prev_node","_listsRemoveEmptyLI","_listsFindMissplacedText","lists","$li","indentMargin","COMMANDS","bold","title","toggle","refresh","format","toggleClass","italic","underline","strikeThrough","subscript","superscript","outdent","indent","undo","forcedRefresh","disabled","redo","insertHR","clearFormatting","selectAll","RegisterCommand","commands","_createDefaultTag","empty","mapping","_execCommand","run","_processIndent","show","$hr","removeAttr","check","default_tag","setAfter","setBefore","execCommand","cmd","params","accessibilityFocus","saveStep","tag","blocks","prop","margin_left","width","Math","max","unwrap","callExec","isArrow","setAtEnd","setAtStart","s_el","e_el","endElement","disableDesign","mozilla","addEventListener","spaces","_normalizeNode","browser_way","p_node","n_node","txt","parent_node","isPreformatted","UNICODE_NBSP","new_text","t","charCodeAt","win","getComputedStyle","display","walker","createTreeWalker","NodeFilter","SHOW_TEXT","temp_node","nextNode","currentNode","normalizeAroundCursor","next_node","INVISIBLE_SPACE","START_MARKER","END_MARKER","_build","$span","place","range","mk","boundary","cloneRange","collapse","insertNode","collapsed","dom_marker","ranges","commonAncestorContainer","original_range","addRange","deep_parent","cursor","isAtStart","isAtEnd","close_str","open_str","h","insertAtPoint","clientX","y","clientY","start","caretPositionFromPoint","createRange","setStart","offsetNode","offset","setEnd","caretRangeFromPoint","startContainer","startOffset","getSelection","sel","removeAllRanges","createTextRange","moveToPoint","end_range","duplicate","setEndPoint","select","text","getRangeAt","rangeCount","child","node_found","p","endContainer","endOffset","rangeElement","rangeContainer","blks","block_parent","inEditor","rngs","start_node","end_node","was_into","rgs","new_ranges","start_m","end_m","setStartAfter","setEndBefore","edge","start_marker","end_marker","ghost","special_case","s_node","e_node","first_node","last_node","len","createTextNode","_normalizedMarker","setStartBefore","setEndAfter","_canDelete","parentsUntil","atEnd","selRange","testRange","selectNodeContents","moveToElementText","isFull","full","inf","_emptyInnerNodes","_filterFrInner","_processNodeDelete","$node","should_delete","keepFormatOnDelete","_prevSibling","_nextSibling","start_markers","sm","end_markers","em","$first_node","start_parent","end_parent","list_start","list_end","tmp_node","clone","fillEmptyBlocks","cleanEmptyTags","last_marker","first_marker","deep","getElementsByClassName","lastChild","span","nd","use_current_node","language","LANGUAGE","lang","translate","translation","placeholderText","placeholder","$placeholder","_add","margin_offset","iframe","$iframe","outerHeight","margin_top","margin_right","padding_top","padding_left","padding_right","ready","marginTop","paddingTop","paddingLeft","marginLeft","paddingRight","marginRight","textAlign","fromCharCode","htmlSimpleAmpersand","htmlIgnoreCSSProperties","htmlExecuteScripts","ENTER_P","ENTER_DIV","ENTER_BR","look_up","emptyBlocks","around_markers","empty_blocks","qr","found","emptyBlockTagsQuery","remove_blocks","NO_DELETE_TAGS","elms","_wrapElement","main_doc","createDocumentFragment","anchor","changed","_wrapElements","_wrap","blockquote","inner","wp_st","block","cleanBlankSpaces","is_block_or_element","_extractMatch","reg_exp","_newDoctype","string","createDocumentType","getDoctype","publicId","systemId","_processBR","br","cleanBRs","brs","getElementsByTagName","_normalize","checkIfEmpty","$dv","_setHtml","set","clean_html","head_bad_html","map","spellcheck","$head","$html","iframe_document","replaceChild","injectStyle","iframeDefaultStyle","iframeStyle","useClasses","_specifity","idRegex","attributeRegex","classRegex","pseudoElementRegex","pseudoClassWithBracketsRegex","pseudoClassRegex","elementRegex","regex","_processOnGet","_el","_sortElementsBySpec","a","keep_markers","keep_classes","updated_elms","elms_info","elems_specs","ignoreRegEx","styleSheets","rules","head_style","cssRules","ownerNode","selectorText","cssText","spec","css_text","rule","specs_elem","original_rules","splits","original_rule","heightMin","getSelected","wrapSelection","wrapInner","selectionParent","cloneContents","htmlText","_hasBlockTags","_setCursorAtEnd","escapeEntities","_unwrapForLists","default_tag_els","insertAfter","do_split","positionCaret","cleanWhiteTags","ignore_selection","current_el","current_white","total_white","possible_elements","removed","_cleanTags","editorClass","typingTimer","requestWithCORS","requestWithCredentials","requestHeaders","iframeStyleFiles","zIndex","disableRightClick","scrollableContainer","theme","$link","syncIframe","_initElementStyle","_initStyle","_initDrag","drag_support","filereader","FileReader","formdata","FormData","progress","XMLHttpRequest","getXHR","method","xhr","open","withCredentials","header","setRequestHeader","sameInstance","$obj","_original_html","autofocus","destroy","cursorLists","_firstParentLI","_firstParentList","_startEnter","next_li","o_str","c_str","br_str","new_str","ndx","_middleEnter","_endEnter","end_str","start_str","add_invisible","_backspace","_del","_atEnd","_atStart","_isAtStart","_isAtEnd","_inLi","_getExtremityCharacterLength","special_chars_regex","_startBackspace","quote","current_block","m_parent","prev_children","_middleBackspace","substring","tabSpaces","tab_str","substr","deleted","t_node","copy_node","backspace","do_default","_cleanEmptyBlockquotes","_endDel","_middleDel","del","_cleanNodesToRemove","shift","c_node","open_default_tag","close_default_tag","add","default","c","E","l","u","n","domain","C","cookie","d","f","A","o","D","abs","v","F","endsWith","FEK","localStorage","key","Image","src","_openTag","_closeTag","_query","_matches","_processNodeFormat","$marker","inner_spans","$mk","_split","$p_node","node_str","p_html","_processNodeRemove","should_remove","reassess","$clone","_cleanFormat","elem","$elem","_filterSpans","applyStyle","$parent","_splitParents","class","$child","$outer_span","to_remove","ic_str","io_str","$spans","msp","just_spans","$x","$p","removeStyle","f_child","BACKSPACE","SHIFT","CTRL","ALT","DELETE","ZERO","ONE","TWO","THREE","FOUR","FIVE","SIX","SEVEN","EIGHT","NINE","FF_SEMICOLON","FF_EQUALS","QUESTION_MARK","G","H","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","META","NUM_ZERO","NUM_ONE","NUM_TWO","NUM_THREE","NUM_FOUR","NUM_FIVE","NUM_SIX","NUM_SEVEN","NUM_EIGHT","NUM_NINE","NUM_MULTIPLY","NUM_PLUS","NUM_MINUS","NUM_PERIOD","NUM_DIVISION","F1","F2","F3","F4","F5","F6","F7","F8","F9","F11","F12","FF_HYPHEN","SEMICOLON","DASH","EQUALS","COMMA","HYPHEN","PERIOD","SLASH","APOSTROPHE","TILDE","SINGLE_QUOTE","OPEN_SQUARE_BRACKET","BACKSLASH","CLOSE_SQUARE_BRACKET","IME","multiLine","_enter","_shiftEnter","_ctlBackspace","deleteContents","modify","_space","_input","start_container","start_offset","_cut","bulkRefresh","_tab","_mapKeyPress","_clearIME","isIME","key_down_code","_empty","_mapKeyDown","sel_el","char_key","isCharacter","del_key","_replaceU200B","height","heightMax","getBoundingRect","toolbarBottom","toolbarStickyOffset","_mapKeyUp","has_invisible","ios_CJK","CJKRegEx","_typing_timeout","_temp_snapshot","_typingKeyDown","snapshot","canDo","_typingKeyUp","forceUndo","_isEmpty","_allowTypingOnEdges","dt","offsetY","_clearTypingTimer","pastePlain","pasteDeniedTags","pasteDeniedAttrs","pasteAllowedStyleProps","paste","clipboard_html","clipboard_rtf","$paste_div","saveCopiedText","plain","setItem","_handleCopy","copied_html","stop_paste","_handlePaste","originalEvent","clipboardData","getData","types","clipboard_types","_processPaste","_beforePaste","_dropPaste","dataTransfer","$sc","_wordClean","word_tags","oldHTML","p_li","previousElementSibling","_plainPasteClean","cleanComments","is_word","response","_isFromEditor","possible_text","getItem","_buildTabs","tabs","keep_formatting","is_gdocs","is_editor_content","htmlAllowedStylePropsCopy","cleanEmptyTagsAndDivs","wordPaste","spans","selection_el","in_list","removeEmptyTags","_afterPaste","getRtfClipboard","_filterNoAttrs","arry","divs","dv","empty_tags","capture","removeEventListener","shortcutsEnabled","shortcutsHint","SHORTCUTS_MAP","RegisterShortcut","letter","shortcuts","inverse_map","srct","active","map_key","_getNodeIndex","prevNode","isEmptyText","twoTexts","_getNodeLocation","loc","reverse","_getRealNodeOffset","_getRange","scLoc","scOffset","ecLoc","ecOffset","_getNodeByLocation","_restoreRange","range_snapshot","startNode","endNode","equal","s1","s2","JSON","stringify","_disableBrowserUndo","keyCode","undo_stack","undo_index","canRedo","last_html","undoing","dropRedo","pop","_do","_content_changed_timer","hideAll","enable","_redo","reset","tooltips","tooltip","$tooltip","to","above","outerWidth","ceil","bind","buttons","toolbarContainer","popup_buttons","_filterButtons","butons_list","search_dropdowns","$filtered_buttons","$button","$dropdown_menu_items","$popup_buttons","$modal_hash","$modal_buttons","_dropdownButtonClick","$dropdown","$active_dropdowns","refreshOnShow","ht","$active_element","_commandButtonClick","refreshAfterCallback","_click","hideActiveDropdowns","_dropdownMenuClick","_dropdownWrapperClick","bindCommands","tooltipAbove","_document","_window","defaultView","parentWindow","hideDropdowns","_content","command","shortcut","visible","showOnMobile","display_selection","displaySelection","icon","default_selection","defaultSelection","displaySelectionWidth","create","popup","modal","button_id","dropdown_id","btn","getTemplate","back","dropdown","buildList","visible_buttons","cmd_name","cmd_info","plugin","_bulkRefresh","btns","refresh_timeout","delayedBulkRefresh","ICON_TEMPLATES","font_awesome","font_awesome_5","font_awesome_5r","font_awesome_5l","image","svg","ICONS","NAME","color","FA5NAME","DefineIconTemplate","DefineIcon","iconsTemplate","template","ICON_DEFAULT_TEMPLATE","$overlay","_modalHTML","head","close_button","$tmp","$body","modalHash","init","resize","$wrapper","allWrapperHeight","exteriorBodyHeight","maxHeight","body_content_height","scrollHeight","newHeight","new_instance","POPUP_TEMPLATES","RegisterTemplate","setContainer","$container","refreshContainer","obj_height","is_visible","at","_repositionPopup","_unmarkExit","_bindInstanceEvents","onRefresh","except","exit_flag","_markExit","_canExit","_buildTemplate","editInPopup","_windowResize","_inputFocus","$target","_inputBlur","_editorKeydown","_preventFocus","originalTarget","input_selector","_editorMouseup","_windowMouseup","_windowKeydown","FocusPopupButton","_doPlaceholder","$label","p_top","w_height","boundingRect","right","_topNormalized","p_offset","new_top","s_height","_leftNormalized","clientWidth","forSelection","selection_rect","offsetWidth","new_left","$arrow","_updateIOSSticky","is_on","prev_top","scheduled_top","$dummy","x_scroll","x_top","min","c_scroll","c_top","_updateSticky","viewport_height","scrollable_top","scrollable_bottom","offset_top","parent_top","parent_height","skip_setting_fixed","el_top","el_bottom","isFixedToTop","isFixedToBottom","at_top","at_bottom","_testSticky","mStyle","animate","_stickyElements","_initSticky","addSticky","_setDisabled","textEdit","_initPopup","_showPopup","_initEvents","update","toolbarButtons","toolbarButtonsXS","toolbarButtonsSM","toolbarButtonsMD","toolbarSticky","toolbarVisibleWithoutSelection","TOOLBAR_BUTTONS","TOOLBAR_BUTTONS_MD","TOOLBAR_BUTTONS_SM","TOOLBAR_BUTTONS_XS","_buttons_map","_addOtherButtons","_addButtons","_buttons","_screenButtons","buttons_list","screen_size","_showScreenButtons","c_buttons","_setVisibility","tm","_showInlineWithTimeout","_initInlineBehavior","setInterval","_initPositioning","_setDefaults","disable","load","doInit","opts_string","tag_name","initOnDefault","contentWindow","write","close","initOnTextarea","initOnA","initOnImg","module_list","m_name","center","justify","align","charCounterMax","charCounterCount","charCounter","$counter","_checkCharNumber","_checkCharNumberOnPaste","_updateCharNumber","chars","scroll_size","codeBeautifier","acorn","exports","nonASCIIidentifierStartChars","nonASCIIidentifierChars","nonASCIIidentifierStart","nonASCIIidentifier","newline","lineBreak","source","allLineBreaks","isIdentifierStart","code","isIdentifierChar","html_source","ltrim","rtrim","multi_parser","indent_inner_html","indent_size","indent_character","wrap_line_length","brace_style","unformatted","preserve_newlines","max_preserve_newlines","indent_handlebars","wrap_attributes","wrap_attributes_indent_size","end_with_newline","extra_liners","max_char","indent_char","isNaN","concat","indent_with_tabs","Parser","pos","token","current_mode","tags","parentcount","parent1","tag_type","token_text","last_token","last_text","token_type","newlines","indent_content","Utils","whitespace","single_token","in_array","what","arr","is_whitespace","traverse_whitespace","input_char","input","space_or_wrap","line_char_count","print_newline","print_indentation","get_content","peek3","get_tag","get_contents_to","reg_match","lastIndex","reg_array","end_script","record_tag","indent_level","retrieve_tag","temp_parent","indent_to_tag","peek","comment","space","first_attr","tag_start","tag_end","tag_start_char","orig_pos","orig_line_char_count","get_unformatted","get_comment","tag_complete","tag_index","tag_offset","tag_check","is_unformatted","search","output","start_pos","delimiter","orig_tag","min_index","get_token","tag_name_type","get_full_indent","level","indent_string","next_tag","printer","js_source","print_token","print_token_raw","unindent","tag_extracted_from_last_output","_beautifier","script_indent_level","js_beautify","css_beautify","indent_scripts","indentation","white","_level","reindent","sweet_code","source_text","NESTED_AT_RULE","CONDITIONAL_GROUP_RULE","indentSize","indentCharacter","selectorSeparatorNewline","selector_separator_newline","newline_between_rules","eol","whiteRe","ch","parenLevel","skipWhitespace","prev_pos","eatWhitespace","eatString","endChars","peekString","endChar","eatComment","singleLine","lookBack","foundNestedPseudoClass","openParen","basebaseIndentString","singleIndent","indentLevel","nestedLevel","print","singleSpace","newLine","_lastCharWhitespace","keepWhitespace","preserveSingleSpace","isAfterSpace","insideRule","insidePropertyValue","enteringConditionalGroup","top_ch","last_top_ch","isAfterNewline","variableOrRule","sweetCode","js_source_text","beautifier","Beautifier","beautify","MODE","BlockStatement","Statement","ObjectLiteral","ArrayLiteral","ForInitializer","Conditional","Expression","tokens","token_pos","Tokenizer","current_token","last_type","last_last_text","flags","previous_flags","flag_store","prefix","handlers","opt","baseIndentString","handle_start_expr","handle_end_expr","handle_start_block","handle_end_block","handle_word","handle_semicolon","handle_string","handle_equals","handle_operator","handle_comma","handle_block_comment","handle_comment","handle_dot","handle_unknown","handle_eof","create_flags","flags_base","mode","next_indent_level","indentation_level","just_added_newline","line_indent_level","next_flags","last_word","declaration_statement","declaration_assignment","multiline_frame","if_block","else_block","do_block","do_while","in_case_statement","in_case","case_body","start_line_index","get_line_number","ternary_depth","braces_on_own_line","break_chained_methods","space_in_paren","space_in_empty_paren","jslint_happy","space_after_anon_function","keep_array_indentation","space_before_conditional","unescape_strings","e4x","comma_first","test_output_raw","preindent_index","Output","raw","set_mode","local_token","tokenizer","tokenize","comments_before","handle_token","get_code","keep_whitespace","is_array","split_newlines","out","allow_wrap_or_preserved_newline","force_linewrap","wanted_newline","proposed_line_length","current_line","get_character_count","space_before_token","force_newline","preserve_statement_flags","restore_mode","add_new_line","print_token_line_indentation","whitespace_before","set_indent","printable_token","add_raw_token","previous_line","add_token","deindent","is_expression","remove_redundant_indentation","start_of_object_property","start_of_statement","all_lines_start_with","lines","line","each_line_matches_indent","is_special_word","word","next_mode","line_starters","next_token","second_token","empty_braces","empty_anonymous_function","just_added_blankline","space_before","space_after","directives","javadoc","starless","lastIndent","lastIndentLength","OutputLine","_character_count","_indent_count","_items","baseIndentLength","indent_length","is_empty","remove_indent","indent_cache","add_outputline","add_space_before_token","frame","output_length","eat_newlines","Token","digit","digit_oct","digit_hex","punct","reserved_words","block_comment_pattern","comment_pattern","directives_block_pattern","directive_pattern","directives_end_ignore_pattern","template_pattern","n_newlines","whitespace_before_token","in_html_comment","parser_pos","input_length","token_values","open_stack","comments","tokenize_next","get_directives","directive_match","resulting_string","whitespace_on_this_line","allow_decimal","allow_e","local_digit","comment_match","sep","has_char_escapes","in_char_class","xmlRegExp","xmlStr","rootTag","depth","isEndTag","isSingletonTag","xmlLength","unescape_string","sharp","template_match","s_hex","escaped","codeMirror","CodeMirror","codeMirrorOptions","lineNumbers","tabMode","indentWithTabs","lineWrapping","tabSize","codeBeautifierOptions","codeViewKeepActiveButtons","codeView","$html_area","code_mirror","isActive","getValue","setSize","_showText","_can_focus","_blur","_focus","_showHTML","_initArea","fromTextArea","rows","was_focused","s_index","e_index","s_line","e_line","lastIndexOf","setValue","setSelection","clearHistory","scroll_top","setSelectionRange","toTextArea","$back_button","cancel","colorsText","colorsBackground","colorsStep","colorsHEXInput","colorsDefaultTab","colorsButtons","colors","_showColorsPopup","_initColorsPopup","_refreshColor","_hideColorsPopup","colors_buttons","_colorsTabsHTML","custom_color","text_colors","_colorPickerHTML","background_colors","_addAccessibility","tabs_html","tab","colors_html","$colors","columns","floor","column","nextIndex","dimension","color_type","$current_color","$select_color","$input","_changeSet","$tab","siblings","background","customColor","showColorsPopup","hideColorsPopup","changeSet","refreshOnCallback","dragInline","draggable","_dragStart","setData","_tagOK","tag_under","_setHelperSize","$draggable_helper","_positionHelper","elementFromPoint","pageX","pageY","top_offset","top_tag","bottom_offset","bottom_tag","mouse_y","$tag_under","margin","appendTo","_dragOver","dropEffect","_getDraggedEl","_dragEnter","_documentDragEnd","$draggedEl","_drop","$droppedEl","_cleanOnGet","emoticons","emoticonsStep","emoticonsSet","desc","emoticonsButtons","emoticonsUseImage","_showEmoticonsPopup","_initEmoticonsPopup","_hideEmoticonsPopup","emoticons_buttons","_emoticonsHTML","_inEmoticon","emoticons_html","$tabElements","$emoticons","emoticon","img","setDeletable","emtcs","className","showEmoticonsPopup","hideEmoticonsPopup","entities","_reg_exp","_map","_encodeEntities","entities_text","entities_array","chr","fileUpload","fileUploadURL","fileUploadParam","fileUploadParams","fileUploadToS3","fileUploadMethod","fileMaxSize","fileAllowedTypes","fileInsertButtons","fileUseSelectedText","file","BAD_LINK","MISSING_LINK","ERROR_DURING_UPLOAD","BAD_RESPONSE","MAX_SIZE_EXCEEDED","BAD_FILE_TYPE","NO_CORS_IE","error_messages","showInsertPopup","_initInsertPopup","hideProgressBar","showProgressBar","_setProgressMessage","dismiss","message","$layer","_showErrorMessage","$message_header","link","$file","_syncFiles","_parseResponse","parse","_throwError","_parseXMLResponse","_fileUploaded","responseXML","responseText","_fileUploadError","_fileUploadProgress","lengthComputable","complete","loaded","total","_fileUploadAborted","upload","files","form_data","keyStart","uploadURL","region","bucket","onload","onerror","onprogress","onabort","readyState","abort","send","_bindInsertEvents","_hideInsertPopup","delayed","file_buttons","upload_layer","progress_bar_layer","progress_bar","_onRemove","c_files","file_srcs","fontFamily","fontFamilySelection","fontFamilyDefaultSelection","_getSelection","$list","$active","_getArray","font_array","array1","array2","font_matches","c_font_array","f_diff","fontSize","fontSizeSelection","fontSizeDefaultSelection","fontSizeUnit","formEditButtons","formStyles","formMultipleStyles","formUpdateButtons","forms","current_input","_inputMouseDown","_inputMouseUp","showEditPopup","_cancelSelection","_inputTouchMove","_bindEvents","_initUpdatePopup","getInput","_initEditPopup","_refreshUpdateCallback","_hideUpdateCallback","text_layer","tab_idx","showUpdatePopup","multipleStyles","styles","updateInput","fullscreen","old_scroll","max_height","z_index","_on","$parent_node","_off","helpSets","help","modal_id","_buildBody","group","imageInsertButtons","imageEditButtons","imageAltButtons","imageSizeButtons","imageUpload","imageUploadURL","imageCORSProxy","imageUploadRemoteUrls","imageUploadParam","imageUploadParams","imageUploadToS3","imageUploadMethod","imageMaxSize","imageAllowedTypes","imageResize","imageResizeWithPercent","imageRoundPercent","imageDefaultWidth","imageDefaultAlign","imageDefaultDisplay","imageSplitHTML","imageStyles","imageMove","imageMultipleStyles","imageTextNear","imagePaste","imagePasteProcess","imageMinWidth","imageOutputSize","imageDefaultMargin","$current_image","$image_resizer","$handler","mousedown","CORRUPTED_IMAGE","_refreshInsertPopup","$url_input","_showEditPopup","getEl","hasCaption","_convertStyleToClasses","$img","getAlign","getDisplay","_convertClassesToStyle","_setStyle","_refreshImageList","images","_syncImages","c_images","image_srcs","old_images_srcs","_repositionResizer","_initImageResizer","wrap_correction_top","wrap_correction_left","_getHandler","_setWidth","_handlerMousedown","start_x","touches","oel","editor_inside_iframe","location","frameElement","clientLeft","toFixed","_handlerMousemove","real_image_size","c_x","s_x","diff_x","round","_handlerMouseup","_editImg","image_buttons","no_message","_exitEdit","insertByURL","img_url","Blob","responseType","_edit","_loadedCallback","sanitize","$existing_img","old_src","_addImage","_imageUploaded","_imageUploadError","_imageUploadProgress","loadCallback","data_str","_imageUploadAborted","_startUpload","$image_placeholder","_sendRequest","reader","binary","atob","array","URL","createObjectURL","Uint8Array","readAsDataURL","_beforeElementDrop","_selectImage","uploadIndex","urlIndex","by_url_layer","_refreshAltPopup","showAltPopup","_initAltPopup","alt_layer","setAlt","alt","_refreshSizePopup","showSizePopup","_initSizePopup","size_layer","showLayer","refreshUploadButton","refreshByURLButton","_resizeImage","initPageX","step","pow","$img_overlay","prevKey","prevTimestamp","timeStamp","imgs","touchScroll","_clipboardPaste","_clipboardPasteCleanup","_uploadPastedImages","_processPastedImage","upload_img","_img","crossOrigin","canvas","getContext","naturalHeight","naturalWidth","drawImage","toDataURL","_clipboardImageLoaded","_processsClipboardPaste","items","getAsFile","force_exit","img_exit_flag","_display","_align","verticalAlign","marginBottom","maxWidth","flt","refreshAlign","refreshAlignOnShow","refreshDisplayOnShow","selectNode","babelHelpers.typeof","toggleCaption","exitEdit","inline","imageAlign","imageManagerLoadURL","imageManagerLoadMethod","imageManagerLoadParams","imageManagerPreloader","imageManagerDeleteURL","imageManagerDeleteMethod","imageManagerDeleteParams","imageManagerPageSize","imageManagerScrollOffset","imageManagerToggleTags","imageManager","$preloader","$media_files","$image_tags","page","image_count","loaded_images","column_number","ERROR_DURING_LOAD","MISSING_LOAD_URL_OPTION","LOAD_BAD_RESPONSE","MISSING_IMG_THUMB","MISSING_IMG_URL","ERROR_DURING_DELETE","MISSING_DELETE_URL_OPTION","_delayedInit","_loadImages","_columnNumber","window_width","_buildColumns","_processLoadedImages","_infiniteScroll","_loadImage","$img_container","_resizeModal","thumb","_imageHasTag","_getImages","_reorderImages","_shortestColumn","$col","min_height","col","$column","from","get_images","$image","infinite_scroll","cols","_getImageAttrs","img_attributes","img_data","_insertImage","_updateTags","_showImagesByTags","_deleteImage","confirm","_toggleTags","title_height","tags_height","$tags","_selectTag","$tag","require","Error","inlineStyles","inlineStyle","new_split","lineBreakerTags","lineBreakerOffset","lineBreakerHorizontalOffset","lineBreaker","$line_breaker","mouseDownFlag","mouseMoveTimer","_show","$tag1","$tag2","breakerTop","breakerLeft","breakerWidth","parent_tag","parent_bottom","tag_top","tag_bottom","tag1_bottom","tag2_top","_checkTagSiblings","mouseY","$sibling","_checkTag","_isInWp","inFroalaWrapper","o_tag","_tagAt","_searchTagVertically","_searchTagHorizontally","limit","_tagUnder","_mouseTimer","_hide","_mouseDown","_mouseUp","_doLineBreak","instance","_initLineBreaker","linkEditButtons","linkInsertButtons","linkAttributes","linkAutoPrefix","linkStyles","linkMultipleStyles","linkConvertEmailAddress","linkAlwaysBlank","linkAlwaysNoFollow","linkNoOpener","linkNoReferrer","linkList","displayText","linkText","c_el","allSelected","selectedLinks","containerEl","links","linkRange","compareBoundaryPoints","END_TO_START","START_TO_END","compareEndPoints","_hideEditPopup","link_buttons","text_inputs","check_inputs","_showInsertPopup","checkmark","input_layer","imageLink","usePredefined","insertCallback","marker_str","original_href","rel","$pop","$ref","$prev","_openFlag","_closeFlag","_replace","$l","_format","start_margin","open_tag","end_tag","_unformat","li_class","li_attrs","_shouldUnformat","do_unformat","_indent","nl","prev_nl","$new_nl","_outdent","_afterCommand","do_indent","paragraphFormat","H1","H2","H3","H4","PRE","paragraphFormatSelection","paragraphDefaultSelection","_styleLiWithoutBlocks","_styleLiWithBlocks","$blk","_styleTdWithBlocks","_style","BLOCKQUOTE","blk","paragraphStyles","paragraphMultipleStyles","paragraphStyle","print_iframe","overflow","frames","frame_doc","forEach","style_el","style_elements","link_el","new_link_el","media","quickInsertButtons","quickInsertTags","QUICK_INSERT_BUTTONS","PATH","RegisterQuickInsertButton","requiredPlugin","$qi_image_input","quickInsert","res","prompt","video","embedly","table","$quick_insert","_place","qiTop","qiLeft","qiTagAlign","$helper","_showQIHelper","_hideHelper","_initquickInsert","deep_tag","_enterInBR","_enterInP","$qi_helper","btns_html","$helpper","_deepestParent","_increase","$quote","_decrease","increase","decrease","saveInterval","saveURL","saveParams","saveParam","saveMethod","_timeout","_last_html","_force","ERROR_ON_SERVER","event_returned_value","_mightSave","specialCharactersSets","specialCharacters","html_list","_focusChar","$char","$focused_char","$next_char","nextAll","prevAll","tableInsertMaxSize","tableEditButtons","tableInsertButtons","tableResizer","tableDefaultWidth","tableResizerOffset","tableResizingLimit","tableColorsButtons","tableColors","tableColorsStep","tableCellStyles","tableStyles","tableCellMultipleStyles","tableMultipleStyles","tableInsertHelper","tableInsertHelperOffset","$resizer","$insert_helper","mouseDownCellFlag","mouseDownCell","resizingFlag","_tableMap","_selectionOffset","selectedCells","table_buttons","rows_columns","_insertTableHtml","_hoverCell","$table_cell","row","$select_size","$cell","$focused_el","$cells","_colorsHTML","_addColorsAccessibility","setBackground","cell_width","$table","$current_table","selectedTable","addHeader","$td","removeHeader","$table_header","td","insertRow","ref_row","$ref_row","_currentSelection","min_i","max_i","deleteRow","$row","rowspan","$row_parent","_updateCellSpan","insertColumn","ref_col","min_j","max_j","old_width","new_width","col_no","td_no","ref_td","$ref_td","colspan","deleteColumn","_columnWidth","_updateColspan","first_span","_decreaseCellSpan","_updateRowspan","span_type","mergeCells","_removeKeyboardSelectionHandlers","cells","$first_cell","$first_row","first_row_cells","empty_trs","splitCellHorizontally","$selected_cell","$current_row","current_rowspan","cell_origin","_cellOrigin","$new_td","new_rowspan","_removeSelection","splitCellVertically","current_colspan","parent_width","new_colspan","_columnsWidth","$selected_cells","horizontalAlign","multiple_styles","classes","$tr","c_index","cspan","rspan","_cellEnds","origin_i","origin_j","_clearSelection","cellOrigin","cellEnd","_selectionLimits","first_i","last_i","first_j","last_j","$tl","$bl","_selectCells","firstCell","lastCell","firstCellOrigin","lastCellOrigin","limits","_getCellUnder","cell","_stopEdit","_resize","_hideResizer","_mouseEnter","_moveInNestedTable","new_map","_moveUp","_moveDown","_moveWithArrows","origin","up","nextElementSibling","_navigateWithArrows","_initResizer","$table_resizer","_mouseMove","_hideInsertHelper","_placeResizer","$table_parent","tag_left","tag_right","tag_origin","second","resizer_top","resizer_height","resizer_left","max_left","max_right","_showInsertColHelper","_initInsertHelper","mouseX","btn_width","_showInsertRowHelper","_insertHelper","tag_below","initial_positon","release_position","table_width","first_widths","first_percentages","second_widths","second_percentages","$second_cell","first_cell_percentage","table_percentage","left_margin","right_margin","col1","col2","left_limit","right_limit","_addMarkersInCell","_useTab","$ti_helper","_selectCellWithKeyboard","_selectCellsWithKeyboard","fixedCell","handlerCell","handlerOrigin","selected_cells","c_selected_cells","below","tableRows","tableColumns","tableCells","Top","Middle","Bottom","tableCellVerticalAlign","tableCellHorizontalAlign","URLRegEx","_linkReplaceHandler","p1","p2","dots","_getRegEx","_convertToLink","_isA","_lastPart","_inlineType","rel_attr","videoAllowedTypes","videoAllowedProviders","videoDefaultAlign","videoDefaultDisplay","videoDefaultWidth","videoEditButtons","videoInsertButtons","videoMaxSize","videoMove","videoResize","videoSizeButtons","videoSplitHTML","videoTextNear","videoUpload","videoUploadMethod","videoUploadParam","videoUploadParams","videoUploadToS3","videoUploadURL","VIDEO_PROVIDERS","test_regex","url_regex","url_text","provider","VIDEO_EMBED_REGEX","$video_resizer","$current_video","$embed_area","$video_obj","video_buttons","embedIndex","embed_layer","refreshEmbedButton","embedded_code","replaced","$video","_editVideo","insertHtmlVideo","$existing_video","_syncVideos","_addVideo","$current_video_obj","vp","insertEmbed","_videoUploaded","_videoUploadError","_videoUploadProgress","_videoUploadAborted","HAVE_FUTURE_DATA","c_y","clientTop","s_y","diff_y","_resizeVideo","$vid_overlay","videos","c_videos","video_srcs","_selectVideo","vid_exit_flag","vid","_refreshVideoList","videoAlign","wordDeniedTags","wordDeniedAttrs","wordAllowedStyleProps","wordPasteModal","_showModal","_buildModalBody","_hideModal","wordAllowedStylePropsBackup","_removeNode","_traverse","current_child","previous_child","_isList","_getListLevel","_getListContent","head_style_hash","cloned_node","heading","_cleanElement","_buildList","order_regex","is_ordered","list_tag","next_element_sibling","previous_element_sibling","next_level","next_element_sibling_copy","_changeTagName","old_node","attribute","_cleanTr","total_width","missing_width","width_attr","td_child","has_single_child","_cleanAlignment","class_attr","_normalizeAttribute","class_matches","xl_class","dot_xl_class","_appendStyle","valign","valign_matches","halign","halign_matches","background_color","background_matches","old_style","new_style","_cleanStyleDuplicates","style_list","style_hash","style_list_item","splited_style","number","_hexToBase64","hexa_chars","dec_chars","dec","btoa","_rtf_map","_getRtfData","rtf","p_type","bliptab_split","image_type","bracket_split","space_split","image_hex","_buildRtfMap","_cleanImage","vshapes_tag","_v_shapes_map","image_base64","data_uri","tag_name_lower_case","ignore_tags","class_contents","class_content","style_attrs","style_attr","paragraph_tag_list","el_class","cleaned_class","paragraph_style","paragraph_text_align","paragraph_style_matches","getNamedItem","_parseHeadStyle","head_styles","style_definitions","style_attrs_array","_getVShapes","oid","parser","DOMParser","word_doc","parseFromString","previous_sibling","list_element","before_element","word_doc_string"],"mappings":"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"}